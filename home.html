<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wareed - Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/ar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>



    <style>
        :root {
    --bg-color: #0d0d0f;
    --card-color: #161616;
    
    /* ğŸ”¥ Ù‡Ù†Ø§ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù‡Ù…: ØºÙŠØ±Ù†Ø§ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ Ù„Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨ÙˆØ±ÙŠØ¯ */
    --primary-color: #00C6FF;  /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø³Ù…Ø§ÙˆÙŠ ÙØ§ØªØ­) */
    --primary-solid: #0072FF;  /* Ù„ÙˆÙ† Ø§Ù„Ø¸Ù„Ø§Ù„ (Ø£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚) */
    
    --text-color: #eee;
    --secondary-text: #aaa;
    --border-color: #222;
    --danger-color: #ff3b30;
    --success-color: #34c759;
    --input-bg: #1f1f1f;
    --header-bg: rgba(22, 22, 22, 0.98);
    --sheet-bg: #1e1e1e;
    --glass-bg: rgba(255, 255, 255, 0.05);
}

        body.light-mode {
    --bg-color: #f0f2f5;         /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù…Ø±ÙŠØ­ Ù„Ù„Ø¹ÙŠÙ† (Ø²ÙŠ ÙÙŠØ³Ø¨ÙˆÙƒ) */
    --card-color: #ffffff;       /* ÙƒØ±ÙˆØª Ø¨ÙŠØ¶Ø§Ø¡ */
    
    --text-color: #050505;       /* Ù†Øµ Ø£Ø³ÙˆØ¯ ØºØ§Ù…Ù‚ Ø¬Ø¯Ø§Ù‹ */
    --secondary-text: #65676b;   /* Ù†Øµ Ø«Ø§Ù†ÙˆÙŠ Ø±Ù…Ø§Ø¯ÙŠ Ù…ØªÙˆØ³Ø· */
    
    --border-color: #ddd;        /* Ø­Ø¯ÙˆØ¯ Ø±Ù…Ø§Ø¯ÙŠØ© ÙˆØ§Ø¶Ø­Ø© */
    --input-bg: #e4e6eb;         /* Ø®Ù„ÙÙŠØ© Ø®Ø§Ù†Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø© */
    
    --header-bg: rgba(255, 255, 255, 0.95); /* Ù‡ÙŠØ¯Ø± Ø£Ø¨ÙŠØ¶ Ø´ÙØ§Ù */
    --sheet-bg: #ffffff;         /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¨ÙŠØ¶Ø§Ø¡ */
    --glass-bg: rgba(0, 0, 0, 0.05);
}


        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Cairo", sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-color); color: var(--text-color); padding-bottom: 80px; overflow-x: hidden; transition: 0.3s; user-select: none; }
        
        /* --- ÙƒØ±Ø© Ø§Ù„ÙŠÙˆØ±Ø§Ù†ÙŠÙˆÙ… --- */
        /* --- ÙƒØ±Ø© Ø§Ù„ÙŠÙˆØ±Ø§Ù†ÙŠÙˆÙ… (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ù…ÙƒØ§Ù†) --- */
/* --- ÙƒØ±Ø© Ø§Ù„ÙŠÙˆØ±Ø§Ù†ÙŠÙˆÙ… (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ù…ÙƒØ§Ù†) --- */
.uranium-orb {
    position: fixed; 
    bottom: 85px;      /* Ø±ÙØ¹Ù†Ø§Ù‡Ø§ ÙÙˆÙ‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø¹Ø´Ø§Ù† Ù…ØªØºØ·ÙŠØ´ Ø¹Ù„ÙŠÙ‡ */
    left: 15px;        /* Ø±ÙƒÙ†Ø§Ù‡Ø§ ÙÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ */
    width: 40px;       /* ØµØºØ±Ù†Ø§ Ø§Ù„Ø­Ø¬Ù… Ù…Ù† 55 Ù„Ù€ 40 */
    height: 40px;      /* ØµØºØ±Ù†Ø§ Ø§Ù„Ø­Ø¬Ù… */
    background: radial-gradient(circle at 30% 30%, #fff, var(--primary-color), #000);
    border-radius: 50%; 
    z-index: 9999; 
    cursor: grab;
    display: flex; 
    align-items: center; 
    justify-content: center;
    box-shadow: 0 0 15px var(--primary-color), inset -2px -2px 8px rgba(0,0,0,0.4); /* ØªØ®ÙÙŠÙ Ø§Ù„Ø¸Ù„ Ø´ÙˆÙŠØ© */
    touch-action: none; 
    transition: transform 0.2s; /* Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø© */
}

        
        .uranium-orb.red-alert {
            background: radial-gradient(circle at 30% 30%, #ffcccc, #ff0000, #4d0000) !important;
            box-shadow: 0 0 30px #ff0000, 0 0 60px #ff0000, 0 0 100px #ff0000 !important;
            animation: shake-hard 0.5s ease-in-out infinite !important; transform: scale(1.1);
        }

        .uranium-orb.super-mode {
            width: 70px; height: 70px;
            box-shadow: 0 0 80px var(--primary-color), 0 0 150px var(--primary-color), 0 0 30px #fff; 
            animation: super-pulse 0.2s infinite alternate; 
            z-index: 10001;
            background: radial-gradient(circle at 50% 50%, #fff, var(--primary-color));
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .satellites-container {
            position: absolute; width: 250px; height: 250px; 
            pointer-events: none; opacity: 0; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .uranium-orb.super-mode .satellites-container { opacity: 1; pointer-events: auto; }
        
        .sat-btn {
            position: absolute; width: 45px; height: 45px;
            background: rgba(20, 20, 20, 0.9); border: 2px solid var(--primary-color);
            border-radius: 50%; color: #fff; display: grid; place-items: center;
            font-size: 18px; box-shadow: 0 0 15px rgba(0,0,0,0.5);
            cursor: pointer; transition: 0.3s;
        }
        .sat-btn i { color: var(--primary-color); text-shadow: 0 0 5px var(--primary-color); }

        .orb-msg-bubble {
            position: absolute; bottom: 75px; left: 50%; transform: translateX(-50%) scale(0);
            background: rgba(220, 20, 60, 0.95); border: 1px solid #ff9999;
            color: #fff; padding: 8px 15px; border-radius: 15px 15px 15px 0;
            font-size: 13px; font-weight: bold; white-space: nowrap; max-width: 200px;
            overflow: hidden; text-overflow: ellipsis; box-shadow: 0 5px 20px rgba(0,0,0,0.6);
            opacity: 0; pointer-events: none; transition: 0.4s; z-index: 10002;
        }
    
        .orb-msg-bubble.show-msg { opacity: 1; transform: translateX(-50%) scale(1); }

        #deleteZone {
    position: fixed; 
    bottom: 90px; /* ğŸ”¥ Ù†Ø²Ù„Ù†Ø§Ù‡Ø§ Ø´ÙˆÙŠØ© Ø¨Ù‚Øª ÙÙˆÙ‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø¨Ø§Ù„Ø¸Ø¨Ø· */
    left: 50%; 
    transform: translateX(-50%) scale(0);
    width: 80px; 
    height: 80px; 
    border-radius: 50%;
    background: rgba(255, 0, 0, 0.1); 
    border: 2px dashed #ff0000;
    color: #ff0000; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    font-size: 30px; 
    transition: 0.3s; 
    z-index: 9998; 
    pointer-events: none;
}


        @keyframes pulse-orb { 0% { box-shadow: 0 0 15px var(--primary-color); } 100% { box-shadow: 0 0 35px var(--primary-color); } }
        @keyframes super-pulse { 0% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 60px var(--primary-color); } 100% { transform: translate(-50%, -50%) scale(1.15); box-shadow: 0 0 120px var(--primary-color); } }
        @keyframes shake-hard { 0%, 100% { transform: translate(0, 0); } 25% { transform: translate(-5px, 5px); } 75% { transform: translate(5px, -5px); } }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… --- */
       
/* 1. Ø¶Ø¨Ø· Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‡ÙŠØ¯Ø± */


/* 2. Ø¶Ø¨Ø· Ø§Ù„Ù„ÙˆØ¬Ùˆ (Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ù‚Ù„Ø¨) */
.premium-logo {
    display: flex;
    align-items: center;     /* Ø³Ù†ØªØ± Ø¹Ù…ÙˆØ¯ÙŠ */
    justify-content: center; /* Ø³Ù†ØªØ± Ø£ÙÙ‚ÙŠ */
    gap: 8px;
    flex: 1;                 /* ÙŠØ§Ø®Ø¯ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù†Øµ */
    height: 100%;            /* ÙŠØ§Ø®Ø¯ Ø·ÙˆÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± */
    
    /* Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø®Ø· */
    line-height: 1;          /* Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙ„Ø§Ù… Ù…ÙŠØ±Ø­Ù„Ø´ ÙÙˆÙ‚ Ø£Ùˆ ØªØ­Øª */
    
    direction: ltr;          /* Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ */
}
/* --- Ø¶Ø¨Ø· Ø­Ø¬Ù… ÙˆÙ…ÙƒØ§Ù† ÙƒÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø© --- */
.nav-item {
    flex: 1;                           /* ÙŠØ®Ù„ÙŠ ÙƒÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ§Ø®Ø¯ Ù…Ø³Ø§Ø­Ø© Ù‚Ø¯ Ø§Ù„ØªØ§Ù†ÙŠØ© */
    display: flex;
    align-items: center;
    justify-content: center;
    height: 45px;
    font-size: 22px;                   /* Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    cursor: pointer;
    position: relative;                /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ù…Ø± ÙŠØ¸Ù‡Ø± ÙÙˆÙ‚Ù‡Ø§ ØµØ­ */
}

.fb-icons {
    position: fixed !important;
    bottom: 20px !important;    /* Ù…Ø±ÙÙˆØ¹ Ø¹Ù† Ø§Ù„Ø£Ø±Ø¶ */
    left: 50% !important;
    transform: translateX(-50%) !important; /* ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø© */
    
    width: 90% !important;      /* Ø§Ù„Ø¹Ø±Ø¶ */
    max-width: 400px !important;
    height: 60px !important;    /* Ø§Ø±ØªÙØ§Ø¹ Ø·Ø¨ÙŠØ¹ÙŠ */
    
    /* Ø§Ù„Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
    background: rgba(22, 22, 22, 0.95) !important; 
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    
    /* Ø§Ù„Ø­ÙˆØ§Ù */
    border-radius: 50px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5) !important;
    
    z-index: 2147483647 !important; 
    
    /* ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
    display: flex !important;
    justify-content: space-around !important; /* Ù…Ø³Ø§ÙØ§Øª Ù…ØªØ³Ø§ÙˆÙŠØ© */
    align-items: center !important;
    padding: 0 5px !important;
}
/* ÙƒÙ„Ø§Ø³ Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø¨Ù†Ø¹ÙˆÙ…Ø© */
.fb-icons.hide-nav {
    transform: translate(-50%, 200%) !important; /* ÙŠÙ†Ø²Ù„ Ù„ØªØ­Øª Ø¨Ø¹ÙŠØ¯ Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
    opacity: 0 !important; /* ÙŠØ®ØªÙÙŠ */
    pointer-events: none; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡ ÙˆÙ‡Ùˆ Ù…Ø®ÙÙŠ */
}

/* --- 2. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¬Ø¯Ø§Ù‹) --- */
.nav-item {
    flex: 1 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: 100% !important;
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    transform: none !important; /* Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ Ø­Ø±ÙƒØ© */
    cursor: pointer;
}

.nav-item i {
    font-size: 22px !important;
    color: #888 !important; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ù„ØºÙŠØ± Ø§Ù„Ù†Ø´Ø· */
    transition: 0.2s;
}

/* --- 3. Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø· (ØªÙ„ÙˆÙŠÙ† ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† ØªÙƒØ¨ÙŠØ±) --- */
.nav-item.active {
    background: transparent !important;
    transform: none !important; /* Ù„Ø§ ÙŠØ·Ù„Ø¹ Ù„ÙÙˆÙ‚ ÙˆÙ„Ø§ ÙŠÙƒØ¨Ø± */
    box-shadow: none !important;
    border: none !important;
}

.nav-item.active i {
    color: var(--primary-color) !important; /* ÙŠØªÙ„ÙˆÙ† Ø¨Ø§Ù„Ø£Ø²Ø±Ù‚ Ø¨Ø³ */
    text-shadow: 0 0 10px rgba(0, 198, 255, 0.4); /* Ù„Ù…Ø¹Ø© Ø®ÙÙŠÙØ© */
}

/* --- 4. ØªÙ†Ø³ÙŠÙ‚ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…ØµØºØ±Ø© --- */
/* --- ØªÙ†Ø³ÙŠÙ‚ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…ØµØºØ±Ø© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ --- */
.nav-avatar-small {
    width: 28px;       /* Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© */
    height: 28px;      /* Ø·ÙˆÙ„ Ø§Ù„ØµÙˆØ±Ø© */
    border-radius: 50%; /* ØªØ¯ÙˆÙŠØ± ÙƒØ§Ù…Ù„ */
    background-size: cover; /* Ø§Ù„ØµÙˆØ±Ø© ØªØºØ·ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
    background-position: center; /* ØªÙˆØ³ÙŠØ· Ø§Ù„ØµÙˆØ±Ø© */
    background-color: #333; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ùˆ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø­Ù…Ù„ØªØ´ */
    border: 2px solid transparent; /* Ø¨Ø±ÙˆØ§Ø² Ø´ÙØ§Ù ÙÙŠ Ø§Ù„Ø¹Ø§Ø¯ÙŠ */
    transition: 0.2s;
}

/* Ù„Ù…Ø§ ØªÙƒÙˆÙ† ÙØ§ØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ØŒ Ø§Ù„ØµÙˆØ±Ø© ØªØ§Ø®Ø¯ Ø¨Ø±ÙˆØ§Ø² Ø£Ø²Ø±Ù‚ */
.nav-item.active .nav-avatar-small {
    border-color: var(--primary-color);
    transform: scale(1.1); /* ØªÙƒØ¨Ø± Ø³Ù†Ø© Ø¨Ø³ÙŠØ·Ø© */
}


/* Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ Ø®Ø·ÙˆØ· Ù‚Ø¯ÙŠÙ…Ø© */
.nav-item::after { display: none !important; }



/* --- ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ù„Ø¨ Ø¬ÙˆÙ‡ Ø§Ù„Ù„ÙˆØ¬Ùˆ --- */
.heart-container {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.heart-container i {
    font-size: 28px; /* Ø­Ø¬Ù… Ø§Ù„Ù‚Ù„Ø¨ Ù…ØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ù†Øµ */
    display: flex;
    align-items: center;
}

        
        .nav-item:hover { background: rgba(255, 255, 255, 0.03); }
/* --- ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ --- */
.nav-badge-count {
    position: absolute;
    top: -6px;           /* ÙŠØ±ÙØ¹ Ø§Ù„Ø±Ù‚Ù… Ù„ÙÙˆÙ‚ Ø´ÙˆÙŠØ© Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø¹Ù„Ù‰ ÙƒØªÙ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    right: 15%;          /* ÙŠØ¸Ø¨Ø· Ù…ÙƒØ§Ù†Ù‡ ÙŠÙ…ÙŠÙ† */
    min-width: 20px;     /* Ø¹Ø±Ø¶ Ù…Ù†Ø§Ø³Ø¨ Ù„Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ */
    height: 20px;        /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
    padding: 0 4px;      /* Ù…Ø³Ø§Ø­Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ø¹Ø´Ø§Ù† Ù„Ùˆ Ø§Ù„Ø±Ù‚Ù… ÙƒØ¨Ø± (99+) */
    
    background: #ff0000; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± ÙØ§Ù‚Ø¹ */
    color: #ffffff;      /* Ù†Øµ Ø£Ø¨ÙŠØ¶ */
    
    border-radius: 50px; /* Ø´ÙƒÙ„ ÙƒØ¨Ø³ÙˆÙ„Ø© Ø¯Ø§Ø¦Ø±ÙŠØ© */
    font-size: 11px;     /* Ø­Ø¬Ù… Ø®Ø· ÙˆØ§Ø¶Ø­ */
    font-weight: 900;    /* Ø®Ø· Ø¹Ø±ÙŠØ¶ */
    font-family: Arial, sans-serif;
    
    display: flex;
    align-items: center;
    justify-content: center;
    
    border: 2px solid var(--bg-color); /* Ø¨Ø±ÙˆØ§Ø² Ø¨Ù†ÙØ³ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„ÙØµÙ„ Ø§Ù„Ø±Ù‚Ù… Ø¹Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    z-index: 100;
    opacity: 0;          /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    transform: scale(0); /* Ø­Ø¬Ù…Ù‡ ØµÙØ± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none; /* Ø¹Ø´Ø§Ù† Ù…ÙŠØ¹Ø·Ù„Ø´ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±Ø§Ø± */
}
    /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ --- */
.premium-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2px;
    font-size: 28px;
    font-weight: 900;
    letter-spacing: 1px;
    cursor: pointer;
    background: linear-gradient(to bottom, #ffffff 0%, #a1a1a1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
    
    /* ğŸ”¥ Ø§Ù„Ø³Ø·Ø± Ø¯Ù‡ Ù‡Ùˆ Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ¹Ø¯Ù„ Ø§Ù„ØªØ±ØªÙŠØ¨ ğŸ”¥ */
    direction: ltr; 
}


/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ù„Ø¨ Ù„Ø¶Ø¨Ø· Ø§Ù„ØªÙˆÙ‡Ø¬ */
.heart-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 2px;
}
/* ØªØµÙ…ÙŠÙ… Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ±ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù„ÙˆÙ† Ø³Ù…Ø§ÙˆÙŠ ÙˆØ£Ø²Ø±Ù‚) */
/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (ØªØ¯Ø±Ø¬ Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ) */
.heart-container i {
    font-size: 30px; /* Ø­Ø¬Ù… Ù…ØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ù†Øµ */
    /* Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù„ÙˆÙ†ÙŠ: Ù…Ù† Ø³Ù…Ø§ÙˆÙŠ ÙØ§ØªØ­ Ù„Ø£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚ */
    background: linear-gradient(135deg, #00E5FF 0%, #0072FF 100%); 
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    
    /* ØªÙˆÙ‡Ø¬ Ø³Ù…Ø§ÙˆÙŠ Ø­ÙˆÙ„ Ø§Ù„Ù‚Ù„Ø¨ */
    filter: drop-shadow(0 0 8px rgba(0, 229, 255, 0.6));
            
    /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¯Ù‚Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ (Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ ÙƒÙˆØ¯Ùƒ) */
    animation: logo-heartbeat 2.5s infinite ease-in-out;
}


/* Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø§Ù„Ù†Ø¨Ø¶ Ø§Ù„Ø£Ø­Ù…Ø±/Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„ØµØºÙŠØ± ÙÙˆÙ‚ Ø§Ù„Ù‚Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¯Ù‚Ø©) */
.heart-container::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 12px;
    /* Ø±Ø³Ù… Ø®Ø· Ù†Ø¨Ø¶ Ø¨Ø³ÙŠØ· Ø¨Ù€ CSS */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff3b30' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='22 12 18 12 15 21 9 3 6 12 2 12'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-size: contain;
    background-position: center;
    opacity: 0.9;
    filter: drop-shadow(0 0 2px #ff3b30);
    animation: pulse-line 2.5s infinite ease-in-out;
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¯Ù‚Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ */
@keyframes logo-heartbeat {
    0% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(0,114,255,0.6)); }
    15% { transform: scale(1.15); filter: drop-shadow(0 0 15px rgba(0,114,255,0.8)); }
    30% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(0,114,255,0.6)); }
    45% { transform: scale(1.15); filter: drop-shadow(0 0 15px rgba(0,114,255,0.8)); }
    60% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(0,114,255,0.6)); }
    100% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(0,114,255,0.6)); }
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø®Ø· Ø§Ù„Ù†Ø¨Ø¶ */
@keyframes pulse-line {
    0%, 100% { opacity: 0.5; width: 18px; }
    15%, 45% { opacity: 1; width: 22px; }
}


/* ÙƒÙ„Ø§Ø³ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ Ø±Ù‚Ù… */
.nav-badge-count.visible {
    opacity: 1;
    transform: scale(1);
}

        .nav-item.has-notification .nav-badge-dot { display: block; animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 4px rgba(255, 59, 48, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }

        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        
       /* --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© --- */
        .side-menu { 
            position: fixed; left: 0; top: 0; width: 320px; height: 100%; 
            background: var(--card-color); z-index: 5002; transform: translateX(-100%); 
            transition: .3s cubic-bezier(0.4, 0, 0.2, 1); border-right: 1px solid var(--border-color); 
            display: flex; flex-direction: column; 
        }
        .side-menu.open { transform: translateX(0); }
        /* --- ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ --- */

/* 1. Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ù‡ÙŠØ¯Ø±) */
.menu-profile-header { 
    padding: 15px 20px; 
    border-bottom: 1px solid var(--border-color); 
    display: flex; 
    align-items: center; 
    gap: 12px; 
    cursor: pointer; 
}

/* 2. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙˆØ±Ø© */
/* 2. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙˆØ±Ø© - ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… */
.menu-avatar {
    width: 58px;          /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ (ÙƒØ§Ù† 45) */
    height: 58px;         /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (ÙƒØ§Ù† 45) */
    border-radius: 50%;   /* Ø¬Ø¹Ù„Ù‡Ø§ Ø¯Ø§Ø¦Ø±ÙŠØ© */
    background: #333;
    display: grid;
    place-items: center;
    font-weight: bold;
    font-size: 22px;      /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    background-size: cover;
    border: 2px solid var(--primary-color); /* Ø¨Ø±ÙˆØ§Ø² Ù…Ù„ÙˆÙ† Ø£Ù†ÙŠÙ‚ */
    flex-shrink: 0;       /* Ù…Ù†Ø¹ Ø§Ù†ÙƒÙ…Ø§Ø´ Ø§Ù„ØµÙˆØ±Ø© */
    box-shadow: 0 2px 10px rgba(0,0,0,0.2); /* Ø¸Ù„ Ø®ÙÙŠÙ Ù„Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„ØµÙˆØ±Ø© */
}


/* 3. ØªÙ†Ø³ÙŠÙ‚ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (Ø¹Ø´Ø§Ù† Ù†Ø±ØµÙ‡Ù… ØªØ­Øª Ø¨Ø¹Ø¶) */
.menu-user-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 2px; /* Ù…Ø³Ø§ÙØ© ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø³Ø·ÙˆØ± */
    flex: 1;
    overflow: hidden; /* Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙ„Ø§Ù… Ù…ÙŠÙƒØ¨Ø±Ø´ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
}

/* 4. Ø§Ù„ØµÙ Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡ Ø§Ù„Ø§Ø³Ù… + Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
.name-row {
    display: flex;
    align-items: center; 
    gap: 5px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµØ­ */
}

/* 5. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø§Ø³Ù… (ØªØµØºÙŠØ± Ø§Ù„Ø®Ø·) */
#menuName {
    font-size: 14px !important; /* ØµØºØ±Ù†Ø§ Ø§Ù„Ø®Ø· Ø¹Ø´Ø§Ù† ÙŠØ¨Ù‚Ù‰ Ø´ÙŠÙƒ */
    font-weight: 700;
    margin: 0;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text-color);
}

/* 6. Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
.verified-icon-style {
    color: #1da1f2; 
    font-size: 13px; /* Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø§Ø³Ù… */
    flex-shrink: 0;
}

/* 7. Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
.profile-link-text {
    font-size: 11px;
    color: #888;
    margin-top: 1px;
}

        .menu-avatar { width: 45px; height: 45px; border-radius: 50%; background: #333; display: grid; place-items: center; font-weight: bold; font-size: 18px; background-size: cover; border: 2px solid var(--primary-color); }
        .menu-items { flex: 1; padding: 12px; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-content: start; }
        .item { background: rgba(255, 255, 255, 0.03); border-radius: 14px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; font-weight: 700; font-size: 11px; color: var(--text-color); transition: 0.2s; border: 1px solid rgba(255,255,255,0.02); height: 85px; position: relative; overflow: hidden; }
        .item:active { transform: scale(0.96); }
        .item:hover { background: var(--input-bg); border-color: var(--border-color); transform: translateY(-2px); }
        .item i { font-size: 20px; width: 38px; height: 38px; display: grid; place-items: center; border-radius: 50%; margin-bottom: 2px; transition: 0.3s; }
        
        .item.c-game i   { color: #8e44ad; background: rgba(142, 68, 173, 0.15); }
                .item.c-gift i   { color: #e91e63; background: rgba(233, 30, 99, 0.15); }
        .item.c-home i   { color: #1877f2; background: rgba(24, 119, 242, 0.15); }
        .item.c-req i    { color: #ff9f0a; background: rgba(255, 159, 10, 0.15); }
        .item.c-msg i    { color: #00d2ff; background: rgba(0, 210, 255, 0.15); }
        .item.c-friend i { color: #3b5998; background: rgba(59, 89, 152, 0.15); }
        .item.c-save i   { color: #f1c40f; background: rgba(241, 196, 15, 0.15); }
        .item.c-notif i  { color: #e74c3c; background: rgba(231, 76, 60, 0.15); }
        .item.c-radar i  { color: #9b59b6; background: rgba(155, 89, 182, 0.15); }
        .item.c-settings i { color: #95a5a6; background: rgba(149, 165, 166, 0.15); }
        .item.c-admin i  { color: #d35400; background: rgba(211, 84, 0, 0.15); }
        
        .item.danger { grid-column: 1 / -1; flex-direction: row; height: 50px; background: rgba(255, 59, 48, 0.08); border: 1px solid rgba(255, 59, 48, 0.2); margin-top: 15px; color: var(--danger-color); font-size: 13px; }
        .item.danger i { background: rgba(255, 59, 48, 0.2); color: #ff3b30; width: 28px; height: 28px; font-size: 14px; }
        .menu-separator { grid-column: 1 / -1; font-size: 12px; color: var(--secondary-text); font-weight: 800; margin-top: 5px; opacity: 0.7; padding-right: 5px; }
        .badge-count { position: absolute; top: 6px; left: 6px; background: var(--danger-color); color: white; font-size: 10px; padding: 1px 6px; border-radius: 8px; display: none; box-shadow: 0 0 0 2px var(--card-color); }
        .overlay-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 5000; display: none; backdrop-filter: blur(5px); }

        /* --- Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª --- */
        .container { max-width: 700px; margin: auto; padding: 0; }
       /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©) */
.new-post-wrapper {
    background: rgba(255, 255, 255, 0.02); /* Ø´ÙØ§ÙÙŠØ© Ø¹Ø§Ù„ÙŠØ© */
    margin: 10px 15px; /* Ù‡ÙˆØ§Ù…Ø´ Ø®Ø§Ø±Ø¬ÙŠØ© Ø£Ù‚Ù„ */
    border-radius: 50px; /* ØªØ¯ÙˆÙŠØ± ÙƒØ§Ù…Ù„ (Ø´ÙƒÙ„ ÙƒØ¨Ø³ÙˆÙ„Ø©) */
    border: 1px solid rgba(255, 255, 255, 0.08); /* Ø­Ø¯ÙˆØ¯ Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
    padding: 6px 8px; /* ØªØµØºÙŠØ± Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
    display: flex;
    align-items: center;
    gap: 8px;
    backdrop-filter: blur(10px); /* Ø²Ø¬Ø§Ø¬ÙŠ */
    box-shadow: 0 4px 20px rgba(0,0,0,0.2); /* Ø¸Ù„ Ù†Ø§Ø¹Ù… */
    height: 60px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª ÙˆÙ…Ù„Ù…ÙˆÙ… */
    transition: transform 0.2s;
}

/* Ø­Ø±ÙƒØ© Ø¶ØºØ· Ø®ÙÙŠÙØ© */
.new-post-wrapper:active {
    transform: scale(0.98);
}

/* Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¶ØºØ· (Ù…ÙƒØ§Ù† Ø§Ù„Ù†Øµ) */
.np-input-trigger {
    flex: 1;
    background: transparent; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© */
    padding: 0 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    height: 100%; /* ÙŠØ§Ø®Ø¯ Ø§Ù„Ø·ÙˆÙ„ ÙƒØ§Ù…Ù„ */
}

/* ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…ØµØºØ±Ø© */
.np-avatar {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    border: 2px solid var(--primary-color); /* Ø¨Ø±ÙˆØ§Ø² Ù…Ù„ÙˆÙ† */
    flex-shrink: 0;
}

/* Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ) */
.typing-text {
    font-size: 14px;
    color: var(--secondary-text);
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    position: relative;
    opacity: 0.8;
}

/* Ø²Ø± Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©) */
.np-media-btn {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.05);
    display: grid;
    place-items: center;
    color: #4caf50; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„ØµÙˆØ±Ø© */
    cursor: pointer;
    transition: 0.2s;
}

.np-media-btn:hover {
    background: rgba(76, 175, 80, 0.15);
}
  .np-input-trigger { flex: 1; background: var(--input-bg); border-radius: 25px; padding: 12px 15px; color: var(--secondary-text); font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .np-avatar { width: 32px; height: 32px; border-radius: 50%; background: #333; background-size: cover; }
        .np-media-btn { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 50%; background: rgba(52, 199, 89, 0.1); color: var(--success-color); transition: 0.2s; font-size: 18px; }
.post {
    background: var(--card-color);
    /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ù…ÙŠÙƒØ© ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø¸Ù„ Ù†Ø§Ø¹Ù… */
    border: none; 
    border-radius: 20px; /* Ø²ÙˆØ§ÙŠØ§ Ø£Ù†Ø¹Ù… */
    margin: 15px 0; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª */
    position: relative;
    /* Ø§Ù„Ø¸Ù„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
    box-shadow: 0 4px 25px rgba(0,0,0,0.2); 
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨ØªØ§Ø¹ Ø§Ù„Ø¨ÙˆØ³Øª */
.post-header {
    padding: 12px 15px;
}

/* ØªØ­Ø³ÙŠÙ† ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨ÙˆØ³Øª */
.post-avatar {
    width: 42px;
    height: 42px;
    border: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* ØªØ­Ø³ÙŠÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ Ø£Ø³ÙÙ„ Ø§Ù„Ø¨ÙˆØ³Øª */
.post-actions {
    border-top: 1px solid rgba(255,255,255,0.03); /* Ø®Ø· ÙØ§ØµÙ„ Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ */
    padding: 10px 0;
    margin: 0 10px;
}

      @media (min-width: 700px) { .post { border-radius: 18px; margin: 15px; } }
        .post-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; }
        .user-info { display: flex; gap: 12px; align-items: center; cursor: pointer; }
        .post-avatar { width: 44px; height: 44px; border-radius: 50%; background: #333; display: grid; place-items: center; font-weight: bold; background-size: cover; border: 1px solid var(--border-color); }
        .user-details h4 { font-size: 15px; font-weight: 700; margin-bottom: 2px; display: flex; align-items: center; gap: 5px; color: var(--text-color); }
        .user-details span { font-size: 12px; color: var(--secondary-text); }
        .post-text { padding: 0 15px 12px; font-size: 15px; line-height: 1.6; color: var(--text-color); white-space: pre-wrap; }
        .post-text.has-bg { min-height: 280px; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 26px; font-weight: 800; color: #fff; padding: 30px; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .media-grid { display: grid; gap: 2px; margin-top: 5px; background: #000; overflow: hidden; width: 100%; }
        .media-grid.single { grid-template-columns: 1fr; }
        .media-grid.double { grid-template-columns: 1fr 1fr; }
        .media-item { width: 100%; max-height: 550px; object-fit: cover; display: block; cursor: pointer; }
        .video-mute-btn { position: absolute; bottom: 10px; right: 10px; width: 32px; height: 32px; background: rgba(0, 0, 0, 0.6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; cursor: pointer; z-index: 20; backdrop-filter: blur(2px); border: 1px solid rgba(255,255,255,0.1); }
       .post-actions {
    padding: 12px 20px;
    border-top: 1px solid rgba(255,255,255,0.05);
    display: flex;
    justify-content: space-between;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 20px;
    color: #aaa;
    transition: 0.3s;
    background: transparent;
}

/* Ù„Ù…Ø§ ØªÙ„Ù…Ø³ Ø§Ù„Ø²Ø±Ø§Ø± ÙŠØ¸Ù‡Ø± Ù„ÙˆÙ† Ø®ÙÙŠÙ */
.action-btn:active {
    background: rgba(255,255,255,0.05);
    color: #fff;
}

/* ØªÙ…ÙŠÙŠØ² Ø²Ø± Ø§Ù„Ù„Ø§ÙŠÙƒ Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ù†Ø´Ø· */
.action-btn.liked {
    color: #ff3b30;
    background: rgba(255, 59, 48, 0.1);
}

        /* --- Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³ÙÙ„ÙŠØ© --- */
        .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: var(--sheet-bg); z-index: 5001; border-radius: 24px 24px 0 0; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); border-top: 1px solid var(--border-color); display: flex; flex-direction: column; max-height: 85vh; box-shadow: 0 -10px 40px rgba(0,0,0,0.5); }
        .bottom-sheet.active { transform: translateY(0); }
        .sheet-handle { width: 40px; height: 5px; background: var(--border-color); border-radius: 10px; margin: 12px auto; }
        .sheet-option { padding: 15px 25px; display: flex; align-items: center; gap: 15px; font-size: 15px; font-weight: 600; color: var(--text-color); cursor: pointer; border-bottom: 1px solid var(--border-color); transition: 0.2s; }
        .sheet-option:hover { background: var(--input-bg); }
        
        /* --- Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© --- */
        .cm-header { padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; font-weight: 800; font-size: 16px; background: var(--sheet-bg); z-index: 10; border-radius: 24px 24px 0 0; }
        .cm-body { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 90px; background: var(--sheet-bg); }
        .cm-footer { position: absolute; bottom: 0; left: 0; right: 0; padding: 10px 15px 15px; border-top: 1px solid var(--border-color); background: var(--sheet-bg); z-index: 202; }
        .cm-input-wrapper { display: flex; align-items: center; background: var(--input-bg); border-radius: 25px; padding: 5px 15px; border: 1px solid var(--border-color); }
        .cm-input { flex: 1; background: transparent; border: none; padding: 10px 5px; color: var(--text-color); outline: none; max-height: 100px; resize: none; font-size: 15px; }
        .cm-send-btn { color: var(--primary-color); padding: 8px; cursor: pointer; font-size: 18px; transition: 0.2s; }
        .cm-send-btn.update-mode { color: var(--success-color); }
        
        .color-0 { --user-color: #5D5FEF; } .color-1 { --user-color: #34c759; } .color-2 { --user-color: #ff3b30; } 
        .color-3 { --user-color: #ffb533; } .color-4 { --user-color: #bf5af2; } .color-5 { --user-color: #64d2ff; }
        .color-6 { --user-color: #ff9f0a; } .color-7 { --user-color: #ff375f; } .color-8 { --user-color: #ac8e68; } .color-9 { --user-color: #808080; }

        .cm-bubble.colored-comment { position: relative; background: #1a1a1a; border: 1px solid var(--user-color); border-right-width: 4px; box-shadow: inset 0 0 10px -5px var(--user-color), 0 5px 15px -8px var(--user-color); border-radius: 12px; padding: 10px 14px; margin-bottom: 5px; }
        .cm-bubble.colored-reply { position: relative; background: #1a1a1a; border: 1px solid var(--user-color); border-right-width: 4px; box-shadow: inset 0 0 10px -5px var(--user-color), 0 5px 15px -8px var(--user-color); border-radius: 12px; padding: 10px 14px; transition:0.2s; }
        
        .cm-bubble .cm-username { color: var(--user-color) !important; filter: brightness(1.3); font-weight: 800; font-size: 13px; margin-bottom: 5px; display: block; }
        .cm-text { font-size: 15px; line-height: 1.6; color: #e0e0e0; white-space: pre-wrap; }
        .cm-bubble.highlight { background: rgba(93, 95, 239, 0.15); border-color: var(--primary-color); box-shadow: 0 0 15px rgba(93, 95, 239, 0.3); }
        .cm-bubble.owner-bubble { background: rgba(93, 95, 239, 0.15); border-color: var(--primary-color); }

        .tree-connector { position: absolute; right: -24px; top: -20px; bottom: 0; width: 2px; background: #333; z-index: 0; }
        .reply-curve { position: absolute; right: -24px; top: 20px; width: 15px; height: 2px; background: #333; }
        
        .sticker-trigger-btn { color: var(--secondary-text); padding: 8px; cursor: pointer; font-size: 22px; }
        .stickers-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; padding: 20px; max-height: 350px; overflow-y: auto; }
        .sticker-option { font-size: 40px; text-align: center; cursor: pointer; user-select: none; }
        .sticker-comment { font-size: 70px !important; background: transparent !important; border: none !important; box-shadow: none !important; padding: 10px 0 !important; }
        
        /* --- Ø§Ù„Ù…Ù†Ø´Ù† --- */
        .reply-mention-link { color: #2979ff; font-weight: 800; cursor: pointer; text-decoration: none; margin-left: 4px; display: inline-block; transition:0.2s; }
        .reply-mention-link:hover { text-decoration: underline; }
        .mention-dropdown { position: absolute; bottom: 60px; left: 0; right: 0; background: var(--sheet-bg); border: 1px solid var(--border-color); border-radius: 12px; max-height: 200px; overflow-y: auto; display: none; z-index: 300; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); margin: 0 10px; }
        .mention-dropdown.active { display: block; animation: fadeIn 0.2s; }
        .mention-suggest-item { padding: 12px; display: flex; align-items: center; gap: 10px; cursor: pointer; border-bottom: 1px solid var(--border-color); transition:0.2s; }
        .mention-suggest-item:hover { background: var(--input-bg); }

        #toast {
    position: fixed;
    bottom: 90px; /* ÙÙˆÙ‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
    left: 50%;
    transform: translateX(-50%) translateY(20px); /* ÙŠØ¨Ø¯Ø£ Ù…Ù† ØªØ­Øª Ø´ÙˆÙŠØ© */
    background: rgba(20, 20, 20, 0.85); /* Ù„ÙˆÙ† ØºØ§Ù…Ù‚ Ø´ÙØ§Ù */
    backdrop-filter: blur(12px); /* ØªØºØ¨ÙŠØ´ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ±Ø§Ù‡ */
    -webkit-backdrop-filter: blur(12px);
    color: #fff;
    padding: 12px 24px;
    border-radius: 50px; /* ÙƒØ¨Ø³ÙˆÙ„Ø© ÙƒØ§Ù…Ù„Ø© */
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* Ø¸Ù„ Ù†Ø§Ø¹Ù… */
    border: 1px solid rgba(255,255,255,0.1); /* Ø­Ø¯ÙˆØ¯ Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Ø­Ø±ÙƒØ© Ù…Ø·Ø§Ø·ÙŠØ© */
    z-index: 10000;
}

/* Ù„Ù…Ø§ ÙŠØ¸Ù‡Ø± */
#toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0); /* ÙŠØ·Ù„Ø¹ Ù„Ù…ÙƒØ§Ù†Ù‡ */
}

/* Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¬ÙˆÙ‡ Ø§Ù„ØªÙˆØ³Øª */
#toast i {
    color: var(--primary-color);
    font-size: 16px;
}

 #scrollSentinel { text-align: center; padding: 20px; color: var(--secondary-text); }
        
        /* --- Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù…ÙƒØ§Ù†Ù‡Ø§ ÙÙˆÙ‚ + ØªØºØ¨ÙŠØ´) --- *//* --- Ø§Ù„Ù†Ø§ÙØ°Ø© (Ù…ÙƒØ§Ù†Ù‡Ø§ ÙÙˆÙ‚ + Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ©) --- */
.custom-modal {
    position: fixed;
    inset: 0;
    z-index: 20000 !important; /* Ø±Ù‚Ù… Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ Ø¹Ø´Ø§Ù† ÙŠØ¸Ù‡Ø± ÙÙˆÙ‚ ÙƒÙ„ Ø­Ø§Ø¬Ø© */
    display: none;
    align-items: center; /* Ø³Ù†ØªØ± ÙÙŠ Ø§Ù„Ù†Øµ */
    justify-content: center;
    background: rgba(0, 0, 0, 0.85); /* Ø®Ù„ÙÙŠØ© ØºØ§Ù…Ù‚Ø© Ù„Ù„ØªØ±ÙƒÙŠØ² */
    backdrop-filter: blur(5px);
}

.pro-dialog-box {
    margin: auto; /* Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† Ø§Ù„ØªÙˆØ³Ø· */
    position: relative;
    z-index: 20001; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© */
}

/* --- Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ (Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ØºØ§Ù…Ù‚) --- */
.modal-box {
    background: #161616;
    width: 90%;
    max-width: 380px;
    border-radius: 24px;
    padding: 20px;
    border: 1px solid #2a2a2a;
    text-align: center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª --- */
.account-list {
    text-align: right;
    max-height: 250px;
    overflow-y: auto;
    background: #0d0d0f; /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© */
    border-radius: 16px;
    padding: 5px;
    margin-bottom: 10px;
}

/* --- Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø³Ø§Ø¨ --- */
.acc-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    margin: 5px;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
    background: transparent;
    border-bottom: 1px solid #222;
}
.acc-item:last-child { border-bottom: none; }
.acc-item:hover { background: #1f1f1f; }

/* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø±Ø§ÙŠØ± (Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ ÙˆØ§Ù„ØºØ§Ù…Ù‚) --- */
.modal-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
}

.btn-purple {
    background: linear-gradient(135deg, #5D5FEF, #7879F1); /* Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ */
    color: white;
    border: none;
    padding: 14px;
    border-radius: 16px;
    font-weight: 800;
    font-size: 15px;
    cursor: pointer;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-dark {
    background: #1f1f1f;
    color: #aaa;
    border: 1px solid #333;
    padding: 12px;
    border-radius: 16px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    width: 100%;
}

/* --- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ø§Ù†Ø© (Ø¹Ø´Ø§Ù† Ù†Ø¸Ø¨Ø· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©) --- */
.input-group {
    position: relative;
    margin-bottom: 15px;
    width: 100%;
}

/* --- Ø´ÙƒÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (ØªØªØ­Ø· ÙŠÙ…ÙŠÙ† Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ) --- */
.input-icon {
    position: absolute;
    top: 50%;
    right: 15px; /* Ù…ÙƒØ§Ù†Ù‡Ø§ ÙŠÙ…ÙŠÙ† */
    transform: translateY(-50%);
    color: #555; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ù…Ø·ÙÙŠ */
    font-size: 16px;
    transition: 0.3s ease;
    z-index: 2;
    pointer-events: none; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø¶ØºØ·Ø© ØªØ¹Ø¯ÙŠ Ù„Ù„Ø®Ø§Ù†Ø© */
}

/* --- Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù†ÙØ³Ù‡Ø§ --- */
.pro-input {
    width: 100%;
    background: #0d0d0f; /* Ù„ÙˆÙ† ØºØ§Ù…Ù‚ Ø¬Ø¯Ø§Ù‹ */
    border: 1px solid #333; /* Ø¨Ø±ÙˆØ§Ø² Ø®ÙÙŠÙ */
    border-radius: 12px; /* Ø­ÙˆØ§Ù Ù…Ø¯ÙˆØ±Ø© */
    padding: 14px 50px 14px 15px; /* Ù…Ø³Ø§ÙØ© ÙŠÙ…ÙŠÙ† Ø¹Ø´Ø§Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    color: #fff; /* Ø§Ù„Ù†Øµ Ø£Ø¨ÙŠØ¶ */
    font-size: 14px;
    font-family: 'Cairo', sans-serif;
    outline: none;
    transition: all 0.3s ease;
}

/* --- Ù„Ù…Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ØºØ· ÙŠÙƒØªØ¨ --- */
.pro-input:focus {
    border-color: #5D5FEF; /* Ø§Ù„Ø¨Ø±ÙˆØ§Ø² ÙŠÙ†ÙˆØ± Ù…ÙˆÙ */
    background: #151515;   /* ØªÙØªÙŠØ­ Ø¨Ø³ÙŠØ· Ù„Ù„Ø®Ù„ÙÙŠØ© */
    box-shadow: 0 0 15px rgba(93, 95, 239, 0.15); /* ØªÙˆÙ‡Ø¬ */
}

/* --- ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù…Ø§ Ø§Ù„Ø®Ø§Ù†Ø© ØªÙƒÙˆÙ† Ù†Ø´Ø·Ø© --- */
.pro-input:focus ~ .input-icon {
    color: #5D5FEF; /* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªÙ‚Ù„Ø¨ Ù…ÙˆÙ */
}

/* --- Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ (Placeholder) --- */
.pro-input::placeholder {
    color: #666;
}

/* --- Ø³ØªØ§ÙŠÙ„ Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ´ØºÙŠÙ„ (Toggle Switch) --- */
.toggle-switch {
    width: 36px;
    height: 20px;
    background: #333; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆÙ‡Ùˆ Ù…Ø·ÙÙŠ */
    border-radius: 20px;
    position: relative;
    transition: 0.3s ease;
    border: 1px solid var(--border-color);
}

/* Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ø´ØºØ§Ù„ */
.toggle-switch.active {
    background: var(--primary-color); /* Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    border-color: var(--primary-color);
}

/* Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù„ÙŠ Ø¨ØªØªØ­Ø±Ùƒ Ø¬ÙˆÙ‡ Ø§Ù„Ù…ÙØªØ§Ø­ */
.toggle-knob {
    width: 14px;
    height: 14px;
    background: #fff;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Ø­Ø±ÙƒØ© Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ù„Ù…Ø§ ÙŠØ´ØªØºÙ„ */
.toggle-switch.active .toggle-knob {
    left: 18px; /* ØªØªØ­Ø±Ùƒ Ù„Ù„ÙŠÙ…ÙŠÙ† */
}

    /* --- ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®ØµÙˆØµÙŠØ© --- */
.privacy-select {
    width: 100%;
    background: var(--input-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 15px;
    font-size: 14px;
    outline: none;
    appearance: none; /* Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…ØªØµÙØ­ */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: left 10px center;
    background-size: 16px;
    padding-left: 30px;
}

/* --- ØªÙ†Ø³ÙŠÙ‚ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„ÙŠØ¯ÙˆÙŠ --- */
.report-textarea {
    width: 100%;
    background: var(--input-bg);
    border: 1px solid var(--border-color);
    color: var(--text-color);
    padding: 10px;
    border-radius: 10px;
    resize: none;
    height: 80px;
    display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    margin-bottom: 10px;
}
.level-menu-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px 18px;
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    border: 1px solid rgba(93, 95, 239, 0.3);
    border-radius: 15px;
    margin: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù„Ù…Ø¹Ø© Ø¹Ù†Ø¯ Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§ÙˆØ³ */
.level-menu-item:hover {
    transform: translateY(-2px);
    border-color: #5D5FEF;
    box-shadow: 0 5px 15px rgba(93, 95, 239, 0.2);
}

.level-menu-item:active {
    transform: scale(0.97);
}

/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
.item-icon {
    width: 40px;
    height: 40px;
    background: rgba(93, 95, 239, 0.15);
    color: #5D5FEF;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†ØµÙˆØµ */
.item-text {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.item-text .title {
    font-size: 15px;
    font-weight: 800;
    color: #ffffff;
}

.item-text .subtitle {
    font-size: 11px;
    color: #94a3b8;
    margin-top: 2px;
}

/* Ø§Ù„Ø³Ù‡Ù… Ø§Ù„ØµØºÙŠØ± */
.item-arrow {
    color: #475569;
    font-size: 12px;
}

/* Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
.level-menu-item:hover .item-icon {
    animation: pulse-icon 1s infinite;
}

@keyframes pulse-icon {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}
    /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ø±Ø© Ù„Ø¶Ø¨Ø· Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */
.rank-badge-container {
    margin-top: 2px;
    margin-bottom: 4px;
    min-height: 18px; /* ÙŠØ­Ø¬Ø² Ù…ÙƒØ§Ù† Ø¹Ø´Ø§Ù† Ø§Ù„Ø´ÙƒÙ„ Ù…ÙŠØ¨ÙˆØ¸Ø´ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
}

/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø§Ø±Ø© Ù†ÙØ³Ù‡Ø§ */
.mini-badge {
    font-size: 10px;       /* Ø®Ø· ØµØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø³Ø§Ø­Ø© */
    font-weight: 800;      /* Ø®Ø· Ø¹Ø±ÙŠØ¶ */
    padding: 2px 8px;      /* Ø­ÙˆØ§Ù Ø¯Ø§Ø®Ù„ÙŠØ© */
    border-radius: 4px;    /* Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ© */
    color: #fff;
    display: inline-flex;  /* Ø¹Ø´Ø§Ù† ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ù‚Ø¯ Ø§Ù„ÙƒÙ„Ø§Ù… */
    align-items: center;
    gap: 4px;              /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ø§Ø³Ù… */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±ØªØ¨ (Ù†ÙØ³ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ) */
.badge-bronze { background: linear-gradient(45deg, #cd7f32, #a05a2c); border: 1px solid #eecfa1; }
.badge-silver { background: linear-gradient(45deg, #bdc3c7, #2c3e50); border: 1px solid #fff; }
.badge-gold   { background: linear-gradient(45deg, #f1c40f, #f39c12); border: 1px solid #ffd700; color: #000; }
.badge-diamond{ background: linear-gradient(45deg, #00c6ff, #0072ff); border: 1px solid #a6eaff; }
.badge-mythic { background: linear-gradient(45deg, #ff00cc, #333399); border: 1px solid #ff99cc; animation: glow 1.5s infinite alternate; }

@keyframes glow { from { box-shadow: 0 0 5px #ff00cc; } to { box-shadow: 0 0 15px #ff00cc; } }

/* --- ØªØµÙ…ÙŠÙ… Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© --- */

/* ØªØ®ØµÙŠØµ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
.logout-box {
    background: linear-gradient(145deg, #1a1a1a, #0d0d0f); /* ØªØ¯Ø±Ø¬ ØºØ§Ù…Ù‚ ÙØ®Ù… */
    border: 1px solid rgba(255, 255, 255, 0.05);
    padding: 30px 20px;
    border-radius: 24px;
    width: 85%;
    max-width: 320px;
    transform: scale(0.9);
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes popIn {
    to { transform: scale(1); }
}

/* Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
.logout-icon-wrapper {
    width: 70px;
    height: 70px;
    background: rgba(255, 59, 48, 0.1); /* Ø®Ù„ÙÙŠØ© Ø­Ù…Ø±Ø§Ø¡ Ø´ÙØ§ÙØ© */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px auto;
    border: 1px solid rgba(255, 59, 48, 0.2);
    box-shadow: 0 0 20px rgba(255, 59, 48, 0.1);
}

.logout-icon-wrapper i {
    font-size: 30px;
    color: #ff3b30; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± */
}

/* Ø§Ù„Ù†ØµÙˆØµ */
.logout-title {
    font-size: 20px;
    font-weight: 800;
    color: #fff;
    margin-bottom: 8px;
}

.logout-desc {
    font-size: 13px;
    color: #aaa;
    line-height: 1.6;
    margin-bottom: 25px;
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.logout-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
}

/* Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ */
.btn-confirm-logout {
    flex: 1;
    background: #ff3b30;
    color: #fff;
    border: none;
    padding: 12px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 4px 15px rgba(255, 59, 48, 0.3);
    transition: 0.2s;
}

.btn-confirm-logout:active {
    transform: scale(0.96);
}

/* Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡ */
.btn-cancel {
    flex: 1;
    background: rgba(255, 255, 255, 0.05);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 12px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: 0.2s;
}

.btn-cancel:hover {
    background: rgba(255, 255, 255, 0.1);
}
/* --- ØªØµÙ…ÙŠÙ… ØµÙØ­Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙƒØ§Ù…Ù„Ø© --- */
.search-page-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--bg-color); z-index: 6000;
    display: flex; flex-direction: column;
    transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.search-page-overlay.active { transform: translateX(0); }

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.sp-header {
    display: flex; align-items: center; gap: 10px; padding: 10px 15px;
    border-bottom: 1px solid var(--border-color); background: var(--header-bg);
}
.sp-input-wrapper {
    flex: 1; position: relative; display: flex; align-items: center;
}
.sp-input-wrapper input {
    width: 100%; background: var(--input-bg); border: none;
    padding: 10px 35px 10px 35px; border-radius: 20px;
    color: var(--text-color); outline: none; font-size: 15px;
}
.sp-input-wrapper .fa-magnifying-glass {
    position: absolute; right: 12px; color: var(--secondary-text);
}
.sp-input-wrapper .clear-btn {
    position: absolute; left: 12px; color: var(--secondary-text); cursor: pointer;
}
.back-btn { font-size: 20px; padding: 5px; cursor: pointer; color: var(--text-color); }
.sp-search-btn {
    background: transparent; color: var(--primary-color); border: none;
    font-weight: bold; cursor: pointer; font-size: 15px;
}

/* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
.sp-tabs {
    display: flex; gap: 15px; padding: 0 15px; overflow-x: auto;
    border-bottom: 1px solid var(--border-color); background: var(--header-bg);
}
.sp-tab {
    padding: 12px 5px; font-weight: 600; color: var(--secondary-text);
    cursor: pointer; position: relative; white-space: nowrap;
}
.sp-tab.active { color: var(--text-color); }
.sp-tab.active::after {
    content: ''; position: absolute; bottom: 0; left: 0; width: 100%;
    height: 3px; background: var(--primary-color); border-radius: 3px 3px 0 0;
}

/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
.sp-content { flex: 1; overflow-y: auto; padding: 10px 0; }
.sp-section-header {
    display: flex; justify-content: space-between; padding: 10px 15px;
    font-weight: bold; color: var(--text-color);
}

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø³Ø¬Ù„ (History Items) */
.history-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 15px; cursor: pointer; transition: 0.2s;
}
.history-item:hover { background: var(--input-bg); }
.history-info { display: flex; align-items: center; gap: 12px; }
.history-avatar {
    width: 40px; height: 40px; border-radius: 50%; background: #333;
    display: grid; place-items: center; font-weight: bold; color: #fff; background-size: cover;
}

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Users) */
.res-user-card {
    display: flex; align-items: center; gap: 12px; padding: 12px 15px;
    border-bottom: 1px solid var(--border-color);
}
.res-btn-follow {
    background: var(--input-bg); color: var(--text-color);
    padding: 6px 15px; border-radius: 8px; font-size: 13px; font-weight: bold;
    border: none; cursor: pointer;
}

/* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Posts) */
.res-post-preview {
    padding: 15px; border-bottom: 1px solid var(--border-color);
    margin-bottom: 5px; background: var(--card-color);
}
/* Ù‡Ø°Ø§ Ø§Ù„ÙƒÙ„Ø§Ø³ Ù‡Ùˆ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙ„ÙˆÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ ÙŠØ¨Ø­Ø« Ø¹Ù†Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
/* ØªÙ†Ø³ÙŠÙ‚ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„ÙØ§ØªØ­ */
/* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø­Ø¯Ø« (Ø¨Ø¯ÙˆÙ† ØªÙƒØ³ÙŠØ± Ø§Ù„ÙƒÙ„Ø§Ù…) --- */
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ…ÙŠÙŠØ² (Ø¨Ø¯ÙˆÙ† ØªÙƒØ³ÙŠØ± Ø§Ù„ÙƒÙ„Ù…Ø§Øª) */
.highlight-text {
    color: var(--primary-color);
    background: rgba(93, 95, 239, 0.15); /* Ø®Ù„ÙÙŠØ© Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
    padding: 0; /* Ù…Ù‡Ù…: ØµÙØ± Ø¹Ø´Ø§Ù† Ø§Ù„Ø­Ø±ÙˆÙ Ù…ØªØªÙ‚Ø·Ø¹Ø´ */
    border-radius: 0;
    font-weight: 900;
    box-shadow: none;
    border: none;
}


    /* Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø´ÙØ§ÙØ© Ù„ØªØ¸Ù‡Ø± ÙÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« */
.bottom-sheet {
    display: flex !important;       /* ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙÙ„ÙŠÙƒØ³ */
    flex-direction: column !important; /* Ø§Ù„Ø¹Ù†Ø§ØµØ± ØªØ­Øª Ø¨Ø¹Ø¶ */
    height: 85vh !important;        /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
    max-height: 85vh !important;
    overflow: hidden !important;    /* Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù„Ù„Ø­Ø§ÙˆÙŠØ© Ù†ÙØ³Ù‡Ø§ */
    /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ */
    position: fixed; 
    bottom: 0; 
    left: 0; 
    right: 0; 
    background: var(--sheet-bg); 
    z-index: 5001; 
    border-radius: 24px 24px 0 0; 
    transform: translateY(100%); 
    transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
}


.overlay-bg {
    z-index: 7000 !important; /* ÙƒØ§Ù† 5000 ÙˆØ®Ù„ÙŠÙ†Ø§Ù‡ 7000 */
}

/* Ø§Ù„ØªØ£ÙƒØ¯ Ø§Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©) Ø£Ø¹Ù„Ù‰ Ø­Ø§Ø¬Ø© Ø®Ø§Ù„Øµ */
.custom-modal {
    z-index: 9000 !important;
}

/* --- ØªØµØ­ÙŠØ­ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª (Z-Index Fixes) --- */

/* 1. ØµÙØ­Ø© Ø§Ù„Ø¨Ø­Ø« Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† ÙÙˆÙ‚ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆÙƒÙ„ Ø­Ø§Ø¬Ø© */
.search-page-overlay {
    z-index: 9999 !important; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø£ÙŠ Ø­Ø§Ø¬Ø© ØªØ§Ù†ÙŠØ© */
    background: var(--bg-color); /* ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ø´Ø§Ù† Ù…ØªØ¨Ù‚Ø§Ø´ Ø´ÙØ§ÙØ© */
}

/* 2. Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ© (Overlay) Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† ØªØ­Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.overlay-bg {
    z-index: 5000 !important; /* Ø·Ø¨Ù‚Ø© Ù…ØªÙˆØ³Ø·Ø© */
}

/* 3. Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³ÙÙ„ÙŠØ© (Bottom Sheets) ÙÙˆÙ‚ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ© */
.bottom-sheet {
    z-index: 5001 !important;
}

/* 4. Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modals) Ù…Ø«Ù„ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± */
.custom-modal {
    z-index: 6000 !important; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³ÙÙ„ÙŠØ© */
    background: rgba(0,0,0,0.8); /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ Ø´ÙØ§ÙØ© Ù‚ÙˆÙŠØ© Ù„Ù„ØªØ±ÙƒÙŠØ² */
}

/* 5. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Side Menu) */
.side-menu {
    z-index: 7500 !important;
}

.hashtag-link {
    color: #1da1f2; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ ØªÙˆÙŠØªØ± Ø§Ù„Ø´Ù‡ÙŠØ± */
    font-weight: 700; /* Ø®Ø· Ø¹Ø±ÙŠØ¶ */
    cursor: pointer;
    text-decoration: none;
    position: relative;
    z-index: 2; /* Ø¹Ø´Ø§Ù† ÙŠÙƒÙˆÙ† ÙÙˆÙ‚ Ø·Ø¨Ù‚Ø© Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© */
}

.hashtag-link:hover {
    text-decoration: underline;
    color: #0d8bd9;
}
/* ØªØµÙ…ÙŠÙ… ÙƒØ§Ø±Øª Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« */
.hashtag-card {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: 0.2s;
}
.hashtag-card:hover { background: var(--input-bg); }

.hash-icon-circle {
    width: 45px; height: 45px;
    border-radius: 50%;
    background: rgba(93, 95, 239, 0.1); /* Ù„ÙˆÙ† Ù…ÙˆÙ Ø®ÙÙŠÙ */
    color: var(--primary-color);
    display: grid; place-items: center;
    font-size: 20px;
    border: 1px solid var(--primary-color);
}

.hash-info h4 {
    font-size: 15px; font-weight: 800; color: var(--text-color); margin: 0;
}

.hash-stats {
    font-size: 12px; color: var(--secondary-text); margin-top: 4px;
    display: flex; gap: 10px;
}
.hash-stats span { display: flex; align-items: center; gap: 4px; }
/* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù„ÙˆÙ†Ø© --- */

/* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ù„ÙŠ Ù„ÙŠÙ‡ Ø®Ù„ÙÙŠØ© Ù…Ù„ÙˆÙ†Ø© */
.colored-post-body {
    min-height: 250px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    font-size: 22px;
    font-weight: 800;
    color: #fff;
    text-shadow: 0 2px 5px rgba(0,0,0,0.3);
    line-height: 1.6;
    margin-bottom: 10px;
}

/* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø§Ø³Ù… */
.feeling-text {
    color: #aaa;
    font-size: 12px;
    font-weight: normal;
    margin-right: 5px;
}
    
.search-page-overlay {
    z-index: 6000 !important;
}

/* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ Ø§Ù„Ø´ÙØ§ÙØ© (Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† ÙÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø«) */
.overlay-bg {
    z-index: 7000 !important; 
}

/* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³ÙÙ„ÙŠØ© (Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† ÙÙˆÙ‚ Ø§Ù„Ø®Ù„ÙÙŠØ©) */
.bottom-sheet {
    z-index: 8000 !important; 
}

/* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù) - Ø£Ø¹Ù„Ù‰ Ø­Ø§Ø¬Ø© */
.custom-modal {
    z-index: 9000 !important; 
}

/* Ø§Ù„ØªÙˆØ³Øª (Ø§Ù„Ø±Ø³Ø§Ø¦Ù„) */
#toast {
    z-index: 10000 !important; 
}
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± */
.filter-section { margin-bottom: 20px; }
.fs-title { font-size: 14px; color: var(--secondary-text); margin-bottom: 10px; font-weight: bold; }
.chips-row { display: flex; gap: 10px; }
.filter-chip {
    padding: 8px 16px;
    background: var(--input-bg);
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid transparent;
    transition: 0.2s;
}
/* Ø§Ù„Ø´ÙƒÙ„ Ù„Ù…Ø§ ØªØ®ØªØ§Ø± Ø§Ù„ÙÙ„ØªØ± */
.filter-chip.active {
    background: rgba(93, 95, 239, 0.15);
    color: var(--primary-color);
    border-color: var(--primary-color);
}
/* --- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø³Ø¬Ù„ Ø§Ù„Ø¨Ø­Ø« (History) --- */
.history-list {
    display: flex; flex-direction: column;
}
/* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© */
.history-item.hidden-item {
    display: none;
}
.show-more-btn {
    text-align: center;
    padding: 10px;
    color: var(--primary-color);
    font-size: 13px;
    font-weight: bold;
    cursor: pointer;
    background: rgba(93, 95, 239, 0.05);
    border-radius: 10px;
    margin: 10px 15px;
    transition: 0.2s;
}
.show-more-btn:hover { background: rgba(93, 95, 239, 0.15); }

/* --- ØªØµÙ…ÙŠÙ… Ù‚Ø³Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø¨Ø­Ø«Ø§Ù‹ (Trending) --- */
.trending-section {
    padding: 15px;
    border-top: 1px solid var(--border-color);
    margin-top: 10px;
}
.trend-header {
    display: flex; align-items: center; gap: 8px;
    font-weight: 800; color: var(--text-color); margin-bottom: 15px;
}
.trend-header i { color: #ff5722; } /* Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„Ù†Ø§Ø± */

.trends-container {
    display: flex; flex-wrap: wrap; gap: 10px;
}
.trend-chip {
    background: var(--input-bg);
    border: 1px solid var(--border-color);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    color: var(--secondary-text);
    cursor: pointer;
    transition: 0.2s;
    display: flex; align-items: center; gap: 6px;
}
.trend-chip:hover {
    background: rgba(93, 95, 239, 0.1);
    color: var(--primary-color);
    border-color: var(--primary-color);
    transform: translateY(-2px);
}
.trend-rank {
    font-size: 10px; opacity: 0.7; font-family: monospace;
    background: rgba(0,0,0,0.2); padding: 2px 5px; border-radius: 4px;
}
/* ØªÙ…ÙŠÙŠØ² Ø±Ù‚Ù… 1 Ùˆ 2 Ùˆ 3 */
.trend-chip:nth-child(1) { border-color: #ffd700; color: #ffd700; background: rgba(255, 215, 0, 0.05); }
.trend-chip:nth-child(2) { border-color: #c0c0c0; }
.trend-chip:nth-child(3) { border-color: #cd7f32; }
/* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± --- */
/* =========================================
   Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙˆØ­Ø¯ (Ù‡Ø§Ø´ØªØ§Ø¬ - Ù…Ù†Ø´Ù† - Ø±ÙˆØ§Ø¨Ø·)
   ========================================= */

/* Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ø£ÙŠ Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ± */
.text-link, 
.post-link, 
.mention-node {
    color: #20D5EC !important; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ */
    font-weight: 800;           /* Ø®Ø· Ø¹Ø±ÙŠØ¶ */
    text-decoration: none;      /* Ø¨Ø¯ÙˆÙ† Ø®Ø· ØªØ­Øª Ø§Ù„ÙƒÙ„Ø§Ù… */
    cursor: pointer;            /* Ø´ÙƒÙ„ Ø§Ù„ÙŠØ¯ */
    
    /* Ø¶Ø±ÙˆØ±ÙŠ Ø¹Ø´Ø§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ´ØªØºÙ„ ÙÙˆÙ‚ Ø£ÙŠ Ø¹Ù†ØµØ± ØªØ§Ù†ÙŠ */
    position: relative;
    z-index: 100; 
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´ÙƒÙ„ */
    display: inline-block;
    padding: 0 2px;
    transition: all 0.2s ease;
}

/* Ù„Ù…Ø§ Ø§Ù„Ù…Ø§ÙˆØ³ ÙŠØ¹Ø¯ÙŠ Ø¹Ù„ÙŠÙ‡ */
.text-link:hover, 
.post-link:hover, 
.mention-node:hover {
    text-decoration: underline;
    text-shadow: 0 0 8px rgba(32, 213, 236, 0.5); /* ØªÙˆÙ‡Ø¬ Ø®ÙÙŠÙ */
}

/* --- ØªØ¹Ø¯ÙŠÙ„ Ø®Ø§Øµ Ù„Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø°Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù„ÙˆÙ†Ø© --- */
/* (Ø¹Ø´Ø§Ù† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ Ù…Ø´ Ø¨ÙŠØ¨Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡) */
.colored-post-body .text-link,
.colored-post-body .post-link,
.colored-post-body .mention-node {
    color: #ffffff !important;       /* Ø®Ù„ÙŠÙ‡ Ø£Ø¨ÙŠØ¶ */
    background: rgba(0, 0, 0, 0.2);  /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© ÙˆØ±Ø§ Ø§Ù„ÙƒÙ„Ù…Ø© */
    border-radius: 4px;
    padding: 0 5px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ù† ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…Ù„ÙˆÙ†Ø© */
.colored-post-body .text-link,
.colored-post-body .mention-node,
.colored-post-body a {
    color: #20D5EC !important; /* Ù„ÙˆÙ† Ø³Ù…Ø§ÙˆÙŠ ÙØ§Ù‚Ø¹ */
    text-shadow: 0 1px 2px rgba(0,0,0,0.5); /* Ø¸Ù„ Ù„Ù„ÙƒÙ„Ø§Ù… Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ù„Ùˆ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */
    background: rgba(0,0,0,0.1); /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ ÙˆØ±Ø§ Ø§Ù„Ø§Ø³Ù… */
    padding: 0 4px;
    border-radius: 4px;
    display: inline-block;
}
/* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø´Ø¹ÙˆØ± ÙˆØ§Ù„Ù…Ù†Ø´Ù† ÙˆØ§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ --- */
.feeling-text {
    font-size: 12px;
    color: var(--secondary-text);
    margin-top: 2px;
    font-weight: normal;
    display: flex;
    align-items: center;
    gap: 4px;
}

.text-link {
    color: #20D5EC !important; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ Ø²ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ */
    font-weight: 800;
    text-decoration: none;
    cursor: pointer;
    position: relative;
    z-index: 10;
}
.text-link:hover {
    text-decoration: underline;
}/* ØªÙ†Ø³ÙŠÙ‚ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ "Ù†Ø¨Ø¶" */
/* ØªÙ†Ø³ÙŠÙ‚ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ "Ù†Ø¨Ø¶" - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠØ© */
/* ØªÙ†Ø³ÙŠÙ‚ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ "Ù†Ø¨Ø¶" - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø© Ø§Ù„ÙØ®Ù…Ø© */
/* ØªÙ†Ø³ÙŠÙ‚ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ "Ù†Ø¨Ø¶" */
.nabd-badge {
    color: #1da1f2; /* Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ Ø§Ù„Ù…Ù…ÙŠØ² */
    text-shadow: 0 0 8px rgba(29, 161, 242, 0.4); /* ØªÙˆÙ‡Ø¬ Ø®ÙÙŠÙ Ø­ÙˆÙ„Ù‡Ø§ */
    display: inline-block;
    margin-right: 4px;
    vertical-align: middle;
    animation: heartbeat 2s infinite; /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù†Ø¨Ø¶ */
}

/* Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø¨Ø¶ (Ø¯Ù‚Ø© Ù‚Ù„Ø¨) */
@keyframes heartbeat {
    0% { transform: scale(1); }
    15% { transform: scale(1.25); } /* Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ */
    30% { transform: scale(1); }
    45% { transform: scale(1.25); } /* Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© */
    60% { transform: scale(1); }
    100% { transform: scale(1); }
}
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¹Ø´Ø§Ù† ØªØ´ÙŠÙ„ Ø£Ù„ÙˆØ§Ù† ÙƒØªÙŠØ± Ù…Ø¹ Ø³ÙƒØ±ÙˆÙ„) */
.colors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); /* ÙŠØ±ØµÙ‡Ù… Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ */
    gap: 12px;
    padding: 5px;
    max-height: 250px; /* Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© */
    overflow-y: auto;  /* Ù„Ùˆ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø²Ø§Ø¯Øª ÙŠØ¹Ù…Ù„ Ø³ÙƒØ±ÙˆÙ„ */
    margin-top: 5px;
}

/* Ø´ÙƒÙ„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
.color-circle {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid rgba(255,255,255,0.1);
    transition: transform 0.2s;
    position: relative;
}
.color-circle:hover {
    transform: scale(1.1);
    border-color: #fff;
}

/* Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ† Ù…Ø®ØµØµ (Ø§Ù„Ù‚Ø·Ø§Ø±Ø©) */
.custom-color-btn {
    width: 45px; height: 45px; border-radius: 50%;
    border: 2px dashed #777; color: #eee;
    display: grid; place-items: center; cursor: pointer;
    font-size: 18px;
}

/* --- ØªÙ†Ø³ÙŠÙ‚ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ (Ø¥ØµÙ„Ø§Ø­ Ø´Ø§Ù…Ù„) --- */

/* Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù†ÙØ³Ù‡ */
.delete-box-style {
    text-align: center !important;
    background: #1a1a1a !important; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù…Ù…ÙŠØ² */
    border: 1px solid #333 !important;
    border-top: 4px solid #ff3b30 !important; /* Ø®Ø· Ø£Ø­Ù…Ø± Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ */
    border-radius: 20px !important;
    padding: 25px 20px !important;
    max-width: 340px !important;
    width: 90% !important;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5) !important;
    animation: popInDelete 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards !important;
}

@keyframes popInDelete {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

    /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Pro Modals) --- */

/* Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ (Ù…Ø´ØªØ±Ùƒ) */
.pro-dialog-box {
    text-align: center;
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 24px;
    padding: 25px 20px;
    max-width: 340px;
    width: 90%;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
.pro-dialog-box.edit-mode { border-top: 4px solid #5D5FEF; } /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
.pro-dialog-box.aud-mode { border-top: 4px solid #00C6FF; }  /* Ø³Ù…Ø§ÙˆÙŠ Ù„Ù„Ø¬Ù…Ù‡ÙˆØ± */

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
.dialog-icon-wrapper {
    width: 70px;
    height: 70px;
    margin: 0 auto;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    margin-bottom: 5px;
}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
.edit-theme { background: rgba(93, 95, 239, 0.1); color: #5D5FEF; border: 1px solid rgba(93, 95, 239, 0.2); }
.aud-theme { background: rgba(0, 198, 255, 0.1); color: #00C6FF; border: 1px solid rgba(0, 198, 255, 0.2); }

/* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
.pro-dialog-title {
    font-size: 20px;
    font-weight: 800;
    color: #fff;
    margin: 0;
}

.pro-dialog-desc {
    font-size: 13px;
    color: #aaa;
    margin-bottom: 10px;
}

/* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ù€ Textarea ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
.pro-textarea {
    width: 100%;
    background: #0d0d0f;
    border: 1px solid #333;
    border-radius: 16px;
    padding: 15px;
    color: #eee;
    font-size: 15px;
    line-height: 1.5;
    resize: none;
    outline: none;
    transition: 0.3s;
    min-height: 120px;
}
.pro-textarea:focus { border-color: #5D5FEF; background: #111; }

/* ØªØ­Ø³ÙŠÙ† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ø§Ù„ÙƒØ±ÙˆØª) */
.option-card {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #0d0d0f;
    border: 1px solid #333;
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
    text-align: right; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ */
    position: relative;
}
.option-card:hover { border-color: #555; background: #151515; }
.option-card input[type="radio"] {
    position: absolute;
    left: 15px;
    accent-color: #00C6FF;
    transform: scale(1.2);
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
.opt-icon {
    width: 35px;
    height: 35px;
    background: rgba(255,255,255,0.05);
    border-radius: 50%;
    display: grid;
    place-items: center;
    color: #ccc;
    font-size: 14px;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ù†ÙØ³ Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø­Ø°Ù) */
.dialog-actions {
    display: flex;
    gap: 10px;
    margin-top: 5px;
}
.btn-save-edit { background: linear-gradient(135deg, #5D5FEF, #7879F1); color: white; border: none; box-shadow: 0 4px 15px rgba(93, 95, 239, 0.3); }
.btn-save-aud { background: linear-gradient(135deg, #00C6FF, #0072FF); color: white; border: none; box-shadow: 0 4px 15px rgba(0, 198, 255, 0.3); }
.btn-cancel-pro { background: transparent; border: 1px solid #444; color: #ccc; }

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†) */
.danger-icon-wrapper {
    position: relative !important;
    width: 80px !important;
    height: 80px !important;
    margin: 0 auto 15px auto !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: rgba(255, 59, 48, 0.1) !important; /* Ø¯Ø§Ø¦Ø±Ø© Ø­Ù…Ø±Ø§Ø¡ Ø´ÙØ§ÙØ© */
    border-radius: 50% !important;
}

/* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù†ÙØ³Ù‡Ø§ (Ø§Ù„Ø³Ù„Ø©) */
.danger-icon-wrapper i {
    font-size: 32px !important;
    color: #ff3b30 !important; /* Ù„ÙˆÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£Ø­Ù…Ø± */
    z-index: 2 !important;
    animation: shake-trash 2s infinite !important; /* Ø§Ù‡ØªØ²Ø§Ø² */
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² */
@keyframes shake-trash {
    0%, 100% { transform: rotate(0deg); }
    10% { transform: rotate(-15deg); }
    20% { transform: rotate(15deg); }
    30% { transform: rotate(-15deg); }
    40% { transform: rotate(15deg); }
    50% { transform: rotate(0deg); }
}

/* Ø§Ù„Ù†ØµÙˆØµ */
.delete-box-style h3 {
    color: #fff !important;
    margin-bottom: 10px !important;
    font-size: 22px !important;
    font-weight: 800 !important;
}

.delete-box-style p {
    color: #aaa !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
    margin-bottom: 25px !important;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø¨ÙŠØ¶) */
.delete-actions {
    display: flex !important;
    gap: 12px !important;
    width: 100% !important;
}

/* Ø²Ø± Ø§Ù„ØªØ±Ø§Ø¬Ø¹ (Ø´ÙØ§Ù Ø¨Ø­Ø¯ÙˆØ¯) */
.btn-ghost {
    flex: 1 !important;
    background: transparent !important;
    border: 1px solid #444 !important;
    color: #eee !important;
    padding: 12px !important;
    border-radius: 12px !important;
    font-weight: bold !important;
    cursor: pointer !important;
    font-size: 14px !important;
}

/* Ø²Ø± Ø§Ù„Ø­Ø°Ù (Ø£Ø­Ù…Ø± ÙØ§Ù‚Ø¹) */
.btn-danger-glow {
    flex: 1 !important;
    background: linear-gradient(45deg, #ff3b30, #ff6b6b) !important; /* ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ */
    color: white !important;
    border: none !important;
    padding: 12px !important;
    border-radius: 12px !important;
    font-weight: bold !important;
    cursor: pointer !important;
    font-size: 14px !important;
    box-shadow: 0 4px 15px rgba(255, 59, 48, 0.4) !important; /* Ø¸Ù„ Ø£Ø­Ù…Ø± */
}

    /* ØªÙ†Ø³ÙŠÙ‚ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± */
.audience-option {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
    background: rgba(255,255,255,0.03);
}
.audience-option:hover { background: var(--input-bg); border-color: var(--primary-color); }
.aud-icon { font-size: 20px; color: var(--text-color); width: 30px; text-align: center; }
.aud-text { flex: 1; display: flex; flex-direction: column; text-align: right; }
.aud-text b { font-size: 14px; color: var(--text-color); }
.aud-text span { font-size: 11px; color: var(--secondary-text); }
input[type="radio"] { accent-color: var(--primary-color); transform: scale(1.2); }
    /* --- Ø¥ØµÙ„Ø§Ø­ Ù…ÙƒØ§Ù† Ù†Ø§ÙØ°Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (ØªØ±Ø¬Ø¹ ÙÙˆÙ‚) --- */
#accountSwitcherModal {
    align-items: flex-start !important; /* ÙŠÙ„ØºÙŠ Ø§Ù„ØªÙˆØ³ÙŠØ· ÙˆÙŠØ®Ù„ÙŠÙ‡Ø§ ØªØ¨Ø¯Ø£ Ù…Ù† ÙÙˆÙ‚ */
    padding-top: 80px; /* Ù…Ø³Ø§ÙØ© Ù…Ù† Ø³Ù‚Ù Ø§Ù„Ø´Ø§Ø´Ø© */
}
.lightbox {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95); z-index: 10000;
    display: none; align-items: center; justify-content: center;
    backdrop-filter: blur(5px);
    animation: fadeIn 0.2s;
}
.lb-img {
    max-width: 95%; max-height: 90%;
    border-radius: 8px;
    box-shadow: 0 0 50px rgba(0,0,0,0.5);
    transform: scale(0.9);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.lightbox.active .lb-img { transform: scale(1); }
.lb-close {
    position: absolute; top: 20px; right: 20px;
    color: #fff; font-size: 40px; cursor: pointer;
}
/* ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ø§Ø³ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Lightbox */
.lb-img {
    max-width: 95%; 
    max-height: 90%;
    border-radius: 8px;
    box-shadow: 0 0 50px rgba(0,0,0,0.5);
    transition: transform 0.1s ease-out; /* Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø²ÙˆÙ… */
    transform-origin: center center;
    touch-action: none; /* ğŸ”¥ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù† Ø§Ù„ØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„Ù„Ù…Ø³ */
    position: relative;
    cursor: grab;
}

.lb-img:active {
    cursor: grabbing;
}
    /* 1. ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù†Ø§Ø¹Ù… Ù„Ù„ØµÙØ­Ø© ÙƒÙ„Ù‡Ø§ */
html {
    scroll-behavior: smooth;
}

/* 2. ØªØµÙ…ÙŠÙ… Ø´Ø§Ø´Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª" Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
.empty-state-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 50px 20px;
    text-align: center;
    animation: fadeIn 0.5s ease;
}

.empty-icon-box {
    width: 100px;
    height: 100px;
    background: rgba(93, 95, 239, 0.1); /* Ù„ÙˆÙ† Ù…ÙˆÙ Ø®ÙÙŠÙ */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
    border: 1px dashed var(--primary-color);
}

.empty-icon-box i {
    font-size: 40px;
    color: var(--primary-color);
    opacity: 0.8;
}

.empty-title {
    font-size: 18px;
    font-weight: 800;
    color: var(--text-color);
    margin-bottom: 8px;
}

.empty-desc {
    font-size: 13px;
    color: var(--secondary-text);
    margin-bottom: 25px;
    max-width: 250px;
    line-height: 1.5;
}

.empty-btn {
    padding: 10px 25px;
    background: var(--input-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.empty-btn:hover {
    background: var(--primary-color);
    color: #fff;
    border-color: var(--primary-color);
}
/* --- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ --- */
#top-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 3px;
    background: var(--primary-color);
    width: 0%;
    z-index: 100000;
    /* ğŸ”¥ Ø§Ù„ØªØºÙŠÙŠØ± Ù‡Ù†Ø§: 0.5s ÙŠØ¹Ù†ÙŠ Ù†ØµÙ Ø«Ø§Ù†ÙŠØ© */
    transition: width 0.5s ease-in-out, opacity 0.3s ease;
    box-shadow: 0 0 10px var(--primary-color);
}

/* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¹Ø¸Ù…ÙŠØ© (Skeleton) --- */
.skeleton {
    background: #1f1f1f;
    background: linear-gradient(90deg, #1f1f1f 25%, #2a2a2a 50%, #1f1f1f 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 8px;
}

@keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

.skeleton-card {
    background: var(--card-color);
    padding: 15px;
    border-radius: 18px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
}

.sk-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
.sk-avatar { width: 45px; height: 45px; border-radius: 50%; }
.sk-line { height: 10px; border-radius: 5px; margin-bottom: 8px; }
.sk-body { height: 150px; width: 100%; border-radius: 12px; }

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
.universal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-color); /* ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù„ÙˆÙ† Ù†ÙØ³ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© */
    z-index: 99999; /* ÙÙˆÙ‚ ÙƒÙ„ Ø­Ø§Ø¬Ø© */
    transform: translateX(100%); /* Ù…Ø®ÙÙŠØ© ÙŠÙ…ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø© */
    display: flex;
    flex-direction: column;
}

.universal-overlay.active {
    transform: translateX(0); /* ØªØ¸Ù‡Ø± ÙˆØªØºØ·ÙŠ Ø§Ù„Ø´Ø§Ø´Ø© */
}

#universalFrame {
    width: 100%;
    height: 100%;
    border: none;
    background: var(--bg-color);
}

/* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø¦Ù… */
.overlay-back-btn {
    position: absolute;
    top: 15px;
    right: 15px; /* Ù…ÙƒØ§Ù†Ù‡Ø§ ÙŠÙ…ÙŠÙ† Ø¹Ø´Ø§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø±Ø¨ÙŠ */
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 20px;
    backdrop-filter: blur(5px);
    z-index: 100000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
/* ØªÙ†Ø³ÙŠÙ‚ Ø´Ø±ÙŠØ· Ø§Ù„Ø§ØªØµØ§Ù„ */
.connection-banner {
    position: fixed;
    bottom: -60px; /* Ù…Ø®ÙÙŠ ØªØ­Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    left: 0;
    width: 100%;
    height: 50px;
    background: #333;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-weight: bold;
    font-size: 14px;
    z-index: 200000; /* ÙÙˆÙ‚ ÙƒÙ„ Ø­Ø§Ø¬Ø© Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
    transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
}

/* Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ (Ø£Ø­Ù…Ø±) */
.connection-banner.offline {
    background: #ff3b30;
    bottom: 0; /* ÙŠØ¸Ù‡Ø± */
}

/* Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (Ø£Ø®Ø¶Ø±) */
.connection-banner.online {
    background: #34c759;
    bottom: 0; /* ÙŠØ¸Ù‡Ø± */
}
    /* --- Ù‚Ù„Ø¨ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„ÙƒØ¨ÙŠØ± (Double Tap Heart) --- */
.big-like-heart {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0); /* Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
    font-size: 80px;
    color: rgba(255, 255, 255, 0.9); /* Ø£Ø¨ÙŠØ¶ Ø´ÙØ§Ù */
    filter: drop-shadow(0 0 15px rgba(0,0,0,0.5)); /* Ø¸Ù„ Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† */
    pointer-events: none; /* Ø¹Ø´Ø§Ù† Ù…ÙŠØ¹Ø·Ù„Ø´ Ø§Ù„Ù„Ù…Ø³ */
    z-index: 100;
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Ø­Ø±ÙƒØ© Ø§Ù„Ø¸Ù‡ÙˆØ± ÙˆØ§Ù„Ø§Ø®ØªÙØ§Ø¡ */
.big-like-heart.active {
    animation: heartPop 0.8s forwards;
}

@keyframes heartPop {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}
/* --- 1. ØªØ­Ø³ÙŠÙ† ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ (Glassmorphism 2.0) --- */
.pro-dialog-box, .bottom-sheet, .logout-box {
    backdrop-filter: blur(20px) !important; /* ØªØºØ¨ÙŠØ´ Ø£Ù‚ÙˆÙ‰ */
    -webkit-backdrop-filter: blur(20px) !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important; /* Ø­Ø¯ÙˆØ¯ Ù†Ø§Ø¹Ù…Ø© */
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37) !important;
}

/* --- 2. ØªØ­Ø³ÙŠÙ† Ø´Ø¨ÙƒØ© Ø§Ù„ØµÙˆØ± (Masonry Layout) --- */
.media-grid { 
    display: grid; gap: 2px; margin-top: 5px; 
    background: #000; overflow: hidden; width: 100%; border-radius: 12px;
}
.media-grid.single { grid-template-columns: 1fr; }
.media-grid.double { grid-template-columns: 1fr 1fr; aspect-ratio: 16/9; }

/* Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù€ 3 ØµÙˆØ± (ÙˆØ§Ø­Ø¯Ø© ÙƒØ¨ÙŠØ±Ø© ÙˆØ§Ø«Ù†ÙŠÙ† ØµØºØ§Ø±) */
.media-grid.triple { 
    grid-template-columns: 1.5fr 1fr; 
    grid-template-rows: 1fr 1fr; 
    aspect-ratio: 4/3;
}
.media-grid.triple .media-item:first-child { 
    grid-row: 1 / span 2; 
    height: 100%; 
}

/* Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù€ 4 ØµÙˆØ± (Ù…Ø±Ø¨Ø¹ Ù…ØªØ³Ø§ÙˆÙŠ) */
.media-grid.quad { 
    grid-template-columns: 1fr 1fr; 
    grid-template-rows: 1fr 1fr; 
    aspect-ratio: 1/1;
}

/* --- 3. Ø²Ø± Ø§Ù„ØµØ¹ÙˆØ¯ Ù„Ù„Ø£Ø¹Ù„Ù‰ (Scroll to Top) --- */
/* --- 3. Ø²Ø± Ø§Ù„ØµØ¹ÙˆØ¯ Ù„Ù„Ø£Ø¹Ù„Ù‰ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©) --- */
.scroll-top-btn {
    position: fixed;
    bottom: 90px;  /* Ø§Ø±ØªÙØ§Ø¹ Ù…Ù†Ø§Ø³Ø¨ ÙÙˆÙ‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
    right: 20px;   /* ğŸ”¥ Ù†Ù‚Ù„Ù†Ø§Ù‡ ÙŠÙ…ÙŠÙ† Ø¹Ø´Ø§Ù† ÙŠØ¨Ø¹Ø¯ Ø¹Ù† Ø§Ù„ÙƒØ±Ø© */
    width: 45px;
    height: 45px;
    background: var(--primary-color);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    border: 2px solid rgba(255,255,255,0.2);
    
    /* Ø·Ø¨Ù‚Ø© Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø£ÙŠ Ø­Ø§Ø¬Ø© ÙÙŠ Ø§Ù„ÙƒÙˆÙ† */
    z-index: 2147483647 !important; 
    
    /* Ø§Ù„Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ù„Ø¸Ù‡ÙˆØ± */
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px) scale(0.8);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.scroll-top-btn.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
}

.scroll-top-btn:active {
    transform: scale(0.9);
}
/* --- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª (Voice Note UI) --- */
.mic-btn {
    font-size: 20px;
    color: var(--secondary-text);
    padding: 8px;
    cursor: pointer;
    transition: 0.2s;
}
.mic-btn.recording {
    color: #ff3b30;
    animation: pulse-mic 1s infinite;
}

@keyframes pulse-mic {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

/* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (ØªØ¸Ù‡Ø± Ù…ÙƒØ§Ù† Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©) */
.recording-ui {
    display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    flex: 1;
    align-items: center;
    gap: 10px;
    padding: 0 10px;
    color: #ff3b30;
    font-weight: bold;
}

/* Ø´ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª */


/* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Øª --- */
@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } }
.mic-btn.recording { color: #ff3b30; animation: pulse 1s infinite; }

/* --- Ø³ØªØ§ÙŠÙ„ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ (Ø²ÙŠ Ø§Ù„Ø´Ø§Øª) --- */

/* --- ØªØµÙ…ÙŠÙ… ÙƒØ§Ø±Øª Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø§Ø¨Ø· (Link Preview) --- */
.link-preview-card {
    display: block;
    margin-top: 10px;
    background: #000; /* Ù„ÙˆÙ† ØºØ§Ù…Ù‚ Ù„Ù„ÙƒØ§Ø±Øª */
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow: hidden;
    text-decoration: none;
    transition: 0.2s;
    cursor: pointer;
}
.link-preview-card:hover {
    border-color: var(--secondary-text);
    opacity: 0.9;
}

.lp-image {
    width: 100%;
    height: 180px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„ØµÙˆØ±Ø© */
    background-size: cover;
    background-position: center;
    background-color: #222;
}

.lp-info {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    background: rgba(255,255,255,0.03);
}

.lp-domain {
    font-size: 11px;
    color: var(--secondary-text);
    text-transform: uppercase;
    font-weight: bold;
}

.lp-title {
    font-size: 15px;
    font-weight: 800;
    color: var(--text-color);
    line-height: 1.4;
    max-height: 42px; /* Ø³Ø·Ø±ÙŠÙ† ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ */
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.lp-desc {
    font-size: 12px;
    color: #aaa;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ */
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ (Ø¹Ø´Ø§Ù† ØªØ¸Ù‡Ø± Ø²Ø±Ù‚Ø§Ø¡) */
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ */


/* ØªÙ†Ø³ÙŠÙ‚ ÙƒØ§Ø±Øª Ø§Ù„Ø±Ø§Ø¨Ø· */
.link-preview-card {
    display: block;
    text-decoration: none !important;
    margin-top: 10px;
    background: #000;
    border: 1px solid #333;
    border-radius: 12px;
    overflow: hidden;
    transition: 0.2s;
    cursor: pointer;
    position: relative;
    z-index: 90;
}
.link-preview-card:hover { border-color: #555; }

/* --- ØªÙ†Ø³ÙŠÙ‚ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª --- */
.fb-icons {
    display: flex;
    justify-content: space-around; /* ØªÙˆØ²ÙŠØ¹ Ù…ØªØ³Ø§ÙˆÙŠ */
    align-items: center;
    width: 100%;
    height: 60px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª ÙˆÙ…Ø±ÙŠØ­ */
    background: transparent; /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ø¹Ø´Ø§Ù† ØªØ¯Ù…Ø¬ Ù…Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø± */
    position: relative;
    padding: 0 10px;
}

/* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª) --- */
.nav-item {
    position: relative;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    cursor: pointer;
    font-size: 24px;
    color: #888; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø© */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: transparent !important; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© */
}

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ */
.nav-item:hover {
    color: #fff; /* ØªÙØªÙŠØ­ Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³ */
}

/* --- ğŸ”¥ Ø§Ù„Ø³Ø­Ø± ÙƒÙ„Ù‡ Ù‡Ù†Ø§: Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© (Active) --- */
.nav-item.active {
    color: var(--primary-color) !important; /* ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ */
    transform: translateY(-2px); /* Ø±ÙØ¹Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ */
    text-shadow: 0 0 15px rgba(0, 198, 255, 0.6); /* ØªÙˆÙ‡Ø¬ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù†ÙØ³Ù‡Ø§ */
}

/* Ø§Ù„Ø®Ø· Ø§Ù„Ù…Ø¶ÙŠØ¡ ØªØ­Øª Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¸Ø¨Ø·) */
.nav-item.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    width: 25px; /* Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø· */
    height: 3px; /* Ø³Ù…Ùƒ Ø§Ù„Ø®Ø· */
    background: var(--primary-color); /* Ù„ÙˆÙ† Ø§Ù„Ø®Ø· */
    border-radius: 10px 10px 0 0; /* ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø­ÙˆØ§Ù */
    box-shadow: 0 -2px 10px var(--primary-color), 0 0 20px var(--primary-color); /* ØªÙˆÙ‡Ø¬ Ø§Ù„Ø®Ø· (Glow) */
    animation: slideUpFade 0.3s ease-out;
}

/* Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø© Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ø®Ø· */
@keyframes slideUpFade {
    from { width: 0px; opacity: 0; }
    to { width: 25px; opacity: 1; }
}

/* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ù…Ø± (Badges) --- */
.nav-badge-count {
    position: absolute;
    top: 10px; /* Ø¶Ø¨Ø· Ø§Ù„Ù…ÙƒØ§Ù† Ø¨Ø¯Ù‚Ø© */
    right: 25%; /* Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    background: #ff3b30;
    color: #fff;
    min-width: 18px;
    height: 18px;
    border-radius: 50%;
    font-size: 10px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid var(--bg-color); /* Ø­Ø¯ÙˆØ¯ Ø¨Ù†ÙØ³ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„ÙØµÙ„Ù‡Ø§ Ø¹Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
    z-index: 10;
    opacity: 0;
    transform: scale(0);
    transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.nav-badge-count.visible {
    opacity: 1;
    transform: scale(1);
}
/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‚ØµØµ */
.bg-scroll-wrapper {
    padding: 10px 0;
    margin-bottom: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.05); /* Ø®Ø· ÙØ§ØµÙ„ Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ */
}

/* Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù‚ØµØ© */
.bg-circle {
    width: 60px; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    height: 60px;
    border-radius: 50%;
    padding: 2px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© */
    background: linear-gradient(45deg, #00C6FF, #0072FF); /* Ù†ÙØ³ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø«ÙŠÙ… */
    position: relative;
    margin: 0 8px;
}

/* Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
.bg-circle::after {
    content: '';
    position: absolute;
    inset: 2px; /* Ø¹Ø´Ø§Ù† Ø§Ù„ØµÙˆØ±Ø© ØªÙƒÙˆÙ† Ø¬ÙˆÙ‡ Ø§Ù„Ø­Ø¯ÙˆØ¯ */
    background: #000; /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ ØªÙØµÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù† Ø§Ù„Ø¥Ø·Ø§Ø± */
    border-radius: 50%;
    z-index: -1;
}
.post {
    background: #151515; /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ø³Ù†Ø© Ø¹Ù† Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø© */
    border: 1px solid rgba(255, 255, 255, 0.05); /* Ø­Ø¯ÙˆØ¯ Ø´ÙØ§ÙØ© Ø¬Ø¯Ø§Ù‹ */
    border-radius: 24px; /* ØªØ¯ÙˆÙŠØ± Ø£ÙƒØ¨Ø± Ù„Ù„Ø­ÙˆØ§Ù */
    margin: 15px 10px; /* Ù…Ø³Ø§ÙØ§Øª Ù…Ù† Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ */
    box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* Ø¸Ù„ Ù†Ø§Ø¹Ù… Ù„Ø±ÙØ¹ Ø§Ù„Ø¨ÙˆØ³Øª */
    overflow: hidden; /* Ø¹Ø´Ø§Ù† Ø§Ù„ØµÙˆØ± Ù…Ø®Ø±Ø¬Ø´ Ø¨Ø±Ù‡ Ø§Ù„ØªØ¯ÙˆÙŠØ± */
    position: relative;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨ØªØ§Ø¹ Ø§Ù„Ø¨ÙˆØ³Øª */
.post-header {
    padding: 15px 20px;
}

/* Ø§Ù„Ø§Ø³Ù… */
.user-details h4 {
    font-size: 16px;
    font-weight: 700;
    color: #fff;
    letter-spacing: 0.5px;
}
/* --- 1. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ÙˆÙ‚Ø¹ --- */
body {
    font-family: 'Cairo', sans-serif;
    -webkit-font-smoothing: antialiased; /* Ø¨ÙŠØ®Ù„ÙŠ Ø§Ù„Ø®Ø· Ù†Ø§Ø¹Ù… Ø¬Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    -moz-osx-font-smoothing: grayscale;
}

/* --- 2. Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙˆØ§Ø¶Ø­ ÙˆÙ‚ÙˆÙŠ) --- */
.user-details h4 {
    font-size: 15px;
    font-weight: 700; /* ØªØ®ÙŠÙ† */
    color: #fff;
    margin-bottom: 3px; /* Ù…Ø³Ø§ÙØ© ØµØºÙŠØ±Ø© ØªØ­Øª Ø§Ù„Ø§Ø³Ù… */
    letter-spacing: 0.3px; /* ØªØ¨Ø§Ø¹Ø¯ Ø®ÙÙŠÙ Ø¨ÙŠÙ† Ø§Ù„Ø­Ø±ÙˆÙ */
}

/* --- 3. Ù†Øµ Ø§Ù„Ù…Ù†Ø´ÙˆØ± (Ù…Ø±ÙŠØ­ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©) --- */
.post-text {
    font-size: 15px;
    font-weight: 400; /* Ø¹Ø§Ø¯ÙŠ Ù…Ø´ ØªØ®ÙŠÙ† */
    line-height: 1.6; /* ğŸ”¥ Ø£Ù‡Ù… Ø³Ø·Ø±: Ø¨ÙŠØ¨Ø¹Ø¯ Ø§Ù„Ø³Ø·ÙˆØ± Ø¹Ù† Ø¨Ø¹Ø¶ Ø¹Ø´Ø§Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
    color: #e0e0e0; /* Ø£Ø¨ÙŠØ¶ Ù‡Ø§Ø¯ÙŠ Ù…Ø´ ÙØ§Ù‚Ø¹ Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹ÙŠÙ† */
    padding: 5px 15px 10px; /* Ù…Ø³Ø§Ø­Ø§Øª Ù…Ø±ÙŠØ­Ø© Ù…Ù† Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ */
    text-align: right; /* Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† */
}

/* --- 4. Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ© (ØµØºÙŠØ± ÙˆØ¨Ø§Ù‡Øª) --- */
.user-details span, 
.user-details .time-display {
    font-size: 11px;
    font-weight: 400;
    color: #888; /* Ø±Ù…Ø§Ø¯ÙŠ Ø¹Ø´Ø§Ù† Ù…ÙŠØ§Ø®Ø¯Ø´ Ø§Ù„Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
}

/* --- 5. Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ (Ù…Ù…ÙŠØ²) --- */
.text-link {
    color: var(--primary-color);
    font-weight: 600;
    text-decoration: none;
}

/* --- 6. Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… (Ø§Ù„Ù‡ÙŠØ¯Ø±) --- */
.header-title, .pro-dialog-title {
    font-weight: 800; /* ØªØ®ÙŠÙ† Ø¬Ø¯Ø§Ù‹ */
    letter-spacing: -0.5px; /* ØªØ¯Ø§Ø®Ù„ Ø¨Ø³ÙŠØ· Ø´ÙŠÙƒ */
}

/* ØªØ®ØµÙŠØµ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± Ù„Ù„Ù…ØªØµÙØ­Ø§Øª (Chrome, Safari) */
::-webkit-scrollbar {
    width: 6px; /* Ø±ÙÙŠØ¹ ÙˆØ£Ù†ÙŠÙ‚ */
    background: transparent; /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© */
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2); /* Ù„ÙˆÙ† Ø§Ù„Ù…Ù‚Ø¨Ø¶ */
    border-radius: 20px; /* ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø­ÙˆØ§Ù */
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-color); /* ÙŠØªÙ„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³ */
}

    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· (Ripple) */
.ripple {
    position: relative;
    overflow: hidden;
    transform: translate3d(0, 0, 0);
}

.ripple::after {
    content: "";
    display: block;
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
    background-repeat: no-repeat;
    background-position: 50%;
    transform: scale(10, 10);
    opacity: 0;
    transition: transform .5s, opacity 1s;
}

.ripple:active::after {
    transform: scale(0, 0);
    opacity: 0.2;
    transition: 0s;
}
/* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
@keyframes heartBounce {
    0% { transform: scale(1); }
    25% { transform: scale(1.3); } /* ÙŠÙƒØ¨Ø± ÙØ¬Ø£Ø© */
    50% { transform: scale(0.9); } /* ÙŠØµØºØ± Ø´ÙˆÙŠØ© */
    100% { transform: scale(1); } /* ÙŠØ±Ø¬Ø¹ Ø·Ø¨ÙŠØ¹ÙŠ */
}

/* ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù…Ø§ Ø§Ù„ÙƒÙ„Ø§Ø³ liked ÙŠÙ†Ø¶Ø§Ù */
.action-btn.liked i {
    animation: heartBounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    color: #ff3b30; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± */
}
/* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± Ù…Ù† ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
::-webkit-scrollbar {
    width: 0px;
    background: transparent;
}
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© */
.fa-circle-check, .nabd-badge {
    position: relative;
    overflow: hidden;
    border-radius: 50%;
    color: #1da1f2; /* Ù„ÙˆÙ† Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
}

/* Ø§Ù„Ù„Ù…Ø¹Ø© Ø§Ù„Ù„ÙŠ Ø¨ØªØ¹Ø¯ÙŠ */
.fa-circle-check::after, .nabd-badge::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
    animation: shineBadge 3s infinite;
}

@keyframes shineBadge {
    0% { left: -100%; }
    20% { left: 100%; } /* Ø§Ù„Ù„Ù…Ø¹Ø© ØªØ¹Ø¯ÙŠ Ø¨Ø³Ø±Ø¹Ø© */
    100% { left: 100%; } /* ÙˆØªØ³ØªÙ†Ù‰ Ø´ÙˆÙŠØ© */
}
/* Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù†ÙØ³Ù‡ */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ØªØ·Ø¨ÙŠÙ‚Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ³Øª */
.post {
    /* ... Ø®ØµØ§Ø¦ØµÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ... */
    animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    opacity: 0; /* Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
}

/* ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„ÙƒÙ„ Ø¨ÙˆØ³Øª Ø¹Ø´Ø§Ù† ÙŠØ¸Ù‡Ø±ÙˆØ§ ÙˆØ±Ø§ Ø¨Ø¹Ø¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø¨Ø³ Ø´ÙŠÙƒ) */
.post:nth-child(1) { animation-delay: 0.1s; }
.post:nth-child(2) { animation-delay: 0.2s; }
.post:nth-child(3) { animation-delay: 0.3s; }
/* 1. Ù„Ø§Ø²Ù… Ù†ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù…Ø´ Ø¨ØªÙ‚Øµ Ø§Ù„Ø­Ø§Ø¬Ø§Øª Ø§Ù„Ù„ÙŠ Ø¨ØªØ®Ø±Ø¬ Ø¨Ø±Ø§Ù‡Ø§ */
.post-avatar, .menu-avatar, .story-user-avatar {
    position: relative;
    overflow: visible !important; /* ğŸ”¥ Ø£Ù‡Ù… Ø³Ø·Ø±: Ø¹Ø´Ø§Ù† Ø§Ù„Ù„Ù…Ø¨Ø© ØªØ¸Ù‡Ø± Ø¨Ø±Ù‡ Ø§Ù„Ø¯Ø§ÙŠØ±Ø© */
}
/* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù„Ù…Ø¨Ø© Ù„ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØµÙˆØ± (Ø¨ÙˆØ³ØªØ§ØªØŒ Ù‚Ø§Ø¦Ù…Ø©ØŒ ÙƒÙˆÙ…Ù†ØªØ§Øª) --- */
.post-avatar::before, 
.menu-avatar::before, 
/* Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„ÙƒÙˆÙ…Ù†ØªØ§Øª */
.cm-avatar {
    position: relative !important; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ù„Ù…Ø¨Ø© ØªÙ„Ø²Ù‚ ÙÙŠÙ‡Ø§ */
    overflow: visible !important;  /* Ø¹Ø´Ø§Ù† Ø§Ù„Ù„Ù…Ø¨Ø© ØªØ¸Ù‡Ø± Ø¨Ø±Ù‡ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¯Ø§ÙŠØ±Ø© */
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù„Ù…Ø¨Ø© Ù„Ù„ÙƒÙˆÙ…Ù†ØªØ§Øª */
.cm-avatar::before {
    content: '';
    position: absolute;
    bottom: -2px; /* Ù†Ø²Ù„Ù†Ø§Ù‡Ø§ Ø³Ù†Ø© Ø¹Ø´Ø§Ù† ØªØ¨Ø§Ù† Ø£Ø­Ù„Ù‰ */
    right: -2px;
    width: 9px;   /* ØµØºØ±Ù†Ø§Ù‡Ø§ Ø³Ù†Ø© Ø¹Ø´Ø§Ù† ØªÙ„ÙŠÙ‚ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„ÙƒÙˆÙ…Ù†Øª */
    height: 9px;
    border-radius: 50%;
    z-index: 10;
    transition: 0.3s;
    background-color: transparent;
}

/* Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† */
.cm-avatar.online::before {
    background-color: #31a24c;
    border: 2px solid var(--card-color);
}

/* --- Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±) --- */
.post-avatar.online::before, 
.menu-avatar.online::before, 
.cm-avatar.online::before { /* Ø¶ÙÙ†Ø§ cm-avatar Ù‡Ù†Ø§ */
    background-color: #31a24c; 
    border: 2px solid var(--card-color); 
    transform: scale(1); 
}

/* Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù„Ù…Ø¨Ø© Ø§Ù„Ù‡Ø§Ø±Ø¨Ø© */
.cm-avatar {
    position: relative !important; /* Ø¯Ù‡ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø³Ø­Ø±ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ­Ø¨Ø³ Ø§Ù„Ù„Ù…Ø¨Ø© Ø¬ÙˆÙ‡ Ø§Ù„ØµÙˆØ±Ø© */
    overflow: visible !important;  /* Ø¹Ø´Ø§Ù† Ø§Ù„Ù„Ù…Ø¨Ø© ØªØ¸Ù‡Ø± ÙƒØ§Ù…Ù„Ø© Ù„Ùˆ Ø®Ø±Ø¬Øª Ø¨Ø±Ù‡ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
}

/* 2. ÙƒÙ„Ø§Ø³ Ø¬Ø¯ÙŠØ¯ Ø§Ø³Ù…Ù‡ online Ù‡Ùˆ Ø§Ù„Ù„ÙŠ Ù‡ÙŠÙ„ÙˆÙ† Ø§Ù„Ù„Ù…Ø¨Ø© Ø£Ø®Ø¶Ø± */

/* Ù„Ùˆ Ø¹Ø§ÙŠØ²Ù‡Ø§ ØªÙƒØ¨Ø± Ù„Ù…Ø§ ÙŠÙ„Ù…Ø³Ù‡Ø§ (Zoom In) */
/* .media-item:hover { transform: scale(1.02); } */
.cm-input, .pro-input, .report-textarea {
    transition: all 0.3s ease;
    border: 1px solid transparent; /* Ø­Ø¯ÙˆØ¯ Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø£ÙˆÙ„ */
}

/* Ù„Ù…Ø§ ÙŠØ¶ØºØ· ÙŠÙƒØªØ¨ */
.cm-input:focus, .pro-input:focus, .report-textarea:focus {
    background: rgba(0, 198, 255, 0.05); /* Ø®Ù„ÙÙŠØ© Ø²Ø±Ù‚Ø§Ø¡ Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
    border-color: var(--primary-color);
    box-shadow: 0 0 15px rgba(0, 198, 255, 0.2); /* ØªÙˆÙ‡Ø¬ Ù†ÙŠÙˆÙ† */
    transform: translateY(-1px);
}
@keyframes imageReveal {
    from { opacity: 0; filter: blur(5px); }
    to { opacity: 1; filter: blur(0); }
}

.media-item {
    animation: imageReveal 0.6s ease-out forwards;
}
* {
    -webkit-tap-highlight-color: transparent !important; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙˆÙ…ÙŠØ¶ */
    outline: none !important; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø±ÙˆØ§Ø² Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· */
}
::selection {
    background-color: var(--primary-color); /* Ù„ÙˆÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
    color: #fff; /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ */
    text-shadow: none;
}

/* Ø¹Ø´Ø§Ù† Ù…ØªØµÙØ­Ø§Øª ÙØ§ÙŠØ±ÙÙˆÙƒØ³ */
::-moz-selection {
    background-color: var(--primary-color);
    color: #fff;
}
 /* --- ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Lightbox) --- */
.lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ Ø´ÙØ§ÙØ© */
    background: rgba(0, 0, 0, 0.95);
    
    /* ğŸ”¥ Ø£Ù‡Ù… Ø³Ø·Ø±: Ù„Ø§Ø²Ù… Ø§Ù„Ø±Ù‚Ù… Ø¯Ù‡ ÙŠÙƒÙˆÙ† Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø± (5000) */
    z-index: 99999 !important; 
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px); /* ØªØºØ¨ÙŠØ´ Ù„Ù„Ø®Ù„ÙÙŠØ© */
    opacity: 0;
    transition: opacity 0.3s ease;
}

/* ÙƒÙ„Ø§Ø³ Ø§Ù„ØªÙØ¹ÙŠÙ„ */
.lightbox.active {
    display: flex;
    opacity: 1;
}

/* Ø§Ù„ØµÙˆØ±Ø© Ù†ÙØ³Ù‡Ø§ */
.lb-img {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
    transform: scale(0.9); /* ØªØ¨Ø¯Ø£ ØµØºÙŠØ±Ø© */
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù€ Bounce */
}

/* Ù„Ù…Ø§ Ø§Ù„ØµÙˆØ±Ø© ØªØ¸Ù‡Ø± */
.lightbox.active .lb-img {
    transform: scale(1);
}

/* Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ */
.lb-close {
    position: absolute;
    top: 30px;
    right: 30px;
    color: #fff;
    font-size: 35px;
    cursor: pointer;
    background: rgba(255,255,255,0.1);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: grid;
    place-items: center;
    transition: 0.2s;
}

.lb-close:hover { background: rgba(255,255,255,0.2); }


html {
    scroll-behavior: smooth;
}
/* ØªØµÙ…ÙŠÙ… ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© */
.share-card-content {
    width: 400px;
    height: 600px;
    background: linear-gradient(145deg, #1a1a1a, #000);
    padding: 30px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    border: 2px solid #333;
    position: relative;
    overflow: hidden;
}

/* Ø²Ø®Ø±ÙØ© Ø®Ù„ÙÙŠØ© */
.share-card-content::before {
    content: '';
    position: absolute;
    top: -50px; right: -50px;
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(0,198,255,0.2), transparent 70%);
    filter: blur(40px);
}

.sc-header {
    display: flex;
    align-items: center;
    gap: 15px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 20px;
}

.sc-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 20px;
}

.sc-user {
    display: flex;
    align-items: center;
    gap: 15px;
}

.sc-user img {
    width: 60px; height: 60px;
    border-radius: 50%;
    border: 3px solid #00C6FF;
}

.sc-user span {
    font-size: 22px;
    font-weight: bold;
    color: #fff;
}

.sc-text {
    font-size: 24px;
    color: #ddd;
    line-height: 1.5;
    background: rgba(255,255,255,0.05);
    padding: 20px;
    border-radius: 15px;
    border-right: 5px solid #00C6FF;
}

.sc-footer {
    display: flex;
    align-items: center;
    gap: 15px;
    background: linear-gradient(90deg, #00C6FF, #5D5FEF);
    padding: 15px;
    border-radius: 15px;
    color: #fff;
}

.sc-qr i { font-size: 40px; }
.sc-cta { display: flex; flex-direction: column; }
.sc-cta span { font-weight: 900; font-size: 18px; }
.sc-cta small { font-size: 14px; opacity: 0.9; }
/* --- ØªÙ†Ø³ÙŠÙ‚ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ù…ÙˆØ¬Ø§Øª --- */
/* --- ØªÙ†Ø³ÙŠÙ‚ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª (Ù…Ø¹Ø¯Ù„) --- */
.custom-audio-player {
    display: flex;
    align-items: center;
    gap: 6px; /* Ù‚Ù„Ù„Ù†Ø§ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø´ÙˆÙŠØ© */
    width: 100%; /* ğŸ”¥ Ø®Ù„ÙŠÙ‡ ÙŠØ§Ø®Ø¯ Ø§Ù„Ø¹Ø±Ø¶ ÙƒÙ„Ù‡ Ø§Ù„Ù…ØªØ§Ø­ */
    min-width: 200px; /* ğŸ”¥ Ù„ÙƒÙ† Ù…Ø§ ÙŠØµØºØ±Ø´ Ø¹Ù† 200 */
    background: rgba(255, 255, 255, 0.08);
    padding: 6px 10px;
    border-radius: 20px;
    margin-top: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    direction: ltr;
}

/* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø¨ØªØ§Ø¹Ùƒ (play-btn, wave-bar, etc) Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ */

/* Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ */
.play-btn {
    background: var(--primary-color);
    color: #fff;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 12px;
    flex-shrink: 0;
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…ÙˆØ¬Ø§Øª */
.audio-waves {
    display: flex;
    align-items: center;
    gap: 3px;
    height: 15px;
    flex: 1;
}

/* Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…ÙˆØ¬Ø§Øª */
.wave-bar {
    width: 3px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 5px;
    height: 3px;
    animation: none;
}

/* Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù…Ø§ ÙŠØ´ØªØºÙ„ */
.custom-audio-player.playing .wave-bar {
    animation: wave-dance 0.5s infinite ease-in-out;
    background: var(--primary-color);
}

@keyframes wave-dance {
    0% { height: 3px; }
    50% { height: 15px; }
    100% { height: 3px; }
}

/* ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ© */
.wave-bar:nth-child(odd) { animation-duration: 0.4s; }
.wave-bar:nth-child(even) { animation-duration: 0.6s; }

/* Ø§Ù„Ø¹Ø¯Ø§Ø¯ */
.audio-duration {
    font-size: 10px;
    color: #aaa;
    min-width: 30px;
    text-align: center;
}
/* Ø¶ÙŠÙ Ø§Ù„Ø³Ø·Ø± Ø¯Ù‡ ÙÙŠ Ø§Ù„Ù€ <style> */
.no-scroll {
    overflow: hidden !important;
    height: 100vh; /* Ø¨ÙŠØ«Ø¨Øª Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ù…ÙƒØ§Ù†Ù‡Ø§ */
}
/* ğŸ”¥ ØªÙˆØ­ÙŠØ¯ Ø´ÙƒÙ„ Ø§Ù„Ù„Ù…Ø¨Ø© ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù† (ÙƒÙˆÙ…Ù†ØªØ§Øª - Ù…Ù†Ø´ÙˆØ±Ø§Øª - Ù‚Ø§Ø¦Ù…Ø©) ğŸ”¥ */

/* 1. Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù„Ù…Ø¨Ø© ØªØ¸Ù‡Ø± Ù„Ùˆ Ø§Ù„Ø¹Ù†ØµØ± ÙˆØ§Ø®Ø¯ ÙƒÙ„Ø§Ø³ online */
.post-avatar.online::before,
.menu-avatar.online::before,
.cm-avatar.online::before {
    content: '' !important;
    position: absolute !important;
    bottom: 0px !important;
    right: 0px !important;
    
    /* Ø­Ø¬Ù… Ø§Ù„Ù„Ù…Ø¨Ø© */
    width: 12px !important; 
    height: 12px !important;
    
    /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø± */
    background-color: #31a24c !important; 
    
    /* Ø§Ù„Ø¨Ø±ÙˆØ§Ø² Ø¹Ø´Ø§Ù† ÙŠÙØµÙ„Ù‡Ø§ Ø¹Ù† Ø§Ù„ØµÙˆØ±Ø© */
    border: 2px solid var(--card-color) !important; 
    border-radius: 50% !important;
    
    z-index: 50 !important;
    display: block !important;
}

/* 2. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„Ù…Ø¨Ø© Ù„Ùˆ Ù…ÙÙŠØ´ ÙƒÙ„Ø§Ø³ online (Ø¹Ø´Ø§Ù† Ù…ØªØ¨Ù‚Ø§Ø´ Ø´ØºØ§Ù„Ø© Ø¹Ù…Ø§Ù„ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù„) */
.post-avatar:not(.online)::before,
.menu-avatar:not(.online)::before {
    display: none !important;
}

/* 3. Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© ØªØ³Ù…Ø­ Ø¨Ø¸Ù‡ÙˆØ± Ø§Ù„Ù„Ù…Ø¨Ø© */
.post-avatar, .menu-avatar, .cm-avatar {
    overflow: visible !important;
}

    /* --- Ø³ØªØ§ÙŠÙ„ Ø´Ø§Ø±Ø© Ø§Ù„Ø±ØªØ¨Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± --- */
.user-rank-tag {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    font-size: 9px; /* Ø­Ø¬Ù… ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹ ÙˆØ£Ù†ÙŠÙ‚ */
    font-weight: 800;
    padding: 2px 6px;
    border-radius: 4px;
    margin-top: 2px;
    margin-bottom: 2px;
    width: fit-content;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±ØªØ¨ (Ù†ÙØ³ Ù†Ø¸Ø§Ù…Ùƒ) */
.rank-bronze { background: linear-gradient(45deg, #4b3621, #cd7f32); color: #ffdca8; border: 1px solid #cd7f32; }
.rank-silver { background: linear-gradient(45deg, #2c3e50, #bdc3c7); color: #fff; border: 1px solid #7f8c8d; }
.rank-gold   { background: linear-gradient(45deg, #b8860b, #ffd700); color: #000; border: 1px solid #ffd700; box-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
.rank-diamond{ background: linear-gradient(45deg, #0072ff, #00c6ff); color: #fff; border: 1px solid #a6eaff; }
.rank-mythic { background: linear-gradient(45deg, #333399, #ff00cc); color: #fff; border: 1px solid #ff99cc; animation: glow-text 2s infinite; }

@keyframes glow-text {
    0% { text-shadow: 0 0 2px #fff; }
    50% { text-shadow: 0 0 8px #ff00cc; }
    100% { text-shadow: 0 0 2px #fff; }
}
    /* --- Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØµØºØ± ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
.mini-follow-btn {
    background: transparent;
    color: var(--primary-color);
    border: 1px solid var(--primary-color);
    padding: 2px 10px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 800;
    cursor: pointer;
    margin-right: 8px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ†Ù‡ ÙˆØ¨ÙŠÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 3px;
    vertical-align: middle; /* Ø¹Ø´Ø§Ù† ÙŠÙŠØ¬ÙŠ ÙÙŠ Ù†Øµ Ø§Ù„Ø³Ø·Ø± Ù…Ø¹ Ø§Ù„Ø§Ø³Ù… */
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø£Ùˆ Ø§Ù„ØªÙØ¹ÙŠÙ„ */
.mini-follow-btn.following {
    background: var(--primary-color);
    color: #fff; /* Ø§Ù„Ù†Øµ ÙŠØ¨Ù‚Ù‰ Ø£Ø¨ÙŠØ¶ */
    border-color: var(--primary-color);
}

.mini-follow-btn:active {
    transform: scale(0.9);
}
/* Ø®Ù„ÙÙŠØ© Ø­ÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */
.ambient-bg {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    background: #0d0d0f;
    z-index: -1;
    overflow: hidden;
}
.ambient-blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.4;
    animation: moveBlob 20s infinite alternate;
}
.blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #00C6FF; animation-duration: 25s; }
.blob-2 { bottom: -10%; right: -10%; width: 400px; height: 400px; background: #5D5FEF; animation-duration: 30s; }
.blob-3 { top: 40%; left: 40%; width: 300px; height: 300px; background: rgba(255, 59, 48, 0.15); animation-duration: 35s; }

@keyframes moveBlob {
    0% { transform: translate(0, 0) scale(1); }
    100% { transform: translate(50px, 50px) scale(1.1); }
}
   
/* Ø³ØªØ§ÙŠÙ„ ØªØ¹Ù„ÙŠÙ‚ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ± */
.owner-comment {
    border: 1px solid var(--primary-color) !important; /* Ø¨Ø±ÙˆØ§Ø² Ø¨Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    background: rgba(0, 198, 255, 0.05) !important; /* Ø®Ù„ÙÙŠØ© Ø²Ø±Ù‚Ø§Ø¡ Ø®ÙÙŠÙØ© */
    box-shadow: 0 0 10px rgba(0, 198, 255, 0.1) !important;
}

/* Ø´Ø§Ø±Ø© "Ø§Ù„Ù…Ø¤Ù„Ù" */
.author-badge {
    font-size: 9px;
    background: var(--primary-color);
    color: #fff;
    padding: 1px 6px;
    border-radius: 4px;
    margin-right: 5px;
    font-weight: bold;
    display: inline-block;
    vertical-align: middle;
}
    /* ==================================================
   ğŸ¨ Ø³ØªØ§ÙŠÙ„ Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø²Ø¬Ø§Ø¬ÙŠ ÙˆØ´ÙŠÙƒ) ğŸ¨
   ================================================== */

/* 1. Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Bottom Sheet) */
#cmSheet {
    /* Ù„ÙˆÙ† Ø£Ø³ÙˆØ¯ Ø´ÙØ§Ù Ø¨Ù†Ø³Ø¨Ø© 85% */
    background: rgba(15, 15, 20, 0.85) !important;
    
    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ (Ø§Ù„ØªØºØ¨ÙŠØ´) */
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    
    /* Ø­Ø¯ÙˆØ¯ Ù…Ø¶ÙŠØ¦Ø© Ø®ÙÙŠÙØ© Ù…Ù† ÙÙˆÙ‚ */
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 30px 30px 0 0 !important; /* ØªØ¯ÙˆÙŠØ± Ù†Ø§Ø¹Ù… */
    
    /* Ø¸Ù„ Ù‚ÙˆÙŠ Ù„ÙØµÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
    box-shadow: 0 -10px 50px rgba(0, 0, 0, 0.7) !important;
}

/* 2. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
/* Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù†ÙˆØ§ Ø´ÙØ§ÙÙŠÙ† ÙˆÙŠØ§Ø®Ø¯ÙˆØ§ Ù†ÙØ³ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ */
.cm-header, .cm-body, .cm-footer {
    background: transparent !important;
    border-color: rgba(255, 255, 255, 0.05) !important; /* Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„ÙØ§ØµÙ„Ø© ØªØ¨Ù‚Ù‰ Ø®ÙÙŠÙØ© */
}

/* 3. ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© ØªØ­Øª */
.cm-input-wrapper {
    background: rgba(255, 255, 255, 0.08) !important; /* Ù„ÙˆÙ† Ø£ÙØªØ­ Ø³Ù†Ø© Ø¨Ø³ÙŠØ·Ø© */
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.2); /* Ø¸Ù„ Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø¹Ù…Ù‚ */
}

/* 4. (Ø¥Ø¶Ø§ÙÙŠ) Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø´Ø© Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© (Noise Texture) - Ø¨ØªØ¯ÙŠ ÙØ®Ø§Ù…Ø© */
#cmSheet::before {
    content: "";
    position: absolute;
    inset: 0;
    z-index: -1;
    opacity: 0.03; /* Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
    border-radius: 30px 30px 0 0;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¯ÙˆØ¯ */
.replies-trigger {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 5px;
    margin-right: 50px; /* Ù…Ø³Ø§ÙØ© Ø¹Ø´Ø§Ù† ÙŠØ¨Ø¹Ø¯ Ø¹Ù† Ø§Ù„ØµÙˆØ±Ø© ÙˆÙŠØ¬ÙŠ ØªØ­Øª Ø§Ù„ÙƒÙ„Ø§Ù… */
    cursor: pointer;
    color: #aaa;
    font-size: 11px;
    font-weight: bold;
    width: fit-content;
}

.replies-trigger:hover {
    color: var(--primary-color);
}

.replies-trigger:hover .reply-line {
    background-color: var(--primary-color);
}

/* Ø§Ù„Ø®Ø· Ø§Ù„Ø£ÙÙ‚ÙŠ */
.reply-line {
    width: 25px;
    height: 1px;
    background-color: #555;
    transition: 0.2s;
}

/* Ø§Ù„Ø³Ù‡Ù… Ø§Ù„ØµØºÙŠØ± */
.reply-arrow {
    font-size: 9px;
    margin-top: 2px;
}
/* Ø·Ø¨Ù‚Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù„Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©) */
.popup-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4); /* Ù„ÙˆÙ† Ø®ÙÙŠÙ ÙˆØ±Ø§ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
    z-index: 9998; /* ØªØ­Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (9999) Ø¹Ù„Ø·ÙˆÙ„ */
    display: none; /* Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¹Ø§Ø¯ÙŠ */
    backdrop-filter: blur(2px); /* ØªØ£Ø«ÙŠØ± Ø²Ø¬Ø§Ø¬ÙŠ Ø®ÙÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù†ÙØ³Ù‡Ø§ Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† ÙÙˆÙ‚ Ø§Ù„Ø·Ø¨Ù‚Ø© Ø¯ÙŠ */
.options-menu {
    z-index: 9999 !important;
}
/* ==================================================
   â¬› Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø´ÙØ§ÙÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹ (Solid Dark Mode) â¬›
   ================================================== */

/* 1. Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©) */
.cm-footer {
    background-color: #0d0d0f !important; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹ (ØºØ§Ù…Ù‚ ØµØ±ÙŠØ­) */
    backdrop-filter: none !important;      /* Ø¥Ù„ØºØ§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ */
    -webkit-backdrop-filter: none !important;
    border-top: 1px solid #222 !important; /* Ø­Ø¯ ÙØ§ØµÙ„ Ø¨Ø³ÙŠØ· */
    box-shadow: 0 -2px 10px rgba(0,0,0,0.5) !important; /* Ø¸Ù„ Ù„ÙØµÙ„Ù‡ Ø¹Ù† Ø§Ù„Ù„ÙŠ ÙÙˆÙ‚Ù‡ */
}

/* 2. Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ØªÙƒØªØ¨ ÙÙŠÙ‡ (Ø§Ù„Ø­Ù‚Ù„ Ù†ÙØ³Ù‡) */
.cm-input-wrapper {
    background-color: #1a1a1a !important;  /* Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚ ØµØ±ÙŠØ­ (Ø£ÙØªØ­ Ø³Ù†Ø© Ù…Ù† Ø§Ù„Ø®Ù„ÙÙŠØ©) */
    border: 1px solid #333 !important;     /* Ø¨Ø±ÙˆØ§Ø² ÙˆØ§Ø¶Ø­ */
    backdrop-filter: none !important;
}

/* 3. Ø§Ù„Ù†Øµ Ø¬ÙˆÙ‡ Ø§Ù„Ù…Ø±Ø¨Ø¹ */
.cm-input-wrapper input {
    color: #fff !important; /* Ø§Ù„ÙƒÙ„Ø§Ù… Ø£Ø¨ÙŠØ¶ ÙˆØ§Ø¶Ø­ */
    background: transparent !important; /* Ø¹Ø´Ø§Ù† ÙŠØ§Ø®Ø¯ Ù„ÙˆÙ† Ø§Ù„Ù€ wrapper */
}
/* --- Ø²Ø± Ø§Ù„Ù„Ø§ÙŠÙƒ ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª --- */
.cm-actions {
    display: flex;
    flex-direction: column; /* Ø§Ù„Ù‚Ù„Ø¨ ÙˆØªØ­ØªÙ‡ Ø§Ù„Ø±Ù‚Ù… */
    align-items: center;
    gap: 2px;
    margin-left: 10px;
}

.like-btn-comment {
    color: #777;
    font-size: 14px;
    cursor: pointer;
    transition: 0.2s;
    background: none;
    border: none;
    padding: 5px;
}

.like-btn-comment.liked {
    color: #ff2e63; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ù„Ù…Ø§ ÙŠØ¹Ù…Ù„ Ù„Ø§ÙŠÙƒ */
    animation: pop 0.3s ease;
}

.like-count {
    font-size: 10px;
    color: #aaa;
}

/* --- Ù‡ÙŠØ¯Ø± Ø§Ù„ÙÙ„ØªØ±Ø© (Ø§Ù„Ø£Ø­Ø¯Ø« / Ø§Ù„Ø£ÙØ¶Ù„) --- */
.comments-filter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    background: rgba(0,0,0,0.2);
}

.filter-title {
    font-size: 14px;
    font-weight: bold;
    color: #fff;
}

.filter-select {
    background: rgba(255,255,255,0.1);
    border: none;
    color: #fff;
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 12px;
    outline: none;
    cursor: pointer;
}

.filter-select option {
    background: #222; /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
    color: #fff;
}
/* ==================================================
   1. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø¹Ø´Ø§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ±Ø¬Ø¹)
   ================================================== */
:root {
    --bg-color: #0d0d0f;          /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
    --card-color: #161616;        /* Ù„ÙˆÙ† Ø§Ù„ÙƒØ±ÙˆØª */
    --primary-color: #00C6FF;     /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ */
    --primary-solid: #0072FF;     /* Ø§Ù„Ø£Ø²Ø±Ù‚ */
    --text-color: #eee;           /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ */
    --secondary-text: #aaa;
    --border-color: #222;
    --input-bg: #1f1f1f;
    --header-bg: rgba(22, 22, 22, 0.95); /* Ù„ÙˆÙ† Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„ØºØ§Ù…Ù‚ */
}

/* Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© */
body {
    background-color: var(--bg-color) !important;
    color: var(--text-color);
    margin: 0;
    font-family: "Cairo", sans-serif;
}

/* ==================================================
   2. Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ (Ø§Ù„Ù…Ø¶Ø¨ÙˆØ·)
   ================================================== */
.fb-header {
    background: rgba(13, 13, 15, 0.85) !important; /* Ù„ÙˆÙ† ØºØ§Ù…Ù‚ Ø´ÙØ§Ù */
    backdrop-filter: blur(15px);                  /* ØªØºØ¨ÙŠØ´ Ø§Ù„Ø²Ø¬Ø§Ø¬ */
    -webkit-backdrop-filter: blur(15px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
    width: 100%;
    height: 60px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠÙ…Ø·Ø´ */
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± (ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø¯Ù‚Ø©) */
.fb-top {
    display: flex !important;
    align-items: center !important;      /* Ø³Ù†ØªØ± Ø¹Ù…ÙˆØ¯ÙŠ */
    justify-content: space-between !important; /* ÙŠÙ…ÙŠÙ† - Ù†Øµ - Ø´Ù…Ø§Ù„ */
    height: 100% !important;
    padding: 0 15px !important;
    width: 100%;
}

/* Ø§Ù„Ù„ÙˆØ¬Ùˆ (ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ØªÙ…Ø§Ù…Ø§Ù‹) */
.premium-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    flex: 1; /* ÙŠØ§Ø®Ø¯ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ù†Øµ */
}

/* ØªÙ†Ø³ÙŠÙ‚ Ù†Øµ Ø§Ù„Ù„ÙˆØ¬Ùˆ (Ø«Ø§Ø¨Øª ÙˆÙˆØ§Ø¶Ø­) */
.premium-logo span {
    font-size: 22px;
    font-weight: 900;
    letter-spacing: 1px;
    /* ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ø«Ø§Ø¨Øª ÙˆÙˆØ§Ø¶Ø­ */
    background: linear-gradient(to right, #fff, var(--primary-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 5px rgba(0, 198, 255, 0.4)); /* ØªÙˆÙ‡Ø¬ Ø®ÙÙŠÙ */
}

/* Ø§Ù„Ù‚Ù„Ø¨ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù„ÙˆØ¬Ùˆ */
.heart-container i {
    font-size: 26px;
    color: var(--primary-color);
    filter: drop-shadow(0 0 5px var(--primary-color));
    animation: logo-heartbeat 2.5s infinite ease-in-out;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ø¨Ø­Ø«) - Ù…Ø±Ø¨Ø¹Ø§Øª Ù†Ø§Ø¹Ù…Ø© */
.icon-btn {
    width: 40px !important;
    height: 40px !important;
    border-radius: 12px !important;
    background: rgba(255, 255, 255, 0.05) !important; /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ø®ÙÙŠÙØ© */
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px !important;
    color: #fff !important; /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨ÙŠØ¶Ø§Ø¡ */
    cursor: pointer;
    flex-shrink: 0; /* Ù…Ù…Ù†ÙˆØ¹ ÙŠØµØºØ± */
}

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± */
.icon-btn:active {
    background: var(--primary-color) !important;
    border-color: var(--primary-color) !important;
    transform: scale(0.95);
}
/* --- Ø¥ØµÙ„Ø§Ø­ Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
.user-info {
    cursor: default !important; /* Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙØ§Ø¶ÙŠØ© Ù…ØªØ¹Ù…Ù„Ø´ Ø´ÙƒÙ„ ÙŠØ¯ */
}

.post-avatar {
    cursor: pointer !important; /* Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± */
    position: relative; 
    z-index: 5; /* Ù†Ø±ÙØ¹Ù‡Ø§ ÙÙˆÙ‚ Ø¹Ø´Ø§Ù† Ù†Ø¶Ù…Ù† Ø¥Ù† Ø§Ù„Ø¶ØºØ·Ø© ØªÙŠØ¬ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ */
}

.user-details h4 {
    cursor: pointer !important; /* Ø§Ù„Ø§Ø³Ù… Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± */
    width: fit-content; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø§Ø³Ù… ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ù‚Ø¯ Ø§Ù„ÙƒÙ„Ø§Ù… Ø¨Ø³ ÙˆÙ…ÙŠØ§Ø®Ø¯Ø´ Ø§Ù„Ø³Ø·Ø± ÙƒÙ„Ù‡ */
    position: relative;
    z-index: 5;
}
/* ==================================================
   ğŸ“¨ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ (In-App Banner)
   ================================================== */
#msgBanner {
    position: fixed;
    top: -100px; /* Ù…Ø®ÙÙŠ ÙÙˆÙ‚ Ø§Ù„Ø´Ø§Ø´Ø© */
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 400px;
    
    /* ØªØµÙ…ÙŠÙ… Ø²Ø¬Ø§Ø¬ÙŠ ØºØ§Ù…Ù‚ */
    background: rgba(20, 20, 25, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-left: 4px solid var(--primary-color); /* Ø®Ø· Ù…Ù„ÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù…Ø§Ù„ */
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    
    border-radius: 16px;
    padding: 12px 15px;
    
    display: flex;
    align-items: center;
    gap: 12px;
    
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    z-index: 2000000; /* ÙÙˆÙ‚ ÙƒÙ„ Ø­Ø§Ø¬Ø© */
    
    transition: top 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); /* Ø­Ø±ÙƒØ© Ù…Ø·Ø§Ø·ÙŠØ© */
    cursor: pointer;
    visibility: hidden;
}

/* Ø­Ø§Ù„Ø© Ø§Ù„Ø¸Ù‡ÙˆØ± */
#msgBanner.visible {
    top: 20px; /* ÙŠÙ†Ø²Ù„ Ù„Ù…ÙƒØ§Ù†Ù‡ */
    visibility: visible;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± */
.banner-content {
    flex: 1;
    overflow: hidden;
}

.banner-name {
    font-size: 14px;
    font-weight: 800;
    color: #fff;
    margin-bottom: 2px;
}

.banner-text {
    font-size: 12px;
    color: #aaa;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}


</style>
    
</head>
<body id="mainBody">

    <audio id="notificationSound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3" preload="auto"></audio>

    <div id="uraniumOrb" class="uranium-orb">
        <div id="orbMsgBubble" class="orb-msg-bubble">Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©...</div>
        
       <div class="satellites-container">
    <div class="sat-btn" id="ghostBtn" onclick="toggleGhostMode()" style="transform: rotate(0deg) translate(80px) rotate(0deg);">
        <i class="fa-solid fa-ghost"></i>
    </div>

           <div class="sat-btn" onclick="goToMessages()" style="transform: rotate(72deg) translate(80px) rotate(-72deg);">
        <i class="fa-solid fa-comment-dots"></i>
    </div>

            <div class="sat-btn theme-btn" onclick="openThemeModal()" style="transform: rotate(144deg) translate(80px) rotate(-144deg);">
        <i class="fa-solid fa-palette"></i>
    </div>

             <div class="sat-btn" onclick="playSound('click'); openPage('radar.html')" style="transform: rotate(216deg) translate(80px) rotate(-216deg);">
        <i class="fa-solid fa-satellite-dish"></i>
    </div>

            <div class="sat-btn" onclick="playSound('click'); openPage('capsules.html')" style="transform: rotate(288deg) translate(80px) rotate(-288deg);">
        <i class="fa-solid fa-hourglass-half"></i>
    </div>
</div>
    </div>

    <div id="deleteZone"><i class="fa-solid fa-xmark"></i></div>
    <div class="overlay-bg" id="globalOverlay" onclick="closeAllSheets()"></div>

        <div class="bottom-sheet" id="optionsSheet" style="height: auto;">
        <div class="sheet-handle"></div>
        <div style="padding:10px;">
            <div id="ownerActions" style="display:none;">
                <div class="sheet-option" onclick="openEditPostModal()">
                    <i class="fa-solid fa-pen"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
                </div>
                <div class="sheet-option" onclick="deletePost()" style="color:var(--danger-color);">
                    <i class="fa-solid fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±
                </div>
            </div>
            <div class="sheet-option" onclick="openAudienceModal()">
    <i class="fa-solid fa-users-gear"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±
</div>

            <div class="sheet-option" id="savePostOption" onclick="toggleSavePost()">
                <i class="fa-regular fa-bookmark" id="saveIcon"></i> <span id="saveText">Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</span>
            </div>
            
            <div class="sheet-option" onclick="copyPostLink()">
                <i class="fa-solid fa-link"></i> Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
            </div>

            <div class="sheet-option" onclick="copyPostText()">
                <i class="fa-regular fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ù†Øµ
            </div>

            <div id="hideAction" class="sheet-option" onclick="hidePost()">
                <i class="fa-solid fa-eye-slash"></i> Ù„Ø§ Ø£Ø±ÙŠØ¯ Ø±Ø¤ÙŠØ© Ù‡Ø°Ø§
            </div>

            <div id="reportAction" class="sheet-option" onclick="openReportModal()" style="color:var(--danger-color);">
                <i class="fa-solid fa-triangle-exclamation"></i> Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±
            </div>
            
            <div style="padding:15px; text-align:center; color:var(--secondary-text); font-weight:600; cursor:pointer; border-top:1px solid var(--border-color); margin-top:10px;" onclick="closeAllSheets()">Ø¥Ù„ØºØ§Ø¡</div>
        </div>
    </div>
    

    <div class="custom-modal" id="reportReasonModal">
        <div class="modal-box">
            <h3 style="color:var(--danger-color); margin-bottom:15px;">ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù„Ø§Øº</h3>
            
            <div id="reportButtons" style="display:flex; flex-direction:column; gap:8px;">
                <button class="btn btn-secondary" onclick="submitReport('Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚')">ğŸ” Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚</button>
                <button class="btn btn-secondary" onclick="submitReport('Ø®Ø·Ø§Ø¨ ÙƒØ±Ø§Ù‡ÙŠØ©')">ğŸ¤¬ Ø®Ø·Ø§Ø¨ ÙƒØ±Ø§Ù‡ÙŠØ©</button>
                <button class="btn btn-secondary" onclick="submitReport('Ø§Ø­ØªÙŠØ§Ù„')">ğŸš« Ø§Ø­ØªÙŠØ§Ù„</button>
                <button class="btn btn-secondary" onclick="showOtherReasonInput()">âœï¸ Ø³Ø¨Ø¨ Ø¢Ø®Ø±...</button>
            </div>

            <div id="otherReasonDiv" style="display:none;">
                <textarea id="customReportInput" class="report-textarea" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ù‡Ù†Ø§..."></textarea>
                <button class="btn btn-primary" style="background:var(--danger-color); width:100%" onclick="submitCustomReport()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº</button>
            </div>

            <button style="margin-top:15px; background:none; color:var(--secondary-text); border:none; cursor:pointer;" onclick="document.getElementById('reportReasonModal').style.display='none'">ØªØ±Ø§Ø¬Ø¹</button>
        </div>
    </div>

    <div class="bottom-sheet" id="cmSheet" style="height: 85vh;">
        <div class="sheet-handle"></div>
        <div class="cm-header">
            <span id="cmHeaderCount">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</span>
            <i class="fa-solid fa-xmark" onclick="closeAllSheets()" style="cursor:pointer;"></i>
        </div>
        <div class="cm-body" id="cmList"></div>
       <div class="cm-footer">
    <div class="mention-dropdown" id="mentionDropdown"></div>
    
    <div class="cm-input-wrapper">
        <div id="recordingInterface" class="recording-ui" style="display:none; flex:1; align-items:center; gap:10px;">
            <div class="rec-dot" style="width:12px; height:12px; background:#ff3b30; border-radius:50%; animation:pulse 1s infinite;"></div>
            <span id="recordTimer" style="color:#ff3b30; font-weight:bold;">00:00</span>
            <span style="flex:1"></span>
            <span style="color:#aaa; font-size:12px; cursor:pointer;" onclick="cancelRecording()">Ø¥Ù„ØºØ§Ø¡</span>
        </div>

        <div id="normalInterface" style="display:flex; flex:1; align-items:center;">
            <i class="fa-solid fa-face-laugh-beam sticker-trigger-btn" onclick="toggleStickerSheet('main')"></i>
            <input type="text" class="cm-input" id="cmInput" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..." autocomplete="off">
        </div>
<label style="margin: 0 8px; cursor: pointer; display: flex; align-items: center;">
    <i class="fa-solid fa-camera" style="color:var(--secondary-text); font-size:20px;"></i>
    <input type="file" hidden accept="image/*" onchange="uploadCommentImage(this)">
</label>

        <i class="fa-solid fa-paper-plane cm-send-btn" id="cmSendBtn" onclick="handleCommentAction()"></i>
        
        <i class="fa-solid fa-microphone mic-btn" id="micBtn" onclick="toggleRecording()" style="padding:0 10px; cursor:pointer;"></i>
    </div>
</div>

    </div>

    <div class="bottom-sheet" id="repliesSheet" style="height: 85vh; border-radius: 24px 24px 0 0;">
        <div class="sheet-handle"></div>
        <div class="cm-header">
            <i class="fa-solid fa-arrow-right" onclick="closeRepliesSheet()" style="cursor:pointer; padding:5px;"></i>
            <span>Ø§Ù„Ø±Ø¯ÙˆØ¯</span>
            <i class="fa-solid fa-xmark" onclick="closeAllSheets()" style="cursor:pointer; padding:5px;"></i>
        </div>
        <div class="cm-body" id="repliesList" style="padding-bottom: 80px;"></div>
        <div class="cm-footer">
            <div class="cm-input-wrapper">
                <i class="fa-solid fa-face-laugh-beam sticker-trigger-btn" onclick="toggleStickerSheet('reply')"></i>
                <input type="text" class="cm-input" id="replyInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ø§Ù‹..." autocomplete="off">
                <i class="fa-solid fa-paper-plane cm-send-btn" id="replySendBtn" onclick="sendReplyToComment()"></i>
            </div>
        </div>
    </div>

    <div class="bottom-sheet" id="replyOptionsSheet" style="height: auto;">
        <div class="sheet-handle"></div>
        <div id="replyOwnerOptions" style="display:none;">
            <div class="sheet-option" onclick="triggerEditReplyAction()"><i class="fa-solid fa-pen"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¯</div>
            <div class="sheet-option" onclick="triggerCopyReply()"><i class="fa-regular fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ù†Øµ</div>
            <div class="sheet-option" onclick="triggerDeleteReply()" style="color:var(--danger-color)"><i class="fa-solid fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ø±Ø¯</div>
        </div>
        <div id="replyViewerOptions" style="display:none;">
            <div class="sheet-option" onclick="triggerReplyToUser()" id="replyToUserBtn"><i class="fa-solid fa-reply"></i> Ø±Ø¯</div>
            <div class="sheet-option" onclick="triggerCopyReply()"><i class="fa-regular fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ù†Øµ</div>
            <div class="sheet-option" onclick="submitReport('Ø±Ø¯ Ù…Ø³ÙŠØ¡')" style="color:var(--danger-color)"><i class="fa-solid fa-triangle-exclamation"></i> Ø¥Ø¨Ù„Ø§Øº</div>
        </div>
        <div style="padding:15px; text-align:center; color:var(--secondary-text); font-weight:600; cursor:pointer;" onclick="closeAllSheets(true)">Ø¥Ù„ØºØ§Ø¡</div>
    </div>

       <div class="bottom-sheet" id="commentOptionsSheet" style="height: auto;">
        <div class="sheet-handle"></div>
        
        <div id="cmOwnerOptions">
            <div class="sheet-option" onclick="triggerEditComment()"><i class="fa-solid fa-pen"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</div>
            <div class="sheet-option" onclick="triggerCopyComment()"><i class="fa-regular fa-copy"></i> Ù†Ø³Ø®</div>
            <div class="sheet-option" onclick="triggerDeleteComment()" style="color:var(--danger-color)"><i class="fa-solid fa-trash"></i> Ø­Ø°Ù</div>
        </div>

        <div id="cmViewerOptions" style="display:none">
            <div class="sheet-option" onclick="triggerReplyComment()"><i class="fa-solid fa-reply"></i> Ø±Ø¯</div>
            <div class="sheet-option" onclick="triggerCopyComment()"><i class="fa-regular fa-copy"></i> Ù†Ø³Ø®</div>
            <div class="sheet-option" onclick="submitReport('ØªØ¹Ù„ÙŠÙ‚ Ù…Ø³ÙŠØ¡')" style="color:var(--danger-color)"><i class="fa-solid fa-triangle-exclamation"></i> Ø¥Ø¨Ù„Ø§Øº</div>
        </div>

        <div style="padding:15px; text-align:center; color:var(--secondary-text); font-weight:600; cursor:pointer; border-top:1px solid var(--border-color); margin-top:5px;" onclick="closeAllSheets(true)">
            Ø¥Ù„ØºØ§Ø¡
        </div>
    </div>


    <div class="bottom-sheet" id="stickerSheet" style="height: 50vh;">
        <div class="sheet-handle"></div>
        <div style="padding:15px; text-align:center; font-weight:bold; color:var(--text-color)">Ø§Ø®ØªØ± Ù…Ù„ØµÙ‚Ø§Ù‹</div>
        <div class="stickers-grid" id="stickersGrid"></div>
    </div>

    <div class="custom-modal" id="chicConfirmModal" style="z-index: 9999;">
        <div class="modal-box" style="border: 1px solid var(--border-color); background: var(--card-color); max-width: 320px;">
            <div style="font-size: 40px; margin-bottom: 15px;" id="chicIcon"></div>
            <h3 id="chicTitle" style="margin-bottom: 10px; color: var(--text-color);">ØªØ£ÙƒÙŠØ¯</h3>
            <p id="chicMessage" style="color: var(--secondary-text); font-size: 14px; margin-bottom: 25px; line-height: 1.5;"></p>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeChicModal()" style="flex: 1;">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" id="chicConfirmBtn" style="flex: 1; background: var(--danger-color);">ØªØ£ÙƒÙŠØ¯</button>
            </div>
        </div>
    </div>

    <div class="custom-modal" id="reportReasonModal">
        <div class="modal-box">
            <h3 style="color:var(--danger-color); margin-bottom:15px;">ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù„Ø§Øº</h3>
            <div style="display:flex; flex-direction:column; gap:8px;">
                <button class="btn btn-secondary" onclick="submitReport('Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚')">ğŸ” Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚</button>
                <button class="btn btn-secondary" onclick="submitReport('Ø®Ø·Ø§Ø¨ ÙƒØ±Ø§Ù‡ÙŠØ©')">ğŸ¤¬ Ø®Ø·Ø§Ø¨ ÙƒØ±Ø§Ù‡ÙŠØ©</button>
                <button class="btn btn-secondary" onclick="submitReport('Ø§Ø­ØªÙŠØ§Ù„')">ğŸš« Ø§Ø­ØªÙŠØ§Ù„</button>
            </div>
            <button style="margin-top:15px; background:none; color:var(--secondary-text); border:none; cursor:pointer;" onclick="document.getElementById('reportReasonModal').style.display='none'">ØªØ±Ø§Ø¬Ø¹</button>
        </div>
    </div>

   <div class="custom-modal" id="themeModal">
    <div class="modal-box">
        <h3 style="margin-bottom:5px;">ğŸ¨ ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¸Ù‡Ø±</h3>
        <p style="color:var(--secondary-text); font-size:13px; margin-bottom: 10px;">Ø§Ø®ØªØ± Ù„ÙˆÙ†Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ø£Ùˆ Ø§Ø®ØªØ± Ù„ÙˆÙ† Ù…Ø®ØµØµ</p>
        
        <div class="colors-grid" id="colorsContainer"></div>
        
        <button class="btn btn-secondary" onclick="document.getElementById('themeModal').style.display='none'" style="margin-top:15px; width:100%">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>


    <div class="custom-modal" id="logoutModal">
    <div class="modal-box logout-box">
        <div class="logout-icon-wrapper">
            <i class="fa-solid fa-power-off"></i>
        </div>

        <h3 class="logout-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ</h3>
        <p class="logout-desc">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ<br>Ø³Ù†Ø´ØªØ§Ù‚ Ø¥Ù„ÙŠÙƒ Ø­ØªÙ‰ ØªØ¹ÙˆØ¯!</p>

        <div class="logout-actions">
            <button class="btn-cancel" onclick="document.getElementById('logoutModal').style.display='none'">
                ØªØ±Ø§Ø¬Ø¹
            </button>
            <button class="btn-confirm-logout" onclick="confirmLogout()">
                <i class="fa-solid fa-right-from-bracket"></i> Ù†Ø¹Ù…ØŒ Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </div>
</div>


      <div class="side-menu" id="sideMenu">
<div class="menu-profile-header" onclick="goToProfile()">
    <div class="menu-avatar" id="menuAvatar">U</div>
    
    <div class="menu-user-info">
        <div class="name-row">
            <h3 id="menuName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
        </div>
        <div id="userRankBadge" class="rank-badge-container"></div>
        <span class="profile-link-text">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
    </div>

    <div class="header-status-box" onclick="event.stopPropagation(); toggleOnlineFeature()">
        <div id="headerOnlineBtn" class="toggle-switch small-switch active">
            <div class="toggle-knob"></div>
        </div>
        <span id="headerStatusText" style="font-size: 10px; font-weight: bold; margin-top: 3px; color: #31a24c;">Ù†Ø´Ø·</span>
    </div>
</div>


        
        <div class="menu-items">
    <div class="menu-separator">Ø§Ù„ØªØ±ÙÙŠÙ‡ ÙˆØ§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
 
            <div class="item c-game" onclick="playSound('click'); location.href='games.html'">
                <i class="fa-solid fa-gamepad"></i> Ø§Ù„Ø¹Ø¨ ÙˆØ§Ø±Ø¨Ø­
            </div>
          
            <div class="item c-gift" onclick="playSound('click'); location.href='gifts.html'">
                <i class="fa-solid fa-gift"></i> Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§
            </div>

            <div class="menu-separator" style="margin-top: 10px;">Ø¹Ø§Ù…</div>
 
            <div class="item c-req" onclick="playSound('click'); location.href='friend_requests.html'">
                <i class="fa-solid fa-user-plus"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                <span id="requestsBadge" class="badge-count">0</span>
            </div>
            <div class="item c-msg" onclick="goToMessages()">
        <i class="fa-solid fa-comment-dots"></i> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    </div>

            <div class="item c-friend" onclick="playSound('click'); openPage('friends.html')">
        <i class="fa-solid fa-users"></i> Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
    </div>

           <div class="item c-save" onclick="playSound('click'); openPage('saved_posts.html')">
        <i class="fa-solid fa-bookmark"></i> Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª
    </div>

            <div class="item c-notif" onclick="goToNotifications()">
        <i class="fa-solid fa-bell"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    </div>

            <div class="item" onclick="toggleOrbPreference()" style="flex-direction: row; justify-content: space-between; padding: 0 15px;">
        <div style="display:flex; align-items:center; gap:8px;">
            <i class="fa-solid fa-circle-nodes" style="font-size:18px;"></i> 
            <span>ÙƒØ±Ø© Ø§Ù„ØªÙ†Ù‚Ù„</span>
        </div>

    <div id="orbToggleSwitch" class="toggle-switch active">
            <div class="toggle-knob"></div>
        </div>
    </div>


            <div class="item c-radar" onclick="playSound('click'); openPage('radar.html')">
        <i class="fa-solid fa-satellite-dish"></i> Ø§Ù„Ø±Ø§Ø¯Ø§Ø±
    </div>

          

             <div class="item c-settings" onclick="goToSettings()">
        <i class="fa-solid fa-gear"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    </div>

            
           <div class="item c-admin" id="adminPanelBtn" style="display:none;" onclick="playSound('click'); openPage('admin.html')">
        <i class="fa-solid fa-shield-halved"></i> Ø§Ù„Ù…Ø´Ø±Ù
    </div>

<div class="item" onclick="openAccountSwitcher()"><i class="fa-solid fa-repeat"></i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</div>

<div class="item" onclick="playSound('click'); openPage('verification.html')" 
         style="background: linear-gradient(135deg, #0061ff 0%, #60efff 100%) !important; 
         border: 1px solid rgba(255,255,255,0.2) !important;
         box-shadow: 0 0 20px rgba(0, 97, 255, 0.4); 
         color: #fff !important;
         position: relative; overflow: hidden;">
        <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%); transform: rotate(45deg);"></div>
        <i class="fa-solid fa-certificate" style="font-size: 26px; margin-bottom: 8px; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.2);"></i>
        <span style="font-weight: 800; font-size: 12px; letter-spacing: 0.5px; z-index:1;">ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
        <i class="fa-solid fa-circle-check" style="position: absolute; top: 8px; left: 8px; font-size: 12px; opacity: 0.8;"></i>
    </div>


            <div class="item danger" onclick="openLogoutModal()">
        <i class="fa-solid fa-right-from-bracket"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    </div>

        </div>
    </div>


    <div class="fb-header">
      <div class="fb-top">
    <i class="fa-solid fa-bars icon-btn" onclick="toggleMenu(true)"></i>

    <div class="fb-logo premium-logo" style="gap: 8px; direction: ltr;">
        <div onclick="location.reload()" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <div class="heart-container">
                <i class="fa-solid fa-heart-pulse"></i>
            </div>
            <span style="font-family: 'Poppins', sans-serif; letter-spacing: 0.5px; font-size: 24px; font-weight: 800; background: linear-gradient(to bottom, #fff 20%, var(--primary-color) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 5px var(--primary-color));">
                Wareed
            </span>
        </div>
    </div>

    <i class="fa-solid fa-magnifying-glass icon-btn" onclick="openFullSearch()"></i>
</div>

                                             

    <div class="container">
<div class="new-post-wrapper">
    <div class="np-input-trigger" onclick="playSound('click'); openPage('create_post.html')">
        <div class="np-avatar" id="myAvatar">U</div>
        <span class="typing-text" id="dynamicPlaceholder">Ø´Ø§Ø±ÙƒÙ†Ø§ Ù„Ø­Ø¸Ø§ØªÙƒ... âœ¨</span>
    </div>

    <div class="np-media-btn" onclick="playSound('click'); openPage('create_media.html')">
        <i class="fa-solid fa-image"></i>
    </div>
</div>

        </div>
        <div id="postsList"></div>
        <div id="scrollSentinel" style="display: none; text-align: center; padding: 20px;"></div>
    </div>
<div id="top-progress-bar"></div>

    <div id="toast"><i class="fa-solid fa-check-circle"></i> <span id="toast-msg">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</span></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        
        moment.locale('ar');
        const firebaseConfig = {
    apiKey: "AIzaSyDpvqNAReChsHn5tFJSp7vV_EJHmtD2x4c",
    authDomain: "pools-e4381.firebaseapp.com",
    projectId: "pools-e4381",
    storageBucket: "pools-e4381.firebasestorage.app",
    messagingSenderId: "339799216046",
    appId: "1:339799216046:web:26e437a7b7d5c24fe9023f"
};

// 1. ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ø§ØªØ¹Ø±Ù Ø¨Ø§Ù„Ù€ Config Ø¨ØªØ§Ø¹Ùƒ Ø§Ù„Ø£ÙˆÙ„
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}

// 2. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¢Ù…Ù†Ø©)
const auth = firebase.auth();
const db = firebase.firestore();
    
    window.isOnlineFeatureEnabled = localStorage.getItem('nabd_online_status') !== 'false';
let storage;
// ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ± Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù„Ù…ÙŠ Ø¹Ø´Ø§Ù† ÙŠØªØ´Ø§Ù ÙÙŠ ÙƒÙ„ Ø­ØªØ©


try {
    storage = firebase.storage(); // Ù…Ø´ Ù‡ÙŠÙˆÙ‚Ù Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø­ØªÙ‰ Ù„Ùˆ ÙÙŠÙ‡ Ù…Ø´ÙƒÙ„Ø©
    console.log("Storage ready!");
} catch (e) {
    console.error("Storage library missing!", e);
}

let currentUser = null, lastVisibleDoc = null, isLoading = false;
let isGhost = false;
let currentPostId = null;
let currentPostOwnerUid = null;  // âœ… ÙƒÙ…Ù„ Ø§Ù„Ø³Ø·Ø±
let currentPostText = "";
let isCurrentPostSaved = false;
let activeStickerContext = null;
let searchTimeout;
let lastReqCount = 0;
let isGlobalMuted = true;
let currentPostPrivacy = 'public';
let isRedirecting = false;
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ±
        let selectedComment = null;
        let isEditingComment = false;
        let selectedReply = null;
        let isEditingReply = false;
        let currentParentComment = null;
        let currentSubReplyTarget = null;
        let directMentionData = null;
        let activeInputId = '';
        let pressTimer;

        const ghostColors = ["#ff0000", "#00ff00", "#0099ff", "#ffff00", "#ff00ff", "#00ffff", "#ff9900", "#9900ff", "#ffffff", "#00ff99"];
        const stickerCollection = ["ğŸ¤£", "ğŸ˜‚", "ğŸ˜…", "ğŸ¥¹", "ğŸ˜", "ğŸ¥°", "ğŸ˜˜", "ğŸ¤ª", "ğŸ˜", "ğŸ˜­", "ğŸ˜¢", "ğŸ˜¤", "ğŸ˜¡", "ğŸ¤¬", "ğŸ¤¯", "ğŸ˜³", "ğŸ˜±", "ğŸ˜´", "ğŸ¤®", "ğŸ¤¡", "ğŸ’€", "ğŸ‘»", "ğŸ‘½", "ğŸ’©", "ğŸ‘", "ğŸ‘", "ğŸ‘Œ", "âœŒï¸", "â¤ï¸", "ğŸ’”", "ğŸ”¥", "âœ¨"];
const audioLibrary = {
    like: new Audio('https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3'),
    sent: new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3'),
    success: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
    click: new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'),
    tab: new Audio('https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3'),
    notification: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3'),
    
    // ğŸ‘‡ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© ğŸ‘‡
    typing: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-typing-on-mechanical-keyboard-1388.mp3'), // ØµÙˆØª ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ
    incoming: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3') // ØµÙˆØª Ø±Ø³Ø§Ù„Ø© "Ø¨ÙˆØ¨" Ø§Ø­ØªØ±Ø§ÙÙŠ
};

// Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ØªÙ‚Ø¯Ø± ØªØºÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· Ø¯Ù‡ Ø¨Ø£ÙŠ ØµÙˆØ±Ø© ØªØ¹Ø¬Ø¨Ùƒ)
const defaultAvatar = "https://cdn-icons-png.flaticon.com/512/149/149071.png"; 

        function playSound(type) {
            const sound = audioLibrary[type];
            if (sound) { sound.currentTime = 0; sound.volume = 0.5; sound.play().catch(e => {}); }
        }

    function getBadge(isVerified, isGhost) {
    if (isGhost) return '';
    // Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ù‡Ù†Ø§ fa-heart-circle-check Ù„ÙŠÙƒÙˆÙ† Ø´ÙƒÙ„Ù‡Ø§ Ù‚Ù„Ø¨ Ù…ÙˆØ«Ù‚
    // ÙˆØ£Ø¶ÙÙ†Ø§ ÙƒÙ„Ø§Ø³ nabd-badge Ø¹Ø´Ø§Ù† Ø§Ù„Ø­Ø±ÙƒØ©
    return isVerified ? `<i class="fa-solid fa-heart-circle-check nabd-badge"></i>` : '';
}

/* --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† XSS --- */
function escapeHTML(str) {
    if (!str) return "";
    return str.replace(/[&<>'"]/g, 
        tag => ({
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            "'": '&#39;',
            '"': '&quot;'
        }[tag]));
}

        /* --- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© --- */
        function generateColor(uid) { 
            const c=["#5D5FEF","#34c759","#ff3b30","#ffb533","#2AF598","#009EFD"]; 
            let h=0; for(let i=0;i<uid.length;i++) h=uid.charCodeAt(i)+((h<<5)-h); 
            return c[Math.abs(h)%c.length]; 
        }
        function getGhostIdentity(uid) {
            let hash=0; for(let i=0;i<uid.length;i++) hash=uid.charCodeAt(i)+((h=hash<<5)-hash);
            hash=Math.abs(hash); return { id: (hash%9000)+1000, color: ghostColors[hash%ghostColors.length] };
        }
        function showToast(m) { const t=document.getElementById('toast'); document.getElementById('toast-msg').innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
        
      function closeAllSheets(keepComments = false) {
          document.body.classList.remove('no-scroll');

    document.querySelectorAll('.bottom-sheet').forEach(s => {
        if(keepComments && s.id === 'cmSheet') return;
        s.classList.remove('active');
    });

    if(!keepComments) {
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ©
        const overlay = document.getElementById('globalOverlay');
        if(overlay) overlay.style.display = 'none';

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        document.getElementById('sideMenu').classList.remove('open');
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø£ÙŠ Ù…ÙˆØ¯Ø§Ù„ Ù…ÙØªÙˆØ­
        document.querySelectorAll('.custom-modal').forEach(m => m.style.display='none');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„ØµÙØ­Ø©
        document.body.style.overflow = 'auto';
document.querySelector('.fb-icons').classList.remove('hide-nav');

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        isEditingComment = false; selectedComment = null;
        isEditingReply = false; selectedReply = null;
        document.querySelectorAll('.cm-bubble').forEach(b => b.classList.remove('highlight'));
        document.getElementById('cmInput').value = "";
        document.getElementById('replyInput').value = "";
    }
}

        
        function formatNumber(num) { if(num>=1000) return (num/1000).toFixed(1)+'k'; return num; }

        /* --- Ø§Ù„Ø¨Ø¯Ø¡ --- */
        // Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© auth.onAuthStateChanged Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø¯Ù‡
auth.onAuthStateChanged(async user => {
    if(!user) { location.href="index.html"; return; }
    currentUser = user;
    
    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const doc = await db.collection('users').doc(user.uid).get();
        const d = doc.data() || {};
 const finalPic = d.profilePic || "https://cdn-icons-png.flaticon.com/512/149/149071.png"; 

    // 1. Ø¥Ø¹Ø¯Ø§Ø¯ ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„ÙŠ Ø¨ØªØ¶ØºØ· Ø¹Ù„ÙŠÙ‡ Ø¹Ø´Ø§Ù† ØªÙƒØªØ¨ Ø¨ÙˆØ³Øª)
    const myAvatarElem = document.getElementById('myAvatar');
    if(myAvatarElem) {
        myAvatarElem.style.backgroundImage = `url('${finalPic}')`;
        myAvatarElem.innerText = "";
    }
    

    
    // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø©)
    document.getElementById('menuName').innerText = d.name || "Ù…Ø³ØªØ®Ø¯Ù…";
    const menuAvatarElem = document.getElementById('menuAvatar');
    if(menuAvatarElem) {
        menuAvatarElem.style.backgroundImage = `url('${finalPic}')`;
        menuAvatarElem.innerText = ""; 
const bottomAvatar = document.getElementById('bottomNavAvatar');
    if(bottomAvatar) {
        bottomAvatar.style.backgroundImage = `url('${finalPic}')`;
    }


        // ğŸ”¥ğŸ”¥ğŸ”¥ Ù‡Ù†Ø§ ÙƒÙˆØ¯ Ø§Ù„Ù„Ù…Ø¨Ø© Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ´ØºÙ„Ù‡Ø§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±Ø§Ø± ğŸ”¥ğŸ”¥ğŸ”¥
        // Ø§Ù„Ù…ØªØºÙŠØ± window.isOnlineFeatureEnabled Ø§Ø­Ù†Ø§ Ø¹Ø±ÙÙ†Ø§Ù‡ ÙÙˆÙ‚ Ø®Ù„Ø§Øµ
        if (window.isOnlineFeatureEnabled) {
            menuAvatarElem.classList.add('online'); // Ù†ÙˆØ± Ø§Ù„Ù„Ù…Ø¨Ø©
        } else {
            menuAvatarElem.classList.remove('online'); // Ø·ÙÙŠÙ‡Ø§
        }
    }

    // 3. Ù„Ùˆ Ø£Ù†Øª Ø§Ù„Ø£Ø¯Ù…Ù† (Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¯Ù‡)ØŒ Ø§Ø¸Ù‡Ø± Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø±Ù
    if (user.email === 'yahiakhodir114@gmail.com') {
        const adminBtn = document.getElementById('adminPanelBtn');
        if(adminBtn) adminBtn.style.display = 'flex';
    }

    // 4. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø©
    db.collection('users').doc(user.uid).collection('friendRequests').onSnapshot(snap => {
        const badge = document.getElementById('requestsBadge');
        if(badge) {
            if (snap.size > 0) {
                badge.style.display = 'inline-block'; 
                badge.innerText = snap.size;
                if(snap.size > lastReqCount) playSound('notification');
            } else { 
                badge.style.display = 'none'; 
            }
            lastReqCount = snap.size;
        }
    });

    // ØªØ´ØºÙŠÙ„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
    updateHeaderBadges();
    monitorIncomingMessages();
    monitorMessageCount();
    
    // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø±Ø§Ø± Ø¹Ø´Ø§Ù† ÙŠØ¨Ù‚Ù‰ Ù…ØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ù„Ù…Ø¨Ø©
    if(typeof updateOnlineToggleUI === 'function') updateOnlineToggleUI();

    // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… "Ø£Ù†Ø§ Ù…ÙˆØ¬ÙˆØ¯" Ø¹Ø´Ø§Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ø±Ù Ø¥Ù†Ùƒ ÙØ§ØªØ­
    if(typeof startPresenceSystem === 'function') startPresenceSystem(user.uid);

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª ÙˆØ§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…ÙØ¶Ù„
    const savedColor = localStorage.getItem('themeColor');
    if(savedColor) changeTheme(savedColor, false);
    
    loadPosts();

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ÙŠÙ† (Scroller & Video)
    const sentinel = document.getElementById('scrollSentinel');
    if(sentinel) {
        new IntersectionObserver(entries => {
            if(entries[0].isIntersecting && !isLoading) loadPosts(true);
        }).observe(sentinel);
    }
    
    const videoObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.play().catch(()=>{});
            else entry.target.pause();
        });
    }, { threshold: 0.7 });
    window.videoObserver = videoObserver;
});

let usersNameCache = {};
let chatsLastState = {};
let appStartTime = Date.now();

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© ØªØ¬ÙŠØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆØªØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ ÙˆØµÙ„
async function getSenderName(uid) {
    if (!uid) return "Ù…Ø³ØªØ®Ø¯Ù…";
    if (usersNameCache[uid]) return usersNameCache[uid]; // Ù„Ùˆ Ù…Ø­ÙÙˆØ¸ Ù‡Ø§ØªÙ‡ Ø¹Ù„Ø·ÙˆÙ„

    try {
        const doc = await db.collection('users').doc(uid).get();
        if (doc.exists) {
            const name = doc.data().name || "Ù…Ø³ØªØ®Ø¯Ù…";
            usersNameCache[uid] = name; // Ø§Ø­ÙØ¸Ù‡ Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø¬Ø§ÙŠØ©
            return name;
        }
    } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…:", e);
    }
    return "Ù…Ø³ØªØ®Ø¯Ù…"; // Ù„Ùˆ ÙØ´Ù„ Ø®Ø§Ù„Øµ
}
function monitorIncomingMessages() {
    if (!auth.currentUser) return;
    const myUid = auth.currentUser.uid;

    db.collection('chats')
      .where('users', 'array-contains', myUid)
      .onSnapshot(snapshot => {
        snapshot.docChanges().forEach(async (change) => {
            const data = change.doc.data();
            const chatId = change.doc.id;
            
            // ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
            const otherUserId = data.users.find(u => u !== myUid) || data.lastSenderId;

            // ØªØ¬Ø§Ù‡Ù„ Ù„Ùˆ Ø£Ù†Ø§ Ø§Ù„Ù…Ø±Ø³Ù„
            if (data.lastSenderId === myUid) return;

            // Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…
            const realName = await getSenderName(otherUserId);

            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙ‚ÙŠØª
            let msgTime = 0;
            if (data.lastMessageTime && data.lastMessageTime.toMillis) msgTime = data.lastMessageTime.toMillis();
            else msgTime = Date.now();

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ùˆ Ø£ÙˆÙ„ Ù…Ø±Ø©
            if (!chatsLastState[chatId]) {
                chatsLastState[chatId] = { time: msgTime, typing: false };
                return;
            }

            // ===========================================
            // ğŸ“¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø£: Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØµÙ„Øª
            // ===========================================
            if (msgTime > chatsLastState[chatId].time && msgTime > appStartTime) {
                chatsLastState[chatId].time = msgTime;
                
                let msgText = data.lastMessage;
                if (msgText.includes('http') && !msgText.includes(' ')) msgText = "ğŸ“· ØµÙˆØ±Ø©/Ù…Ù„Ù";

                // ğŸ”¥ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù‡Ù†Ø§
                playSound('incoming');

                triggerUraniumAlert(`${realName}: ${msgText}`, {name: realName}, false);
                
                chatsLastState[chatId].typing = false;
            }
            
            // ===========================================
            // âœï¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨: ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†
            // ===========================================
            else {
                const typingMap = data.typingStatus || {};
                const now = Date.now();
                let isTyping = false;

                if (typingMap[otherUserId] && (now - typingMap[otherUserId] < 5000)) {
                    isTyping = true;
                }

                if (isTyping && !chatsLastState[chatId].typing) {
                    
                    // ğŸ”¥ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ÙƒØªØ§Ø¨Ø© (ÙƒÙŠØ¨ÙˆØ±Ø¯) Ù‡Ù†Ø§
                    playSound('typing');

                    triggerUraniumAlert(`${realName} ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†... âœï¸`, {name: realName}, true);
                    
                    chatsLastState[chatId].typing = true;

                    setTimeout(() => {
                        chatsLastState[chatId].typing = false;
                    }, 5000);
                }
            }
        });
    });
}

function monitorMessageCount() {
    if (!auth.currentUser) return;

    db.collection('chats')
      .where('users', 'array-contains', auth.currentUser.uid)
      .onSnapshot(snap => {
          // ğŸ”¥ Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø³ØŒ ÙˆÙ‚Ù ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
          if (isRedirecting) return;

          let totalUnread = 0;
          snap.forEach(doc => {
              const data = doc.data();
              if (data.lastSender !== auth.currentUser.uid && data.unreadCount > 0) {
                  totalUnread += data.unreadCount;
              }
          });

          const badge = document.getElementById('topMsgCount');
          if (badge) {
              if (totalUnread > 0) {
                  badge.innerText = totalUnread > 99 ? '99+' : totalUnread;
                  badge.classList.add('visible');
                  badge.style.display = 'flex';
                  badge.style.opacity = '1';
              } else {
                  badge.classList.remove('visible');
                  badge.style.display = 'none';
              }
          }
      });
}


// 3. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Uranium Alert) Ø§Ù„Ù…Ø·ÙˆØ±Ø©
function triggerUraniumAlert(text, senderInfo, isTyping) {
    const orb = document.getElementById('uraniumOrb');
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙÙ‚Ø§Ø¹Ø© Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø©
    let bubble = document.getElementById('orbMsgBubble');
    if (!bubble) {
        bubble = document.createElement('div');
        bubble.id = 'orbMsgBubble';
        bubble.className = 'orb-msg-bubble'; 
        orb.appendChild(bubble);
    }

    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØ±Ø© (Ù„Ùˆ Ù…ÙÙŠØ´ ØµÙˆØ±Ø© Ù†Ø­Ø· Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„)
    let avatarHtml = '';
    if (senderInfo.pic) {
        avatarHtml = `<div class="orb-avatar" style="background-image: url('${senderInfo.pic}');"></div>`;
    } else {
        avatarHtml = `<div class="orb-avatar" style="background-color: ${senderInfo.color || '#555'};">${senderInfo.char}</div>`;
    }

    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨ØªÙ†Ø³ÙŠÙ‚ HTML Ø§Ø­ØªØ±Ø§ÙÙŠ
    const htmlContent = `
        <div class="orb-notification-content">
            ${avatarHtml}
            <div class="orb-text">
                <span class="orb-name">${senderInfo.name}</span>
                <span class="orb-message" style="${isTyping ? 'font-style:italic; color:#aaa;' : ''}">${text}</span>
            </div>
        </div>
    `;

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
    const audio = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3");
    audio.play().catch(e=>{});
    if(navigator.vibrate) navigator.vibrate(200);

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    orb.classList.add('red-alert');
    bubble.innerHTML = htmlContent;
    bubble.classList.add('show-msg');
    
    // Ø¶Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„ÙƒØªÙŠØ±
    bubble.style.padding = "5px 15px 5px 5px"; 
    bubble.style.borderRadius = "30px";
    
    // Ø§Ù„Ø¥Ø®ÙØ§Ø¡
    setTimeout(() => {
        orb.classList.remove('red-alert');
        bubble.classList.remove('show-msg');
    }, 4000);
}





        function triggerUraniumAlert(msg) {
            playSound('notification');
            if (navigator.vibrate) navigator.vibrate([200, 100, 300]);
            const orb = document.getElementById('uraniumOrb');
            const bubble = document.getElementById('orbMsgBubble');
            orb.classList.add('red-alert');
            bubble.innerHTML = msg;
            bubble.classList.add('show-msg');
            setTimeout(() => { orb.classList.remove('red-alert'); bubble.classList.remove('show-msg'); }, 5000);
        }
/* --- Ù…ØªØºÙŠØ±Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø­Ø« --- */
let searchHistory = JSON.parse(localStorage.getItem('nabd_search_history') || '[]');
let currentSearchQuery = "";

// 1. ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
function openFullSearch() {
    closeAllSheets(); 
    document.getElementById('fullSearchPage').classList.add('active');
    document.getElementById('superSearchInput').focus();
    
    renderSearchHistory();
    loadTrendingSearches();
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù„Ø­ÙŠÙ† Ø§Ù„Ø¨Ø­Ø«
    document.getElementById('searchResultTabs').style.display = 'none';
    document.getElementById('searchHistorySection').style.display = 'block';
    document.getElementById('searchResultsSection').style.display = 'none';

    // ğŸ”¥ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø¥ÙŠÙ‚Ø§Ù ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ§Ù‹
    document.querySelectorAll('#postsList video').forEach(v => v.pause());
}

function closeSearchPage() {
    document.getElementById('fullSearchPage').classList.remove('active');
    
    // ğŸ”¥ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    // (Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ù‡ÙŠØ´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¯ÙˆØ± Ù„ÙˆØ­Ø¯Ù‡)
    const visibleVideos = document.querySelectorAll('#postsList video');
    if(window.videoObserver) {
        visibleVideos.forEach(v => window.videoObserver.observe(v));
    }
}


function clearSearchInput() {
    document.getElementById('superSearchInput').value = '';
    document.getElementById('clearSearchBtn').style.display = 'none';
    document.getElementById('superSearchInput').focus();
    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ø¬Ù„
    document.getElementById('searchResultTabs').style.display = 'none';
    document.getElementById('searchHistorySection').style.display = 'block';
    document.getElementById('searchResultsSection').style.display = 'none';
}

// 3. Ø¥Ø¯Ø§Ø±Ø© Ø³Ø¬Ù„ Ø§Ù„Ø¨Ø­Ø« (History)
let isHistoryExpanded = false; // Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø±

function renderSearchHistory() {
    const list = document.getElementById('historyList');
    const btn = document.getElementById('showMoreBtn');
    list.innerHTML = "";
    
    if(searchHistory.length === 0) {
        list.innerHTML = "<div style='text-align:center; padding:20px; color:#777'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¨Ø­Ø«</div>";
        btn.style.display = 'none';
        return;
    }

    searchHistory.forEach((item, index) => {
        const div = document.createElement('div');
        
        div.className = 'history-item';
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø«Ø§Ù„Ø« Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ³Ø¹Ø§Ù‹
        if (index >= 3 && !isHistoryExpanded) {
            div.classList.add('hidden-item');
        }

        const isUser = item.type === 'user';
        const iconOrImg = isUser 
            ? `<div class="history-avatar" style="${item.pic ? `background-image:url('${item.pic}')` : `background:${generateColor(item.id || 'x')}`}">${item.pic ? '' : (item.name[0])}</div>`
            : `<div class="history-avatar" style="background:rgba(255,255,255,0.05); color:#aaa;"><i class="fa-solid fa-clock-rotate-left"></i></div>`;

        div.innerHTML = `
            <div class="history-info" onclick="useHistoryItem('${item.text}')">
                ${iconOrImg}
                <div style="font-weight:600; font-size:14px;">${item.name || item.text}</div>
            </div>
            <i class="fa-solid fa-xmark" style="color:#555; padding:10px;" onclick="deleteHistoryItem(${index})"></i>
        `;
        list.appendChild(div);
    });

    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¸Ù‡ÙˆØ± Ø²Ø± "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯"
    if (searchHistory.length > 3) {
        btn.style.display = 'block';
        btn.innerText = isHistoryExpanded ? 'Ø¹Ø±Ø¶ Ø£Ù‚Ù„ â˜ï¸' : 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ ğŸ‘‡';
    } else {
        btn.style.display = 'none';
    }
}
// 1. Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
function updateSearchTrendCounter(term) {
    if(!term || term.startsWith('#') || term.startsWith('@')) return; // Ù„Ø§ Ù†Ø­Ø³Ø¨ Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ ÙˆØ§Ù„Ù…Ù†Ø´Ù† Ù‡Ù†Ø§
    
    const cleanTerm = term.trim().toLowerCase();
    const trendRef = db.collection('search_trends').doc(cleanTerm);

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Transaction Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø¹Ø¯
    db.runTransaction(async (transaction) => {
        const doc = await transaction.get(trendRef);
        if (!doc.exists) {
            transaction.set(trendRef, { 
                term: cleanTerm, 
                count: 1, 
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp() 
            });
        } else {
            transaction.update(trendRef, { 
                count: firebase.firestore.FieldValue.increment(1),
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });
        }
    }).catch(console.error);
}

// 2. Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„ØªØ±ÙŠÙ†Ø¯
async function loadTrendingSearches() {
    const container = document.getElementById('trendingContainer');
    // Ø¬Ù„Ø¨ Ø£Ø¹Ù„Ù‰ 10 ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø«Ø§Ù‹
    try {
        const snap = await db.collection('search_trends')
            .orderBy('count', 'desc')
            .limit(10)
            .get();

        container.innerHTML = "";
        if (snap.empty) {
            container.innerHTML = "<div style='font-size:12px; color:#555; width:100%; text-align:center;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ±ÙŠÙ†Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹</div>";
            return;
        }

        snap.forEach((doc, index) => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'trend-chip';
            div.onclick = () => useHistoryItem(data.term);
            div.innerHTML = `
                <span class="trend-rank">#${index + 1}</span>
                <span>${data.term}</span>
                ${index < 3 ? '<i class="fa-solid fa-fire" style="font-size:10px; color:#ff5722;"></i>' : ''}
            `;
            container.appendChild(div);
        });
    } catch (e) {
        console.error("Error loading trends:", e);
        container.innerHTML = "";
    }
}

function toggleHistoryView() {
    isHistoryExpanded = !isHistoryExpanded;
    renderSearchHistory(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø³Ù… Ø¨Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
}

function addToHistory(obj) {
    // obj = { type: 'text'|'user', text: '...', name: '...', id: '...', pic: '...' }
    // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±: Ù†Ø­Ø°Ù Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ ÙˆÙ†Ø¶ÙŠÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø£ÙˆÙ„
    searchHistory = searchHistory.filter(x => x.text !== obj.text);
    searchHistory.unshift(obj);
    if(searchHistory.length > 10) searchHistory.pop(); // Ù†Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± 10 ÙÙ‚Ø·
    localStorage.setItem('nabd_search_history', JSON.stringify(searchHistory));
}

function deleteHistoryItem(index) {
    searchHistory.splice(index, 1);
    localStorage.setItem('nabd_search_history', JSON.stringify(searchHistory));
    renderSearchHistory();
}

function clearSearchHistory() {
    if(confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„ØŸ')) {
        searchHistory = [];
        localStorage.setItem('nabd_search_history', '[]');
        renderSearchHistory();
    }
}

function useHistoryItem(text, type, id) {
    document.getElementById('superSearchInput').value = text || name;
    if(type === 'user' && id) {
        window.location.href = `profile.html?uid=${id}`;
    } else {
        performSuperSearch();
    }
}


// 5. ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
function switchSearchTab(tab) {
    // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.sp-tab').forEach(t => {
        t.classList.remove('active');
        if(t.innerText.includes('Ø§Ù„ÙƒÙ„') && tab === 'all') t.classList.add('active');
        if(t.innerText.includes('Ø£Ø´Ø®Ø§Øµ') && tab === 'people') t.classList.add('active');
        if(t.innerText.includes('Ù†Ø¨Ø¶') && tab === 'nabd') t.classList.add('active');
        if(t.innerText.includes('Ù‡Ø§Ø´ØªØ§Ø¬') && tab === 'hashtags') t.classList.add('active');
        if(t.innerText.includes('Ù…Ù†Ø´ÙˆØ±Ø§Øª') && tab === 'posts') t.classList.add('active');
    });

    const people = document.getElementById('resPeople');
    const videos = document.getElementById('resNabdVideos');
    const hashtags = document.getElementById('resHashtags');
    const posts = document.getElementById('resPosts');

    // 2. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„
    people.style.display = 'none';
    videos.style.display = 'none';
    hashtags.style.display = 'none';
    posts.style.display = 'none';

    // 3. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙÙ‚Ø·
    if (tab === 'all') {
        people.style.display = 'block';
        hashtags.style.display = 'block';
        posts.style.display = 'block';
        videos.style.display = 'none'; // ğŸ”¥ Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù‡Ù†Ø§ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
    } 
    else if (tab === 'people') {
        people.style.display = 'block';
    } 
    else if (tab === 'nabd') {
        videos.style.display = 'block';
    } 
    else if (tab === 'hashtags') {
        hashtags.style.display = 'block';
    } 
    else if (tab === 'posts') {
        posts.style.display = 'block';
    }
}



       function openThemeModal() { 
    playSound('click'); 
    closeAllSheets(); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
    document.getElementById('themeModal').style.display = 'flex'; 
}
        function changeTheme(color, play=true) {
            document.documentElement.style.setProperty('--primary-color', color);
            localStorage.setItem('themeColor', color);
            if(play) playSound('success');
            document.getElementById('themeModal').style.display = 'none';
        }

        function openLogoutModal() { playSound('click'); closeAllSheets(); document.getElementById('logoutModal').style.display = 'flex'; }
        function confirmLogout() { playSound('click'); firebase.auth().signOut().then(() => location.href="index.html"); }
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø±Ø³Ù… Ø§Ù„Ù‡ÙŠÙƒÙ„ (Ø¹Ø´Ø§Ù† Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¨Ø³Ù‡ÙˆÙ„Ø©)
function getSkeletonHTML() {
    return `
    <div class="skeleton-card">
        <div class="sk-header">
            <div class="skeleton sk-avatar"></div>
            <div style="flex:1">
                <div class="skeleton sk-line" style="width: 40%"></div>
                <div class="skeleton sk-line" style="width: 25%"></div>
            </div>
        </div>
        <div class="skeleton sk-body"></div>
    </div>
    `.repeat(2); // ÙŠÙƒØ±Ø± Ø§Ù„Ø´ÙƒÙ„ Ù…Ø±ØªÙŠÙ†
}

async function loadPosts(more = false) {
    if (isLoading) return;
    isLoading = true;
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
    if(typeof startLoadingBar === "function") startLoadingBar();

    const list = document.getElementById('postsList');
    const sentinel = document.getElementById('scrollSentinel');

    // 1. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø´ÙƒÙ„ Ù‚Ø¨Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    if (!more) {
        // Ù„Ùˆ Ø£ÙˆÙ„ Ù…Ø±Ø©: Ø§Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ø¹Ø±Ø¶ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙƒØ¨ÙŠØ±
        list.innerHTML = getSkeletonHTML(); 
        sentinel.style.display = 'none'; 
    } else {
        // Ù„Ùˆ Ø¨Ù†Ø­Ù…Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯: Ø§Ø¸Ù‡Ø± Ø§Ù„Ø­Ø³Ø§Ø³ ÙˆØ­Ø· ÙÙŠÙ‡ Ø´ÙƒÙ„ ØªØ­Ù…ÙŠÙ„ Ø®Ø·ÙŠ
        sentinel.style.display = 'flex';
        sentinel.innerHTML = '<div class="skeleton sk-line" style="width:120px; height:10px; border-radius:10px; margin:auto; opacity:0.7"></div>'; 
    }

    let q = db.collection('posts').orderBy('createdAt', 'desc').limit(20);
    if (more && lastVisibleDoc) q = q.startAfter(lastVisibleDoc);

    try {
        const snap = await q.get();

        // 2. Ù„Ùˆ Ø¯ÙŠ Ø£ÙˆÙ„ Ù…Ø±Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØµÙ„ØªØŒ Ø§Ù…Ø³Ø­ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙˆÙ‡Ù…ÙŠ
        if (!more) {
            list.innerHTML = ""; 
        }

        // --- ğŸ”¥ Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù‡Ù†Ø§: Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø®Ù„ØµØªØŸ ---
        if (snap.empty) {
            const emptyDesign = `
                <div class="empty-state-container" style="padding: 40px 10px; padding-bottom: 120px;"> <div class="empty-icon-box">
                        <i class="fa-solid fa-check-double"></i>
                    </div>
                    <div class="empty-title">${more ? 'ÙˆØµÙ„Øª Ù„Ù„Ù†Ù‡Ø§ÙŠØ©' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª'}</div>
                    <div class="empty-desc">${more ? 'Ù„Ù‚Ø¯ ØªØµÙØ­Øª ÙƒÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.' : 'ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ Ù„Ø­Ø¸Ø§ØªÙ‡ Ù‡Ù†Ø§!'}</div>
                    <button class="empty-btn" onclick="loadPosts()">                        <i class="fa-solid fa-rotate-right"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                    </button>
                </div>
            `;

            if (!more) {
                // Ø§Ù„Ø­Ø§Ù„Ø© 1: Ø§Ù„ØµÙØ­Ø© ÙØ§Ø¶ÙŠØ© Ù…Ù† Ø§Ù„Ø£ÙˆÙ„
                list.innerHTML = emptyDesign;
                sentinel.style.display = 'none';
            } else {
                // Ø§Ù„Ø­Ø§Ù„Ø© 2: Ù†Ø²Ù„Øª Ù„Ù„Ø¢Ø®Ø± ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø®Ù„ØµØª
                // ğŸ”¥ Ø§Ù„ØªØºÙŠÙŠØ±: Ø­Ø·ÙŠÙ†Ø§ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¬ÙˆÙ‡ Ø§Ù„Ø­Ø³Ø§Ø³ Ù†ÙØ³Ù‡ Ø¹Ø´Ø§Ù† Ù†Ø¶Ù…Ù† Ù…ÙƒØ§Ù†Ù‡Ø§
                sentinel.style.display = 'block';
                sentinel.innerHTML = emptyDesign;
            }
            
            if(typeof finishLoadingBar === "function") finishLoadingBar();
            isLoading = false;
            return;
        }

        // --- ØªÙ… Ø¬Ù„Ø¨ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ---
        lastVisibleDoc = snap.docs[snap.docs.length - 1];

        const fragment = document.createDocumentFragment();
        for (const doc of snap.docs) {
            const postElement = await renderPost({ id: doc.id, ...doc.data() }, true);
            if (postElement) {
                fragment.appendChild(postElement);
            }
        }
        list.appendChild(fragment);

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø³ Ù„Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø¬Ø§ÙŠØ©
        if(more) {
            sentinel.innerHTML = ''; // ÙØ¶ÙŠ Ø§Ù„Ù„ÙˆØ¯Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…
            sentinel.style.display = 'block'; // Ø®Ù„ÙŠÙ‡ Ø¬Ø§Ù‡Ø²
            sentinel.style.height = '20px'; // Ø§Ø¯ÙŠÙ„Ù‡ Ø·ÙˆÙ„ Ø¹Ø´Ø§Ù† Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ ÙŠØ­Ø³ Ø¨ÙŠÙ‡
        } else {
            sentinel.style.display = 'block';
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
        document.querySelectorAll('#postsList video').forEach(v => {
            if (window.videoObserver) window.videoObserver.observe(v);
        });

    } catch (e) {
        console.error(e);
        if(!more) {
             list.innerHTML = `<div style="text-align:center; padding:50px; color:var(--danger-color)">ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ <br> <i class="fa-solid fa-wifi"></i></div>`;
        }
    }

    if(typeof finishLoadingBar === "function") finishLoadingBar();
    isLoading = false;
    if(navigator.vibrate) navigator.vibrate(5);
}



// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
function getPrivacyIcon(privacy) {
    if (privacy === 'private') {
        return '<i class="fa-solid fa-lock" style="font-size:12px; margin-right:5px;" title="Ø£Ù†Ø§ ÙÙ‚Ø·"></i>';
    } else if (privacy === 'friends') {
        return '<i class="fa-solid fa-user-group" style="font-size:12px; margin-right:5px;" title="Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡"></i>';
    } else {
        // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ø§Ù…
        return '<i class="fa-solid fa-earth-americas" style="font-size:12px; margin-right:5px;" title="Ø¹Ø§Ù…"></i>';
    }
}

          
           async function renderPost(p) {
    // ---------------------------------------------------------
    // 1. Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
    // ---------------------------------------------------------
    if (p.privacy === 'private' && p.uid !== currentUser.uid) {
        return; 
    }

    // ---------------------------------------------------------
    // 2. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
    // ---------------------------------------------------------
    let u = { name: "Ù…Ø³ØªØ®Ø¯Ù…", pic: defaultAvatar, isVerified: false, isOnline: false, totalViews: 0 };

    try {
        const ud = await db.collection('users').doc(p.uid).get();
        if(ud.exists) { 
            const d = ud.data(); 
            u.name = d.name; 
            u.pic = d.profilePic || defaultAvatar; 
            u.isVerified = d.isVerified; 
            u.totalViews = d.totalViews || 0; 

            // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
            if (window.isOnlineFeatureEnabled && d.lastSeen) {
                const now = new Date();
                const lastSeenDate = d.lastSeen.toDate();
                const diffSeconds = (now - lastSeenDate) / 1000;
                if (diffSeconds < 300) u.isOnline = true;
            }
        }
    } catch(e){}

    // ØªÙˆÙ„ÙŠØ¯ Ø´Ø§Ø±Ø© Ø§Ù„Ø±ØªØ¨Ø©
    const rankHtml = getRankHTML(u.totalViews);

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨
    const isLiked = p.likes && p.likes[currentUser.uid];
    const likesCount = p.likes ? Object.keys(p.likes).length : 0;

    // ---------------------------------------------------------
    // 3. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø´Ø¹ÙˆØ± (Feeling)
    // ---------------------------------------------------------
    let feelingHtml = "";
    if (p.feeling) {
        feelingHtml = `<div class="feeling-text" style="color:var(--secondary-text); font-size:13px; margin-top:2px;">
            ÙŠØ´Ø¹Ø± Ø¨Ù€ ${p.feeling.icon} ${p.feeling.text}
        </div>`;
    }

    // ---------------------------------------------------------
    // 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Content)
    // ---------------------------------------------------------
    let contentHtml = "";
    
    // Ø£) Ø®Ù„ÙÙŠØ© Ù…Ù„ÙˆÙ†Ø©
    if (p.background) {
        let finalBodyText = p.contentHtml ? p.contentHtml : processPostText(p.text);
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ©
        if(p.contentHtml) {
            finalBodyText = finalBodyText.replace(/((https?:\/\/|www\.)[^\s<]+)/g, '<a href="$1" target="_blank" class="post-link" onclick="event.stopPropagation()">$1</a>');
            finalBodyText = finalBodyText.replace(/(^|\s|>)(#[\w\u0600-\u06FF]+)/g, '$1<span class="text-link" onclick="searchForHashtag(event, \'$2\')">$2</span>');
        }
        contentHtml = `<div class="colored-post-body" style="background: ${p.background}">${finalBodyText}</div>`;
    } 
    // Ø¨) Ù†Øµ ÙˆÙ…ÙŠØ¯ÙŠØ§ Ø¹Ø§Ø¯ÙŠ
    else {
        if (p.contentHtml) {
            let finalHtml = p.contentHtml;
            finalHtml = finalHtml.replace(/(?![^<]*> )((https?:\/\/|www\.)[^\s<]+)/g, (url) => {
                let href = url.startsWith('www.') ? 'http://' + url : url;
                return `<a href="${href}" target="_blank" class="post-link" onclick="event.stopPropagation();">${url}</a>`;
            });
            finalHtml = finalHtml.replace(/(^|\s|>)(#[\w\u0600-\u06FF]+)/g, '$1<span class="text-link" style="color:#20D5EC;font-weight:bold;cursor:pointer;" onclick="searchForHashtag(event, \'$2\')">$2</span>');
            contentHtml += `<div class="post-text">${finalHtml}</div>`;
        } else if (p.text) {
            contentHtml += `<div class="post-text">${processPostText(p.text)}</div>`;
        }

        // ÙƒØ§Ø±Øª Ø§Ù„Ø±Ø§Ø¨Ø·
        if (p.linkMeta && p.linkMeta.url) {
            const fallbackImg = "https://cdn-icons-png.flaticon.com/512/3669/3669968.png";
            const imgUrl = p.linkMeta.image || fallbackImg;
            contentHtml += `
            <div class="link-preview-card" onclick="window.open('${p.linkMeta.url}', '_blank'); event.stopPropagation();">
                <div class="lp-image" style="background-image: url('${imgUrl}');"></div>
                <div class="lp-info">
                    <div class="lp-domain">${p.linkMeta.domain || 'RABT'}</div>
                    <div class="lp-title">${p.linkMeta.title || 'Ø±Ø§Ø¨Ø·'}</div>
                    <div class="lp-desc">${p.linkMeta.description || ''}</div>
                </div>
            </div>`;
        }
        
        // Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ (ØµÙˆØ± ÙˆÙÙŠØ¯ÙŠÙˆ)
        if (p.media && p.media.length > 0) {
            let gridClass = 'single';
            if (p.media.length === 2) gridClass = 'double';
            else if (p.media.length === 3) gridClass = 'triple';
            else if (p.media.length >= 4) gridClass = 'quad';

            contentHtml += `<div class="media-grid ${gridClass}">`;
            const displayMedia = p.media.slice(0, 4);

            displayMedia.forEach((m, idx) => {
                if (m.type === 'video') {
                    const uniqueVideoId = `vid-${p.id}-${idx}`;
                    const muteIcon = isGlobalMuted ? 'fa-volume-xmark' : 'fa-volume-high';
                    // Ø¥Ø¶Ø§ÙØ© event.stopPropagation() Ù„Ù…Ù†Ø¹ ÙØªØ­ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø§Ø­ØªÙŠØ§Ø·ÙŠ)
                    contentHtml += `
                    <div class="media-item-wrapper" style="position:relative; overflow:hidden; width:100%; height:100%;">
                        <video src="${m.url}" id="${uniqueVideoId}" class="media-item" loop playsinline ${isGlobalMuted ? 'muted' : ''} 
                            style="width:100%; height:100%; object-fit:cover;"
                            onclick="location.href='videos.html?id=${p.id}&src=${encodeURIComponent(m.url)}'; event.stopPropagation();"
                            onplay="incrementViewCount('${p.id}'); startLiveViews('${p.id}')" 
                            onpause="stopLiveViews()"></video>
                        <div class="video-mute-btn" onclick="toggleMute(event)"><i class="fa-solid ${muteIcon}"></i></div>
                    </div>`;
                } else {
                    contentHtml += `<img src="${m.url}" class="media-item" loading="lazy" 
                        style="width:100%; height:100%; object-fit:cover; display:block;" 
                        onclick="viewImage('${m.url}'); event.stopPropagation();">`;
                }
            });

            if (p.media.length > 4) {
                contentHtml += `<div style="position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.6); color:#fff; padding:5px 10px; border-radius:15px; font-size:12px; pointer-events:none;">+${p.media.length - 4}</div>`;
            }
            contentHtml += `</div>`;
        }
    }

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ø²Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    const rawText = p.text || '';
    const safeText = rawText.replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');

    // Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
    let followBtnHtml = "";
    if (currentUser && p.uid !== currentUser.uid) {
        followBtnHtml = `<button class="mini-follow-btn" onclick="toggleMiniFollow(this, '${p.uid}', event)">Ù…ØªØ§Ø¨Ø¹Ø© <i class="fa-solid fa-plus"></i></button>`;
    }

    const div = document.createElement('div');
    div.className = 'post';
    div.id = `post-${p.id}`;

    // ğŸ”¥ğŸ”¥ğŸ”¥ Ù‡Ù†Ø§ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ ğŸ”¥ğŸ”¥ğŸ”¥
    // 1. Ø´Ù„Ù†Ø§ onclick Ù…Ù† user-info
    // 2. Ø­Ø·ÙŠÙ†Ø§ onclick Ø¹Ù„Ù‰ post-avatar Ùˆ h4 Ø¨Ø³
    div.innerHTML = `
        <div class="post-header">
            <div class="user-info">
                <div class="post-avatar ${u.isOnline ? 'online' : ''}" 
                     style="background-image:url('${u.pic}');"
                     onclick="goToProfile('${p.uid}'); event.stopPropagation();">
                </div>
                
                <div class="user-details">
                    <h4 onclick="goToProfile('${p.uid}'); event.stopPropagation();" style="display:flex; align-items:center; flex-wrap:wrap; gap:4px;">
                        ${u.name} 
                        ${getBadge(u.isVerified, false)} 
                        ${followBtnHtml}
                    </h4>
                    
                    ${rankHtml} ${feelingHtml}
                    
                    <div style="display:flex; align-items:center; gap:6px; color:var(--secondary-text); font-size:11px; margin-top:2px;">
                        <span>${moment(p.createdAt?.toDate()).fromNow()}</span>
                        <span style="font-size:6px; opacity:0.6">â€¢</span>
                        ${getPrivacyIcon(p.privacy)}
                    </div>
                </div>
            </div>
            <i class="fa-solid fa-ellipsis" onclick="openOptions('${p.id}', '${p.uid}', \`${safeText}\`, '${p.privacy || 'public'}')" style="cursor:pointer; padding:5px; color:var(--secondary-text)"></i>
        </div>

        ${contentHtml}
                   
        <div class="post-actions">
            <div class="action-btn ${isLiked?'liked':''}" onclick="toggleLike('${p.id}', '${p.uid}', this)">
                <i class="${isLiked?'fa-solid':'fa-regular'} fa-heart"></i> <span id="cnt-${p.id}">${likesCount}</span>
            </div>
            <div class="action-btn" onclick="openComments('${p.id}', '${p.uid}')">
                <i class="fa-regular fa-comment"></i> <span>${Math.max(0, p.commentsCount || 0)}</span>
            </div>
            <div class="action-btn" onclick="toggleSaveDirect('${p.id}', this)">
                <i class="fa-regular fa-bookmark"></i>
            </div>
            <div class="action-btn" onclick="sharePost('${p.id}', '${p.uid}')">
                <i class="fa-solid fa-share-nodes"></i>
            </div>
        </div>
    `;

    document.getElementById('postsList').appendChild(div);
    
    div.querySelectorAll('video').forEach(v => {
        if(window.videoObserver) window.videoObserver.observe(v);
    });
}
        
                    
           
       async function toggleLike(pid, ownerUid, btn) {
    const icon = btn.querySelector('i');
    const span = btn.querySelector('span');
    let count = parseInt(span.innerText);
    
    if(btn.classList.contains('liked')) {
        // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù„Ø§ÙŠÙƒ
        playSound('click'); 
        btn.classList.remove('liked'); 
        icon.className = 'fa-regular fa-heart';
        span.innerText = Math.max(0, count-1);
        
        await db.collection('posts').doc(pid).set({
            likes: {[currentUser.uid]: firebase.firestore.FieldValue.delete()}
        }, {merge:true});
    } else {
        // Ø¹Ù…Ù„ Ù„Ø§ÙŠÙƒ
        playSound('like'); 
        btn.classList.add('liked'); 
        icon.className = 'fa-solid fa-heart';
        span.innerText = count+1;
        
        // --- (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù†Ø§Ù‚Øµ: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±) ---
        // Ø¨Ù†Ø¨Ø¹Øª pid Ø¹Ø´Ø§Ù† Ù„Ù…Ø§ ÙŠØ¶ØºØ· Ø¹Ù„ÙŠÙ‡ ÙŠØ±ÙˆØ­ Ù„Ù„Ù…Ù†Ø´ÙˆØ±
        pushNotification(ownerUid, 'like', 'Ø£Ø¹Ø¬Ø¨ Ø¨Ù…Ù†Ø´ÙˆØ±Ùƒ', null, pid);
        // --------------------------------------

        await db.collection('posts').doc(pid).set({
            likes: {[currentUser.uid]: true}
        }, {merge:true});
    }
}


      // ==========================================
// 1. Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø¨ØªØ­ÙØ¸ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©)
// ==========================================
function openOptions(pid, uid, txt, privacy) { 
    playSound('click'); 
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    window.currentPostId = pid; 
    currentPostOwnerUid = uid; 
    currentPostText = txt; // Ø§Ù„Ù†Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ø´Ø§Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    currentPostPrivacy = privacy;

    // --- Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠ (Sync) ---
    // Ø¨Ù†Ø±ÙˆØ­ Ù†Ø¬ÙŠØ¨ Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù„ÙŠ ÙÙŠ ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù†ÙØ³Ù‡
    const postCard = document.getElementById(`post-${pid}`);
    const cardSaveIcon = postCard ? postCard.querySelector('.action-btn:nth-child(3) i') : null;
    
    const menuIcon = document.getElementById('saveIcon');
    const menuText = document.getElementById('saveText');

    // Ù„Ùˆ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙƒØ§Ø±Øª Ù…Ù„ÙŠØ§Ù†Ø© (fa-solid) ÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸ØŒ Ù†ØºÙŠØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù€ "Ø¥Ù„ØºØ§Ø¡"
    if(cardSaveIcon && cardSaveIcon.classList.contains('fa-solid')) {
        menuIcon.className = 'fa-solid fa-bookmark';
        menuText.innerText = 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­ÙØ¸';
        isCurrentPostSaved = true;
    } else {
        // Ù„Ùˆ Ù…Ø´ Ù…Ø­ÙÙˆØ¸
        menuIcon.className = 'fa-regular fa-bookmark';
        menuText.innerText = 'Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±';
        isCurrentPostSaved = false;
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    document.getElementById('globalOverlay').style.display = 'block'; 
    document.getElementById('optionsSheet').classList.add('active'); 

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø§Ù„Ùƒ
    if (currentUser && uid === currentUser.uid) {
        document.getElementById('ownerActions').style.display = 'block'; 
        document.getElementById('reportAction').style.display = 'none';
        document.getElementById('hideAction').style.display = 'none';
    } else {
        document.getElementById('ownerActions').style.display = 'none'; 
        document.getElementById('reportAction').style.display = 'flex';
        document.getElementById('hideAction').style.display = 'flex';
    }
}
async function toggleSavePost() {
    closeAllSheets(); // Ù‚ÙÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹
    
    const pid = window.currentPostId;
    const postCard = document.getElementById(`post-${pid}`);
    // Ø¨Ù†Ø¬ÙŠØ¨ Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ø£ØµÙ„ÙŠ
    const cardSaveBtn = postCard ? postCard.querySelector('.action-btn:nth-child(3)') : null;

    if(cardSaveBtn) {
        // Ø¨Ù†Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ ÙƒØ£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø³ Ø¹Ù„ÙŠÙ‡
        // Ø¯Ù‡ Ù‡ÙŠØ´ØºÙ„ Ø¯Ø§Ù„Ø© toggleSaveDirect ÙˆÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„ÙˆØ§Ø¬Ø¨ (Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ² ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©)
        toggleSaveDirect(pid, cardSaveBtn);
    } else {
        // Ù„Ùˆ ÙƒÙ†Ø§ ÙÙŠ ØµÙØ­Ø© ØªØ§Ù†ÙŠØ© ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ± Ù…Ø´ Ù‚Ø¯Ø§Ù…Ù†Ø§ØŒ Ù†Ø¹Ù…Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙŠØ¯ÙˆÙŠ
        const saveRef = db.collection("users").doc(currentUser.uid).collection("savedPosts").doc(pid);
        if(!isCurrentPostSaved) {
            await saveRef.set({ postId: pid, savedAt: firebase.firestore.FieldValue.serverTimestamp() });
            showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
        } else {
            await saveRef.delete();
            showToast("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸");
        }
    }
}
        
// ==========================================
// 2. Ø¯Ø§Ù„Ø© Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø£ÙˆÙ„ (Ø¨ÙŠÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø³)
// ==========================================
// ==========================================
// 1. Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø°Ù (Ø¨ØªØ±Ø¨Ø· Ø§Ù„Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø£Ù…Ø± Ù…Ø¨Ø§Ø´Ø±Ø©)
// ==========================================
function deletePost() {
    playSound('click');
    closeAllSheets(); // Ù‚ÙÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† ÙÙŠÙ‡ Ù…Ù†Ø´ÙˆØ± Ù…ØªØ­Ø¯Ø¯
    if (!currentPostId && !window.currentPostId) {
        showToast("âŒ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±!");
        return;
    }

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù€ ID (Ø³ÙˆØ§Ø¡ Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ø£Ùˆ Ø§Ù„Ø¯Ø§Ø¦Ù…)
    const pid = currentPostId || window.currentPostId;

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    const modal = document.getElementById('deleteConfirmModal');
    modal.style.display = 'flex';
    
    // --- Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø°ÙƒÙŠØ© Ù‡Ù†Ø§ ---
    // Ø¨Ù†Ù…Ø³Ùƒ Ø§Ù„Ø²Ø±Ø§Ø± ÙˆÙ†Ù„ØºÙŠ Ø£ÙŠ Ø£Ù…Ø± Ù‚Ø¯ÙŠÙ… Ø¹Ù„ÙŠÙ‡ ÙˆÙ†Ø­Ø· Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØµØ­
    const btn = document.getElementById('confirmDeleteBtn');
    
    // (Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø²Ø±Ø§Ø± Ø¹Ø´Ø§Ù† Ù†Ù†Ø¶ÙÙ‡ Ù…Ù† Ø£ÙŠ Ø£ÙˆØ§Ù…Ø± Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹Ù„Ù‚Ø©)
    const newBtn = btn.cloneNode(true);
    btn.parentNode.replaceChild(newBtn, btn);
    
    // Ø¥Ø¶Ø§ÙØ© Ø£Ù…Ø± Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯
    newBtn.addEventListener('click', function() {
        performFinalDelete(pid);
    });

    // Ù‡Ø²Ø§Ø² Ù„Ù„ØªØ­Ø°ÙŠØ±
    if(navigator.vibrate) navigator.vibrate([50, 50, 50]); 
}

// ==========================================
// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙØ¹Ù„ÙŠ (Ù…Ø³ØªÙ‚Ù„Ø© ÙˆØªØ¹Ù…Ù„ 100%)
// ==========================================
async function performFinalDelete(idToDelete) {
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙÙˆØ±Ø§Ù‹ Ø¹Ø´Ø§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙŠØ¶ØºØ·Ø´ Ù…Ø±ØªÙŠÙ†
    document.getElementById('deleteConfirmModal').style.display = 'none';
    playSound('click'); 

    if (!idToDelete) {
        showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø´ÙˆØ±");
        return;
    }

    try {
        // Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await db.collection("posts").doc(idToDelete).delete();
        
        // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© (Ø¨Ø£Ù†ÙŠÙ…ÙŠØ´Ù†)
        const postEl = document.getElementById(`post-${idToDelete}`);
        if(postEl) {
            postEl.style.transition = "0.5s";
            postEl.style.transform = "scale(0)";
            postEl.style.opacity = "0";
            setTimeout(() => postEl.remove(), 500);
        }

        showToast("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");

    } catch(e) {
        console.error("Delete Error:", e);
        showToast("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ØµÙ„Ø§Ø­ÙŠØ§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ©");
        // Ù„Ùˆ Ø§Ù„Ø­Ø°Ù ÙØ´Ù„ØŒ Ø±Ø¬Ø¹ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ØªØ§Ù†ÙŠ Ø¹Ø´Ø§Ù† ÙŠØ¹Ø±Ù
        alert("ÙØ´Ù„ Ø§Ù„Ø­Ø°ÙØŒ ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø£Ù†Ùƒ ØªÙ…Ù„Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ±.");
    }
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ (ØªØ±Ø§Ø¬Ø¹)
function closeDeleteModal() {
    document.getElementById('deleteConfirmModal').style.display = 'none';
}



        function copyPostText() { playSound('success'); navigator.clipboard.writeText(currentPostText); showToast("ØªÙ… Ø§Ù„Ù†Ø³Ø®"); closeAllSheets(); }
        function openReportModal() { playSound('click'); closeAllSheets(); document.getElementById('reportReasonModal').style.display='flex'; }
        function submitReport(r) { playSound('sent'); showToast("ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº: "+r); document.getElementById('reportReasonModal').style.display='none'; closeAllSheets(); }
        
      // 1. Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø¨Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
function openEditPostModal() {
    playSound('click'); 
    closeAllSheets(); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³ÙÙ„ÙŠØ©

    const modal = document.getElementById('edit_modal_secure');
    const input = document.getElementById('edit_input_secure');
    const privacy = document.getElementById('edit_privacy_secure');

    if(modal && input) {
        const postText = currentPostText || window.currentPostText || "";
        input.value = postText;
        
        if(privacy) {
            const postPrivacy = currentPostPrivacy || window.currentPostPrivacy || 'public';
            privacy.value = postPrivacy;
        }
        
        modal.style.display = 'flex';
    } else {
        console.error("Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ HTML");
        showToast("Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");
    }
}

// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ° (Ø¨Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯ execute_update)
async function execute_update() {
    const pid = window.currentPostId || currentPostId;
    const input = document.getElementById('edit_input_secure');
    const privacy = document.getElementById('edit_privacy_secure');

    if(!pid) {
        showToast("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±");
        return;
    }
    
    const newText = input ? input.value.trim() : "";
    const newPrivacy = privacy ? privacy.value : 'public';

    if(!newText) {
        showToast("Ø§ÙƒØªØ¨ Ù†ØµØ§Ù‹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„");
        return;
    }

    showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...");

    try {
        await db.collection("posts").doc(pid).update({ 
            text: newText,
            privacy: newPrivacy,
            isEdited: true
        });

        const postEl = document.getElementById(`post-${pid}`);
        if(postEl) {
            const txtEl = postEl.querySelector('.post-text');
            if(txtEl) txtEl.innerHTML = processPostText(newText);

            const timeDiv = postEl.querySelector('.user-details > div:last-child');
            if(timeDiv) {
                const timeText = timeDiv.querySelector('span')?.innerText || 'Ø§Ù„Ø¢Ù†';
                timeDiv.innerHTML = `
                    <span>${timeText}</span>
                    <span style="font-size:6px; opacity:0.6">â€¢</span>
                    ${getPrivacyIcon(newPrivacy)}
                `;
            }

            const optBtn = postEl.querySelector('.fa-ellipsis');
            if(optBtn) {
                const safeText = newText.replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');
                const ownerUid = currentPostOwnerUid || currentUser.uid;
                optBtn.setAttribute('onclick', `openOptions('${pid}', '${ownerUid}', '${safeText}', '${newPrivacy}')`);
            }
        }

        currentPostText = newText;
        window.currentPostText = newText;
        currentPostPrivacy = newPrivacy;
        window.currentPostPrivacy = newPrivacy;

        document.getElementById('edit_modal_secure').style.display = 'none';
        playSound('success');
        showToast("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");

    } catch(e) {
        console.error("Error updating post:", e);
        showToast("ÙØ´Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª");
    }
}



        /* --- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ± (Ù…Ù†Ø´Ù†ØŒ Ø´Ø¨Ø­ØŒ Ø±Ø¯ÙˆØ¯) --- */
        function openComments(pid, ownerUid) {
            document.body.classList.add('no-scroll'); 

    playSound('tab'); 
    document.querySelector('.fb-icons').classList.add('hide-nav');
    // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    currentPostId = pid; 
    currentPostOwnerUid = ownerUid;

    // 2. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹
    document.getElementById('cmSheet').classList.add('active');
    document.getElementById('globalOverlay').style.display='block';

    // 3. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯
    const list = document.getElementById('cmList');
    const headerCount = document.getElementById('cmHeaderCount');
    
    // Ø¹Ù„Ø§Ù…Ø© ØªØ­Ù…ÙŠÙ„
    list.innerHTML = '<div style="text-align:center; padding:20px; color:#fff;"><i class="fa-solid fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
    
    // ØªÙØ±ÙŠØº Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©)
    const inputField = document.getElementById('cmInput');
    if(inputField) inputField.value = ""; 
    isEditingComment = false;

    // 4. ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ø¯Ù‡ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£Ù‡Ù…)
    // Ø­Ø·ÙŠÙ†Ø§Ù‡ ÙÙŠ Ø§Ù„Ø£ÙˆÙ„ Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ Ù…Ù‡Ù…Ø§ Ø­ØµÙ„ Ø£Ø®Ø·Ø§Ø¡ ØªØ§Ù†ÙŠØ©
    const unsubscribe = db.collection('posts').doc(pid).collection('comments')
        .orderBy('createdAt', 'asc')
        .onSnapshot(snap => {
            list.innerHTML = ""; // Ù…Ø³Ø­ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            
            if (headerCount) headerCount.innerText = `Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (${snap.size})`;
            
            if(snap.empty) { 
                list.innerHTML = "<div style='text-align:center; color:#777; margin-top:20px'>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚!</div>"; 
                return; 
            }
            
            // Ø±Ø³Ù… ÙƒÙ„ ØªØ¹Ù„ÙŠÙ‚
            snap.forEach(doc => { 
                renderCommentItem({id: doc.id, ...doc.data()}, list); 
            });
            
            // Ù†Ø²ÙˆÙ„ Ù„Ø¢Ø®Ø± ØªØ¹Ù„ÙŠÙ‚
            if(list.scrollTop === 0) setTimeout(() => list.scrollTop = list.scrollHeight, 100);
        }, error => {
            console.error("Error loading comments:", error);
            list.innerHTML = "<div style='text-align:center; color:red;'>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>";
        });

    // 5. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ù† (ÙÙŠ try-catch Ø¹Ø´Ø§Ù† Ù„Ùˆ ÙØ´Ù„ Ù…ÙŠØ¨ÙˆØ¸Ø´ Ø§Ù„Ø¯Ù†ÙŠØ§)
    try {
        if(typeof setupSmartInputListener === "function") {
            setupSmartInputListener('cmInput', 'mentionDropdown');
        }
    } catch(e) { console.log("Smart Input Error ignored"); }
}


 async function handleCommentAction(sticker = null) {
    // ---------------------------------------------------------
    // 1. Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ (Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰)
    // ---------------------------------------------------------
    // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ³Ø¬Ù„ ØµÙˆØª ÙˆØ¯Ø§Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±Ø§Ø±ØŒ Ù†ÙˆÙ‚Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆÙ†Ø±ÙØ¹Ù‡
    if (isRecording) {
        stopAndSendRecording(); 
        return; // ÙˆÙ†Ø®Ø±Ø¬ ÙÙˆØ±Ø§Ù‹ Ø¹Ø´Ø§Ù† Ù…ÙŠÙƒÙ…Ù„Ø´ Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯
    }

    // ---------------------------------------------------------
    // 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù†Øµ
    // ---------------------------------------------------------
    const inp = document.getElementById('cmInput'); // ØªØ£ÙƒØ¯ Ø¥Ù† Ø¯Ù‡ Ù†ÙØ³ Ø§Ù„Ù€ ID ÙÙŠ HTML
    const txt = sticker || inp.value.trim();
    
    // Ù„Ùˆ Ù…ÙÙŠØ´ Ù†Øµ ÙˆÙ…ÙÙŠØ´ Ø³ØªÙŠÙƒØ±.. Ø§Ø®Ø±Ø¬ (Ù…ØªØ¨Ø¹ØªØ´ ÙØ§Ø¶ÙŠ)
    if (!txt && !sticker) return;
    
    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØªÙØ±ÙŠØº Ø§Ù„Ø®Ø§Ù†Ø©
    playSound('sent'); 
    inp.value = "";

    try {
        // ---------------------------------------------------------
        // 3. Ø­Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ ØªØ¹Ù„ÙŠÙ‚ Ø³Ø§Ø¨Ù‚ (Edit Mode)
        // ---------------------------------------------------------
        if (isEditingComment && selectedComment && !sticker) {
            
            showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...");
            
            await db.collection('posts').doc(currentPostId)
                .collection('comments').doc(selectedComment.id)
                .update({ 
                    text: txt, 
                    isEdited: true 
                });
            
            showToast("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ âœ…"); 
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø²Ø±Ø§Ø± ÙˆØ´ÙƒÙ„Ù‡ Ù„ÙˆØ¶Ø¹Ù‡ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
            isEditingComment = false;
            selectedComment = null;
            
            // Ø¥Ø±Ø¬Ø§Ø¹ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø·ÙŠØ§Ø±Ø©
            const sendBtn = document.getElementById('cmSendBtn');
            sendBtn.classList.remove('fa-check', 'update-mode');
            sendBtn.classList.add('fa-paper-plane');
        } 
        
        // ---------------------------------------------------------
        // 4. Ø­Ø§Ù„Ø© ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ (New Comment)
        // ---------------------------------------------------------
        else {
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const uDoc = await db.collection('users').doc(currentUser.uid).get();
            const uData = uDoc.data();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const commentRef = await db.collection('posts').doc(currentPostId).collection('comments').add({
                uid: currentUser.uid, 
                name: uData.name || "Ù…Ø³ØªØ®Ø¯Ù…", 
                pic: uData.profilePic || "", 
                isVerified: uData.isVerified || false,
                text: txt, 
                isSticker: !!sticker, // Ù„Ùˆ Ù…Ø¨Ø¹ÙˆØª Ø³ØªÙŠÙƒØ± ÙŠØ¨Ù‚Ù‰ true
                isGhost: isGhost,     // Ù‡Ù„ ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø¨Ø­ Ù…ÙØ¹Ù„ØŸ
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ø£ØµÙ„ÙŠ
            await db.collection('posts').doc(currentPostId).update({
                commentsCount: firebase.firestore.FieldValue.increment(1)
            });

            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ± (Ù„Ùˆ Ù…Ø´ Ø£Ù†Ø§ Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ù„Ù‚ Ù„Ù†ÙØ³ÙŠ)
            if (currentPostOwnerUid && currentPostOwnerUid !== currentUser.uid) {
                pushNotification(
                    currentPostOwnerUid, 
                    'comment', 
                    'Ø¹Ù„Ù‚ Ø¹Ù„Ù‰ Ù…Ù†Ø´ÙˆØ±Ùƒ ğŸ’¬', 
                    null, 
                    currentPostId, 
                    commentRef.id
                );
            }
        }
    } catch (e) {
        console.error("Error sending comment:", e);
        showToast("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª");
    }
}

// 1. Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ±ÙØ¹Ù‡ (Ø¨ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ù† Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„)
function stopRecordingProcess() {
    if(mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop(); // Ø¯Ù‡ Ù‡ÙŠØ´ØºÙ„ Ø­Ø¯Ø« onstop Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ±ÙØ¹ Ø§Ù„Ù…Ù„Ù
    }
    isRecording = false;
    clearInterval(recordInterval);
    
    // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø·Ø¨ÙŠØ¹ØªÙ‡Ø§
    document.getElementById('cmInput').style.display = 'block';
    document.getElementById('recordingInterface').style.display = 'none';
    document.getElementById('micBtn').classList.remove('recording');
    document.getElementById('recordTimer').innerText = "00:00";
}

// 2. Ø¯Ø§Ù„Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù (Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹)


        function openRepliesSheet(cid, uid, name, pic, isVerified, text, isGhostUser) {
    playSound('tab');
    currentParentComment = {id: cid, uid: uid, name: name}; // Ø¨Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø±Ø¯
    
    // ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø§Ù„ØªÙˆØ«ÙŠÙ‚)
    let displayName = name; 
    let displayStyle = ""; 
    let avatarStyle = "";
    
    if (isGhostUser) {
        // Ù„Ùˆ Ø´Ø¨Ø­ØŒ Ù†Ø±Ø¬Ø¹ Ù‡ÙˆÙŠØªÙ‡ ÙˆÙ†Ø®ÙÙŠ ØµÙˆØ±ØªÙ‡
        const g = getGhostIdentity(uid); 
        displayName = `Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø¨Ø¶ #${g.id}`; 
        displayStyle = `color:${g.color}`;
        avatarStyle = `border:1px solid ${g.color}; color:${g.color}; display:grid; place-items:center; background:#000`;
        pic = null; 
        isVerified = false; 
    } else { 
        displayStyle = `color:var(--primary-color)`; 
        // Ù„Ùˆ ÙÙŠÙ‡ ØµÙˆØ±Ø© Ù†Ø¹Ø±Ø¶Ù‡Ø§ØŒ Ù…ÙÙŠØ´ Ù†Ø¹Ø±Ø¶ Ù„ÙˆÙ†
        avatarStyle = pic ? `background-image:url('${pic}')` : `background-color:${generateColor(uid)}`; 
    }

    const list = document.getElementById('repliesList');
    list.innerHTML = `
        <div class="parent-comment-header" style="padding:15px; border-bottom:1px solid var(--border-color); background:rgba(255,255,255,0.02)">
            <div style="display:flex; gap:12px; align-items:flex-start;">
                <div class="cm-avatar" style="width:42px; height:42px; border-radius:50%; flex-shrink:0; background-size:cover; background-position:center; ${avatarStyle}">
                    ${isGhostUser ? '<i class="fa-solid fa-user-secret"></i>' : (pic ? '' : name[0])}
                </div>
                
                <div style="flex:1;">
                    <div style="font-weight:800; ${displayStyle}; font-size:14px; display:flex; align-items:center; margin-bottom:4px;">
                        ${displayName} 
                        ${getBadge(isVerified, isGhostUser)}
                    </div>
                    <div style="font-size:15px; color:#eee; white-space:pre-wrap; line-height:1.5;">${text}</div>
                </div>
            </div>
        </div>
        <div style="font-size:12px; color:#aaa; text-align:center; padding:15px 10px 5px;">Ø§Ù„Ø±Ø¯ÙˆØ¯</div>
        <div id="actualRepliesContainer"></div>`;
        
    document.getElementById('repliesSheet').classList.add('active');
       setupSmartInputListener('replyInput', 'mentionDropdown');
        loadRealtimeReplies(cid); 
}


        function loadRealtimeReplies(cid) {
            db.collection('posts').doc(currentPostId).collection('comments').doc(cid).collection('replies').orderBy('createdAt', 'asc').onSnapshot(snap => {
                const container = document.getElementById('actualRepliesContainer'); container.innerHTML = "";
                if(snap.empty) { container.innerHTML = "<div style='text-align:center; color:#555; margin-top:20px'>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ±Ø¯!</div>"; return; }
                let participants = [currentParentComment.uid]; 
                snap.forEach((doc, idx) =>{
                renderReplyItem({id: doc.id, ...doc.data()}, container, idx === snap.size-1, participants); 
                });
                setTimeout(() => container.parentElement.scrollTop = container.parentElement.scrollHeight, 100);
            });
        }

        function renderReplyItem(r, container, isLast, participants) {
            let name = r.name; let pic = r.pic; let style = ""; let nameStyle = "";
            let clickAction = `playSound('click'); goToProfile('${r.uid}')`;
            
            // 1. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø´Ø¨Ø­ Ù„Ù„Ø±Ø¯ÙˆØ¯
            if(r.isGhost) { 
    const g = getGhostIdentity(r.uid); name = `Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø¨Ø¶ #${g.id}`; pic = null; 
    style = `border:1px solid ${g.color}; color:${g.color}; display:grid; place-items:center; background:#000`;
    nameStyle = `color:${g.color} !important; text-shadow:0 0 5px ${g.color}40`;
    clickAction = "showToast('â›” Ù‡ÙˆÙŠØ© Ù…Ø­Ù…ÙŠØ©')";
} else { 
    let finalPic = pic || defaultAvatar;
    style = `background-image:url('${finalPic}'); background-color:transparent;`; 
}

            // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù†Ø´Ù†
            // --- Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---
let displayText = r.text;
if(!r.isSticker && r.replyToUid && r.replyToName && r.text.startsWith(r.replyToName)) {
    const clean = r.text.substring(r.replyToName.length);
    // Ù‡Ù†Ø§ Ø§Ù„ØªØºÙŠÙŠØ±: Ù†Ø¹Ø§Ù„Ø¬ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù†Øµ Ø¹Ø´Ø§Ù† Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ ÙŠØ´ØªØºÙ„
    displayText = `<span class="reply-mention-link" onclick="event.stopPropagation(); goToProfile('${r.replyToUid}')">${r.replyToName}</span> ${processPostText(clean)}`;
} else {
    // ÙˆÙ‡Ù†Ø§ Ø§Ù„ØªØºÙŠÙŠØ±: Ù„Ùˆ Ù…ÙÙŠØ´ Ù…Ù†Ø´Ù†ØŒ Ù†Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù†Øµ ÙƒÙ„Ù‡
    displayText = r.isSticker ? r.text : processPostText(r.text);
}
// --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---

            // 3. Ø£Ù„ÙˆØ§Ù† Ø´Ø¬Ø±Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯
            let userIndex = participants.indexOf(r.uid);
            if (userIndex === -1) { participants.push(r.uid); userIndex = participants.length - 1; }
            const colorClass = `color-${userIndex % 10}`;

            const div = document.createElement('div');
            setTimeout(() => {
        const avatarEl = div.querySelector('.cm-avatar');
        if(avatarEl && !r.isGhost) { // r.isGhost Ù„Ù„Ù…ØªØºÙŠØ± ÙÙŠ Ø§Ù„Ø±Ø¯ÙˆØ¯
            checkAndColorAvatar(r.uid, avatarEl);
        }
    }, 0);


            div.style.cssText = "position:relative; margin-right:25px; margin-bottom:15px;";
            div.addEventListener('touchstart', () => { pressTimer = setTimeout(() => openReplyOptions(r), 600); });
            div.addEventListener('touchend', () => clearTimeout(pressTimer));

            div.innerHTML = `
                <div class="tree-connector" style="${isLast?'height:25px':'bottom:-15px'}"></div>
                <div class="reply-curve"></div>
                <div style="display:flex; gap:10px; align-items:flex-start">
                    <div class="cm-avatar" style="width:30px; height:30px; border-radius:50%; background-size:cover; flex-shrink:0; cursor:pointer; ${style}" onclick="${clickAction}">
                        ${r.isGhost ? '<i class="fa-solid fa-user-secret" style="font-size:14px"></i>' : (pic?'':name[0])}
                    </div>
                    <div style="flex:1">
                        <div class="cm-bubble colored-reply ${colorClass}" ${r.isSticker?'style="background:transparent;border:none;box-shadow:none;padding:0"':''}>
                            <div class="cm-username" style="font-size:12px; ${nameStyle}" onclick="${clickAction}">
                                ${name} ${getBadge(r.isVerified, r.isGhost)}
                            </div>
                            <div class="cm-text" style="${r.isSticker?'font-size:45px':''}">${displayText}</div>
                        </div>
                        <div style="font-size:10px; color:#777; margin-top:3px; display:flex; gap:10px">
                            <span>${moment(r.createdAt?.toDate()).fromNow()}</span>
                            ${!r.isGhost ? `<span style="cursor:pointer; font-weight:bold; color:var(--text-color)" onclick="prepareSubReply('${r.uid}', '${name}')">Ø±Ø¯</span>` : ''}
                        </div>
                    </div>
                </div>`;
            container.appendChild(div);
        }

        function prepareSubReply(uid, name) {
            currentSubReplyTarget = {uid, name};
            const inp = document.getElementById('replyInput');
            inp.value = name + " "; inp.focus();
            if(navigator.vibrate) navigator.vibrate(30);
        }

      async function sendReplyToComment(sticker = null) {
    const inp = document.getElementById('replyInput');
    let txt = sticker || inp.value.trim();
    
    // Ù„Ùˆ Ù…ÙÙŠØ´ Ù†Øµ ÙˆÙ…ÙÙŠØ´ Ø³ØªÙŠÙƒØ±ØŒ Ø§Ø®Ø±Ø¬
    if ((!txt && !sticker) || !currentParentComment) return;
    
    playSound('sent'); 
    
    // Ù„Ùˆ Ù…Ø´ Ø³ØªÙŠÙƒØ±ØŒ Ø´ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© @ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (!sticker) txt = txt.replace(/^@/, '');

    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ù†Ø´Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ùˆ Ù…ÙØ¹Ù„Ù‡)
    let replyToUid = null;
    let replyToName = null;
    if (!sticker) {
        if (window.directMentionData && txt.includes(window.directMentionData.name)) {
            replyToUid = window.directMentionData.uid;
            replyToName = window.directMentionData.name;
            window.directMentionData = null;
        } else if (currentSubReplyTarget && txt.startsWith(currentSubReplyTarget.name)) {
            replyToUid = currentSubReplyTarget.uid;
            replyToName = currentSubReplyTarget.name;
        }
    }

    try {
        // --- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Edit) ---
        if (isEditingReply && selectedReply && !sticker) {
            await db.collection('posts').doc(currentPostId)
                .collection('comments').doc(currentParentComment.id)
                .collection('replies').doc(selectedReply.id)
                .update({ text: txt });
                
            showToast("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¯");
            isEditingReply = false;
            document.getElementById('replySendBtn').classList.remove('fa-check', 'update-mode');
            document.getElementById('replySendBtn').classList.add('fa-paper-plane');
        } 
        // --- Ø­Ø§Ù„Ø© Ø±Ø¯ Ø¬Ø¯ÙŠØ¯ (New Reply) - Ù‡Ù†Ø§ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù‡Ù… ---
        else {
            const uDoc = await db.collection('users').doc(currentUser.uid).get();
            const uData = uDoc.data();

            // 1. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¯ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
            await db.collection('posts').doc(currentPostId)
                .collection('comments').doc(currentParentComment.id)
                .collection('replies').add({
                    uid: currentUser.uid,
                    name: uData.name,
                    pic: uData.profilePic,
                    isVerified: uData.isVerified || false,
                    text: txt,
                    isSticker: !!sticker,
                    isGhost: isGhost,
                    replyToUid: replyToUid,
                    replyToName: replyToName,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

            // ğŸ”¥ğŸ”¥ğŸ”¥ 2. ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø¯ÙˆØ¯ ÙÙŠ Ø§Ù„ÙƒÙˆÙ…Ù†Øª Ø§Ù„Ø£Ø¨ (Ø¹Ø´Ø§Ù† ÙƒÙ„Ù…Ø© "Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¯ÙˆØ¯" ØªØ¸Ù‡Ø±) ğŸ”¥ğŸ”¥ğŸ”¥
            const batch = db.batch();
            const postRef = db.collection('posts').doc(currentPostId);
            const commentRef = db.collection('posts').doc(currentPostId).collection('comments').doc(currentParentComment.id);

            batch.update(postRef, { commentsCount: firebase.firestore.FieldValue.increment(1) });
            batch.update(commentRef, { repliesCount: firebase.firestore.FieldValue.increment(1) });
            await batch.commit();

            // ğŸ”¥ğŸ”¥ğŸ”¥ 3. Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø­Ø¸ÙŠ Ù„Ù„Ø´Ø§Ø´Ø© (Ø¹Ø´Ø§Ù† Ø§Ù„Ø±Ù‚Ù… ÙŠØ²ÙŠØ¯ Ø¨Ø±Ù‡) ğŸ”¥ğŸ”¥ğŸ”¥
            const postCard = document.getElementById(`post-${currentPostId}`);
            if (postCard) {
                // Ø§Ù„Ø²Ø±Ø§Ø± Ø§Ù„ØªØ§Ù†ÙŠ Ù‡Ùˆ Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
                const commentCounter = postCard.querySelectorAll('.action-btn')[1].querySelector('span');
                if (commentCounter) {
                    let currentNum = parseInt(commentCounter.innerText) || 0;
                    commentCounter.innerText = currentNum + 1; // Ø²ÙˆØ¯ 1 ÙÙˆØ±Ø§Ù‹
                }
            }

            // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            if (currentParentComment.uid !== currentUser.uid) {
                pushNotification(currentParentComment.uid, 'reply', 'Ø±Ø¯ Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ‚Ùƒ', null, currentPostId, currentParentComment.id);
            }
            if (replyToUid && replyToUid !== currentUser.uid && replyToUid !== currentParentComment.uid) {
                pushNotification(replyToUid, 'reply', 'Ø£Ø´Ø§Ø± Ø¥Ù„ÙŠÙƒ ÙÙŠ Ø±Ø¯', null, currentPostId, currentParentComment.id);
            }
        }
    } catch (e) {
        console.error("Error sending reply:", e);
        showToast("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯");
    }

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø®Ø§Ù†Ø©
    inp.value = "";
    currentSubReplyTarget = null;
}


        

        function openCommentOptions(c) {
            playSound('tab'); selectedComment = c;
            document.getElementById('commentOptionsSheet').classList.add('active');
            const isMine = (c.uid === currentUser.uid);
            const isOwner = (currentPostOwnerUid === currentUser.uid);

            document.getElementById('cmOwnerOptions').style.display = isMine ? 'block' : 'none';
            document.getElementById('cmViewerOptions').style.display = isMine ? 'none' : 'block';
            
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
            let viewerOpts = document.getElementById('cmViewerOptions');
            let delBtn = viewerOpts.querySelector('.admin-del');
            if(delBtn) delBtn.remove();
            if(isOwner && !isMine) {
                let btn = document.createElement('div'); btn.className='sheet-option admin-del'; btn.style.color='red';
                btn.innerHTML='<i class="fa-solid fa-trash"></i> Ø­Ø°Ù (Ù…Ø´Ø±Ù)';
                btn.onclick = triggerDeleteComment;
                viewerOpts.appendChild(btn);
            }
        }

        function triggerReplyComment() { document.getElementById('commentOptionsSheet').classList.remove('active'); openRepliesSheet(selectedComment.id, selectedComment.uid, selectedComment.name, selectedComment.pic, selectedComment.isVerified, selectedComment.text, selectedComment.isGhost); }
        function triggerEditComment() { closeAllSheets(true); document.getElementById('commentOptionsSheet').classList.remove('active'); const inp = document.getElementById('cmInput'); inp.value = selectedComment.text; inp.focus(); isEditingComment = true; document.getElementById('cmSendBtn').classList.remove('fa-paper-plane'); document.getElementById('cmSendBtn').classList.add('fa-check', 'update-mode'); }
        function triggerDeleteComment() { showChicConfirm("Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ", "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ", '<i class="fa-solid fa-trash-can" style="color:red"></i>', async () => { await db.collection('posts').doc(currentPostId).collection('comments').doc(selectedComment.id).delete(); await db.collection('posts').doc(currentPostId).update({commentsCount: firebase.firestore.FieldValue.increment(-1)}); showToast("ØªÙ… Ø§Ù„Ø­Ø°Ù"); closeAllSheets(true); document.getElementById('commentOptionsSheet').classList.remove('active'); }); }
        function triggerCopyComment() { navigator.clipboard.writeText(selectedComment.text); showToast("ØªÙ… Ø§Ù„Ù†Ø³Ø®"); closeAllSheets(true); }
        function openReplyOptions(r) { selectedReply = r; document.getElementById('replyOptionsSheet').classList.add('active'); const isMine = (r.uid === currentUser.uid); document.getElementById('replyOwnerOptions').style.display = isMine ? 'block' : 'none'; document.getElementById('replyViewerOptions').style.display = isMine ? 'none' : 'block'; if(!isMine) document.getElementById('replyToUserBtn').innerHTML = `<i class="fa-solid fa-reply"></i> Ø±Ø¯ Ø¹Ù„Ù‰ ${r.name}`; }
        function triggerEditReplyAction() { document.getElementById('replyOptionsSheet').classList.remove('active'); const inp = document.getElementById('replyInput'); inp.value = selectedReply.text; inp.focus(); isEditingReply = true; document.getElementById('replySendBtn').classList.remove('fa-paper-plane'); document.getElementById('replySendBtn').classList.add('fa-check', 'update-mode'); }
        function triggerReplyToUser() { document.getElementById('replyOptionsSheet').classList.remove('active'); prepareSubReply(selectedReply.uid, selectedReply.name); }
        function triggerDeleteReply() { document.getElementById('replyOptionsSheet').classList.remove('active'); showChicConfirm("Ø­Ø°Ù Ø§Ù„Ø±Ø¯ØŸ", "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù", '<i class="fa-solid fa-trash-can" style="color:red"></i>', async () => { await db.collection('posts').doc(currentPostId).collection('comments').doc(currentParentComment.id).collection('replies').doc(selectedReply.id).delete(); showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø¯"); }); }
        function triggerCopyReply() { navigator.clipboard.writeText(selectedReply.text); showToast("ØªÙ… Ø§Ù„Ù†Ø³Ø®"); document.getElementById('replyOptionsSheet').classList.remove('active'); }
        function toggleStickerSheet(ctx) { playSound('click'); activeStickerContext = ctx; const grid = document.getElementById('stickersGrid'); if(grid.children.length === 0) { stickerCollection.forEach(s => { const el = document.createElement('div'); el.className = 'sticker-option'; el.innerText = s; el.onclick = () => { if(activeStickerContext === 'main') handleCommentAction(s); else sendReplyToComment(s); document.getElementById('stickerSheet').classList.remove('active'); }; grid.appendChild(el); }); } document.getElementById('stickerSheet').classList.add('active'); }
        function closeRepliesSheet() { document.getElementById('repliesSheet').classList.remove('active'); currentParentComment = null; }
        function showChicConfirm(title, msg, icon, callback) { document.getElementById('chicTitle').innerText = title; document.getElementById('chicMessage').innerText = msg; document.getElementById('chicIcon').innerHTML = icon; document.getElementById('chicConfirmModal').style.display='flex'; document.getElementById('chicConfirmBtn').onclick = () => { callback(); document.getElementById('chicConfirmModal').style.display='none'; }; }
        function closeChicModal() { document.getElementById('chicConfirmModal').style.display='none'; }
      async function sharePost(pid, ownerUid) {
    playSound('click');
    showToast("Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©... ğŸ¨");

    try {
        // 1. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙˆØ³Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
        const postCard = document.getElementById(`post-${pid}`);
        const userImg = postCard.querySelector('.post-avatar').style.backgroundImage.slice(5, -2).replace(/"/g, "");
        const userName = postCard.querySelector('h4').innerText.split('\n')[0]; // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø·
        const postText = postCard.querySelector('.post-text') ? postCard.querySelector('.post-text').innerText : "Ø´Ø§Ù‡Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ù…Ù…ÙŠØ²!";

        // 2. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø®ÙÙŠ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('scUserPic').src = userImg || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';
        document.getElementById('scUserName').innerText = userName;
        // Ù‡Ù†Ø§Ø®Ø¯ Ø£ÙˆÙ„ 100 Ø­Ø±Ù Ø¨Ø³ Ø¹Ø´Ø§Ù† Ø§Ù„Ø´ÙƒÙ„
        document.getElementById('scPostText').innerText = postText.length > 100 ? postText.substring(0, 100) + "..." : postText;

        // 3. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ø±Øª Ù„ØµÙˆØ±Ø© (Canvas)
        const canvas = await html2canvas(document.querySelector("#shareCardContainer"), {
            useCORS: true, // Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ØªØ¸Ù‡Ø±
            scale: 2 // Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©
        });

        // 4. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù€ Canvas Ù„Ù…Ù„Ù ØµÙˆØ±Ø© (Blob)
        canvas.toBlob(async (blob) => {
            const file = new File([blob], "wareed_share.png", { type: "image/png" });
            const shareUrl = `${window.location.origin}${window.location.pathname}?post=${pid}`;
            
            // 5. Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„Ù…Ø±Ø§ÙÙ‚Ø©
            const shareData = {
                title: 'Wareed - ÙˆØ±ÙŠØ¯',
                text: `âœ¨ Ø´ÙˆÙ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¯Ù‡ Ù…Ù† ${userName} Ø¹Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ Wareed!\n\n"${postText.substring(0, 50)}..."\n\nğŸ”— Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙˆØ§Ù„ØªÙØ§Ø¹Ù„:`,
                url: shareUrl,
                files: [file] // Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù„ÙŠ Ø¹Ù…Ù„Ù†Ø§Ù‡Ø§
            };

            // 6. ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
            if (navigator.share && navigator.canShare({ files: [file] })) {
                await navigator.share(shareData);
                
                // Ø¥Ø´Ø¹Ø§Ø± Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø¨ÙˆØ³Øª (Ù„Ùˆ Ù…Ø´ Ø£Ù†Ø§)
                if (ownerUid && ownerUid !== currentUser.uid) {
                    pushNotification(ownerUid, 'share', 'Ù‚Ø§Ù… Ø¨Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù†Ø´ÙˆØ±Ùƒ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù…Ù…ÙŠØ² ğŸŒŸ', null, pid);
                }
            } else {
                // Ù„Ùˆ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø´ Ø¨ÙŠØ¯Ø¹Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ± (ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…Ø«Ù„Ø§Ù‹)ØŒ Ù†Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø³
                navigator.clipboard.writeText(shareData.text + " " + shareData.url);
                showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø© ğŸ“‹");
            }
        });

    } catch (e) {
        console.error(e);
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„ØŒ Ù†Ø±Ø¬Ø¹ Ù„Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·)
        const url = `${window.location.origin}${window.location.pathname}?post=${pid}`;
        navigator.clipboard.writeText(url);
        showToast("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø´ÙˆØ±");
    }
}


             function toggleMute(e) { 
    e.stopPropagation(); 
    
    // 1. Ø¹ÙƒØ³ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
    isGlobalMuted = !isGlobalMuted; 

    // 2. ØªØ­Ø¯ÙŠØ¯ Ø§Ø­Ù†Ø§ ÙÙŠÙ†ØŸ (ÙÙŠ Ø§Ù„Ø¨Ø­Ø« ÙˆÙ„Ø§ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
    const isSearchOpen = document.getElementById('fullSearchPage').classList.contains('active');
    
    // 3. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù†
    // Ù„Ùˆ Ø§Ù„Ø¨Ø­Ø« Ù…ÙØªÙˆØ­ -> Ù‡Ø§Øª ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø¨Ø³
    // Ù„Ùˆ Ù…Ù‚ÙÙˆÙ„ -> Ù‡Ø§Øª ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø³
    const selector = isSearchOpen ? '#searchResultsSection video' : '#postsList video';
    const targetVideos = document.querySelectorAll(selector);

    // 4. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙˆØª/Ø§Ù„ÙƒØªÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙ‚Ø·
    targetVideos.forEach(v => {
        v.muted = isGlobalMuted;
    });

    // 5. ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­ ÙÙ‚Ø·
    const btnSelector = isSearchOpen ? '#searchResultsSection .video-mute-btn i' : '#postsList .video-mute-btn i';
    const allIcons = document.querySelectorAll(btnSelector);
    
    allIcons.forEach(icon => {
        if(isGlobalMuted) {
            icon.className = 'fa-solid fa-volume-xmark';
        } else {
            icon.className = 'fa-solid fa-volume-high';
        }
    });
}


        function toggleGhostMode() { isGhost = !isGhost; const btn = document.getElementById('ghostBtn'); if(isGhost) { playSound('success'); btn.style.background = "#ff0000"; btn.style.boxShadow="0 0 20px #ff0000"; showToast("ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø¨Ø­ ğŸ•µï¸"); } else { playSound('click'); btn.style.background = ""; btn.style.boxShadow=""; showToast("ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø¨Ø­"); } if(currentUser) db.collection('users').doc(currentUser.uid).update({isGhost: isGhost}); }
        function toggleMenu(show) {
    const m = document.getElementById('sideMenu');
    const o = document.getElementById('globalOverlay');
    const navBar = document.querySelector('.fb-icons'); // Ù…Ø³ÙƒÙ†Ø§ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ

    if (show) {
        playSound('tab');
        m.classList.add('open');
        o.style.display = 'block';
        document.body.style.overflow = 'hidden';

        // ğŸ”¥ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ø®ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ù„Ù…Ø§ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªÙØªØ­
        if (navBar) navBar.classList.add('hide-nav');

    } else {
        m.classList.remove('open');
        o.style.display = 'none';
        document.body.style.overflow = 'auto';

        // ğŸ”¥ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø±Ø¬Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ù„Ù…Ø§ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªÙ‚ÙÙ„
        if (navBar) navBar.classList.remove('hide-nav');
    }
}

  function renderCommentItem(c, container) {
    // ----------------------------------------------------
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø§Ù„Ø´Ø¨Ø­)
    // ----------------------------------------------------
    let name = c.name || "Ù…Ø³ØªØ®Ø¯Ù…"; 
    let pic = c.pic; 
    let clickAction = `goToProfile('${c.uid}')`; 
    let avatarStyle = ""; 
    let nameStyle = "";
    
    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø´Ø¨Ø­
    if(c.isGhost) {
        const g = getGhostIdentity(c.uid); 
        name = `Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø¨Ø¶ #${g.id}`; 
        pic = null;
        avatarStyle = `border:1px solid ${g.color}; display:grid; place-items:center; color:${g.color}; background:#000`;
        nameStyle = `color:${g.color} !important; text-shadow: 0 0 5px ${g.color}40;`;
        clickAction = "showToast('â›” Ù‡ÙˆÙŠØ© Ù…Ø­Ù…ÙŠØ©')";
    } else { 
        let finalPic = c.pic || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
        avatarStyle = `background-image:url('${finalPic}'); background-color:transparent;`; 
    }

    // ----------------------------------------------------
    // 2. ØªÙ…ÙŠÙŠØ² ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙˆØ§Ù„ÙÙ‚Ø§Ø¹Ø©
    // ----------------------------------------------------
    const isOwner = (c.uid === currentPostOwnerUid);
    const ownerClass = isOwner ? 'owner-comment' : '';
    const ownerBadge = isOwner ? '<span class="author-badge"><i class="fa-solid fa-crown"></i> Ø§Ù„Ù…Ø¤Ù„Ù</span>' : '';

    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ÙÙ‚Ø§Ø¹Ø©
    let hash=0; for(let i=0;i<c.uid.length;i++) hash+=c.uid.charCodeAt(i);
    const colorClass = isOwner ? '' : `color-${hash%10}`; 
    let bubbleClass = `cm-bubble colored-comment ${colorClass} ${ownerClass}`;

    const safeText = (c.text || "").replace(/'/g, "\\'").replace(/"/g, "&quot;");

    // ----------------------------------------------------
    // 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (ØµÙˆØª / ØµÙˆØ±Ø© / Ù†Øµ Ø·ÙˆÙŠÙ„)
    // ----------------------------------------------------
    let contentHtml = "";
    
    if (c.isAudio) {
        contentHtml = `
        <div class="custom-audio-player" id="player_${c.id}" onclick="event.stopPropagation()" dir="ltr">
            <button class="play-btn" id="btn_${c.id}" onclick="toggleAudio('${c.id}', event)"><i class="fa-solid fa-play"></i></button>
            <div class="audio-waves"><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div></div>
            <input type="range" class="audio-slider" id="range_${c.id}" value="0" oninput="seekAudio('${c.id}'); event.stopPropagation();" style="flex:1; margin:0 5px;">
            <span id="dur_${c.id}" style="font-size:10px; color:#aaa; width:35px; text-align:center;">${c.duration || '00:00'}</span>
            <audio id="audio_${c.id}" src="${c.text}" preload="none" ontimeupdate="updateAudioProgress('${c.id}')" onended="resetAudio('${c.id}')"></audio>
        </div>`;
    } 
    else if (c.isImage) {
        contentHtml = `<div style="margin-top:5px;"><img src="${c.text}" style="max-width:200px; max-height:250px; border-radius:12px;" onclick="viewImage('${c.text}')"></div>`;
    } 
    else {
        // Ù…ÙŠØ²Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù„Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„
        let extraClass = ""; 
        let btnHtml = "";
        // Ù„Ùˆ Ø§Ù„Ù†Øµ Ø£Ø·ÙˆÙ„ Ù…Ù† 150 Ø­Ø±Ù
        if (!c.isSticker && c.text.length > 150) {
            extraClass = "collapsed";
            btnHtml = `<span class="read-more-btn" onclick="toggleReadMore(this)">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯... ğŸ‘‡</span>`;
        }
        contentHtml = `<div class="cm-text ${extraClass}" style="${c.isSticker?'font-size:50px':''}">${c.isSticker ? c.text : processPostText(c.text)}</div>${btnHtml}`;
    }

    // ----------------------------------------------------
    // 4. Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¯ÙˆØ¯ (Ø¨ÙŠØ¸Ù‡Ø± Ø¨Ø³ Ù„Ùˆ ÙÙŠÙ‡ Ø±Ø¯ÙˆØ¯)
    // ----------------------------------------------------
    let repliesButtonHtml = "";
    // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙˆØ£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±
    const rCount = c.repliesCount ? parseInt(c.repliesCount) : 0;
    
    if (rCount > 0) {
        repliesButtonHtml = `
        <div class="replies-trigger" onclick="openRepliesSheet('${c.id}', '${c.uid}', '${c.name||name}', '${c.pic||defaultAvatar}', ${c.isVerified||false}, '${safeText}', ${c.isGhost})">
            <div class="reply-line"></div>
            <span>Ø¹Ø±Ø¶ ${rCount} Ø±Ø¯</span>
            <i class="fa-solid fa-chevron-down reply-arrow"></i>
        </div>`;
    }

    // ----------------------------------------------------
    // 5. Ø²Ø± Ø§Ù„Ù„Ø§ÙŠÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯)
    // ----------------------------------------------------
    const myUid = currentUser.uid;
    const isLiked = c.likes && c.likes.includes(myUid);
    const likeClass = isLiked ? 'liked' : '';
    const likesCount = c.likesCount || 0;
    const likeIcon = isLiked ? 'fa-solid fa-heart' : 'fa-regular fa-heart';

    // ----------------------------------------------------
    // 6. ØªØ¬Ù…ÙŠØ¹ ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    // ----------------------------------------------------
    const div = document.createElement('div');
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ù…
    div.style.cssText = "display:flex; flex-direction:column; margin-bottom:15px; position:relative;";
    div.id = `comment-${c.id}`;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
    div.addEventListener('touchstart', () => { pressTimer = setTimeout(() => openCommentOptions(c), 600); });
    div.addEventListener('touchend', () => clearTimeout(pressTimer));

    div.innerHTML = `
        <div style="display:flex; gap:10px; align-items:flex-start;">
            <div class="cm-avatar" style="width:38px; height:38px; border-radius:50%; flex-shrink:0; background-size:cover; cursor:pointer; ${avatarStyle}" onclick="${clickAction}">
                ${c.isGhost ? '<i class="fa-solid fa-user-secret"></i>' : ''}
            </div>
            
            <div style="flex:1; overflow:hidden;">
                <div class="${bubbleClass}">
                    <div class="cm-username" style="${nameStyle}" onclick="${clickAction}">
                        ${name} ${getBadge(c.isVerified, c.isGhost)} ${ownerBadge}
                    </div>
                    ${contentHtml} 
                </div>
                
                <div style="font-size:11px; color:#aaa; margin-top:5px; display:flex; gap:15px; align-items:center;">
                    <span>${moment(c.createdAt?.toDate()).fromNow()}</span>
                    <span style="cursor:pointer; font-weight:bold; color:#fff;" onclick="openRepliesSheet('${c.id}', '${c.uid}', '${c.name||name}', '${c.pic||defaultAvatar}', ${c.isVerified||false}, '${safeText}', ${c.isGhost})">Ø±Ø¯</span>
                </div>
            </div>

            <div class="cm-actions">
                <button class="like-btn-comment ${likeClass}" onclick="toggleCommentLike('${c.id}')">
                    <i class="${likeIcon}"></i>
                </button>
                <span class="like-count" id="like-count-${c.id}">${likesCount > 0 ? likesCount : ''}</span>
            </div>
        </div>

        ${repliesButtonHtml}
    `;
    
    container.appendChild(div);
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ù…Ø¨Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ (Ù„Ùˆ Ù…ØªØ§Ø­)
    if(!c.isGhost && typeof checkAndColorAvatar === 'function') {
        checkAndColorAvatar(c.uid, div.querySelector('.cm-avatar'));
    }
}
async function toggleCommentLike(commentId) {
    const btn = document.querySelector(`#comment-${commentId} .like-btn-comment`);
    const countSpan = document.getElementById(`like-count-${commentId}`);
    
    // ØªØ£Ø«ÙŠØ± ÙˆÙ‡Ù…ÙŠ ÙÙˆØ±ÙŠ (UI Optimistic Update)
    const isLikedNow = btn.classList.contains('liked');
    if(isLikedNow) {
        btn.classList.remove('liked');
        btn.innerHTML = '<i class="fa-regular fa-heart"></i>';
        if(countSpan.innerText !== '') countSpan.innerText = Math.max(0, parseInt(countSpan.innerText) - 1) || '';
    } else {
        btn.classList.add('liked');
        btn.innerHTML = '<i class="fa-solid fa-heart"></i>';
        playSound('like'); // Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø¯Ø§Ù„Ø© ØµÙˆØª
        let num = parseInt(countSpan.innerText) || 0;
        countSpan.innerText = num + 1;
    }

    // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¹Ù„ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
    const commentRef = db.collection('posts').doc(currentPostId).collection('comments').doc(commentId);
    
    if (isLikedNow) {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„Ø§ÙŠÙƒ
        await commentRef.update({
            likes: firebase.firestore.FieldValue.arrayRemove(currentUser.uid),
            likesCount: firebase.firestore.FieldValue.increment(-1)
        });
    } else {
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§ÙŠÙƒ
        await commentRef.update({
            likes: firebase.firestore.FieldValue.arrayUnion(currentUser.uid),
            likesCount: firebase.firestore.FieldValue.increment(1)
        });
    }
}





function goToMessages() {
    playSound('click');

    const badge = document.getElementById('topMsgCount');
    if (badge) {
        // 1. Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ² (Ø§Ù„Ù…ØªØ®Ø²Ù† ÙÙŠ Ø§Ù„Ø²Ø±Ø§Ø±)
        let currentTotal = parseInt(badge.getAttribute('data-total-unread') || '0');
        
        // 2. Ù†Ø­ÙØ¸ Ø§Ù„Ø±Ù‚Ù… Ø¯Ù‡ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙƒÙ€ "Ù†Ù‚Ø·Ø© ØªÙØªÙŠØ´" (Checkpoint)
        // Ø¯Ù‡ Ù…Ø¹Ù†Ø§Ù‡: "ÙŠØ§ Ù…ØªØµÙØ­ØŒ Ø£Ù†Ø§ Ø´ÙˆÙØª Ù„Ø­Ø¯ Ø§Ù„Ø±Ù‚Ù… Ø¯Ù‡ØŒ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ù‚Ø¯Ù‡ Ø£Ùˆ Ø£Ù‚Ù„ Ù…Ù†Ù‡ Ù…Ø§ØªÙ†ÙˆØ±Ø´ Ø§Ù„Ù„Ù…Ø¨Ø©"
        localStorage.setItem('messenger_seen_checkpoint', currentTotal);
        
        // 3. Ù†Ø®ÙÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙˆØ±Ø§Ù‹ (Ø¹Ø´Ø§Ù† ÙŠØ­Ø³ Ø¨Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©)
        badge.style.display = 'none';
        badge.classList.remove('visible');
        badge.innerText = '0';
    }

    // ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.location.href = 'messages.html'; 
}



  function goToNotifications() {
    playSound('click');
    
    // ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ù…Ø± Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
    const notifBadge = document.getElementById('topNotifCount');
    if(notifBadge) {
        notifBadge.style.display = 'none';
        notifBadge.classList.remove('visible');
    }

    openPage('notifications.html');
}
   function goToVideos() {
    playSound('click');
    openPage('videos.html');
}
  function goToSettings() {
    playSound('click');
    openPage('settings.html');
}

        // --- ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ø¥Ø¶Ø§ÙØ© postId Ùˆ commentId) ---
        function pushNotification(recipientId, type, text, link, postId = null, commentId = null) {
            if (!recipientId || recipientId === currentUser.uid) return;

            let senderName = currentUser.displayName || document.getElementById('menuName').innerText.split(' ')[0] || "Ù…Ø³ØªØ®Ø¯Ù…";
            let senderPic = ""; 
            const myAvatarDiv = document.getElementById('myAvatar');
            if (myAvatarDiv && myAvatarDiv.style.backgroundImage !== 'none') {
                senderPic = myAvatarDiv.style.backgroundImage.slice(5, -2);
            }

            if (isGhost) { senderName = "Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø¨Ø¶ (Ø´Ø¨Ø­)"; senderPic = ""; }

            db.collection("notifications").add({
                recipientId: recipientId, senderUid: currentUser.uid, senderName: senderName, senderPic: senderPic,
                isGhost: isGhost, type: type, text: text, link: link,
                postId: postId,       // Ù‡Ø§Ù… Ù„Ù„ØªÙˆØ¬ÙŠÙ‡
                commentId: commentId, // Ù‡Ø§Ù… Ù„Ù„ØªÙˆØ¬ÙŠÙ‡
                read: false, opened: false, createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        // --- Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ ---
                // --- Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ + Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© ---
        // --- Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©: Ø¹Ø¯Ø§Ø¯Ø§Øª (ÙÙˆÙ‚ ÙˆØ¬Ù†Ø¨) + ØµÙˆØª + ØªÙˆØ³Øª ---
function updateHeaderBadges() {
    if (!currentUser) return;

    // 1. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ø§Ù„Ø¬Ø±Ø³)
    db.collection("notifications")
      .where("recipientId", "==", currentUser.uid)
      .where("read", "==", false)
      .onSnapshot(snap => {
            const count = snap.size;
            const text = count > 99 ? '99+' : count;

            // Ø£) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£Ø­Ù…Ø±)
            const topBadge = document.getElementById('topNotifCount');
            if (topBadge) {
                topBadge.innerText = text;
                if (count > 0) topBadge.classList.add('visible');
                else topBadge.classList.remove('visible');
            }

            // Ø¨) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            const sideBadge = document.getElementById('mainNotifBadge');
            if (sideBadge) {
                sideBadge.innerText = text;
                sideBadge.style.display = count > 0 ? 'inline-block' : 'none';
            }

            // Ø¬) Ø§Ù„ØµÙˆØª ÙˆØ§Ù„ØªÙˆØ³Øª (Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø¬Ø¯ÙŠØ¯)
            snap.docChanges().forEach(change => {
                if (change.type === "added") {
                    // Ù†ØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ Ø¬Ø¯ÙŠØ¯ (Ø£Ù‚Ù„ Ù…Ù† 10 Ø«ÙˆØ§Ù†ÙŠ)
                    const timeDiff = Date.now() - (change.doc.data().createdAt?.toDate().getTime() || Date.now());
                    if (timeDiff < 10000) {
                        playSound('notification');
                        showToast("ğŸ”” Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯");
                        if(navigator.vibrate) navigator.vibrate(200);
                    }
                }
            });
      });

    // 2. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø©
    db.collection("users").doc(currentUser.uid).collection("friendRequests")
      .onSnapshot(snap => {
            const count = snap.size;
            const text = count > 99 ? '99+' : count;

            // Ø£) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
            const topBadge = document.getElementById('topReqCount');
            if (topBadge) {
                topBadge.innerText = text;
                if (count > 0) topBadge.classList.add('visible');
                else topBadge.classList.remove('visible');
            }

            // Ø¨) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            const sideBadge = document.getElementById('requestsBadge');
            if (sideBadge) {
                sideBadge.innerText = text;
                sideBadge.style.display = count > 0 ? 'inline-block' : 'none';
            }

            // Ø¬) Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµÙˆØªÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª
            snap.docChanges().forEach(change => {
                if (change.type === "added") {
                    playSound('notification');
                    showToast("ğŸ‘¥ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯");
                }
            });
      });
}

        // --- Ø¯Ø§Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø²Ø§Ø¦Ø± ÙˆØ§Ù„Ù†Ø²ÙˆÙ„ Ù„Ù„Ù…Ù†Ø´ÙˆØ± (Deep Links) ---
        function checkDeepLinks() {
            const urlParams = new URLSearchParams(window.location.search);
            const targetPostId = urlParams.get('post');
            const targetCommentId = urlParams.get('comment');

            if (targetPostId) {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
                const checkExist = setInterval(() => {
                    const postElement = document.getElementById(`post-${targetPostId}`);
                    if (postElement) {
                        clearInterval(checkExist);
                        postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        // ÙˆÙ…ÙŠØ¶ Ù„Ù„ØªÙ…ÙŠÙŠØ²
                        postElement.style.transition = "0.5s";
                        postElement.style.boxShadow = "0 0 30px var(--primary-solid)";
                        setTimeout(() => postElement.style.boxShadow = "none", 2000);

                        // Ù„Ùˆ ÙÙŠÙ‡ ØªØ¹Ù„ÙŠÙ‚ØŒ Ø§ÙØªØ­Ù‡
                        if (targetCommentId) {
                            // Ù…Ø­Ø§ÙƒØ§Ø© ÙØªØ­ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
                            const commentBtn = postElement.querySelector('.action-btn:nth-child(2)'); 
                            if(commentBtn) commentBtn.click();

                            setTimeout(() => {
                                const commentEl = document.getElementById(`comment-${targetCommentId}`);
                                if(commentEl) {
                                    commentEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                    const bubble = commentEl.querySelector('.cm-bubble');
                                    if(bubble) bubble.classList.add('highlight');
                                }
                            }, 1500);
                        }
                    }
                }, 500);
                setTimeout(() => clearInterval(checkExist), 10000); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ
            }
        }

        // ØªØ´ØºÙŠÙ„ checkDeepLinks Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        auth.onAuthStateChanged(user => {
            if(user) checkDeepLinks();
        });
// ==========================================
//  ÙÙŠØ²ÙŠØ§Ø¡ ÙƒØ±Ø© Ø§Ù„ÙŠÙˆØ±Ø§Ù†ÙŠÙˆÙ… + Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ (Dark Mode)
// ==========================================
(function() {
    const orb = document.getElementById('uraniumOrb');
    const deleteZone = document.getElementById('deleteZone');
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    // Ø®Ù„ÙŠÙ†Ø§ Ø§Ù„Ù€ Y ÙŠÙ†Ù‚Øµ 120 Ø¹Ø´Ø§Ù† ØªØ·Ù„Ø¹ ÙÙˆÙ‚ Ø´ÙˆÙŠØ© ÙˆÙ…ØªØ¨Ù‚Ø§Ø´ Ù„Ø§Ø²Ù‚Ø© ØªØ­Øª
let isDragging = false, startX, startY, currentX = 15, currentY = window.innerHeight - 200;
    let velocityX = 0, velocityY = 0, lastX, lastY, lastTime, animationFrame, superMode = false, orbVisible = true;
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ (Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    let pressTimer;
    let isLongPress = false; 

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù„ÙˆÙ† Ø§Ù„Ø«ÙŠÙ…
    const savedColor = localStorage.getItem('themeColor');
    if(savedColor) document.documentElement.style.setProperty('--primary-solid', savedColor);
    
    // ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    orb.style.left = currentX + 'px'; 
    orb.style.top = currentY + 'px';

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø´Ø§Ø´Ø© (Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)
    function captureScreen() {
        if (isLongPress) return; // Ù„Ùˆ ÙƒØ§Ù† Ø¶ØºØ· Ù…Ø·ÙˆÙ„ØŒ Ù…ØªØµÙˆØ±Ø´ Ø§Ù„Ø´Ø§Ø´Ø©
        if(navigator.vibrate) navigator.vibrate(50);
        orb.style.opacity = '0'; deleteZone.style.display = 'none'; playSound('click');
        html2canvas(document.body, { useCORS: true, allowTaint: true, scrollY: -window.scrollY }).then(canvas => {
            orb.style.opacity = '1'; deleteZone.style.display = 'flex';
            const link = document.createElement('a'); link.download = `NABD_Snap_${Date.now()}.png`; link.href = canvas.toDataURL(); link.click();
            showToast("ğŸ“¸ ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø´Ø§Ø´Ø©");
        }).catch(err => { orb.style.opacity = '1'; });
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ (Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    function toggleDarkMode() {
        document.body.classList.toggle('light-mode');
        const isLight = document.body.classList.contains('light-mode');
        localStorage.setItem('nabd_theme_mode', isLight ? 'light' : 'dark');
        showToast(isLight ? "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ" : "ğŸŒ‘ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ");
        playSound('success');
        if (navigator.vibrate) navigator.vibrate(100);
    }

    // --- Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³ ---
    orb.addEventListener('touchstart', e => { 
        if(superMode || !orbVisible) return; 
        
        const t=e.touches[0]; 
        startX=t.clientX; startY=t.clientY; 
        lastX=startX; lastY=startY; lastTime=Date.now(); 
        isDragging=false; 
        isLongPress=false; // ØªØµÙÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„
        velocityX=0; velocityY=0; 
        cancelAnimationFrame(animationFrame); 

        // ØªØ´ØºÙŠÙ„ Ù…Ø¤Ù‚Øª Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ (800 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
        pressTimer = setTimeout(() => {
            if (!isDragging) { // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø±ÙƒØ´ Ø§Ù„ÙƒØ±Ø©
                isLongPress = true; // Ø¹Ù„Ù… Ø¥Ù† Ø¯ÙŠ Ø¶ØºØ·Ø© Ù…Ø·ÙˆÙ„Ø©
                toggleDarkMode(); // ØºÙŠØ± Ø§Ù„ÙˆØ¶Ø¹
            }
        }, 800);

    }, {passive:false});

    // --- Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø±ÙŠÙƒ ---
    orb.addEventListener('touchmove', e => { 
        if(superMode || !orbVisible) return; 
        e.preventDefault(); 
        
        const t=e.touches[0]; 
        const now=Date.now(); 
        const dt=now-lastTime; 

        // Ù„Ùˆ Ø§ØªØ­Ø±ÙƒØª Ù…Ø³Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø©ØŒ Ù†Ø¹ØªØ¨Ø±Ù‡Ø§ Ø³Ø­Ø¨ ÙˆÙ†Ù„ØºÙŠ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„
        if(Math.abs(t.clientX-startX)>5 || Math.abs(t.clientY-startY)>5) {
            isDragging=true;
            clearTimeout(pressTimer); // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ ÙÙˆØ±Ø§Ù‹
        }

                        if(isDragging) { 
            // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯
            let newX = t.clientX - 20; 
            let newY = t.clientY - 20; 

            // 2. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§Ø± (Ø¹Ø´Ø§Ù† Ù…Ø§ ØªÙ†Ø²Ù„Ø´ ØªØ­Øª Ø§Ù„Ù‡ÙŠØ¯Ø±Ø§)
            // Ø§Ù„Ø±Ù‚Ù… Ø¯Ù‡ (130) Ù‡Ùˆ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ­Ø¯Ø¯ Ù…ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚ÙˆÙ
            let floorLimit = window.innerHeight - 130; 
            
            // Ù„Ùˆ Ø­Ø§ÙˆÙ„Øª ØªÙ†Ø²Ù„ Ø¹Ù† Ø§Ù„Ø¬Ø¯Ø§Ø±ØŒ Ù†Ø«Ø¨ØªÙ‡Ø§ Ø¹Ù†Ø¯Ù‡
            if(newY > floorLimit) newY = floorLimit;

            // 3. ØªØ­Ø¯ÙŠØ« Ù…ÙƒØ§Ù† Ø§Ù„ÙƒØ±Ø©
            currentX = newX; 
            currentY = newY; 
            
            orb.style.left = `${currentX}px`; 
            orb.style.top = `${currentY}px`; 
            
            // 4. (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù„ÙŠ Ø£Ù†Øª Ø¨Ø¹ØªÙ‡) Ø´Ø±Ø· Ø¸Ù‡ÙˆØ± Ø§Ù„Ø³Ù„Ø©
            // Ø¨Ù†Ø®Ù„ÙŠÙ‡Ø§ ØªØ¸Ù‡Ø± Ù„Ùˆ Ù‚Ø±Ø¨Øª Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§Ø± Ø¨ÙØ±Ù‚ Ø¨Ø³ÙŠØ· (20 Ø¨ÙƒØ³Ù„)
            if(newY >= floorLimit - 20) { 
                deleteZone.style.transform='translateX(-50%) scale(1.1)'; 
                deleteZone.style.background='rgba(255,0,0,0.4)'; 
                orb.style.opacity='0.5'; 
            } else { 
                deleteZone.style.transform='translateX(-50%) scale(0)'; 
                orb.style.opacity='1'; 
            } 
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© (Ø³ÙŠØ¨Ù‡ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ ØªØ­Øª Ø§Ù„ÙƒÙˆØ¯ Ø¯Ù‡)
            if(dt > 0) { 
                velocityX = (t.clientX - lastX) / dt * 15; 
                velocityY = (t.clientY - lastY) / dt * 15; 
            } 
            lastX = t.clientX; lastY = t.clientY; lastTime = now; 
        } 


    }, {passive:false});

    // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³ ---
        // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³ (Ù„Ø­Ø¸Ø© Ø§Ù„Ø­Ø°Ù) ---
    orb.addEventListener('touchend', (e) => { 
        clearTimeout(pressTimer); 
        
        if(superMode || !window.orbVisible) return; 
        
        // Ø¥Ø®ÙØ§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø³Ù„Ø© (ØªØ±Ø¬Ø¹ ØµØºÙŠØ±Ø©)
        deleteZone.style.transform='translateX(-50%) scale(0)'; 
        orb.style.opacity='1'; 
        
        if (isLongPress) return;

        // Ù„Ùˆ Ø¶ØºØ·Ø© Ø¹Ø§Ø¯ÙŠØ© (Ù…Ø´ Ø³Ø­Ø¨)ØŒ Ø®Ø¯ Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª
        if(!isDragging) { captureScreen(); return; } 
        
        // ğŸ”¥ğŸ”¥ Ø¯Ù‡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† Ø§Ù„Ø­Ø°Ù ÙŠØ´ØªØºÙ„ ğŸ”¥ğŸ”¥
        // Ù„Ø§Ø²Ù… Ø§Ù„Ø±Ù‚Ù… Ù‡Ù†Ø§ ÙŠÙƒÙˆÙ† (150) Ø²ÙŠ Ù…Ø§ Ø¹Ù…Ù„Ù†Ø§ ÙÙŠ Ø§Ù„Ø³Ù„Ø©
        // 150 = 130 (Ø§Ù„Ø¬Ø¯Ø§Ø±) + 20 (Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø³Ù„Ø©)
        if(currentY >= window.innerHeight - 150) { 
            hideOrb(); 
            return; 
        } 
        
        // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ùˆ Ø±Ù…ÙŠØªÙ‡Ø§ Ù„ÙÙˆÙ‚ Ù‚ÙˆÙŠ
        if(currentY < 100) { activateSuperMode(); return; } 
        
        // Ù„Ùˆ Ù…ÙÙŠØ´ Ø­Ø°Ù ÙˆÙ„Ø§ Ù‚Ø§Ø¦Ù…Ø©ØŒ Ù†ÙØ° Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡
        applyMomentum(); 
    });


    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø²Ø®Ù… (Ø§Ù„Ø±Ù…ÙŠ)
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø²Ø®Ù… (Ø§Ù„Ø±Ù…ÙŠ) - Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ
    function applyMomentum() { 
        const friction = 0.95; // Ø§Ù„Ø§Ø­ØªÙƒØ§Ùƒ
        const bounce = -0.7;   // Ù‚ÙˆØ© Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯
        
        // ğŸ”¥ ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ (Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù„ÙŠ ÙÙˆÙ‚)
        const floorLimit = window.innerHeight - 130;

        function step() { 
            if(Math.abs(velocityX) > 0.1 || Math.abs(velocityY) > 0.1) { 
                currentX += velocityX; 
                currentY += velocityY; 
                
                // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© (ÙŠÙ…ÙŠÙ† ÙˆØ´Ù…Ø§Ù„)
                if(currentX < 0) { currentX = 0; velocityX *= bounce; } 
                else if(currentX > window.innerWidth - 45) { currentX = window.innerWidth - 45; velocityX *= bounce; } 
                
                // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© (ÙÙˆÙ‚)
                if(currentY < 0) { currentY = 0; velocityY *= bounce; } 
                
                // ğŸ”¥ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© (ØªØ­Øª) - Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
                else if(currentY > floorLimit) { 
                    currentY = floorLimit; // Ø«Ø¨ØªÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ø¯Ø§Ø±
                    velocityY *= bounce;   // Ø§Ø¹ÙƒØ³ Ø§Ù„Ø­Ø±ÙƒØ© (Ù†Ø·)
                } 

                velocityX *= friction; 
                velocityY *= friction; 
                
                orb.style.left = `${currentX}px`; 
                orb.style.top = `${currentY}px`; 
                
                animationFrame = requestAnimationFrame(step); 
            } 
        } 
        step(); 
    }


    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³ÙˆØ¨Ø± Ù…ÙˆØ¯ (Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©)
    function activateSuperMode() { superMode=true; playSound('tab'); orb.classList.add('super-mode'); orb.style.left='50%'; orb.style.top='150px'; orb.style.transform='translate(-50%,-50%)'; setTimeout(() => document.addEventListener('click', closeSuperModeOutside), 100); }
    function closeSuperModeOutside(e) { if(!orb.contains(e.target) && !document.getElementById('themeModal').contains(e.target)) { deactivateSuperMode(); document.removeEventListener('click', closeSuperModeOutside); } }
    function deactivateSuperMode() { superMode=false; orb.classList.remove('super-mode'); orb.style.transform='none'; currentX=window.innerWidth-70; currentY=window.innerHeight-150; orb.style.left=`${currentX}px`; orb.style.top=`${currentY}px`; }
    
    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
    function hideOrb() { playSound('click'); orb.style.display='none'; orbVisible=false; showToast("ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ±Ø©. Ø§Ø¶ØºØ· Ù…Ø±ØªÙŠÙ† Ù„Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§."); }
        // ÙƒÙˆØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒØ±Ø© (Ù„Ù…Ø§ ØªØ¶ØºØ· Ù…Ø±ØªÙŠÙ† ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙØ§Ø¶ÙŠ)
    let lastTapTime = 0; 
    document.addEventListener('touchend', function(e) { 
        if(orbVisible) return; // Ù„Ùˆ Ù‡ÙŠ Ø¸Ø§Ù‡Ø±Ø© Ø£ØµÙ„Ø§Ù‹ Ù…Ø§ ØªØ¹Ù…Ù„Ø´ Ø­Ø§Ø¬Ø©
        
        const currentTime = new Date().getTime(); 
        const tapLength = currentTime - lastTapTime; 
        
        if(tapLength < 300 && tapLength > 0) { 
            orb.style.display = 'flex'; 
            orbVisible = true; 
            
            // ğŸ”¥ Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…: Ø¨Ù†Ø¬Ø¨Ø±Ù‡Ø§ ØªØ±Ø¬Ø¹ Ù„Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ (200 Ø¨ÙƒØ³Ù„ Ù…Ù† ØªØ­Øª)
            currentX = 15; 
            currentY = window.innerHeight - 200; // Ø®Ù„ÙŠÙ†Ø§ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ 200 Ø²ÙŠ Ù…Ø§ Ø·Ù„Ø¨Øª
            
            orb.style.left = `${currentX}px`; 
            orb.style.top = `${currentY}px`; 
            
            playSound('success'); 
            showToast("ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒØ±Ø©"); 
        } 
        lastTapTime = currentTime; 
    });


    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸
    if (localStorage.getItem('nabd_theme_mode') === 'light') {
        document.body.classList.add('light-mode');
    }
})();

        // ==========================================
// ğŸ‘ï¸ Ø¯ÙˆØ§Ù„ Ø§Ø­ØªØ³Ø§Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
// ==========================================

// 1. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù… (Ù…Ø«Ù„Ø§Ù‹ 1000 ØªØ¨Ù‚Ù‰ 1K)
function formatNumber(num) { 
    if (!num) return '0'; 
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M'; 
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K'; 
    return num.toString(); 
}

// 2. Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©)
async function incrementViewCount(postId) {
    const viewedKey = `viewed_${postId}`;
    // Ù„Ùˆ Ø´Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯Ù‡ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡ ÙˆÙ‡Ùˆ ÙØ§ØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ù…Ù†Ø²ÙˆØ¯Ø´ Ø§Ù„Ø±Ù‚Ù…
    if (sessionStorage.getItem(viewedKey)) return;

    try {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
        await db.collection("posts").doc(postId).update({
            views: firebase.firestore.FieldValue.increment(1)
        });
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¹Ø´Ø§Ù† Ù…ØªØªÙƒØ±Ø±Ø´
        sessionStorage.setItem(viewedKey, 'true');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚Ù… ÙÙˆØ±Ø§Ù‹ Ù‚Ø¯Ø§Ù…Ùƒ (Ø¹Ø´Ø§Ù† Ù…ØªØ³ØªÙ†Ø§Ø´ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø§ÙŠ)
        const viewSpan = document.getElementById(`vid-views-${postId}`);
        if(viewSpan) {
            let current = parseInt(viewSpan.innerText.replace(/[^0-9]/g, '')) || 0;
            viewSpan.innerText = formatNumber(current + 1);
        }
    } catch (e) { console.error("Error updating views:", e); }
}

// 3. Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¹Ø¯Ø§Ø¯ (Live)
let viewUpdateInterval = null;

function startLiveViews(postId) {
    if (viewUpdateInterval) clearInterval(viewUpdateInterval);

    // ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ Ø¨Ù†Ø¨Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ² Ù†Ø´ÙˆÙ Ø§Ù„Ø±Ù‚Ù… ÙˆØµÙ„ ÙƒØ§Ù…
    viewUpdateInterval = setInterval(async () => {
        try {
            const doc = await db.collection("posts").doc(postId).get();
            if (doc.exists) {
                const realViews = doc.data().views || 0;
                const el = document.getElementById(`vid-views-${postId}`);
                if (el) el.innerText = formatNumber(realViews);
            }
        } catch (e) {}
    }, 10000); 
}

function stopLiveViews() {
    if (viewUpdateInterval) {
        clearInterval(viewUpdateInterval);
        viewUpdateInterval = null;
    }
}
/* === Ø¯ÙˆØ§Ù„ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ù†Ø³Ø®Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠØ©) === */

// Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø­Ø°Ù) Ø²ÙŠ Ù…Ø§ Ø¨Ø¹ØªÙ‡Ø§Ù„Ùƒ ÙÙŠ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù„ÙŠ ÙØ§ØªØŒ Ø¶ÙŠÙÙ‡Ù… Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ†

function openAccountSwitcher() {
    playSound('click');
    toggleMenu(false); 

    document.getElementById('accountSwitcherModal').style.display = 'flex';
    document.getElementById('addAccountForm').style.display = 'none';
    document.getElementById('addAccBtnContainer').style.display = 'flex';

    const list = document.getElementById('accountList');
    list.innerHTML = "";

    let accounts = JSON.parse(localStorage.getItem('nabd_accounts') || '[]');

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
    if(currentUser) {
        const currentIdx = accounts.findIndex(a => a.uid === currentUser.uid);
        if(currentIdx > -1) {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø£ÙŠ ÙƒÙˆØ¯ HTML
            const rawName = document.getElementById('menuName').innerText;
            accounts[currentIdx].name = rawName.split(' ')[0] + " " + (rawName.split(' ')[1] || "");
            localStorage.setItem('nabd_accounts', JSON.stringify(accounts));
        }
    }

    if (accounts.length === 0) {
        list.innerHTML = "<div style='text-align:center;color:#777;padding:20px'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>";
    }

    accounts.forEach((acc, idx) => {
        const isCurrent = (currentUser && acc.uid === currentUser.uid);
        
        // ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØ±Ø© (Ù„Ùˆ Ù…ÙÙŠØ´ ØµÙˆØ±Ø© Ù†Ø³ØªØ®Ø¯Ù… Ù„ÙˆÙ†)
        const bgStyle = acc.pic ? `background-image:url('${acc.pic}')` : `background:${generateColor(acc.uid)}`;
        const content = acc.pic ? '' : (acc.name ? acc.name[0] : 'U');

        list.innerHTML += `
        <div class="acc-item" onclick="${isCurrent?'':`switchAccount(${idx})`}" style="${isCurrent?'opacity:0.5; cursor:default;':''}">
            <div style="width:40px; height:40px; border-radius:50%; ${bgStyle}; background-size:cover; background-position:center; display:grid; place-items:center; font-weight:bold; border:1px solid #333; flex-shrink:0;">
                ${content}
            </div>
            
            <div style="flex:1; text-align:right;">
                <div style="font-weight:bold; font-size:14px; color:#fff;">
                    ${acc.name} ${acc.isVerified ? '<i class="fa-solid fa-circle-check" style="color:#1da1f2; font-size:12px;"></i>' : ''}
                </div>
                <div style="font-size:11px; color:#aaa;">${acc.email}</div>
            </div>

            ${!isCurrent ? `<i class="fa-solid fa-trash-can" style="color:#ff3b30; padding:10px; font-size:14px;" onclick="removeAccount(event, ${idx})"></i>` : ''}
        </div>`;
    });
}

function closeAccountSwitcher() {
    document.getElementById('accountSwitcherModal').style.display = 'none';
}


                // --- Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ø§Ù„Ù†ÙˆØ§Ù‚Øµ) ---

        function showAddAccountForm() {
            playSound('click');
            document.getElementById('addAccountForm').style.display = 'block';
            document.getElementById('addAccBtnContainer').style.display = 'none';
        }

        function hideAddAccountForm() {
            document.getElementById('addAccountForm').style.display = 'none';
            document.getElementById('addAccBtnContainer').style.display = 'flex';
        }

        async function addNewAccountAction() {
            playSound('click');
            const e = document.getElementById('newAccEmail').value;
            const p = document.getElementById('newAccPass').value;
            
            if(!e || !p) return showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");
            
            try { 
                // 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØµØ­Ø©
                const cred = await auth.signInWithEmailAndPassword(e, p); 
                const uid = cred.user.uid;

                // 2. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¹Ø´Ø§Ù† Ù†Ø®Ø²Ù† Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø©)
                const userDoc = await db.collection('users').doc(uid).get();
                const userData = userDoc.data() || {};
                const realName = userData.name || e.split('@')[0];
                const isVerified = userData.isVerified || false;
                const pic = userData.profilePic || "";

                // 3. Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ LocalStorage
                let accs = JSON.parse(localStorage.getItem('nabd_accounts') || '[]'); 
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ Ù…Ø´ Ù…ØªØ¶Ø§Ù Ù‚Ø¨Ù„ ÙƒØ¯Ù‡
                if(!accs.find(a => a.uid === uid)) {
                    accs.push({
                        uid: uid, 
                        email: e, 
                        token: btoa(p), // ØªØ´ÙÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
                        name: realName, 
                        isVerified: isVerified, 
                        pic: pic
                    }); 
                    localStorage.setItem('nabd_accounts', JSON.stringify(accs)); 
                }
                
                // 4. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (Ù‡ÙŠØ¯Ø®Ù„ Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ)
                location.reload(); 

            } catch(er) { 
                console.error(er); 
                showToast("Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"); 
            }
        }

        function switchAccount(idx) { 
            playSound('click');
            let accs = JSON.parse(localStorage.getItem('nabd_accounts')); 
            if(accs[idx]) {
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
                auth.signInWithEmailAndPassword(accs[idx].email, atob(accs[idx].token))
                    .then(() => location.reload())
                    .catch(() => showToast("ÙØ´Ù„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŒ Ù‚Ø¯ ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØªØºÙŠØ±Øª"));
            }
        }

        function removeAccount(e, idx) { 
            e.stopPropagation(); // Ø¹Ø´Ø§Ù† Ù…ÙŠØ¹Ù…Ù„Ø´ Switch Ø¨Ø§Ù„ØºÙ„Ø· Ù„Ù…Ø§ ØªØ¯ÙˆØ³ Ø­Ø°Ù
            if(!confirm("Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ")) return;
            
            let accs = JSON.parse(localStorage.getItem('nabd_accounts')); 
            accs.splice(idx, 1); // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ±
            localStorage.setItem('nabd_accounts', JSON.stringify(accs)); 
            
            openAccountSwitcher(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹
            showToast("ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø©");
        }

// --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· ---
async function toggleSaveDirect(pid, btnElement) {
    playSound('click');
    const icon = btnElement.querySelector('i');
    const saveRef = db.collection("users").doc(currentUser.uid).collection("savedPosts").doc(pid);
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù‡Ù„ Ù‡Ùˆ Ù…Ø­ÙÙˆØ¸ ÙˆÙ„Ø§ Ù„Ø£) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
    if(icon.classList.contains('fa-regular')) {
        // --- Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­ÙØ¸ ---
        icon.classList.remove('fa-regular');
        icon.classList.add('fa-solid'); // ÙŠØ®Ù„ÙŠ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù…ØªÙ„Ø¦Ø©
        btnElement.style.color = 'var(--primary-solid)'; // ÙŠÙ„ÙˆÙ† Ø§Ù„Ø²Ø±Ø§Ø±
        
        await saveRef.set({
            postId: pid,
            savedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ± âœ…");
    } else {
        // --- Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­ÙØ¸ ---
        icon.classList.remove('fa-solid');
        icon.classList.add('fa-regular'); // ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙØ§Ø¶ÙŠØ©
        btnElement.style.color = 'var(--secondary-text)'; // ÙŠØ±Ø¬Ø¹ Ø§Ù„Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ
        
        await saveRef.delete();
        showToast("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸");
    }
}
// --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¸Ù‡ÙˆØ± ÙƒØ±Ø© Ø§Ù„ÙŠÙˆØ±Ø§Ù†ÙŠÙˆÙ… ---

// 1. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø­Ø·Ù‡Ø§ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ù…Ø¹ window.onload)
function initOrbState() {
    const isHidden = localStorage.getItem('nabd_orb_hidden') === 'true';
    const orb = document.getElementById('uraniumOrb');
    const toggle = document.getElementById('orbToggleSwitch');
    
    if (isHidden) {
        // Ù„Ùˆ Ù…Ø­ÙÙˆØ¸ Ø¥Ù†Ù‡Ø§ Ù…Ø®ÙÙŠØ© -> Ø§Ø®ÙÙŠÙ‡Ø§ ÙˆØ·ÙÙŠ Ø§Ù„Ø²Ø±Ø§Ø±
        if(orb) orb.style.display = 'none';
        if(toggle) toggle.classList.remove('active');
        window.orbVisible = false; // Ù†Ø­Ø¯Ø« Ù…ØªØºÙŠØ± Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡
    } else {
        // Ø§Ù„Ø¹ÙƒØ³
        if(orb) orb.style.display = 'flex';
        if(toggle) toggle.classList.add('active');
        window.orbVisible = true;
    }
}

// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Ù„Ù…Ø§ ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±)
function toggleOrbPreference() {
    playSound('click');
    const orb = document.getElementById('uraniumOrb');
    const toggle = document.getElementById('orbToggleSwitch');
    
    // Ø¨Ù†Ø´ÙˆÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ø³
    const isActive = toggle.classList.contains('active');
    
    if (isActive) {
        // Ù‡Ùˆ Ø´ØºØ§Ù„ ÙˆØ¹Ø§ÙŠØ² ÙŠØ·ÙÙŠÙ‡
        toggle.classList.remove('active');
        orb.style.transition = '0.3s';
        orb.style.transform = 'scale(0)'; // Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ø®ØªÙØ§Ø¡
        setTimeout(() => orb.style.display = 'none', 300);
        
        localStorage.setItem('nabd_orb_hidden', 'true'); // Ø­ÙØ¸ Ø§Ù„Ø¥Ø®ÙØ§Ø¡
        showToast("ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ±Ø©");
    } else {
        // Ù‡Ùˆ Ù…Ø·ÙÙŠ ÙˆØ¹Ø§ÙŠØ² ÙŠØ´ØºÙ„Ù‡
        toggle.classList.add('active');
        orb.style.display = 'flex';
        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        orb.style.left = '15px';
        orb.style.top = (window.innerHeight - 200) + 'px';
        orb.style.bottom = 'auto';
        // Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø¸Ù‡ÙˆØ±
        setTimeout(() => {
            orb.style.transform = 'scale(1)';
            orb.style.opacity = '1';
        }, 10);
        
        localStorage.setItem('nabd_orb_hidden', 'false'); // Ø­ÙØ¸ Ø§Ù„Ø¸Ù‡ÙˆØ±
        showToast("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØ±Ø©");
    }
}

// ğŸ”¥ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„ØµÙØ­Ø© ØªÙØªØ­
// Ø¶ÙŠÙ Ø§Ù„Ø³Ø·Ø± Ø¯Ù‡ Ø¬ÙˆÙ‡ auth.onAuthStateChanged Ø£Ùˆ ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª
initOrbState();
        /* --- Ø¯Ø§Ù„Ø© Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· --- */
function copyPostLink() {
    playSound('success');
    // ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø·: Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ + Ø§Ù„Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ±
    const url = `${window.location.origin}${window.location.pathname}?post=${currentPostId}`;
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(() => showToast("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø´ÙˆØ± ğŸ”—"));
    } else {
        // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        const textArea = document.createElement("textarea");
        textArea.value = url;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand("Copy");
        textArea.remove();
        showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·");
    }
    closeAllSheets();
}

/* --- Ø¯Ø§Ù„Ø© Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø´ÙˆØ± --- */
function hidePost() {
    playSound('click');
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø¨ØµØ±ÙŠØ§Ù‹
    const postEl = document.getElementById(`post-${currentPostId}`);
    if(postEl) {
        postEl.style.transition = "0.5s";
        postEl.style.opacity = "0";
        postEl.style.transform = "scale(0.9)";
        setTimeout(() => postEl.remove(), 500);
    }
    showToast("ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ğŸ‘ï¸â€ğŸ—¨ï¸");
    closeAllSheets();
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø¬Ø¹Ù„Ù‡ Ø¯Ø§Ø¦Ù…Ø§Ù‹ØŒ ÙŠØ¬Ø¨ Ø­ÙØ¸ Ø§Ù„Ù€ ID ÙÙŠ Ù…ØµÙÙˆÙØ© 'hiddenPosts' ÙÙŠ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ ÙˆØ§Ø³ØªØ«Ù†Ø§Ø¤Ù‡ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
}

/* --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…ØªÙ‚Ø¯Ù… --- */
function openReportModal() { 
    playSound('click'); 
    closeAllSheets(); 
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø´ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    document.getElementById('reportButtons').style.display = 'flex';
    document.getElementById('otherReasonDiv').style.display = 'none';
    document.getElementById('customReportInput').value = '';
    document.getElementById('reportReasonModal').style.display='flex'; 
}

function showOtherReasonInput() {
    playSound('click');
    document.getElementById('reportButtons').style.display = 'none';
    document.getElementById('otherReasonDiv').style.display = 'block';
    document.getElementById('customReportInput').focus();
}

function submitCustomReport() {
    const reason = document.getElementById('customReportInput').value.trim();
    if(!reason) return showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø³Ø¨Ø¨");
    submitReport(reason);
}

function submitReport(r) { 
    playSound('sent'); 
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ù„Ø­ÙØ¸ Ø§Ù„Ø¨Ù„Ø§Øº ÙÙŠ ÙƒÙˆÙ„ÙƒØ´Ù† 'reports' ÙÙŠ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³
    // db.collection('reports').add({ postId: currentPostId, reason: r, reporter: currentUser.uid, time: ... });
    
    showToast("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ù„Ø§Øº: " + r); 
    document.getElementById('reportReasonModal').style.display='none'; 
    closeAllSheets(); 
}

/* --- ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø®ØµÙˆØµÙŠØ©) --- */


async function saveEditedPost() {
    playSound('success');
    const newText = document.getElementById('editPostInput').value;
    const newPrivacy = document.getElementById('editPrivacySelect').value; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©

    if(!newText) return;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    await db.collection("posts").doc(currentPostId).update({ 
        text: newText,
        privacy: newPrivacy,
        isEdited: true
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
    const postEl = document.getElementById(`post-${currentPostId}`);
    if(postEl) {
        postEl.querySelector('.post-text').innerText = newText;
        // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„ÙˆÙ‚Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ù„Ùˆ ÙƒÙ†Øª ØªØ¹Ø±Ø¶Ù‡Ø§)
    }
    
    document.getElementById('editPostModal').style.display = 'none';
    showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ± âœ…");
}

// --- Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ (Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©) ---
async function sendVerificationRequest() {
    playSound('click');
    toggleMenu(false); // Ù‚ÙÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

    if (!currentUser) return;

    // 1. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const userDoc = await db.collection('users').doc(currentUser.uid).get();
    const userData = userDoc.data();

    // Ù„Ùˆ Ù…ÙˆØ«Ù‚ Ø£ØµÙ„Ø§Ù‹
    if (userData.isVerified) {
        showToast("Ø­Ø³Ø§Ø¨Ùƒ Ù…ÙˆØ«Ù‚ Ø¨Ø§Ù„ÙØ¹Ù„! ğŸ‰");
        return;
    }

    // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨ Ø³Ø§Ø¨Ù‚
    const existingReq = await db.collection('verification_requests').doc(currentUser.uid).get();
    if (existingReq.exists) {
        showToast("Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ â³");
        return;
    }

    // 3. ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„
    showChicConfirm(
        "ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨",
        "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªÙˆØ«ÙŠÙ‚ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©ØŸ Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ø´Ø§Ø·Ùƒ.",
        '<i class="fa-solid fa-certificate" style="color:#f59e0b"></i>',
        async () => {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
            await db.collection('verification_requests').doc(currentUser.uid).set({
                uid: currentUser.uid,
                name: userData.name,
                email: userData.email,
                photoURL: userData.profilePic || "",
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            showToast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        }
    );
}

        // ØªØ¹Ø±ÙŠÙ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø±ØªØ¨ (Ù†ÙØ³ Ù…Ù†Ø·Ù‚ ØµÙØ­Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚)
const USER_RANKS = [
    { v: 0,        class: 'badge-bronze',  name: 'Ù…Ø¨ØªØ¯Ø¦',       icon: 'fa-shoe-prints' },
    { v: 25000,    class: 'badge-silver',  name: 'ØµØ§Ù†Ø¹ Ù…Ø­ØªÙˆÙ‰',  icon: 'fa-video' },
    { v: 1000000,  class: 'badge-gold',    name: 'Ø§Ù„Ù†Ø®Ø¨Ø©',      icon: 'fa-certificate' },
    { v: 5000000,  class: 'badge-diamond', name: 'VIP',         icon: 'fa-gem' },
    { v: 20000000, class: 'badge-mythic',  name: 'Ø£Ø³Ø·ÙˆØ±Ø©',      icon: 'fa-dragon' }
];

async function loadUserBadgeInMenu(uid) {
    try {
        // 1. Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        let totalViews = 0;
        // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙØ¶Ù„ ØªØ®Ø²ÙŠÙ† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª ÙÙŠ ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø£Ø¯Ø§Ø¡
        // ÙˆÙ„ÙƒÙ† Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø³ÙŠÙ‚ÙˆÙ… Ø¨Ø­Ø³Ø§Ø¨Ù‡Ø§ Ø§Ù„Ø¢Ù†:
        const postsSnap = await db.collection('posts').where('uid', '==', uid).get();
        postsSnap.forEach(doc => {
            totalViews += (doc.data().views || 0);
        });

        // 2. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±ØªØ¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
        let myRank = USER_RANKS[0]; // Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ù„Ù‰ Ø±ØªØ¨Ø© Ø­Ù‚Ù‚ Ø´Ø±ÙˆØ·Ù‡Ø§
        for (let i = 0; i < USER_RANKS.length; i++) {
            if (totalViews >= USER_RANKS[i].v) {
                myRank = USER_RANKS[i];
            }
        }

        // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯
        const badgeEl = document.getElementById('userRankBadge');
        if(badgeEl) {
            badgeEl.innerHTML = `
                <div class="mini-badge ${myRank.class}">
                    <i class="fa-solid ${myRank.icon}"></i> ${myRank.name}
                </div>
            `;
        }
    } catch (e) {
        console.error("Error loading badge:", e);
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
auth.onAuthStateChanged(user => {
    if(user) {
        loadUserBadgeInMenu(user.uid);
    }
});
function renderUserCardInSearch(doc) {
    const u = doc.data();
    const isMe = (currentUser && doc.id === currentUser.uid) ? '<span style="color:var(--primary-color); font-size:11px;">(Ø£Ù†Øª)</span>' : '';
    
    const div = document.createElement('div');
    div.className = 'res-user-card';
    div.innerHTML = `
    <div class="history-avatar" style="${u.profilePic ? `background-image:url('${u.profilePic}')` : `background:${generateColor(doc.id)}`}">${u.profilePic?'':(u.name[0])}</div>
    
    <div style="flex:1" onclick="openPage('profile.html?uid=${doc.id}')">
        <div style="font-weight:bold; color:var(--text-color); unicode-bidi: isolate;" dir="auto">
            ${highlightMatch(u.name, currentSearchQuery)} ${isMe} 
            ${u.isVerified ? getBadge(true, false) : ''}
        </div>
    </div>

    <button class="res-btn-follow" onclick="openPage('profile.html?uid=${doc.id}')">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</button>
`;

    document.getElementById('resPeople').appendChild(div);
}
 async function renderFullPostInSearch(p, targetId = 'resPosts') {
    // 1. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    let u = { name: "Ù…Ø³ØªØ®Ø¯Ù…", pic: defaultAvatar, isVerified: false };
    try {
        const ud = await db.collection('users').doc(p.uid).get();
        if(ud.exists) { 
            const d = ud.data(); 
            u.name = d.name; 
            u.pic = d.profilePic || defaultAvatar;
            u.isVerified = d.isVerified; 
        }
    } catch(e){}

    const isLiked = p.likes && p.likes[currentUser.uid];
    const likesCount = p.likes ? Object.keys(p.likes).length : 0;
    
    // --- Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†Øµ: ØªÙ†Ø¸ÙŠÙÙ‡ Ù…Ù† Ø§Ù„Ø³Ø·ÙˆØ± ÙˆØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†ØµÙŠØµ Ø¹Ø´Ø§Ù† Ø§Ù„Ø²Ø± ÙŠØ´ØªØºÙ„ ---
    const rawText = p.text || '';
    const safeText = rawText.replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');

    // 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…ÙŠØ¯ÙŠØ§
    let contentHtml = "";

    if (p.background) {
        contentHtml = `
            <div class="colored-post-body" style="background:${p.background}; min-height:200px; display:flex; align-items:center; justify-content:center; text-align:center; padding:15px; font-weight:800; font-size:20px; color:#fff; direction:rtl;">
                ${processPostText(p.text, currentSearchQuery)}
            </div>`;
    } else {
        if (p.text) {
            contentHtml += `<div class="post-text" style="padding:10px 15px;">${processPostText(p.text, currentSearchQuery)}</div>`;
        }

        if (p.media && p.media.length) {
            let gridClass = p.media.length > 1 ? 'double' : 'single';
            contentHtml += `<div class="media-grid ${gridClass}">`;
            
            p.media.forEach((m, idx) => {
                if (m.type === 'video') {
                    const uniqueVideoId = `search-vid-${p.id}-${idx}`;
                    const videoLink = `videos.html?id=${p.id}&post=${p.id}&index=${idx}&src=${encodeURIComponent(m.url)}`;
                    
                    contentHtml += `
                    <div style="position:relative; overflow:hidden; border-radius:4px; cursor:pointer;">
                        <video src="${m.url}" id="${uniqueVideoId}" class="media-item search-video-item" loop playsinline muted 
                            onclick="openPage('${videoLink}')"
></video>
                        <div class="video-mute-btn" onclick="toggleMute(event)"><i class="fa-solid fa-volume-xmark"></i></div>
                    </div>`;
                } else {
                    contentHtml += `<img src="${m.url}" class="media-item">`;
                }
            });
            contentHtml += `</div>`;
        }
    }

    // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒØ§Ø±Øª
    const div = document.createElement('div');
    div.className = 'post'; 
    div.style.border = "1px solid var(--border-color)";
    div.style.marginBottom = "10px";
    div.id = `search-post-${p.id}`;
    
    div.innerHTML = `
        <div class="post-header">
            <div class="user-info" onclick="goToProfile('${p.uid}')">
                <div class="post-avatar" style="background-image:url('${u.pic}'); background-color:transparent;"></div>
                <div class="user-details">
                   
<h4 dir="auto" style="unicode-bidi: isolate;">
    ${highlightMatch(u.name, currentSearchQuery)} ${getBadge(u.isVerified, false)}
</h4>

                    <span>${moment(p.createdAt?.toDate()).fromNow()}</span>
                </div>
            </div>
            <i class="fa-solid fa-ellipsis" onclick="openOptions('${p.id}', '${p.uid}', '${safeText}', '${p.privacy || 'public'}')" style="cursor:pointer; padding:5px; color:var(--secondary-text)"></i>
        </div>
        
        ${contentHtml}
                   
        <div class="post-actions">
            <div class="action-btn ${isLiked?'liked':''}" onclick="toggleLike('${p.id}', '${p.uid}', this)">
                <i class="${isLiked?'fa-solid':'fa-regular'} fa-heart"></i> 
                <span id="search-cnt-${p.id}">${likesCount}</span>
            </div>
            
            <div class="action-btn" onclick="openComments('${p.id}', '${p.uid}')">
                <i class="fa-regular fa-comment"></i> <span>${p.commentsCount || 0}</span>
            </div>

            <div class="action-btn" onclick="toggleSaveDirect('${p.id}', this)">
                <i class="fa-regular fa-bookmark"></i>
            </div>

             <div class="action-btn" onclick="sharePost('${p.id}')">
                <i class="fa-solid fa-share-nodes"></i>
            </div>
        </div>
    `;

    const container = document.getElementById(targetId);
    if(container) {
        container.appendChild(div);
        div.querySelectorAll('video').forEach(v => {
            if(window.videoObserver) window.videoObserver.observe(v);
        });
    }
}




function highlightMatch(text, query) {
    // 1. Ù„Ùˆ Ù…ÙÙŠØ´ Ù†Øµ Ø£ØµÙ„Ø§Ù‹ Ø£Ùˆ Ù…ÙÙŠØ´ ÙƒÙ„Ù…Ø© Ø¨Ø­Ø«ØŒ Ø±Ø¬Ø¹ Ø§Ù„Ù†Øµ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ
    if (!text || !query) return text;

    // 2. Ø¥Ù†Ø´Ø§Ø¡ "ØªØ¹Ø¨ÙŠØ± Ù†Ù…Ø·ÙŠ" (Regex) Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø©
    // Ø§Ù„Ø±Ù…Ø² 'gi' ÙŠØ¹Ù†ÙŠ: Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†Øµ ÙƒÙ„Ù‡ (Global) ÙˆØªØ¬Ø§Ù‡Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø­Ø±Ù (Insensitive)
    const regex = new RegExp(`(${query})`, 'gi');

    // 3. Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø£ÙŠ ØªØ·Ø§Ø¨Ù‚ Ø¨Ù€ Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø© Ù„ÙƒÙ† Ø¯Ø§Ø®Ù„ Span ÙˆØ§Ø®Ø¯ Ø§Ù„ÙƒÙ„Ø§Ø³ Ø¨ØªØ§Ø¹Ù†Ø§
    return text.replace(regex, '<span class="highlight-text">$1</span>');
}
// Ø¯Ø§Ù„Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Øµ (Ù‡Ø§Ø´ØªØ§Ø¬ + Ù…Ù†Ø´Ù† + ØªÙ„ÙˆÙŠÙ† Ø¨Ø­Ø«)
// Ø¯Ø§Ù„Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Øµ (Ø­Ù…Ø§ÙŠØ© + Ù‡Ø§Ø´ØªØ§Ø¬ + Ù…Ù†Ø´Ù† + ØªÙ„ÙˆÙŠÙ† Ø¨Ø­Ø«)
/* ==========================================
   Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ (ÙŠÙˆØªÙŠÙˆØ¨ + Ø±ÙˆØ§Ø¨Ø· + Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØµÙˆØ±)
   ========================================== */

// 1. Ø¯Ø§Ù„Ø© Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ID Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ù…Ù† Ø£ÙŠ Ø±Ø§Ø¨Ø·
function getYouTubeID(url) {
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}

// 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Øµ (ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø±ÙˆØ§Ø¨Ø· + ÙØªØ­ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©)
function processPostText(text) {
    if (!text) return "";
    let processed = escapeHTML(text);

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù†Øµ Ø£Ø²Ø±Ù‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¶ØºØ·
    const urlRegex = /((https?:\/\/|www\.)[^\s]+)/g;
    processed = processed.replace(urlRegex, (url) => {
        let href = url.startsWith('www.') ? 'http://' + url : url;
        // target="_blank" Ø¹Ø´Ø§Ù† ÙŠÙØªØ­ ÙÙŠ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©
        return `<a href="${href}" target="_blank" class="post-link" onclick="event.stopPropagation();">${url}</a>`;
    });

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ ÙˆØ§Ù„Ù…Ù†Ø´Ù†
    processed = processed.replace(/(^|\s)(#[^\s<]+)/g, '$1<span class="text-link" onclick="searchForHashtag(event, \'$2\')">$2</span>');
    processed = processed.replace(/(^|\s)(@[^\s<]+)/g, (m, s, ment) => `${s}<span class="text-link" onclick="openSearchWithName('${ment.replace('@','')}')">${ment}</span>`);

    return processed;
}

// 3. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø· Ù…Ù† Ø§Ù„Ù†Øµ
function extractFirstLink(text) {
    const matches = text.match(/((https?:\/\/|www\.)[^\s]+)/);
    return matches ? (matches[0].startsWith('www.') ? 'http://'+matches[0] : matches[0]) : null;
}

// 4. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø¹ Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù„ØµÙˆØ± ÙŠÙˆØªÙŠÙˆØ¨)
async function fetchLinkMetadata(url) {
    try {
        // Ø£) Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ØŸ
        const videoId = getYouTubeID(url);

        if (videoId) {
            // Ù„Ùˆ ÙŠÙˆØªÙŠÙˆØ¨ØŒ Ù‡Ø§Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
            return {
                title: "YouTube Video",
                description: "Ø§Ø¶ØºØ· Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¹Ù„Ù‰ ÙŠÙˆØªÙŠÙˆØ¨",
                // Ø¯ÙŠ Ø³ÙŠØ±ÙØ±Ø§Øª Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Ø³Ø±ÙŠØ¹Ø© Ø¬Ø¯Ø§Ù‹ ÙˆÙ…Ø¶Ù…ÙˆÙ†Ø©)
                image: `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`, 
                domain: "youtube.com",
                url: url
            };
        }

        // Ø¨) Ù„Ùˆ Ø±Ø§Ø¨Ø· Ø¹Ø§Ø¯ÙŠ (ØªÙŠÙƒ ØªÙˆÙƒØŒ ÙÙŠØ³Ø¨ÙˆÙƒØŒ Ø£Ø®Ø¨Ø§Ø±...)
        const response = await fetch(`https://api.microlink.io?url=${encodeURIComponent(url)}`);
        const json = await response.json();
        
        if (json.status === 'success') {
            const data = json.data;
            return {
                title: data.title || "Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ",
                description: data.description || url,
                image: data.image ? data.image.url : null, // Ù„Ùˆ Ù…ÙÙŠØ´ ØµÙˆØ±Ø© Ù‡ØªØ±Ø¬Ø¹ null
                domain: data.publisher || new URL(url).hostname,
                url: url
            };
        }
        return null;

    } catch (e) {
        console.error("Link Error:", e);
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ØªØ§Ù…ØŒ Ù†Ø±Ø¬Ø¹ null ÙˆØ§Ù„Ø¨ÙˆØ³Øª ÙŠØ¸Ù‡Ø± ÙƒÙ†Øµ Ø¨Ø³
        return null;
    }
}

// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¶ØºØ·

function openSearchWithName(name) {
    event.stopPropagation();
    openFullSearch();
    document.getElementById('superSearchInput').value = name;
    performSuperSearch();
}

// Ø¯Ø§Ù„Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
function searchForHashtag(e, tag) {
    e.stopPropagation(); // Ù…Ù†Ø¹ ÙØªØ­ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù†ÙØ³Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬
    e.preventDefault();
    
    // 1. ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¨Ø­Ø«
    openFullSearch();
    
    // 2. ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø«
    const searchInput = document.getElementById('superSearchInput');
    searchInput.value = tag;
    
    // 3. ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« ÙÙˆØ±Ø§Ù‹
    performSuperSearch();
}
// Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØ­ÙØ¸ Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø´Ø±
async function saveHashtagsToDB(text, postId) {
    if (!text) return;
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù„ÙŠ Ø¨ØªØ¨Ø¯Ø£ Ø¨Ù€ #
    const matches = text.match(/#[\w\u0600-\u06FF]+/g);
    
    if (matches) {
        const batch = db.batch(); // Ø¹Ø´Ø§Ù† Ù†Ø¨Ø¹Øª ÙƒÙ„Ù‡ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
        
        matches.forEach(tag => {
            const cleanTag = tag.replace('#', ''); // Ø§Ø³Ù… Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø´Ø¨Ø§Ùƒ
            const tagRef = db.collection('hashtags').doc(cleanTag);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ Ø²ÙˆØ¯ 1ØŒ Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ø£Ù†Ø´Ø¦Ù‡)
            batch.set(tagRef, {
                name: cleanTag,
                postsCount: firebase.firestore.FieldValue.increment(1),
                views: firebase.firestore.FieldValue.increment(0), // Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹ 0 Ù„Ø­Ø¯ Ù…Ø§ Ø­Ø¯ ÙŠØ´ÙˆÙÙ‡
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
        });
        
        await batch.commit();
    }
}
// 1. Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙÙ„ØªØ±Ø©
// 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙÙ„ØªØ± (ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®)
let filterSettings = {
    sort: 'rel',
    date: 'all',
    specificDate: null
};

// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± (ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«)
function setFilter(type, value, elem) {
    // Ù„Ùˆ Ø§Ø®ØªØ§Ø± Ø²Ø±Ø§Ø± ÙˆÙ‚Øª (ÙŠÙˆÙ…ØŒ Ø£Ø³Ø¨ÙˆØ¹...) Ø¨Ù†Ù„ØºÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯
    if (type === 'date') {
        const dateInput = document.getElementById('specificDateInput');
        if(dateInput) dateInput.value = ''; 
        filterSettings.specificDate = null;
    }

    filterSettings[type] = value;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù†
    const parent = elem.parentElement;
    parent.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
    elem.classList.add('active');
}

// 3. Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ù…Ø¹ÙŠÙ† (Ø¯ÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª Ù†Ø§Ù‚ØµØ©)
function setSpecificDate(input) {
    if(input.value) {
        filterSettings.date = 'specific'; 
        filterSettings.specificDate = input.value; // Ø¨ÙŠØ­ÙØ¸ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© 2024-12-31

        // Ø¨Ù†Ø´ÙŠÙ„ Ø§Ù„Ù„ÙˆÙ† Ù…Ù† Ø£Ø²Ø±Ø§Ø± (ÙŠÙˆÙ…ØŒ Ø£Ø³Ø¨ÙˆØ¹ØŒ Ø´Ù‡Ø±) Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø¥Ù†Ù‡ Ø§Ø®ØªØ§Ø± ØªØ§Ø±ÙŠØ® Ù…Ø®ØµØµ
        document.querySelectorAll('#filterSheet .filter-chip').forEach(c => {
            if(c.innerText !== 'Ø§Ù„ØµÙ„Ø©' && c.innerText !== 'Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ø¹Ø¬Ø§Ø¨Ø§Ù‹' && c.innerText !== 'Ø§Ù„Ø£Ø­Ø¯Ø«') {
                c.classList.remove('active');
            }
        });
    }
}




// 3. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„ (History)
function useHistoryItem(text, type, id) {
    if(type === 'user' && id) {
        // ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: ÙŠÙØªØ­ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
        openPage(`profile.html?uid=${id}`);
    } else {
        document.getElementById('superSearchInput').value = text || "";
        performSuperSearch();
    }
}


// 4. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„ØªÙ‚Ø¨Ù„ Ø§Ù„ÙÙ„ØªØ±Ø©)
async function performSuperSearch() {
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    document.querySelectorAll('#postsList video').forEach(v => v.pause());

    const val = document.getElementById('superSearchInput').value.trim();
    if (!val) return;
updateSearchTrendCounter(val);
    addToHistory({ type: 'text', text: val, name: val });
    currentSearchQuery = val;

    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø´Ø§Ø´Ø©
    document.getElementById('searchHistorySection').style.display = 'none';
    document.getElementById('searchResultsSection').style.display = 'block';
    document.getElementById('searchResultTabs').style.display = 'flex';
    document.getElementById('searchLoader').style.display = 'block';
    document.getElementById('noResultsMsg').style.display = 'none';

    // ØªÙØ±ÙŠØº Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    document.getElementById('resPeople').innerHTML = "";
    document.getElementById('resPosts').innerHTML = "";
    document.getElementById('resNabdVideos').innerHTML = "";
    document.getElementById('resHashtags').innerHTML = "";

    switchSearchTab('all');

    try {
        // --- 1. Ø¨Ø­Ø« Ø§Ù„Ø£Ø´Ø®Ø§Øµ ---
        const userSnap = await db.collection('users')
            .where('name', '>=', val).where('name', '<=', val + '\uf8ff').limit(5).get();
        if (!userSnap.empty) {
            document.getElementById('resPeople').insertAdjacentHTML('beforeend', '<div style="padding:10px;font-weight:bold;color:var(--secondary-text)">Ø£Ø´Ø®Ø§Øµ</div>');
            userSnap.forEach(doc => renderUserCardInSearch(doc));
        }

        // --- 2. Ø¨Ø­Ø« Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª ---
        const cleanTag = val.replace('#', '');
        const hashSnap = await db.collection('hashtags')
            .where('name', '>=', cleanTag).where('name', '<=', cleanTag + '\uf8ff').limit(5).get();
        if (!hashSnap.empty) {
            document.getElementById('resHashtags').insertAdjacentHTML('beforeend', '<div style="padding:10px;font-weight:bold;color:var(--primary-color)">Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª</div>');
            hashSnap.forEach(doc => {
                const h = doc.data();
                const div = document.createElement('div');
                div.className = 'hashtag-card';
                div.onclick = () => { 
                    document.getElementById('superSearchInput').value = '#' + h.name;
                    performSuperSearch(); 
                    switchSearchTab('all');
                };
                div.innerHTML = `
                    <div class="hash-icon-circle"><i class="fa-solid fa-hashtag"></i></div>
                    <div class="hash-info"><h4>#${h.name}</h4><div class="hash-stats"><span>${formatNumber(h.postsCount||0)} Ù…Ù†Ø´ÙˆØ±</span></div></div>`;
                document.getElementById('resHashtags').appendChild(div);
            });
        }

        // --- 3. Ø¨Ø­Ø« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ± ---
        const allRecentPosts = await db.collection('posts').orderBy('createdAt', 'desc').limit(100).get();
        
        let filteredPosts = [];
        const term = val.toLowerCase().replace('#', '');

        // ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù†Øµ
        allRecentPosts.forEach(doc => {
            const p = { id: doc.id, ...doc.data() };
            const txt = (p.text || "").toLowerCase();
            if (txt.includes(term)) {
                filteredPosts.push(p);
            }
        });

        // ğŸ”¥ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§) ğŸ”¥
        const now = new Date();
        filteredPosts = filteredPosts.filter(p => {
            if (!p.createdAt) return false;
            const postDate = p.createdAt.toDate();

            // Ø£) Ù„Ùˆ Ù…Ø®ØªØ§Ø± ÙŠÙˆÙ… Ù…Ø­Ø¯Ø¯
            if (filterSettings.date === 'specific' && filterSettings.specificDate) {
                // ØªØ­ÙˆÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù„Ù†Øµ (2024-12-31) Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                const pYear = postDate.getFullYear();
                const pMonth = String(postDate.getMonth() + 1).padStart(2, '0');
                const pDay = String(postDate.getDate()).padStart(2, '0');
                const postDateString = `${pYear}-${pMonth}-${pDay}`;
                
                return postDateString === filterSettings.specificDate;
            }

            // Ø¨) Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            if (filterSettings.date !== 'all' && filterSettings.date !== 'specific') {
                const diffHours = (now - postDate) / (1000 * 60 * 60);
                if (filterSettings.date === '24h') return diffHours <= 24;
                if (filterSettings.date === 'week') return diffHours <= 168;
                if (filterSettings.date === 'month') return diffHours <= 720;
            }
            return true;
        });

        // ØªØ±ØªÙŠØ¨
        if (filterSettings.sort === 'likes') {
            filteredPosts.sort((a, b) => {
                const likesA = a.likes ? Object.keys(a.likes).length : 0;
                const likesB = b.likes ? Object.keys(b.likes).length : 0;
                return likesB - likesA;
            });
        } else if (filterSettings.sort === 'date') {
            filteredPosts.sort((a, b) => b.createdAt - a.createdAt);
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        document.getElementById('searchLoader').style.display = 'none';

        if (filteredPosts.length > 0) {
            const postsContainer = document.getElementById('resPosts');
            const videoContainer = document.getElementById('resNabdVideos');
            let videoHeaderAdded = false;
            let postsHeaderAdded = false;

            filteredPosts.forEach(p => {
                if (p.type === 'video' || (p.media && p.media.some(m => m.type === 'video'))) {
                    if (!videoHeaderAdded) {
                        videoContainer.insertAdjacentHTML('beforeend', '<div style="padding:10px;font-weight:bold;color:var(--primary-color)">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>');
                        videoHeaderAdded = true;
                    }
                    renderFullPostInSearch(p, 'resNabdVideos');
                }
                if (!postsHeaderAdded) {
                    postsContainer.insertAdjacentHTML('beforeend', '<div style="padding:10px;font-weight:bold;color:var(--secondary-text)">Ù…Ù†Ø´ÙˆØ±Ø§Øª</div>');
                    postsHeaderAdded = true;
                }
                renderFullPostInSearch(p, 'resPosts');
            });
        }

        if (userSnap.empty && hashSnap.empty && filteredPosts.length === 0) {
            document.getElementById('noResultsMsg').style.display = 'block';
        }

    } catch (e) {
        console.error(e);
        document.getElementById('searchLoader').style.display = 'none';
    }
}

function applyFilters() {
    playSound('click');
    closeAllSheets(); // Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„Ø§ØªØ±
    performSuperSearch(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    showToast("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± âœ…");
}

// Ø¯Ø§Ù„Ø© ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„Ø§ØªØ± (Ø¯ÙŠ Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª Ù†Ø§Ù‚ØµØ©)
function openFilterSheet() {
    playSound('click');
    document.getElementById('filterSheet').classList.add('active');
}
        document.addEventListener('click', function(e) {
    if (e.target && e.target.classList.contains('mention-node')) {
        const uid = e.target.getAttribute('data-uid');
        if (uid) {
            playSound('click');
            openPage(`profile.html?uid=${uid}`); // ÙŠÙØªØ­ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
        }
    }
});

function setupSmartInputListener(inputId, dropdownId) {
    const inp = document.getElementById(inputId);
    const drop = document.getElementById(dropdownId);

    inp.addEventListener('keyup', async (e) => {
        const val = inp.value;
        const cursor = inp.selectionStart;

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„ØªÙŠ ÙŠÙƒØªØ¨Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const beforeCursor = val.substring(0, cursor);
        const lastWord = beforeCursor.split(/(\s+)/).pop();

        // ============================
        // Ø§Ù„Ø­Ø§Ù„Ø© 1: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙƒØªØ¨ Ù…Ù†Ø´Ù† @
        // ============================
        if (lastWord.startsWith('@') && lastWord.length > 1) {
            const query = lastWord.substring(1);
            activeInputId = inputId; // Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù†Ø´Ø·

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
            const wrapper = inp.parentElement.parentElement; 
            if(!wrapper.contains(drop)) wrapper.insertBefore(drop, wrapper.firstChild);
            drop.classList.add('active');
            drop.innerHTML = '<div style="padding:10px;text-align:center"><i class="fa-solid fa-spinner fa-spin"></i></div>';

            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                const snap = await db.collection('users').orderBy('name').startAt(query).endAt(query + '\uf8ff').limit(5).get();
                drop.innerHTML = "";

                if(snap.empty) { drop.classList.remove('active'); return; }

                snap.forEach(doc => {
                    const d = doc.data();
                    const div = document.createElement('div');
                    div.className = 'mention-suggest-item';
                    div.innerHTML = `<div style="width:30px;height:30px;border-radius:50%;background:${d.profilePic?`url(${d.profilePic})`:`#444`};background-size:cover"></div><div>${d.name}</div>`;
                    
                    div.onclick = () => {
                        const afterCursor = val.substring(cursor);
                        const textBeforeLastWord = beforeCursor.substring(0, beforeCursor.lastIndexOf(lastWord));
                        // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù†Ø´Ù†
                        inp.value = textBeforeLastWord + '@' + d.name + " " + afterCursor;
                        inp.focus();
                        drop.classList.remove('active');
                        
                        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ù† Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                        window.directMentionData = { uid: doc.id, name: d.name };
                        if(activeInputId === 'replyInput') currentSubReplyTarget = {uid: doc.id, name: d.name};
                    };
                    drop.appendChild(div);
                });
            } catch(e) { console.error(e); }
        }

        // ============================
        // Ø§Ù„Ø­Ø§Ù„Ø© 2: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙƒØªØ¨ Ù‡Ø§Ø´ØªØ§Ø¬ #
        // ============================
        else if (lastWord.startsWith('#') && lastWord.length > 1) {
            const query = lastWord.substring(1);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
            const wrapper = inp.parentElement.parentElement; 
            if(!wrapper.contains(drop)) wrapper.insertBefore(drop, wrapper.firstChild);
            drop.classList.add('active');
            drop.innerHTML = '<div style="padding:10px;text-align:center"><i class="fa-solid fa-spinner fa-spin"></i></div>';

            try {
                // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒÙˆÙ„ÙƒØ´Ù† Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª
                const snap = await db.collection('hashtags').orderBy('name').startAt(query).endAt(query + '\uf8ff').limit(5).get();
                drop.innerHTML = "";

                if(snap.empty) { drop.classList.remove('active'); return; }

                snap.forEach(doc => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = 'mention-suggest-item';
                    div.innerHTML = `
                        <div style="width:30px;height:30px;border-radius:50%; background:rgba(93, 95, 239, 0.1); color:var(--primary-color); display:grid; place-items:center; font-size:16px;">
                            <i class="fa-solid fa-hashtag"></i>
                        </div>
                        <div>
                            <div style="font-weight:bold; font-size:14px;">${data.name}</div>
                            <div style="font-size:10px; color:#777;">${data.postsCount || 0} Ù…Ù†Ø´ÙˆØ±</div>
                        </div>`;
                    
                    div.onclick = () => {
                        const afterCursor = val.substring(cursor);
                        const textBeforeLastWord = beforeCursor.substring(0, beforeCursor.lastIndexOf(lastWord));
                        // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬
                        inp.value = textBeforeLastWord + '#' + data.name + " " + afterCursor;
                        inp.focus();
                        drop.classList.remove('active');
                    };
                    drop.appendChild(div);
                });
            } catch(e) { console.error(e); }
        }

        // ============================
        // Ø§Ù„Ø­Ø§Ù„Ø© 3: Ù„Ø§ Ø´ÙŠØ¡ (Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
        // ============================
        else {
            drop.classList.remove('active');
        }
    });
}

// --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ (30+ Ù„ÙˆÙ†) ---
const appColors = [
    // ğŸ’œ Ø¨Ù†ÙØ³Ø¬ÙŠ ÙˆÙˆØ±Ø¯ÙŠ
    "#5D5FEF", "#8e44ad", "#9b59b6", "#bf5af2", "#ac00e6", "#ff00ff", "#ff416c", "#e91e63", "#ff7eb3",
    // ğŸ’™ Ø£Ø²Ø±Ù‚ ÙˆØ³Ù…Ø§ÙˆÙŠ
    "#2979ff", "#00eaff", "#00d2ff", "#1877f2", "#3498db", "#0984e3", "#74b9ff", "#341f97",
    // ğŸ’š Ø£Ø®Ø¶Ø±
    "#34c759", "#00ff00", "#11998e", "#2ecc71", "#00b894", "#55efc4", "#badc58", "#6ab04c",
    // ğŸ§¡ Ù†Ø§Ø±ÙŠ (Ø£Ø­Ù…Ø± ÙˆØ£ØµÙØ±)
    "#ff3b30", "#ff0000", "#e74c3c", "#d35400", "#ff9f0a", "#f7971e", "#ffeb3b", "#f1c40f",
    // ğŸ–¤ Ø£Ù„ÙˆØ§Ù† Ø®Ø§ØµØ©
    "#ffd700", "#c0c0c0", "#304352", "#636e72"
];

function renderThemeColors() {
    const container = document.getElementById('colorsContainer');
    if(!container) return;
    container.innerHTML = ""; 

    // 1. Ø²Ø±Ø§Ø± "Ù„ÙˆÙ† Ù…Ø®ØµØµ" (Picker)
    const customDiv = document.createElement('div');
    customDiv.className = 'custom-color-btn';
    customDiv.innerHTML = '<i class="fa-solid fa-eye-dropper"></i>';
    customDiv.onclick = () => {
        const input = document.createElement('input');
        input.type = 'color';
        input.onchange = (e) => changeTheme(e.target.value);
        input.click();
    };
    container.appendChild(customDiv);

    // 2. Ø±Ø³Ù… Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
    appColors.forEach(color => {
        const div = document.createElement('div');
        div.className = 'color-circle';
        div.style.backgroundColor = color;
        div.onclick = () => changeTheme(color);
        container.appendChild(div);
    });
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠÙØªØ­
document.addEventListener('DOMContentLoaded', renderThemeColors);
// Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø­Ø·Ù‡Ø§ ÙÙŠ Ù…ÙƒØ§Ù† Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ù„Ù)
// Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¯Ø§Ù„Ø© (Ø¹Ø´Ø§Ù† Ù†ØªØ­ÙƒÙ… ÙÙŠÙ‡)
let toastTimer = null;

function showToast(message) {
    const toast = document.getElementById('toast');
    const toastMsg = document.getElementById('toast-msg');
    
    if (!toast || !toastMsg) return;

    // 1. Ù„Ùˆ ÙÙŠÙ‡ Ø¹Ø¯Ø§Ø¯ Ø´ØºØ§Ù„ Ù…Ù† Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù„ÙŠ ÙØ§ØªØªØŒ Ø§Ù„ØºÙŠÙ‡ ÙÙˆØ±Ø§Ù‹
    if (toastTimer) {
        clearTimeout(toastTimer);
        toastTimer = null;
    }

    // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ
    toastMsg.innerText = message;

    // 3. Ø®Ø¯Ø¹Ø© Ø¨Ø±Ù…Ø¬ÙŠØ©: Ø´ÙŠÙ„ Ø§Ù„ÙƒÙ„Ø§Ø³ ÙˆØ­Ø·Ù‡ ØªØ§Ù†ÙŠ Ø¨Ø³Ø±Ø¹Ø© Ø¹Ø´Ø§Ù† Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ÙŠØ´ØªØºÙ„ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„
    toast.classList.remove('show');
    
    // Ø³Ø·Ø± Ø³Ø­Ø±ÙŠ: Ø¨ÙŠØ¬Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­ ÙŠÙ„Ø§Ø­Ø¸ Ø§Ù„ØªØºÙŠÙŠØ± (Reflow)
    void toast.offsetWidth; 

    // 4. Ø£Ø¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    toast.classList.add('show');

    // 5. Ø§Ø¨Ø¯Ø£ Ø¹Ø¯Ø§Ø¯ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¥Ø®ÙØ§Ø¡
    toastTimer = setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

let tempPrivacySelection = 'public'; // Ù…ØªØºÙŠØ± Ù…Ø¤Ù‚Øª

function openAudienceModal() {
    closeAllSheets();
    playSound('click');
    
    const pid = window.currentPostId || currentPostId;
    const currentPriv = window.currentPostPrivacy || currentPostPrivacy || 'public';
    
    if(!pid) {
        showToast("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±");
        return;
    }
    
    const radioBtn = document.getElementById(`aud_${currentPriv}`);
    if(radioBtn) radioBtn.checked = true;
    
    tempPrivacySelection = currentPriv;
    
    document.getElementById('audienceModal').style.display = 'flex';
}
function selectAudience(val) {
    tempPrivacySelection = val;
    document.getElementById(`aud_${val}`).checked = true;
}

async function saveAudienceChange() {
    const pid = window.currentPostId || currentPostId;
    
    if(!pid) {
        showToast("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±");
        return;
    }
    
    playSound('success');
    document.getElementById('audienceModal').style.display = 'none';
    showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...");
    
    try {
        await db.collection('posts').doc(pid).update({
            privacy: tempPrivacySelection
        });
        
        const postCard = document.getElementById(`post-${pid}`);
        if(postCard) {
            const detailsDiv = postCard.querySelector('.user-details');
            if(detailsDiv) {
                const timeDiv = detailsDiv.querySelector('div:last-child');
                if(timeDiv) {
                    const timeText = timeDiv.querySelector('span')?.innerText || 'Ø§Ù„Ø¢Ù†';
                    timeDiv.innerHTML = `
                        <span>${timeText}</span>
                        <span style="font-size:6px; opacity:0.6">â€¢</span>
                        ${getPrivacyIcon(tempPrivacySelection)}
                    `;
                }
            }
            
            const optBtn = postCard.querySelector('.fa-ellipsis');
            if(optBtn) {
                const safeText = (currentPostText || "").replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');
                const ownerUid = currentPostOwnerUid || currentUser.uid;
                optBtn.setAttribute('onclick', `openOptions('${pid}', '${ownerUid}', '${safeText}', '${tempPrivacySelection}')`);
            }
        }
        
        currentPostPrivacy = tempPrivacySelection;
        window.currentPostPrivacy = tempPrivacySelection;
        
        showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± âœ…");
        
    } catch(e) {
        console.error("Error updating audience:", e);
        showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    }
}
        /* --- 4. Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„ØªØ­Ø¯ÙŠØ« (Ù…Ø¹ Ø¥ØµÙ„Ø§Ø­ ØªØ¹Ø§Ø±Ø¶ Ø§Ù„ÙƒØ±Ø©) --- */
/* --- 4. Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„ØªØ­Ø¯ÙŠØ« (Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©: Ø¨Ø¯ÙˆÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø©ØŒ Ø´Ø±ÙŠØ· Ø£ØµÙØ± ÙÙ‚Ø·) --- */
let pStart = {x:0, y:0};
let pCurrent = {x:0, y:0};
let isPulling = false;

// Ù…Ù„Ø§Ø­Ø¸Ø©: Ø­Ø°ÙÙ†Ø§ ÙƒÙˆØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ loader Ù…Ù† Ù‡Ù†Ø§

document.addEventListener('touchstart', e => {
    // Ù„Ùˆ Ø§Ù„Ù„Ù…Ø³Ø© Ø¨Ø¯Ø£Øª Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±Ø© Ø£Ùˆ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ø¹Ø§Ø¦Ù…Ø©ØŒ Ù†ÙˆÙ‚Ù Ø§Ù„Ø³Ø­Ø¨
    if (e.target.closest('#uraniumOrb') || e.target.closest('.universal-overlay')) return;

    if(window.scrollY === 0) {
        pStart.x = e.touches[0].screenX;
        pStart.y = e.touches[0].screenY;
        isPulling = true;
    }
}, {passive: false});

document.addEventListener('touchmove', e => {
    if (!isPulling) return;

    if(window.scrollY === 0) {
        pCurrent.x = e.touches[0].screenX;
        pCurrent.y = e.touches[0].screenY;
        
        // Ø­Ø°ÙÙ†Ø§ ÙƒÙˆØ¯ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„ÙˆØ¯Ø± Ù…Ù† Ù‡Ù†Ø§
    }
}, {passive: false});

document.addEventListener('touchend', e => {
    if (!isPulling) return; 

    const diff = pCurrent.y - pStart.y;
    
    // Ù„Ùˆ Ø³Ø­Ø¨Øª Ù…Ø³Ø§ÙØ© ÙƒØ§ÙÙŠØ© (80 Ø¨ÙƒØ³Ù„)
    if(window.scrollY === 0 && diff > 80) {
        playSound('tab');
        if(navigator.vibrate) navigator.vibrate(50);
        
        // ØªØ´ØºÙŠÙ„ Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
        // (Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯ÙŠ Ø¬ÙˆØ§Ù‡Ø§ ÙƒÙˆØ¯ startLoadingBar Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ¸Ù‡Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø£ØµÙØ±)
        loadPosts();
    }
    
    // ØªØµÙÙŠØ± Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    pStart = {x:0, y:0}; 
    pCurrent = {x:0, y:0};
    isPulling = false;
});

// --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø²ÙˆÙ… ÙˆØ§Ù„Ø­Ø±ÙƒØ© ---
let currentScale = 1;
let currentX = 0;
let currentY = 0;
let startX = 0;
let startY = 0;
let initialPinchDistance = 0;
let isDragging = false;
let isPinching = false;
let longPressTimer;

// --- Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø­Ø¯Ø«Ø©) ---
/* --- Ø¯ÙˆØ§Ù„ ØªØ´ØºÙŠÙ„ Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± --- */
function viewImage(url) {
    const lb = document.getElementById('imgLightbox');
    const img = document.getElementById('lbImage');
    
    if (!lb || !img) return;

    // 1. Ø­Ø· Ø§Ù„ØµÙˆØ±Ø©
    img.src = url;
    
    // 2. Ø§Ø¸Ù‡Ø± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
    lb.style.display = 'flex';
    
    // 3. Ø´ØºÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¨Ø¹Ø¯ Ù„Ø­Ø¸Ø© (Ø¹Ø´Ø§Ù† ÙŠÙ„Ø­Ù‚ ÙŠØªØ±Ø³Ù…)
    setTimeout(() => {
        lb.classList.add('active');
        if(navigator.vibrate) navigator.vibrate(30); // Ù‡Ø²Ø© Ø¨Ø³ÙŠØ·Ø©
    }, 10);
}

function closeLightbox() {
    const lb = document.getElementById('imgLightbox');
    if (!lb) return;
    
    // 1. Ø§Ù„ØºÙŠ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† (ÙŠØ®ØªÙÙŠ Ø¨Ù†Ø¹ÙˆÙ…Ø©)
    lb.classList.remove('active');
    
    // 2. Ø§Ø®ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ø¨Ø¹Ø¯ Ù…Ø§ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ÙŠØ®Ù„Øµ
    setTimeout(() => {
        lb.style.display = 'none';
        document.getElementById('lbImage').src = ''; /* ØªÙØ±ÙŠØº Ø§Ù„ØµÙˆØ±Ø© */
    }, 300);
}

// --- Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø­Ø¯Ø«Ø©) --
// --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø²ÙˆÙ… + Ø³Ø­Ø¨ ÙÙ‚Ø·) ---
function setupImageInteractions(img) {
    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ listeners Ø³Ø§Ø¨Ù‚Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
    const newImg = img.cloneNode(true);
    img.parentNode.replaceChild(newImg, img);
    img = newImg; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù†Ø¸ÙŠÙ

    // 1. Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³ (Touch Start)
    img.addEventListener('touchstart', (e) => {
        // Ø£) Ù„Ùˆ Ø¥ØµØ¨Ø¹ÙŠÙ† (Ø²ÙˆÙ…)
        if (e.touches.length === 2) {
            isPinching = true;
            initialPinchDistance = getDistance(e.touches);
        } 
        // Ø¨) Ù„Ùˆ Ø¥ØµØ¨Ø¹ ÙˆØ§Ø­Ø¯ (Ø³Ø­Ø¨ ÙÙ‚Ø·)
        else if (e.touches.length === 1) {
            isDragging = true;
            startX = e.touches[0].clientX - currentX;
            startY = e.touches[0].clientY - currentY;
        }
    }, { passive: false });

    // 2. Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ù…Ø³ (Touch Move)
    img.addEventListener('touchmove', (e) => {
        e.preventDefault(); // Ù…Ù†Ø¹ Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„ØµÙØ­Ø©

        // Ø£) Ø²ÙˆÙ… (Ø¥ØµØ¨Ø¹ÙŠÙ†)
        if (isPinching && e.touches.length === 2) {
            const newDistance = getDistance(e.touches);
            const scaleChange = newDistance / initialPinchDistance;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø²ÙˆÙ… (Ù…Ù† 1x Ø¥Ù„Ù‰ 5x)
            let newScale = currentScale * scaleChange;
            if (newScale < 1) newScale = 1;
            if (newScale > 5) newScale = 5;
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø²ÙˆÙ… Ù…Ø¨Ø§Ø´Ø±Ø©
            img.style.transform = `translate(${currentX}px, ${currentY}px) scale(${newScale})`;
        }
        // Ø¨) Ø³Ø­Ø¨ (Ø¥ØµØ¨Ø¹ ÙˆØ§Ø­Ø¯) - ÙŠØ´ØªØºÙ„ ÙÙ‚Ø· Ù„Ùˆ Ø§Ù„Ø²ÙˆÙ… Ø£ÙƒØ¨Ø± Ù…Ù† 1
        else if (isDragging && e.touches.length === 1 && currentScale > 1) {
            currentX = e.touches[0].clientX - startX;
            currentY = e.touches[0].clientY - startY;
            updateImageTransform();
        } 
    }, { passive: false });

    // 3. Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³ (Touch End)
    img.addEventListener('touchend', (e) => {
        if (isPinching && e.touches.length < 2) {
            isPinching = false;
            // Ø­ÙØ¸ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø²ÙˆÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù€ style Ø§Ù„Ø­Ø§Ù„ÙŠ
            const style = window.getComputedStyle(img);
            const matrix = new WebKitCSSMatrix(style.transform);
            currentScale = matrix.a; // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù€ Scale Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
            if(currentScale < 1) currentScale = 1; // Ø­Ù…Ø§ÙŠØ©
        }
        
        isDragging = false;
        
        // Ù„Ùˆ Ø±Ø¬Ø¹Ù†Ø§ Ø§Ù„Ø²ÙˆÙ… Ù„Ù€ 1ØŒ Ù†Ø±Ø¬Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØªØµÙ
        if (currentScale <= 1.1) {
            currentScale = 1;
            currentX = 0;
            currentY = 0;
            updateImageTransform();
        }
    });
}


// --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ---

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø¥ØµØ¨Ø¹ÙŠÙ† (ÙÙŠØ«Ø§ØºÙˆØ±Ø³)
function getDistance(touches) {
    return Math.hypot(
        touches[0].clientX - touches[1].clientX,
        touches[0].clientY - touches[1].clientY
    );
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø±ÙƒØ© Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
function updateImageTransform() {
    const img = document.getElementById('lbImage');
    if(img) {
        img.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentScale})`;
    }
}

// Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©
function saveImageAction(url) {
    if(navigator.vibrate) navigator.vibrate(50); // Ù‡Ø²Ø§Ø² Ø¨Ø³ÙŠØ·
    
    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ (Ø§Ø³ØªØ®Ø¯Ø§Ù… ChicModal Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ ÙƒÙˆØ¯Ùƒ)
    // Ù†ÙØªØ±Ø¶ Ø£Ù† Ø¯Ø§Ù„Ø© showChicConfirm Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚
    if(typeof showChicConfirm === 'function') {
        showChicConfirm(
            "Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©", 
            "Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ", 
            '<i class="fa-solid fa-download" style="color:var(--primary-color)"></i>',
            () => downloadImageForce(url)
        );
    } else {
        // Ù„Ùˆ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ø­Ù…Ù„ Ø¹Ù„Ø·ÙˆÙ„
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©ØŸ")) {
            downloadImageForce(url);
        }
    }
}

function downloadImageForce(url) {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ÙˆÙ‡Ù…ÙŠ Ù„Ù„ØªØ­Ù…ÙŠÙ„
    const link = document.createElement('a');
    link.href = url;
    link.download = `Wareed_Image_${Date.now()}.jpg`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
    if(typeof showToast === 'function') showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... ğŸ“¥");
}
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ·
// Ø¯ÙˆØ§Ù„ Ø§Ù„Ø´Ø±ÙŠØ· (Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©) â±ï¸
function startLoadingBar() {
    const bar = document.getElementById('top-progress-bar');
    if(!bar) return;

    // 1. Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø´Ø±ÙŠØ· Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
    bar.style.transition = 'none'; 
    bar.style.width = '0%';
    bar.style.opacity = '1';

    // 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù€ 100% ÙÙŠ Ù†ØµÙ Ø«Ø§Ù†ÙŠØ©
    setTimeout(() => {
        // ğŸ”¥ Ù„Ø§Ø²Ù… Ù†ÙƒØªØ¨ Ù‡Ù†Ø§ Ù†ÙØ³ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø¨ØªØ§Ø¹ CSS (0.5s)
        bar.style.transition = 'width 0.5s ease-in-out, opacity 0.3s ease';
        bar.style.width = '100%'; 
    }, 10);
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ (Ø²ÙŠ Ù…Ø§ Ù‡ÙŠØŒ Ø¨ØªØ®ÙÙŠ ÙÙˆØ±Ø§Ù‹)
function finishLoadingBar() {
    const bar = document.getElementById('top-progress-bar');
    if(!bar) return;

    bar.style.width = '100%';

    // Ø§Ø®ØªÙØ§Ø¡ ÙÙˆØ±ÙŠ Ø¨Ø¹Ø¯ Ù„Ø­Ø¸Ø© ÙˆØµÙˆÙ„Ù‡
    setTimeout(() => {
        bar.style.opacity = '0';
        setTimeout(() => { bar.style.width = '0%'; }, 300); 
    }, 100); 
}

// --- Ø¯Ø§Ù„Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© ---
// --- Ø¯Ø§Ù„Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
function monitorMessageCount() {
    if (!auth.currentUser) return;

    db.collection('chats')
      .where('users', 'array-contains', auth.currentUser.uid)
      .onSnapshot(snap => {
          let totalUnread = 0;

          // 1. Ù†Ø¹Ø¯ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§ÙŠÙ„ Ø§Ù„Ù„ÙŠ Ù…Ø´ Ù…ØªØ´Ø§ÙØ© ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
          snap.forEach(doc => {
              const data = doc.data();
              if (data.lastSender !== auth.currentUser.uid && data.unreadCount > 0) {
                  totalUnread += data.unreadCount;
              }
          });

          const badge = document.getElementById('topMsgCount');
          
          if (badge) {
              // Ø¨Ù†Ø®Ø²Ù† Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ ÙÙŠ Ø§Ù„Ø²Ø±Ø§Ø± Ø¹Ø´Ø§Ù† Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ù…Ø§ ØªØ¶ØºØ·
              badge.setAttribute('data-total-unread', totalUnread);

              // Ø¨Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù„ÙŠ Ø£Ù†Øª "Ø´ÙˆÙØªÙ‡" Ø¢Ø®Ø± Ù…Ø±Ø© ÙˆØ¯ÙˆØ³Øª Ø¹Ù„ÙŠÙ‡
              let seenCount = parseInt(localStorage.getItem('messenger_seen_checkpoint') || '0');

              // ğŸ”¥ Ø§Ù„Ù„ÙˆØ¬ÙŠÙƒ:
              // Ù„Ùˆ Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§ÙŠÙ„ Ù‚Ù„ (ÙŠØ¹Ù†ÙŠ Ø£Ù†Øª ÙØªØ­ØªÙ‡Ù… ÙˆÙ‚Ø±ÙŠØªÙ‡Ù…)ØŒ Ù†Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø·Ø© Ø¹Ø´Ø§Ù† Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯
              if (totalUnread < seenCount) {
                  seenCount = totalUnread;
                  localStorage.setItem('messenger_seen_checkpoint', totalUnread);
              }

              // Ù„Ùˆ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù„ÙŠ Ø£Ù†Øª Ø´ÙˆÙØªÙ‡ (ÙŠØ¹Ù†ÙŠ Ø¬Øª Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø²ÙŠØ§Ø¯Ø©) -> Ø§Ø¸Ù‡Ø± Ø±Ù‚Ù… 1
              if (totalUnread > seenCount) {
                  badge.innerText = "1"; // Ø±Ù‚Ù… Ø«Ø§Ø¨Øª Ø²ÙŠ Ù…Ø§ Ø·Ù„Ø¨Øª
                  badge.classList.add('visible');
                  badge.style.display = 'flex';
              } 
              else {
                  // ØºÙŠØ± ÙƒØ¯Ù‡ (ÙŠØ¹Ù†ÙŠ Ù…ÙÙŠØ´ Ø¬Ø¯ÙŠØ¯ Ø¹Ù† Ø¢Ø®Ø± Ù…Ø±Ø© Ø¯ÙˆØ³Øª)ØŒ Ø§Ø®ÙÙŠÙ‡
                  badge.classList.remove('visible');
                  badge.style.display = 'none';
              }
          }
      });
}
// --- Ø¯Ø§Ù„Ø© ÙØªØ­ Ø£ÙŠ ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† Ø±ÙŠÙØ±ÙŠØ´ ---
// --- Ø¯Ø§Ù„Ø© ÙØªØ­ Ø£ÙŠ ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† Ø±ÙŠÙØ±ÙŠØ´ (Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ·) ---
function openPage(url) {
    const overlay = document.getElementById('universalOverlay');
    const frame = document.getElementById('universalFrame');
    
    // 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·
    frame.src = url;
    
    // 2. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø©
    overlay.classList.add('active');
    
    // 3. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ (Ø§Ù„Ù‡ÙŠØ¯Ø±Ø§) Ø¹Ø´Ø§Ù† ÙŠÙˆØ³Ø¹ Ø§Ù„Ù…ÙƒØ§Ù†
    // ğŸ”¥ Ø¯Ù‡ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const navBar = document.querySelector('.fb-icons');
    if(navBar) navBar.classList.add('hide-nav');
    
    // 4. ÙˆÙ‚Ù Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.body.style.overflow = 'hidden';

    // 5. Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ© ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®
    history.pushState({ pageOpen: true }, null, "");
}

// --- Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© (Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø´Ø±ÙŠØ·) ---
function closeUniversalPage() {
    const overlay = document.getElementById('universalOverlay');
    const frame = document.getElementById('universalFrame');
    
    // 1. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
    overlay.classList.remove('active');
    
    // 2. Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ù…ÙƒØ§Ù†Ù‡
    // ğŸ”¥ Ø¯Ù‡ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const navBar = document.querySelector('.fb-icons');
    if(navBar) navBar.classList.remove('hide-nav');
    
    // 3. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ±
    document.body.style.overflow = 'auto';
    
    // 4. ØªÙØ±ÙŠØº Ø§Ù„Ø±Ø§Ø¨Ø·
    setTimeout(() => {
        frame.src = ""; 
    }, 300);
}



function goToProfile(uid) {
    playSound('click');

    // 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø±Ù (ID)
    // Ù„Ùˆ Ø§ØªØ¨Ø¹Øª ÙÙŠ Ø§Ù„Ù‚ÙˆØ³ (uid) Ù†Ø³ØªØ®Ø¯Ù…Ù‡ (Ø¯Ù‡ Ù„Ù…Ø§ ØªØ¶ØºØ· Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø­Ø¯ ØªØ§Ù†ÙŠ)
    // Ù„Ùˆ Ø§Ù„Ù‚ÙˆØ³ ÙØ§Ø¶ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù… currentUser.uid (Ø¯Ù‡ Ù„Ù…Ø§ ØªØ¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø±Ø§Ø± Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ùƒ Ø£Ù†Øª)
    let targetUid = uid || (currentUser ? currentUser.uid : null);

    if (targetUid) {
        // 2. Ø§Ù„ÙØªØ­ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¨Ø¯ÙˆÙ† Ø±ÙŠÙØ±ÙŠØ´)
        openPage(`profile.html?uid=${targetUid}`);
    } else {
        console.log("Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù…");
    }
}
// --- Ù…Ø±Ø§Ù‚Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ---
// --- Ù…Ø±Ø§Ù‚Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ---
function updateConnectionStatus() {
    const banner = document.getElementById('connectionStatus');
    const text = document.getElementById('connText');
    const icon = banner.querySelector('i');

    if (navigator.onLine) {
        // Ù„Ùˆ Ø§Ù„Ù†Øª Ø´ØºØ§Ù„ (ÙˆØ±Ø§Ø¬Ø¹ Ù…Ù† ÙØµÙ„Ø©)
        if (banner.classList.contains('offline')) {
            banner.classList.remove('offline');
            banner.classList.add('online');
            text.innerText = "ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª âš¡";
            icon.className = "fa-solid fa-wifi";
            playSound('success'); // ØµÙˆØª Ù†Ø¬Ø§Ø­ Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯ÙŠ

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                banner.classList.remove('online');
                banner.style.bottom = '-60px'; // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø®ÙØ§Ø¡
            }, 3000);
        }
    } else {
        // Ù„Ùˆ Ø§Ù„Ù†Øª ÙØµÙ„
        banner.classList.remove('online');
        banner.classList.add('offline');
        text.innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª âŒ";
        icon.className = "fa-solid fa-wifi-slash";
        if(navigator.vibrate) navigator.vibrate([200, 100, 200]); // Ø§Ù‡ØªØ²Ø§Ø² Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', () => {
    // Ù„Ùˆ ÙØªØ­ ÙˆØ§Ù„ØªØª ÙØ§ØµÙ„ Ø£ØµÙ„Ø§Ù‹
    if (!navigator.onLine) {
        updateConnectionStatus();
    }
});

// Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª (ÙØµÙ„ / Ø±Ø¬ÙˆØ¹)
window.addEventListener('online', updateConnectionStatus);
window.addEventListener('offline', updateConnectionStatus);
/* --- Ù…Ù†Ø·Ù‚ Ø²Ø± Ø§Ù„ØµØ¹ÙˆØ¯ Ù„Ù„Ø£Ø¹Ù„Ù‰ --- */

/* --- Ù…Ù†Ø·Ù‚ Ø²Ø± Ø§Ù„ØµØ¹ÙˆØ¯ Ù„Ù„Ø£Ø¹Ù„Ù‰ --- */
/* --- Ù…Ù†Ø·Ù‚ Ø²Ø± Ø§Ù„ØµØ¹ÙˆØ¯ Ù„Ù„Ø£Ø¹Ù„Ù‰ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ 5 Ù…Ù†Ø´ÙˆØ±Ø§Øª) --- */
window.addEventListener('scroll', () => {
    const btn = document.getElementById('scrollTopBtn');
    if (!btn) return;

    // 1. Ù†Ø¬ÙŠØ¨ ÙƒÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
    const posts = document.querySelectorAll('.post');

    // 2. Ù†ØªØ£ÙƒØ¯ Ø¥Ù† ÙÙŠÙ‡ 5 Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
    if (posts.length >= 5) {
        // Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ø®Ø§Ù…Ø³ (Ø±Ù‚Ù… 4 Ù„Ø£Ù† Ø§Ù„Ø¹Ø¯ Ø¨ÙŠØ¨Ø¯Ø£ Ù…Ù† 0)
        const fifthPost = posts[4]; 
        
        // 3. Ø§Ù„Ø´Ø±Ø·: Ù„Ùˆ Ù†Ø²Ù„Ù†Ø§ Ø¨Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù…Ø³Ø§ÙØ© Ø£ÙƒØ¨Ø± Ù…Ù† Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ø®Ø§Ù…Ø³
        // (post.offsetTop) Ù‡Ùˆ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¹Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© Ù…Ù† ÙÙˆÙ‚
        if (window.scrollY > fifthPost.offsetTop) {
            btn.classList.add('visible');
        } else {
            btn.classList.remove('visible');
        }
    } else {
        // 4. (Ø§Ø­ØªÙŠØ§Ø·ÙŠ) Ù„Ùˆ Ø§Ù„ØµÙØ­Ø© Ù„Ø³Ù‡ Ø¨ØªØ­Ù…Ù„ ÙˆÙ…ÙÙŠØ´ 5 Ù…Ù†Ø´ÙˆØ±Ø§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø§ÙØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© (2000 Ø¨ÙƒØ³Ù„)
        if (window.scrollY > 2000) {
            btn.classList.add('visible');
        } else {
            btn.classList.remove('visible');
        }
    }
});

function scrollToTop() {
    if(typeof playSound === 'function') playSound('click'); 
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ ÙˆØ§Ù„Ø±ÙØ¹ --- */
let mediaRecorder = null;
let audioChunks = [];
let recordInterval = null;
let recordSeconds = 0;
let isRecording = false;
// 1. ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
async function toggleRecording() {
    if (!isRecording) {
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            document.getElementById("normalInterface").style.display = "none";
            document.getElementById("recordingInterface").style.display = "flex";
            document.getElementById("micBtn").classList.add("recording");
            
            // Ø§Ù„Ø¹Ø¯Ø§Ø¯
            recordSeconds = 0;
            document.getElementById("recordTimer").innerText = "00:00";
            clearInterval(recordInterval);
            recordInterval = setInterval(() => {
                recordSeconds++;
                const m = Math.floor(recordSeconds / 60).toString().padStart(2,'0');
                const s = (recordSeconds % 60).toString().padStart(2,'0');
                document.getElementById("recordTimer").innerText = `${m}:${s}`;
            }, 1000);

            mediaRecorder.ondataavailable = e => { if(e.data.size > 0) audioChunks.push(e.data); };
            mediaRecorder.start();
            isRecording = true;
            
            if(navigator.vibrate) navigator.vibrate(50);

        } catch(e) { 
            console.error(e); 
            showToast("âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†"); 
        }
    } else {
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡
        stopAndSendRecording();
    }
}

// 2. Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¥Ø±Ø³Ø§Ù„ (Ø²ÙŠ Ø§Ù„Ø´Ø§Øª Ø¨Ø§Ù„Ø¸Ø¨Ø·)
// 2. Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¥Ø±Ø³Ø§Ù„ (Ø²ÙŠ Ø§Ù„Ø´Ø§Øª Ø¨Ø§Ù„Ø¸Ø¨Ø·)
async function stopAndSendRecording() {
    if(!mediaRecorder || mediaRecorder.state === "inactive") return;
    
    mediaRecorder.stop();
    mediaRecorder.onstop = async () => {
        clearInterval(recordInterval);
        document.getElementById("recordingInterface").style.display = "none";
        document.getElementById("normalInterface").style.display = "flex";
        document.getElementById("micBtn").classList.remove("recording");
        isRecording = false;

        // --- ğŸ”¥ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù‡Ù†Ø§: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ù…ØªØµÙØ­ ---
        // Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙˆØ¹ Ø§Ù„Ù€ Blob Ø§Ù„Ø£ÙˆÙ„ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        let actualMimeType = audioChunks[0]?.type || 'audio/mp4'; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        let fileExtension = 'm4a';

        if (actualMimeType.includes('webm')) {
            fileExtension = 'webm';
        } else if (actualMimeType.includes('ogg')) {
            fileExtension = 'ogg';
        }

        const audioBlob = new Blob(audioChunks, { type: actualMimeType });
        
        // ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„ØµØ­ÙŠØ­
        const voicePath = `comments_media_v2/${currentPostId}/voices/${Date.now()}_${currentUser.uid}.${fileExtension}`; 
        const ref = storage.ref().child(voicePath);

        try {
            showToast("Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª... ğŸ™ï¸");
            const snapshot = await ref.put(audioBlob);
            const url = await snapshot.ref.getDownloadURL();
            
            // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ (Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²...)
            const uDoc = await db.collection('users').doc(currentUser.uid).get();
            const uData = uDoc.data();
            
            const m = Math.floor(recordSeconds / 60).toString().padStart(2,'0');
            const s = (recordSeconds % 60).toString().padStart(2,'0');
            const durationText = `${m}:${s}`;

            await db.collection('posts').doc(currentPostId).collection('comments').add({
                uid: currentUser.uid,
                name: uData.name,
                pic: uData.profilePic,
                isVerified: uData.isVerified || false,
                text: url,
                isAudio: true,
                isImage: false,
                duration: durationText,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                isGhost: isGhost
            });

            await db.collection('posts').doc(currentPostId).update({
                commentsCount: firebase.firestore.FieldValue.increment(1)
            });

            if (currentPostOwnerUid !== currentUser.uid) {
                pushNotification(currentPostOwnerUid, 'comment', 'Ø£Ø±Ø³Ù„ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹ ØµÙˆØªÙŠØ§Ù‹', null, currentPostId);
            }
            
            showToast("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…");
            playSound('sent');

        } catch(e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹:", e);
            showToast("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: " + e.message); // ğŸ”¥ Ù…Ù‡Ù… Ù„ØªØ´ÙˆÙ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        }
    }
}


// 3. Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
function cancelRecording() {
    clearInterval(recordInterval);
    if(mediaRecorder && mediaRecorder.state !== "inactive") mediaRecorder.stop();
    resetUI();
    showToast("ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡");
}

function resetUI() {
    isRecording = false;
    document.getElementById("normalInterface").style.display = "flex";
    document.getElementById("recordingInterface").style.display = "none";
    document.getElementById("micBtn").classList.remove("recording");
}

// 4. ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© handleCommentAction (Ø§Ù„Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ù‚)
async function handleCommentAction(sticker = null) {
    console.log("ØªÙ… Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"); // Ù„Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø²Ø±Ø§Ø± Ø´ØºØ§Ù„

    // 1. Ù„Ùˆ Ø¨Ù†Ø³Ø¬Ù„ ØµÙˆØªØŒ ÙˆÙ‚Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ø¨Ø¹ØªÙ‡
    if (typeof isRecording !== 'undefined' && isRecording) {
        stopAndSendRecording();
        return;
    }

    // 2. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø®Ø§Ù†Ø© Ø§Ù„Ù†Øµ Ø¨Ø£ÙŠ Ø·Ø±ÙŠÙ‚Ø©
    let inp = document.getElementById('cmInput');
    if (!inp) inp = document.getElementById('commentInput'); // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    
    if (!inp && !sticker) {
        alert("Ø®Ø·Ø£: Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
        return;
    }

    const txt = sticker || inp.value.trim();
    
    // Ù„Ùˆ Ù…ÙÙŠØ´ Ù†Øµ ÙˆÙ…ÙÙŠØ´ Ø³ØªÙŠÙƒØ±ØŒ Ø§Ø®Ø±Ø¬
    if (!txt) return;

    // ØªÙØ±ÙŠØº Ø§Ù„Ø®Ø§Ù†Ø© ÙÙˆØ±Ø§Ù‹ Ø¹Ø´Ø§Ù† ÙŠØ­Ø³ Ø¨Ø§Ù„Ø³Ø±Ø¹Ø©
    inp.value = "";
    if(typeof playSound === 'function') playSound('sent'); 

    try {
        const uDoc = await db.collection('users').doc(currentUser.uid).get();
        const uData = uDoc.data();

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
        await db.collection('posts').doc(currentPostId).collection('comments').add({
            uid: currentUser.uid,
            name: uData.name || "Ù…Ø³ØªØ®Ø¯Ù…",
            pic: uData.profilePic || "",
            isVerified: uData.isVerified || false,
            text: txt,
            isSticker: !!sticker,
            isGhost: (typeof isGhost !== 'undefined' ? isGhost : false),
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
        await db.collection('posts').doc(currentPostId).update({
            commentsCount: firebase.firestore.FieldValue.increment(1)
        });
        
        // Ø¥Ø´Ø¹Ø§Ø±
        if (currentPostOwnerUid && currentPostOwnerUid !== currentUser.uid) {
            pushNotification(currentPostOwnerUid, 'comment', 'Ø¹Ù„Ù‚ Ø¹Ù„Ù‰ Ù…Ù†Ø´ÙˆØ±Ùƒ', null, currentPostId);
        }

    } catch (e) {
        console.error(e);
        showToast("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + e.message);
    }
}

// --- Ø¯ÙˆØ§Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª (Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Øª) ---
function toggleAudio(id, event) {
    if (event) event.stopPropagation();
    const audio = document.getElementById(`audio_${id}`);
    const btnIcon = document.querySelector(`#btn_${id} i`);

    if (audio.paused) {
        // ÙˆÙ‚Ù Ø£ÙŠ ØµÙˆØª ØªØ§Ù†ÙŠ
        document.querySelectorAll('audio').forEach(a => {
            if (a !== audio) {
                a.pause();
                const otherId = a.id.split('_')[1];
                const otherIcon = document.querySelector(`#btn_${otherId} i`);
                if(otherIcon) otherIcon.className = "fa-solid fa-play";
            }
        });
        audio.play();
        btnIcon.className = "fa-solid fa-pause";
    } else {
        audio.pause();
        btnIcon.className = "fa-solid fa-play";
    }
}

function updateAudioProgress(id) { 
    const a = document.getElementById(`audio_${id}`); 
    const r = document.getElementById(`range_${id}`);
    if(a.duration) r.value = (a.currentTime/a.duration)*100; 
}

function seekAudio(id) { 
    const a = document.getElementById(`audio_${id}`); 
    const r = document.getElementById(`range_${id}`);
    a.currentTime = (r.value/100) * a.duration; 
}

function resetAudio(id) { 
    const btn = document.querySelector(`#btn_${id} i`);
    if(btn) btn.className = "fa-solid fa-play"; 
    document.getElementById(`range_${id}`).value = 0; 
}

function changeSpeed(id) { 
    const a = document.getElementById(`audio_${id}`); 
    const btn = document.getElementById(`speed_${id}`);
    let r = a.playbackRate; 
    r = (r===1) ? 1.5 : (r===1.5) ? 2 : 1; 
    a.playbackRate = r; 
    btn.innerText = r + "x"; 
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ÙˆÙ‚Øª
function formatTimeSec(s) { 
    if(isNaN(s)) return "00:00"; 
    const m = Math.floor(s/60); 
    const sc = Math.floor(s%60); 
    return `${m}:${sc.toString().padStart(2,'0')}`; 
}


/* --- Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠ --- */

// 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø· Ù…Ù† Ø§Ù„Ù†Øµ

// 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API Ø®Ø§Ø±Ø¬ÙŠ
/* --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ (Ù…Ø­Ø¯Ø«Ø© Ù„Ù„ÙŠÙˆØªÙŠÙˆØ¨) --- */

// 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Øµ (ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚)
function processPostText(text) {
    if (!text) return "";
    let processed = escapeHTML(text);

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (URLs) Ù„Ù†ØµÙˆØµ Ø²Ø±Ù‚Ø§Ø¡ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¶ØºØ·
    // Regex Ù‚ÙˆÙŠ ÙŠÙƒØªØ´Ù Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø­ØªÙ‰ Ù„Ùˆ Ù„Ø§Ø²Ù‚Ø© ÙÙŠ ÙƒÙ„Ø§Ù…
    const urlRegex = /((https?:\/\/|www\.)[^\s]+)/g;
    
    processed = processed.replace(urlRegex, (url) => {
        // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http
        let href = url.startsWith('www.') ? 'http://' + url : url;
        return `<a href="${href}" target="_blank" class="post-link" onclick="event.stopPropagation();">${url}</a>`;
    });

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬ ÙˆØ§Ù„Ù…Ù†Ø´Ù† (Ø²ÙŠ Ù…Ø§ Ù‡Ù…Ø§)
    processed = processed.replace(/(^|\s)(#[^\s<]+)/g, '$1<span class="text-link" onclick="searchForHashtag(event, \'$2\')">$2</span>');
    processed = processed.replace(/(^|\s)(@[^\s<]+)/g, (m, s, ment) => `${s}<span class="text-link" onclick="openSearchWithName('${ment.replace('@','')}')">${ment}</span>`);

    return processed;
}

// 2. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø·
function extractFirstLink(text) {
    const matches = text.match(/((https?:\/\/|www\.)[^\s]+)/);
    return matches ? (matches[0].startsWith('www.') ? 'http://'+matches[0] : matches[0]) : null;
}
        // --- Ø¯Ø§Ù„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ ID Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ (ÙƒØ§Ù†Øª Ù†Ø§Ù‚ØµØ©) ---
function getYouTubeID(url) {
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}
    /* --- ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¢Ù„Ø© Ø§Ù„ÙƒØ§ØªØ¨Ø© (Ù†Ø³Ø®Ø© Ù‡Ø§Ø¯Ø¦Ø© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©) --- */
const placeholderTexts = [
    "Ø´Ø§Ø±ÙƒÙ†Ø§ Ù„Ø­Ø¸Ø§ØªÙƒ... âœ¨",
    "Ù…Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø¯ÙŠÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ ğŸ¤”",
    "Ø£Ø¶Ù ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ ğŸ“¸",
    "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù†Ù‚Ø§Ø´ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ğŸ’¬",
    "Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹ Ù…Ù…ÙŠØ²Ø§Ù‹... âœï¸"
];

let textIndex = 0;
let charIndex = 0;
let isDeleting = false;

// ğŸ”¥ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø£Ù‡Ø¯Ø£ ÙˆØ£Ø¨Ø·Ø£)
const typingSpeed = 150;   // Ø³Ø±Ø¹Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø­Ø±Ù (Ø£Ø¨Ø·Ø£ Ø´ÙˆÙŠØ© Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹ÙŠÙ† ØªÙ„Ø­Ù‚)
const deletingSpeed = 70;  // Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø³Ø­
const pauseTime = 6000;    // ğŸ”¥ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 6 Ø«ÙˆØ§Ù†ÙŠ ÙƒØ§Ù…Ù„Ø© Ù‚Ø¨Ù„ ØªØºÙŠÙŠØ± Ø§Ù„Ø¬Ù…Ù„Ø©

function typeEffect() {
    const element = document.getElementById('dynamicPlaceholder');
    if (!element) return;

    const currentText = placeholderTexts[textIndex];
    
    if (isDeleting) {
        // ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³Ø­
        element.innerText = currentText.substring(0, charIndex - 1);
        charIndex--;
    } else {
        // ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø©
        element.innerText = currentText.substring(0, charIndex + 1);
        charIndex++;
    }

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
    let nextSpeed = isDeleting ? deletingSpeed : typingSpeed;

    // Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª
    if (!isDeleting && charIndex === currentText.length) {
        // 1. Ø®Ù„ØµØª ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¬Ù…Ù„Ø©ØŸ Ø§Ø³ØªÙ†Ù‰ 6 Ø«ÙˆØ§Ù†ÙŠ
        nextSpeed = pauseTime;
        isDeleting = true;
    } else if (isDeleting && charIndex === 0) {
        // 2. Ø®Ù„ØµØª Ù…Ø³Ø­ØŸ Ø§Ù†Ù‚Ù„ Ù„Ù„Ø¬Ù…Ù„Ø© Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯Ù‡Ø§
        isDeleting = false;
        textIndex = (textIndex + 1) % placeholderTexts.length;
        nextSpeed = 500; // Ø§Ø³ØªØ±Ø§Ø­Ø© Ù†Øµ Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Ù…Ø§ ÙŠØ¨Ø¯Ø£ ÙŠÙƒØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    }

    setTimeout(typeEffect, nextSpeed);
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', typeEffect);
async function uploadCommentImage(input) {
    const file = input.files[0];
    if (!file) return;

    playSound('click');
    showToast("Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©... ğŸ–¼ï¸");

    // ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¢Ù† Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù‚Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (comments_media_v2)
    const imagePath = `comments_media_v2/${currentPostId}/images/${Date.now()}_${currentUser.uid}`;
    const storageRef = storage.ref().child(imagePath);
    
    try {
        await storageRef.put(file);
        const url = await storageRef.getDownloadURL();

        const uDoc = await db.collection('users').doc(currentUser.uid).get();
        const uData = uDoc.data();

        await db.collection('posts').doc(currentPostId).collection('comments').add({
            uid: currentUser.uid,
            name: uData.name || "Ù…Ø³ØªØ®Ø¯Ù…",
            pic: uData.profilePic || "",
            isVerified: uData.isVerified || false,
            text: url, 
            isImage: true, 
            isAudio: false,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            isGhost: isGhost
        });

        await db.collection('posts').doc(currentPostId).update({
            commentsCount: firebase.firestore.FieldValue.increment(1)
        });
        
        if (currentPostOwnerUid !== currentUser.uid) {
            pushNotification(currentPostOwnerUid, 'comment', 'Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª', null, currentPostId);
        }

        showToast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© âœ…");
        playSound('sent');

    } catch (e) {
        console.error(e);
        showToast("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© comments_media_v2 ÙÙŠ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³");
    }
}

// ==================================================
// ğŸŸ¢ Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ§Ø¬Ø¯ (ÙŠÙˆØ¶Ø¹ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª)
// ==================================================
function startPresenceSystem(uid) {
    if (!uid) return;

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
    const updateStatus = () => {
        db.collection('users').doc(uid).update({
            lastSeen: firebase.firestore.FieldValue.serverTimestamp() // ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ±
        }).catch(err => console.log("Presence Error:", err));
    };

    // 1. ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø£ÙˆÙ„ Ù…Ø§ ÙŠÙØªØ­
    updateStatus();

    // 2. ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (Ø¹Ø´Ø§Ù† Ù„Ùˆ Ù‚ÙÙ„ØŒ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§ÙŠÙ‚ ÙˆÙ‚ØªÙ‡ ÙŠØ¨Ù‚Ù‰ Ù‚Ø¯ÙŠÙ…)
    setInterval(updateStatus, 60000); 

    // 3. ØªØ­Ø¯ÙŠØ« Ù„Ùˆ Ø®Ø±Ø¬ ÙˆØ±Ø¬Ø¹ Ù„Ù„ØªØ¨ÙˆÙŠØ¨
    document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === 'visible') updateStatus();
    });
}


function updateMyStatus(uid) {
    // Ø¨Ù†Ø­Ø¯Ø« Ø­Ù‚Ù„ lastSeen Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø³ÙŠØ±ÙØ±
    db.collection('users').doc(uid).update({
        isOnline: true,
        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
    }).catch(err => console.log("Presence Error:", err));
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
auth.onAuthStateChanged(user => {
    if (user) {
        startPresenceSystem(user.uid);
    }
});
// Ø¯Ø§Ù„Ø© Ø¨ØªØ­Ø³Ø¨ Ø§Ù„ÙØ±Ù‚ ÙˆØªØ±Ø¬Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
function formatLastSeen(timestamp) {
    if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

    // ØªØ­ÙˆÙŠÙ„ ØªÙˆÙ‚ÙŠØª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ù„ØªØ§Ø±ÙŠØ® Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª
    const date = timestamp.toDate();
    const now = new Date();
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
    const diffSeconds = Math.floor((now - date) / 1000);

    // 1. Ù„Ùˆ Ø§Ù„ÙØ±Ù‚ Ø£Ù‚Ù„ Ù…Ù† Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ† (120 Ø«Ø§Ù†ÙŠØ©) -> ÙŠØ¨Ù‚Ù‰ Ù„Ø³Ù‡ ÙØ§ØªØ­ Ø£Ùˆ Ø®Ø§Ø±Ø¬ Ø­Ø§Ù„Ø§Ù‹
    if (diffSeconds < 120) {
        return 'Ù†Ø´Ø· Ø§Ù„Ø¢Ù† ğŸŸ¢';
    }

    // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
    const diffMinutes = Math.floor(diffSeconds / 60);
    
    if (diffMinutes < 60) {
        return `Ù†Ø´Ø· Ù…Ù†Ø° ${diffMinutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
    }

    // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
    const diffHours = Math.floor(diffMinutes / 60);
    if (diffHours < 24) {
        return `Ù†Ø´Ø· Ù…Ù†Ø° ${diffHours} Ø³Ø§Ø¹Ø©`;
    }

    // 4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…
    const diffDays = Math.floor(diffHours / 24);
    return `Ù†Ø´Ø· Ù…Ù†Ø° ${diffDays} ÙŠÙˆÙ…`;
}

// ==========================================
// Ù…Ø«Ø§Ù„: Ø¥Ø²Ø§ÙŠ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ø´Ø§Ù† ØªÙ†ÙˆØ± Ø§Ù„Ù„Ù…Ø¨Ø© ÙˆØªÙƒØªØ¨ Ø§Ù„Ù†Øµ
// ==========================================
// 1. Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª (Ù‡ÙŠ Ø¯ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ØªØ´ØºÙ„ Ø§Ù„Ù„Ù…Ø¨Ø© Ø¨Ø¬Ø¯)
function formatLastSeen(timestamp) {
    if (!timestamp) return { text: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ', color: 'gray' };

    const date = timestamp.toDate();
    const now = new Date();
    const diffSeconds = Math.floor((now - date) / 1000); // Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ

    // === Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ===
    // Ù„Ùˆ Ø§Ù„ÙØ±Ù‚ Ø£Ù‚Ù„ Ù…Ù† Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ† (120 Ø«Ø§Ù†ÙŠØ©) -> ÙŠØ¨Ù‚Ù‰ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (Ø£Ø®Ø¶Ø±)
    if (diffSeconds < 120) {
        return { text: 'Ù†Ø´Ø· Ø§Ù„Ø¢Ù†', color: 'green' };
    }

    // ØºÙŠØ± ÙƒØ¯Ù‡ -> ÙŠØ¨Ù‚Ù‰ Ø£ÙˆÙÙ„Ø§ÙŠÙ† (Ø±Ù…Ø§Ø¯ÙŠ) ÙˆÙ†Ø­Ø³Ø¨ Ø¨Ù‚Ø§Ù„Ù‡ Ù‚Ø¯ Ø¥ÙŠÙ‡
    const diffMinutes = Math.floor(diffSeconds / 60);
    if (diffMinutes < 60) return { text: `Ù†Ø´Ø· Ù…Ù†Ø° ${diffMinutes} Ø¯Ù‚ÙŠÙ‚Ø©`, color: 'gray' };

    const diffHours = Math.floor(diffMinutes / 60);
    if (diffHours < 24) return { text: `Ù†Ø´Ø· Ù…Ù†Ø° ${diffHours} Ø³Ø§Ø¹Ø©`, color: 'gray' };

    const diffDays = Math.floor(diffHours / 24);
    return { text: `Ù†Ø´Ø· Ù…Ù†Ø° ${diffDays} ÙŠÙˆÙ…`, color: 'gray' };
}

// Ù…ØªØºÙŠØ± Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯
let headerStatusInterval = null;

// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« (Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø¹Ø±Ø¶)
function updateHeader(uid) { 
    if(!uid) return;
    
    // ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ Ø§Ø³ØªÙ…Ø§Ø¹ Ù‚Ø¯ÙŠÙ…
    if (headerUnsubscribe) headerUnsubscribe();

    headerUnsubscribe = db.collection('users').doc(uid).onSnapshot(doc => {
        if (!doc.exists) return;
        const u = doc.data();
        
        // --- (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø©) ---
        const savedNick = localStorage.getItem(`nick_${chatId}`);
        const displayName = savedNick ? savedNick : (u.name || "Ù…Ø³ØªØ®Ø¯Ù…");
        document.getElementById("headerName").innerText = displayName; 
        
        const hImg = document.getElementById("headerImage");
        if(u.profilePic) { 
            hImg.style.backgroundImage = `url('${u.profilePic}')`; 
            hImg.innerText = ''; 
        } else { 
            hImg.style.backgroundColor = u.color || '#555'; 
            hImg.innerText = (u.name||'U')[0];
            hImg.style.backgroundImage = 'none';
        }

        // --- ğŸ”¥ Ù‡Ù†Ø§ Ø§Ù„Ù„Ù…Ø¨Ø© Ø¨ØªØ´ØªØºÙ„ Ø¨Ø¬Ø¯ ğŸ”¥ ---
        
        const refreshStatus = () => {
            // Ù„Ùˆ Ù…ÙÙŠØ´ ÙˆÙ‚Øª Ù…Ø³Ø¬Ù„ØŒ Ø§Ø¹ØªØ¨Ø±Ù‡ Ø£ÙˆÙÙ„Ø§ÙŠÙ†
            if (!u.lastSeen) return;

            const statusData = formatLastSeen(u.lastSeen);
            const statusElement = document.getElementById("headerStatus");
            const onlineIndicator = document.querySelector(".online-status");

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ„Ø§Ù… (Ù†Ø´Ø· Ø§Ù„Ø¢Ù† / Ù…Ù†Ø° ÙƒØ°Ø§)
            if (statusElement) {
                statusElement.innerText = statusData.text;
                statusElement.style.color = (statusData.color === 'green') ? "#2cc069" : "#888";
            }

            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„Ù„Ù…Ø¨Ø©
            if (onlineIndicator) {
                onlineIndicator.style.backgroundColor = (statusData.color === 'green') ? "#2cc069" : "#888";
            }
        };

        // 1. Ø´ØºÙ„Ù‡Ø§ ÙÙˆØ±Ø§Ù‹
        refreshStatus();

        // 2. Ø´ØºÙ„ Ø¹Ø¯Ø§Ø¯ ÙŠØ±Ø§Ø¬Ø¹ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ (Ø¹Ø´Ø§Ù† Ù„Ùˆ Ø¹Ø¯Ù‰ Ø§Ù„ÙˆÙ‚Øª ØªÙ‚Ù„Ø¨ Ø±Ù…Ø§Ø¯ÙŠ Ù„ÙˆØ­Ø¯Ù‡Ø§)
        if (headerStatusInterval) clearInterval(headerStatusInterval);
        headerStatusInterval = setInterval(refreshStatus, 10000); 
    });
}
function checkAndColorAvatar(uid, element) {
    // Ù„Ùˆ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ø¨ÙŠÙ‚ÙˆÙ„ false (Ù…Ù‚ÙÙˆÙ„)ØŒ Ø§Ø®Ø±Ø¬ ÙÙˆØ±Ø§Ù‹
    if (window.isOnlineFeatureEnabled === false) return;

    if (!uid || !element) return;

    db.collection('users').doc(uid).get().then(doc => {
        if (doc.exists) {
            const d = doc.data();
            if (d.lastSeen) {
                const now = new Date();
                const lastSeenDate = d.lastSeen.toDate();
                
                if ((now - lastSeenDate) / 1000 < 300) {
                    // ÙØ­Øµ Ø£Ø®ÙŠØ± Ù‚Ø¨Ù„ Ù…Ø§ Ù†Ù†ÙˆØ± Ø§Ù„Ù„Ù…Ø¨Ø©
                    if(window.isOnlineFeatureEnabled) {
                        element.classList.add('online');
                    }
                }
            }
        }
    }).catch(() => {});
}

function updateOnlineToggleUI() {
    const headerBtn = document.getElementById('headerOnlineBtn');
    const headerText = document.getElementById('headerStatusText');
    const myAvatar = document.getElementById('menuAvatar');

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù„Ù„ØªØ£ÙƒÙŠØ¯
    window.isOnlineFeatureEnabled = localStorage.getItem('nabd_online_status') !== 'false';

    if (headerBtn) {
        if (window.isOnlineFeatureEnabled) {
            // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            headerBtn.classList.add('active');
            if(headerText) { headerText.innerText = "Ù†Ø´Ø·"; headerText.style.color = "#31a24c"; }
            if(myAvatar) myAvatar.classList.add('online'); // Ù†ÙˆØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        } else {
            // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
            headerBtn.classList.remove('active');
            if(headerText) { headerText.innerText = "Ù…Ø®ÙÙŠ"; headerText.style.color = "#888"; }
            if(myAvatar) myAvatar.classList.remove('online'); // Ø·ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        }
    }
}

    
// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Ù„Ù…Ø§ ØªØ¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±Ø§Ø±)
// ==================================================
// ğŸŸ¢ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· (Online Status) - Ù…ØµØ­Ø­
// ==================================================

// 1. Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù… (Ø¨ÙŠÙ‚Ø±Ø£ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø£Ùˆ ÙŠØ¹ØªØ¨Ø±Ù‡ Ø´ØºØ§Ù„ Ù„Ùˆ Ù…ÙÙŠØ´ Ù‚ÙŠÙ…Ø©)
window.isOnlineFeatureEnabled = localStorage.getItem('nabd_online_status') !== 'false';

// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Ù„Ù…Ø§ ØªØ¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±Ø§Ø±)
function toggleOnlineFeature() {
    if(typeof playSound === 'function') playSound('click');

    // Ø¹ÙƒØ³ Ø§Ù„Ø­Ø§Ù„Ø©
    window.isOnlineFeatureEnabled = !window.isOnlineFeatureEnabled;
    
    // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    localStorage.setItem('nabd_online_status', window.isOnlineFeatureEnabled);

    // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±Ø§Ø±
    updateOnlineToggleUI();

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ£Ø«ÙŠØ± ÙÙˆØ±Ø§Ù‹
    if (!window.isOnlineFeatureEnabled) {
        // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù: Ø´ÙŠÙ„ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø± Ù…Ù† Ø§Ù„ÙƒÙ„
        document.querySelectorAll('.online').forEach(el => el.classList.remove('online'));
        if(typeof showToast === 'function') showToast("ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· ğŸ”•");
    } else {
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„: Ù†ÙˆØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙÙˆØ±Ø§Ù‹
        const myAvatar = document.getElementById('menuAvatar');
        if(myAvatar) myAvatar.classList.add('online'); // âœ… ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§
        
        if(typeof showToast === 'function') showToast("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· ğŸŸ¢");
    }
}

// 3. Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù†ØµÙˆØµ
function updateOnlineToggleUI() {
    const headerBtn = document.getElementById('headerOnlineBtn');
    const headerText = document.getElementById('headerStatusText');
    const myAvatar = document.getElementById('menuAvatar');

    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const isActive = window.isOnlineFeatureEnabled;

    if (headerBtn) {
        if (isActive) {
            headerBtn.classList.add('active');
            if(headerText) { headerText.innerText = "Ù†Ø´Ø·"; headerText.style.color = "#31a24c"; }
            if(myAvatar) myAvatar.classList.add('online');
        } else {
            headerBtn.classList.remove('active');
            if(headerText) { headerText.innerText = "Ù…Ø®ÙÙŠ"; headerText.style.color = "#888"; }
            if(myAvatar) myAvatar.classList.remove('online');
        }
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', updateOnlineToggleUI);

function getRankHTML(views) {
    const v = views || 0;
    // Ù†ÙØ³ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯Ùƒ
    if (v >= 20000000) return '<div class="user-rank-tag rank-mythic"><i class="fa-solid fa-dragon"></i> Ø£Ø³Ø·ÙˆØ±Ø©</div>';
    if (v >= 5000000)  return '<div class="user-rank-tag rank-diamond"><i class="fa-solid fa-gem"></i> VIP</div>';
    if (v >= 1000000)  return '<div class="user-rank-tag rank-gold"><i class="fa-solid fa-certificate"></i> Ù†Ø®Ø¨Ø©</div>';
    if (v >= 25000)    return '<div class="user-rank-tag rank-silver"><i class="fa-solid fa-video"></i> ØµØ§Ù†Ø¹</div>';
    
    // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù…Ø¨ØªØ¯Ø¦)
    return '<div class="user-rank-tag rank-bronze"><i class="fa-solid fa-shoe-prints"></i> Ù…Ø¨ØªØ¯Ø¦</div>';
}
// --- Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØµØºØ± ---
async function toggleMiniFollow(btn, targetUid, event) {
    event.stopPropagation(); // Ø¹Ø´Ø§Ù† Ù…ÙŠÙØªØ­Ø´ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
    if(navigator.vibrate) navigator.vibrate(30);

    const isFollowing = btn.classList.contains('following');

    if (isFollowing) {
        // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
        btn.classList.remove('following');
        btn.innerHTML = `Ù…ØªØ§Ø¨Ø¹Ø© <i class="fa-solid fa-plus"></i>`;
        // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
        await db.collection("users").doc(currentUser.uid).collection("following").doc(targetUid).delete();
        await db.collection("users").doc(targetUid).collection("followers").doc(currentUser.uid).delete();
        showToast("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©");
    } else {
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
        btn.classList.add('following');
        btn.innerHTML = `Ù…ØªØ§Ø¨Ø¹ <i class="fa-solid fa-check"></i>`;
        
        // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
        const batch = db.batch();
        const followingRef = db.collection("users").doc(currentUser.uid).collection("following").doc(targetUid);
        const followersRef = db.collection("users").doc(targetUid).collection("followers").doc(currentUser.uid);
        
        batch.set(followingRef, { at: firebase.firestore.FieldValue.serverTimestamp() });
        batch.set(followersRef, { at: firebase.firestore.FieldValue.serverTimestamp() });
        await batch.commit();

        pushNotification(targetUid, 'follow', 'Ø¨Ø¯Ø£ Ø¨Ù…ØªØ§Ø¨Ø¹ØªÙƒ', null);
        showToast("ØªÙ…Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© âœ…");
    }
}


// Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© showTopBanner Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ø¯ÙŠ ğŸ‘‡

function showTopBanner(name, text, pic, type = 'msg') {
    // 1. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨Ø§Ù†Ø±
    let banner = document.getElementById('msgBanner');
    if (!banner) { createBannerAssets(); banner = document.getElementById('msgBanner'); }

    if(banner) {
        // 2. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('bannerName').innerText = name || "Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯";
        document.getElementById('bannerText').innerText = text;
        
        let finalPic = pic || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
        document.getElementById('bannerAvatar').style.backgroundImage = `url('${finalPic}')`;

        // 3. ğŸ”¥ ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„ÙˆØ¬Ù‡Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        const iconDiv = banner.querySelector('i'); // Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ø¨Ø§Ù†Ø±
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        banner.onclick = null; 

        if (type === 'msg') {
            // Ù„Ùˆ Ø±Ø³Ø§Ù„Ø©
            iconDiv.className = "fa-solid fa-comment-dots";
            iconDiv.style.color = "#00C6FF"; // Ø£Ø²Ø±Ù‚
            banner.onclick = () => { goToMessages(); banner.classList.remove('visible'); };
        } 
        else if (type === 'req') {
            // Ù„Ùˆ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø©
            iconDiv.className = "fa-solid fa-user-plus";
            iconDiv.style.color = "#34c759"; // Ø£Ø®Ø¶Ø±
            banner.onclick = () => { openPage('Friend_requests.html'); banner.classList.remove('visible'); };
        } 
        else if (type === 'comment') {
            // Ù„Ùˆ ØªØ¹Ù„ÙŠÙ‚
            iconDiv.className = "fa-solid fa-comments";
            iconDiv.style.color = "#FFD700"; // Ø°Ù‡Ø¨ÙŠ
            // ÙŠÙØªØ­ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù†ÙØ³Ù‡ (Ù„Ùˆ Ù…Ø¹Ø§Ùƒ Ø§Ù„Ù€ PostID) Ø£Ùˆ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            banner.onclick = () => { goToNotifications(); banner.classList.remove('visible'); };
        }

        // 4. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¨Ø§Ù†Ø±
        banner.classList.add('visible');
        if(navigator.vibrate) navigator.vibrate(100);

        // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ
        setTimeout(() => { banner.classList.remove('visible'); }, 4000);
    }
}

    </script>
       <div class="custom-modal" id="accountSwitcherModal">
    <div class="modal-box">
        <h3 style="color:#fff; margin-top:5px;">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
        
        <div class="account-list" id="accountList"></div>

        <div id="addAccountForm" style="display:none; width:100%; margin-top:15px;">
    
    <div class="input-group">
        <input type="email" id="newAccEmail" class="pro-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" autocomplete="off">
        <i class="fa-solid fa-envelope input-icon"></i>
    </div>

    <div class="input-group">
        <input type="password" id="newAccPass" class="pro-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="new-password">
        <i class="fa-solid fa-lock input-icon"></i>
    </div>

    <div class="modal-actions" style="margin-top: 10px;">
        <button class="btn-purple" onclick="addNewAccountAction()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
        <button class="btn-dark" onclick="hideAddAccountForm()">Ø±Ø¬ÙˆØ¹</button>
    </div>

</div>

        <div id="addAccBtnContainer" class="modal-actions">
            <button class="btn-purple" onclick="showAddAccountForm()">
                <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨
            </button>
            <button class="btn-dark" onclick="closeAccountSwitcher()">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    </div>
</div>

</div>
<div id="fullSearchPage" class="search-page-overlay">
    
    <div class="sp-header">
        <i class="fa-solid fa-arrow-right back-btn" onclick="closeSearchPage()"></i>
        <div class="sp-input-wrapper">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="superSearchInput" placeholder="Ø¨Ø­Ø«..." autocomplete="off">
            <i class="fa-solid fa-xmark clear-btn" onclick="clearSearchInput()" style="display:none" id="clearSearchBtn"></i>
        </div>
        <i class="fa-solid fa-sliders" onclick="openFilterSheet()" style="padding:10px; font-size:20px; cursor:pointer; color:var(--primary-color);"></i>
        <button class="sp-search-btn" onclick="performSuperSearch()">Ø¨Ø­Ø«</button>
    </div>

    <div class="sp-tabs" id="searchResultTabs" style="display:none;">
        <div class="sp-tab active" onclick="switchSearchTab('all')">Ø§Ù„ÙƒÙ„</div>
        <div class="sp-tab" onclick="switchSearchTab('people')">Ø£Ø´Ø®Ø§Øµ</div>
        <div class="sp-tab" onclick="switchSearchTab('nabd')">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>
        <div class="sp-tab" onclick="switchSearchTab('posts')">Ù…Ù†Ø´ÙˆØ±Ø§Øª</div>
        <div class="sp-tab" onclick="switchSearchTab('hashtags')">Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª #</div>
    </div>

    <div class="sp-content">
        
        <div id="searchHistorySection">
            <div class="sp-section-header">
                <span>ğŸ•’ Ø£Ø­Ø¯Ø« Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø«</span>
                <span style="color:var(--danger-color); cursor:pointer; font-size:12px;" onclick="clearSearchHistory()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</span>
            </div>
            
            <div id="historyList" class="history-list"></div>
            <div id="showMoreBtn" class="show-more-btn" style="display:none;" onclick="toggleHistoryView()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ ğŸ‘‡</div>

            <div class="trending-section">
                <div class="trend-header">
                    <i class="fa-solid fa-fire"></i> Ø§Ù„Ø£ÙƒØ«Ø± Ø¨Ø­Ø«Ø§Ù‹ (Trending)
                </div>
                <div id="trendingContainer" class="trends-container">
                    <div style="width:100%; text-align:center; padding:10px; color:#777;">
                        <i class="fa-solid fa-circle-notch fa-spin"></i> ØªØ­Ù…ÙŠÙ„...
                    </div>
                </div>
            </div>
        </div>

        <div id="searchResultsSection" style="display:none;">
            <div id="resPeople" class="res-group"></div>
            <div id="resNabdVideos" class="res-group" style="display:none;"></div>
            <div id="resHashtags" class="res-group" style="display:none;"></div>
            <div id="resPosts" class="res-group"></div>
            
            <div id="searchLoader" style="display:none; text-align:center; padding:20px;">
                <i class="fa-solid fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...
            </div>
            <div id="noResultsMsg" style="display:none; text-align:center; padding:20px; color:#777;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©
            </div>
        </div>

    </div>
</div>

<div class="bottom-sheet" id="filterSheet" style="height:auto; z-index:99999;">
    <div class="sheet-handle"></div>
    <div style="padding:15px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <span style="font-weight:bold;">ØªØµÙÙŠØ© Ø§Ù„Ø¨Ø­Ø«</span>
            <span style="color:var(--danger-color); cursor:pointer;" onclick="closeAllSheets(true)">Ø¥Ù„ØºØ§Ø¡</span>
        </div>

        <div class="filter-section">
            <div class="fs-title">ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
            <div class="chips-row">
                <div class="filter-chip active" onclick="setFilter('sort', 'rel', this)">Ø§Ù„ØµÙ„Ø©</div>
                <div class="filter-chip" onclick="setFilter('sort', 'likes', this)">Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ø¹Ø¬Ø§Ø¨Ø§Ù‹</div>
                <div class="filter-chip" onclick="setFilter('sort', 'date', this)">Ø§Ù„Ø£Ø­Ø¯Ø«</div>
            </div>
        </div>

        <div class="filter-section">
            <div class="fs-title">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</div>
            <div class="chips-row" style="flex-wrap:wrap; margin-bottom:10px;">
                <div class="filter-chip active" id="chip-all" onclick="setFilter('date', 'all', this)">Ø§Ù„ÙƒÙ„</div>
                <div class="filter-chip" onclick="setFilter('date', '24h', this)">Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©</div>
                <div class="filter-chip" onclick="setFilter('date', 'week', this)">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                <div class="filter-chip" onclick="setFilter('date', 'month', this)">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
            </div>

            <div style="position:relative; margin-top:10px;">
                <label style="font-size:12px; color:var(--secondary-text); margin-bottom:5px; display:block;">Ø£Ùˆ Ø§Ø®ØªØ± ÙŠÙˆÙ…Ø§Ù‹ Ù…Ø­Ø¯Ø¯Ø§Ù‹:</label>
                <input type="date" id="specificDateInput" onchange="setSpecificDate(this)" 
                       style="width:100%; background:var(--input-bg); border:1px solid var(--border-color); color:var(--text-color); padding:12px; border-radius:12px; outline:none; color-scheme: dark;">
            </div>
        </div>

        <button class="btn btn-primary" style="width:100%; margin-top:20px; padding:12px;" onclick="applyFilters()">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
    </div>
</div>

<div id="toast">
    <i class="fa-solid fa-bell"></i> 
    <span id="toast-msg">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</span>
</div>

<div class="custom-modal" id="deleteConfirmModal">
    <div class="modal-box delete-box-style pro-dialog-box">
        <div class="danger-icon-wrapper">
            <i class="fa-solid fa-trash-can"></i>
        </div>
        <h3 class="pro-dialog-title" style="margin-bottom:10px;">Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±ØŸ</h3>
        <p class="pro-dialog-desc">
            Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.
        </p>
        <div class="delete-actions" style="display:flex; gap:10px; width:100%;">
            <button class="btn-ghost" onclick="closeDeleteModal()" style="flex:1;">ØªØ±Ø§Ø¬Ø¹</button>
            <button id="confirmDeleteBtn" class="btn-danger-glow" style="flex:1;">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</button>
        </div>
    </div>
</div>

<div class="custom-modal" id="edit_modal_secure">
    <div class="modal-box pro-dialog-box edit-mode">
        <div class="dialog-icon-wrapper edit-theme">
            <i class="fa-solid fa-pen-to-square"></i>
        </div>
        <h3 class="pro-dialog-title">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
        <p class="pro-dialog-desc">Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ Ø£Ùˆ ØªØºÙŠÙŠØ± Ø§Ù„Ø®ØµÙˆØµÙŠØ©</p>
        
        <div style="position:relative; width:100%;">
            <select id="edit_privacy_secure" class="privacy-select" style="margin:0 0 15px 0; background:#0d0d0f; border-color:#333; color:#fff; width:100%;">
                <option value="public">ğŸŒ Ø¹Ø§Ù…</option>
                <option value="friends">ğŸ‘¥ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙÙ‚Ø·</option>
                <option value="private">ğŸ”’ Ø®Ø§Øµ</option>
            </select>
        </div>

        <textarea id="edit_input_secure" class="pro-textarea" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§..."></textarea>
        
        <div class="dialog-actions" style="width:100%;">
            <button class="btn-ghost btn-cancel-pro" onclick="document.getElementById('edit_modal_secure').style.display='none'" style="flex:1; padding:12px; border-radius:12px;">Ø¥Ù„ØºØ§Ø¡</button>
            <button class="btn-danger-glow btn-save-edit" onclick="execute_update()" style="flex:1; padding:12px; border-radius:12px;">Ø­ÙØ¸</button>
        </div>
    </div>
</div>

<div class="custom-modal" id="audienceModal">
    <div class="modal-box pro-dialog-box aud-mode">
        <div class="dialog-icon-wrapper aud-theme">
            <i class="fa-solid fa-users-gear"></i>
        </div>
        <h3 class="pro-dialog-title">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</h3>
        <p class="pro-dialog-desc">Ø§Ø®ØªØ± Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ø±Ø¤ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</p>

        <div style="display:flex; flex-direction:column; gap:8px; width:100%;">
            <label class="option-card" onclick="selectAudience('public')">
                <div class="opt-icon"><i class="fa-solid fa-earth-americas"></i></div>
                <div style="flex:1"><div style="font-weight:bold; color:#fff; font-size:14px;">Ø§Ù„Ø¹Ø§Ù…Ø©</div><div style="font-size:11px; color:#777;">Ø§Ù„ÙƒÙ„ ÙŠØ±Ù‰</div></div>
                <input type="radio" name="audience" value="public" id="aud_public">
            </label>

            <label class="option-card" onclick="selectAudience('friends')">
                <div class="opt-icon"><i class="fa-solid fa-user-group"></i></div>
                <div style="flex:1"><div style="font-weight:bold; color:#fff; font-size:14px;">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</div><div style="font-size:11px; color:#777;">Ø£ØµØ¯Ù‚Ø§Ø¤Ùƒ ÙÙ‚Ø·</div></div>
                <input type="radio" name="audience" value="friends" id="aud_friends">
            </label>

            <label class="option-card" onclick="selectAudience('private')">
                <div class="opt-icon"><i class="fa-solid fa-lock"></i></div>
                <div style="flex:1"><div style="font-weight:bold; color:#fff; font-size:14px;">Ø£Ù†Ø§ ÙÙ‚Ø·</div><div style="font-size:11px; color:#777;">Ø³Ø±ÙŠ Ù„Ù„ØºØ§ÙŠØ©</div></div>
                <input type="radio" name="audience" value="private" id="aud_private">
            </label>
        </div>

        <div class="dialog-actions" style="margin-top:10px; width:100%;">
            <button class="btn-ghost btn-cancel-pro" onclick="document.getElementById('audienceModal').style.display='none'" style="flex:1; padding:12px; border-radius:12px;">Ø¥Ù„ØºØ§Ø¡</button>
            <button class="btn-danger-glow btn-save-aud" onclick="saveAudienceChange()" style="flex:1; padding:12px; border-radius:12px;">ØªØ£ÙƒÙŠØ¯</button>
        </div>
    </div>
</div>
<div class="lightbox" id="imgLightbox" onclick="closeLightbox()">
    <span class="lb-close">&times;</span>
    <img class="lb-img" id="lbImage">
    <div class="lb-caption" id="lbCaption"></div>
</div>

<div id="universalOverlay" class="universal-overlay">
    <div class="overlay-back-btn" onclick="closeUniversalPage()">
        <i class="fa-solid fa-arrow-right"></i>
    </div>
    
    <iframe id="universalFrame" src="" frameborder="0"></iframe>
</div>
<div id="connectionStatus" class="connection-banner">
    <i class="fa-solid fa-wifi"></i>
    <span id="connText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>
</div>
<div id="scrollTopBtn" class="scroll-top-btn" onclick="scrollToTop()">
    <i class="fa-solid fa-arrow-up"></i>
</div>

<div class="lightbox" id="imgLightbox" onclick="closeLightbox()">
    <span class="lb-close"><i class="fa-solid fa-xmark"></i></span>
    <img class="lb-img" id="lbImage">
</div>
    <div id="shareCardContainer" style="position:fixed; top:-9999px; left:-9999px; width:400px; height:600px; background:#0d0d0f; z-index:-1;">
    <div class="share-card-content">
        <div class="sc-header">
            <i class="fa-solid fa-heart-pulse" style="color:#00C6FF; font-size:40px;"></i>
            <span style="font-weight:900; font-size:30px; color:#fff;">Wareed</span>
        </div>

        <div class="sc-body">
            <div class="sc-user">
                <img id="scUserPic" src="" crossorigin="anonymous">
                <span id="scUserName">User Name</span>
            </div>
            <div class="sc-text" id="scPostText">
                Ù†Øµ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù‡Ù†Ø§...
            </div>
        </div>

        <div class="sc-footer">
            <div class="sc-qr">
                <i class="fa-solid fa-qrcode"></i>
            </div>
            <div class="sc-cta">
                <span>Ø§Ù†Ø¶Ù… Ù„Ø¹Ø§Ù„Ù…Ù†Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯</span>
                <small>www.wareed.lol</small>
            </div>
        </div>
    </div>
</div>
<div class="ambient-bg">
    <div class="ambient-blob blob-1"></div>
    <div class="ambient-blob blob-2"></div>
    <div class="ambient-blob blob-3"></div>
</div>
<div class="fb-icons">
    <div class="nav-item active" onclick="playSound('tab'); location.reload()">
    <i class="fa-solid fa-house"></i>
</div>


    <div class="nav-item" onclick="openPage('Friend_requests.html'); playSound('click');">
        <i class="fa-solid fa-user-plus"></i>
        <div id="topReqCount" class="nav-badge-count">0</div>
    </div>

    <div class="nav-item" onclick="goToMessages();">
        <i class="fa-solid fa-comment-dots"></i>
        <div id="topMsgCount" class="nav-badge-count">0</div> 
    </div>
    
    <div class="nav-item" onclick="goToVideos(); playSound('click');">
        <i class="fa-solid fa-circle-play"></i>
    </div>
    
    <div class="nav-item" onclick="goToNotifications(); playSound('click');">
        <i class="fa-solid fa-bell"></i>
        <div id="topNotifCount" class="nav-badge-count">0</div>
    </div>

    <div class="nav-item" onclick="goToProfile(); playSound('click');">
        <div id="bottomNavAvatar" class="nav-avatar-small" style="background-color: #333;"></div>
    </div>
</div>

<div id="optionsBackdrop" class="popup-backdrop" onclick="closeCommentOptions()"></div>



</div>
<script src="global-call.js"></script>
<script src="global-notifications.js"></script>
</body>

</body>
</html>