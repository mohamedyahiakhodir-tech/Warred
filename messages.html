<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title> Warred - Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/ar.min.js"></script>

    <style>
        /* ================= Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… ================= */
        :root {
            --bg-deep: #050505;
            --text-color: #ffffff;
            --text-secondary: #a0a0a0;
            --card-bg: rgba(30, 30, 35, 0.6);
            --card-border: rgba(255, 255, 255, 0.08);
            --accent-color: #8b5cf6;
            --accent-glow: rgba(139, 92, 246, 0.4);
            --verify-color: #38bdf8;
            --danger-color: #ef4444;
            --seen-blue: #38bdf8;
            --archive-green: #22c55e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(90, 40, 250, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(40, 150, 250, 0.1) 0%, transparent 40%);
            background-attachment: fixed;
            color: var(--text-color);
            padding-bottom: 100px;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }

        /* ================= Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ================= */
        
        .sidebar.active { right: 0; }
        
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 10000; opacity: 0; pointer-events: none; transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .sidebar-overlay.active { opacity: 1; pointer-events: auto; }

        
        .sidebar-avatar-container {
            width: 90px; height: 90px; border-radius: 50%;
            border: 3px solid var(--accent-color);
            box-shadow: 0 0 25px var(--accent-glow);
            margin-bottom: 15px; background-size: cover; background-position: center;
            background-color: #222;
        }

        .sidebar-my-name { 
    font-size: 22px; /* Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
    font-weight: 700; 
    color: #fff; 
    display: flex; 
    align-items: center; 
    justify-content: center; /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    gap: 8px; 
    text-align: center; /* ÙÙŠ Ø­Ø§Ù„ Ù†Ø²Ù„ Ø³Ø·Ø±ÙŠÙ† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
    flex-wrap: wrap; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†Ø²ÙˆÙ„ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ */
    line-height: 1.3;
    transition: font-size 0.2s ease; /* ØªÙ†Ø¹ÙŠÙ… Ø¹Ù…Ù„ÙŠØ© ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· */
    width: 100%;
}
     /* --- ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„ØªÙƒÙˆÙ† Ù…Ø±Ù†Ø© --- */
.sidebar {
    position: fixed; top: 0; right: -320px; width: 280px; height: 100%;
    background: rgba(15, 15, 20, 0.95); /* Ù„ÙˆÙ† ØºØ§Ù…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ÙˆØ¶ÙˆØ­ Ø§Ù„ÙƒÙ„Ø§Ù… */
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-left: 1px solid var(--card-border);
    z-index: 10001; transition: 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    
    /* ğŸ”¥ Ø£Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„: Ø¬Ø¹Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙ„ÙŠÙƒØ³ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
    display: flex; 
    flex-direction: column; 
    padding-top: env(safe-area-inset-top);
    box-shadow: -10px 0 30px rgba(0,0,0,0.5);
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø«Ø§Ø¨Øª Ù„Ø§ ÙŠØªØ­Ø±Ùƒ */
.sidebar-profile-header {
    flex-shrink: 0; /* Ù…Ù†Ø¹ Ø§Ù†ÙƒÙ…Ø§Ø´ Ø§Ù„Ù‡ÙŠØ¯Ø± */
    padding: 40px 20px 30px;
    background: linear-gradient(180deg, rgba(139, 92, 246, 0.15), transparent);
    border-bottom: 1px solid var(--card-border);
    text-align: center;
    display: flex; flex-direction: column; align-items: center;
}

/* ğŸ”¥ ÙƒÙ„Ø§Ø³ Ø¬Ø¯ÙŠØ¯: Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³ÙƒØ±ÙˆÙ„ */
.sidebar-scroll-area {
    flex-grow: 1; /* ØªØ£Ø®Ø° Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© */
    overflow-y: auto; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ */
    padding-bottom: 20px; /* Ù…Ø³Ø§ÙØ© Ø£Ù…Ø§Ù† ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
    
    /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù„Ø¬Ù…Ø§Ù„ Ø§Ù„Ø´ÙƒÙ„ */
    scrollbar-width: none; 
}
.sidebar-scroll-area::-webkit-scrollbar { display: none; }

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
.sidebar-item {
    padding: 16px 25px; display: flex; align-items: center; gap: 15px;
    font-size: 16px; font-weight: 600; color: #e0e0e0; cursor: pointer;
    transition: 0.2s; border-radius: 12px; margin: 5px 10px;
}
.sidebar-item:active { background: rgba(255,255,255,0.08); transform: scale(0.98); }
.sidebar-item i { width: 30px; text-align: center; color: var(--accent-color); font-size: 20px; }

        /* ================= Ø§Ù„Ù‚ØµØµ (Stories - FB Style) ================= */
        .stories-section {
            padding: 10px 0 15px 0;
            border-bottom: 1px solid var(--card-border);
            margin-bottom: 5px;
        }
        .stories-title { padding: 0 20px 10px; font-weight: 700; font-size: 14px; color: var(--text-secondary); }
        
        .stories-scroll {
            display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; padding: 0 15px;
        }

        /* Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ù„Ù„Ù‚ØµØ© */
        .story-card {
            position: relative;
            width: 105px; height: 170px;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
            cursor: pointer;
            background-color: #2a2a2a;
            transition: transform 0.2s;
            border: 1px solid var(--card-border);
        }
        .story-card:active { transform: scale(0.97); }

        /* ØµÙˆØ±Ø© Ø§Ù„Ù‚ØµØ© Ø§Ù„Ø®Ù„ÙÙŠØ© */
        .story-card-bg {
            width: 100%; height: 100%;
            object-fit: cover;
            transition: 0.3s;
        }
        .story-card:hover .story-card-bg { transform: scale(1.05); }

        /* Ø§Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„ØµØºÙŠØ± */
        .story-card-avatar {
            position: absolute; top: 8px; left: 8px;
            width: 34px; height: 34px;
            border-radius: 50%;
            border: 3px solid var(--accent-color);
            background-size: cover; background-position: center;
            z-index: 2;
        }

        /* Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        .story-card-name {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 30px 8px 8px 8px;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
            color: #fff; font-size: 12px; font-weight: bold;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            text-align: right; z-index: 2;
        }

        /* === ÙƒØ§Ø±Øª "Ø¥Ø¶Ø§ÙØ© Ù‚ØµØ©" Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ === */
        .my-story-card {
            background: #1e1e1e;
            display: flex; flex-direction: column;
        }
        .my-story-top-img {
            width: 100%; height: 65%;
            background-size: cover; background-position: center;
            filter: brightness(0.8);
        }
        .my-story-bottom {
            height: 35%; width: 100%;
            position: relative;
            background: #1e1e1e;
            display: flex; align-items: flex-end; justify-content: center;
            padding-bottom: 10px;
        }
        /* Ø²Ø± Ø§Ù„Ø²Ø§Ø¦Ø¯ */
        .add-story-btn-circle {
            position: absolute; top: -18px; left: 50%; transform: translateX(-50%);
            width: 36px; height: 36px;
            background: var(--accent-color);
            border: 3px solid #1e1e1e;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: #fff; font-size: 18px;
            z-index: 5;
        }

        /* === Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø§Ù„Ø³Ø¨ÙŠÙ†Ø±) === */
        .uploading-spinner {
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            width: 40px; height: 40px;
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 4;
        }
        @keyframes spin { 0% { transform: translateX(-50%) rotate(0deg); } 100% { transform: translateX(-50%) rotate(360deg); } }


        /* --- ØªØµÙ…ÙŠÙ… Ø¹Ø§Ø±Ø¶ Ø§Ù„Ù‚ØµØµ (Pro) --- */
        #storyViewer {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 25000; flex-direction: column;
        }
        
        .story-blur-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            filter: blur(30px) brightness(0.6); opacity: 0.8; z-index: 1;
            transition: background 0.5s ease;
        }

        .story-media-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center; z-index: 2;
        }
        
        .story-media-container img, .story-media-container video {
            max-width: 100%; max-height: 100%; object-fit: contain; width: 100%;
            animation: fadeInStory 0.4s ease-out;
        }

        @keyframes fadeInStory {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        .progress-bars-wrapper {
            position: absolute; top: 10px; left: 10px; right: 10px;
            display: flex; gap: 4px; z-index: 30; transition: opacity 0.3s;
        }
        .progress-segment {
            height: 3px; flex: 1; background: rgba(255,255,255,0.3);
            border-radius: 2px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; width: 0%; background: #fff;
        }
        
        .story-footer {
            position: absolute; bottom: 20px; left: 0; width: 100%; 
            padding: 0 15px; display: flex; align-items: center; gap: 10px; 
            z-index: 30; transition: opacity 0.3s;
        }
      /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Ù†Ø© Ø§Ù„Ø±Ø¯ Ø¹Ø´Ø§Ù† ØªØ³ØªÙˆØ¹Ø¨ Ø§Ù„Ø²Ø±Ø§Ø± */
.story-reply-input {
    flex: 1; 
    position: relative; /* Ø¶Ø±ÙˆØ±ÙŠ Ø¹Ø´Ø§Ù† Ù†Ø«Ø¨Øª Ø§Ù„Ø²Ø±Ø§Ø± Ø¬ÙˆØ§Ù‡ */
    margin-left: 10px;
}

.story-reply-input input {
    width: 100%; 
    background: rgba(0,0,0,0.5); 
    border: 1px solid rgba(255,255,255,0.3); 
    border-radius: 25px; 
    padding: 12px 15px 12px 45px; /* ÙˆØ³Ø¹Ù†Ø§ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ Ø¹Ø´Ø§Ù† Ø§Ù„Ø²Ø±Ø§Ø± */
    color: #fff; 
    outline: none; 
    backdrop-filter: blur(5px);
    font-size: 14px;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Ø§Ù„Ø·ÙŠØ§Ø±Ø©) */
.send-btn-inside {
    position: absolute;
    left: 15px;      /* Ù…ÙƒØ§Ù†Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù…Ø§Ù„ */
    top: 50%;
    transform: translateY(-50%); /* ØªÙˆØ³ÙŠØ· Ø¹Ù…ÙˆØ¯ÙŠ */
    color: var(--accent-color);
    font-size: 18px;
    cursor: pointer;
    z-index: 10;
    transition: 0.2s;
}

.send-btn-inside:active {
    transform: translateY(-50%) scale(0.9);
    opacity: 0.7;
}

        .story-reaction-btn {
            font-size: 24px; cursor: pointer; transition: 0.2s; padding: 5px;
        }
        .story-reaction-btn:active { transform: scale(1.3); }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-300px) scale(1.5); opacity: 0; }
        }

        .story-header-info {
            position:absolute; top:20px; left:20px; right:20px; 
            display:flex; justify-content:space-between; align-items:center; 
            z-index:30; transition: opacity 0.3s;
        }
        
        .story-user-details {
            display: flex; flex-direction: column; align-items: flex-start; 
             margin-right: 10px;
        }
        .story-user-avatar-small {
            width: 32px; height: 32px; border-radius: 50%; 
            background-size: cover; border: 1px solid #fff;
        }

        .story-views-count {
            color: #fff; font-size: 14px; background: rgba(0,0,0,0.6);
            padding: 6px 14px; border-radius: 20px;
            display: flex; align-items: center; gap: 6px;
            backdrop-filter: blur(5px);
        }

        /* ================= Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚ØµØµ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ================= */
        .story-more-btn {
            padding: 10px; color: #fff; font-size: 20px; cursor: pointer; text-shadow: 0 2px 5px rgba(0,0,0,0.5); z-index: 50;
        }
        .story-options-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #1a1a1a; border-top-left-radius: 20px; border-top-right-radius: 20px;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 30000; padding: 20px 0; border-top: 1px solid rgba(255,255,255,0.1);
        }
        .story-options-sheet.active { transform: translateY(0); }
        .story-opt-item {
            padding: 15px 20px; display: flex; align-items: center; gap: 15px;
            color: #fff; font-size: 16px; font-weight: 500; cursor: pointer;
            transition: background 0.2s;
        }
        .story-opt-item:active { background: rgba(255,255,255,0.1); }
        .story-opt-item i { width: 25px; text-align: center; font-size: 18px; }
        .story-opt-item.danger { color: #ff4444; }
        .story-sheet-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 29000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .story-sheet-overlay.active { opacity: 1; pointer-events: auto; }


        /* ================= Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª ================= */
        .chat-wrapper {
            position: relative; margin: 0 10px 8px 10px; overflow: hidden; border-radius: 16px;
        }
        .swipe-bg {
            position: absolute; top: 0; bottom: 0; width: 100%; height: 100%;
            display: flex; align-items: center; padding: 0 25px; font-size: 20px; color: #fff; font-weight: bold;
            border-radius: 16px; z-index: 1; pointer-events: none;
        }
        .swipe-bg.right { background: var(--danger-color); justify-content: flex-start; }
        .swipe-bg.left { background: var(--archive-green); justify-content: flex-end; }

        .avatar-container { position: relative; flex-shrink: 0; width: 58px; height: 58px; }
        .avatar { 
            width: 100%; height: 100%; border-radius: 18px;
            background-size: cover; background-position: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); background-color: #2a2a2a;
        }
        .active-dot { 
            position: absolute; bottom: -2px; right: -2px; width: 14px; height: 14px; 
            background: #22c55e; border: 3px solid var(--bg-deep); border-radius: 50%; 
        }

        .info { flex-grow: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: center; }
        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .name { font-weight: 700; font-size: 16px; color: #fff; display: flex; align-items: center; gap: 6px; }
        .verify-badge { color: var(--verify-color); font-size: 14px; }
        .time { font-size: 11px; color: var(--text-secondary); font-weight: 600; display: flex; align-items: center; gap: 5px; }

        .bottom-row { display: flex; justify-content: space-between; align-items: center; margin-top: 3px; }
        .last-message-wrapper { display: flex; align-items: center; overflow: hidden; max-width: 80%; }
        .last { color: var(--text-secondary); font-size: 14px; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 5px; }
        
        .typing-indicator { color: var(--accent-color); font-style: italic; font-size: 13px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        .read-blue-dot { 
            width: 8px; height: 8px; background-color: var(--seen-blue); 
            border-radius: 50%; display: inline-block; margin-left: 5px; 
            box-shadow: 0 0 5px var(--seen-blue); flex-shrink: 0; 
        }

        .unread-badge {
            background: linear-gradient(45deg, var(--accent-color), #6d28d9); 
            box-shadow: 0 2px 10px rgba(139, 92, 246, 0.4);
            color: white; min-width: 22px; height: 22px; padding: 0 6px; 
            border-radius: 12px; font-size: 11px; font-weight: 800;
            display: flex; align-items: center; justify-content: center;
        }

        /* ================= Ø§Ù„Ù‡ÙŠØ¯Ø± ================= */
        .main-header { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; background: rgba(20, 20, 25, 0.8); backdrop-filter: blur(15px); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--card-border); }
        .header-title { font-size: 22px; font-weight: 800; background: linear-gradient(to right, #fff, #a0a0a0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-icons { display: flex; gap: 15px; }
       /* ================= Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø¶ÙŠØ¦Ø© (Neon Gold Buttons) ================= */

/* 1. Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø²Ø± (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© + Ø§Ù„Ø¨ÙŠØª) */
.icon-btn {
    width: 42px; 
    height: 42px; 
    border-radius: 14px; /* ÙƒÙŠØ±Ù Ù†Ø§Ø¹Ù… */
    display: flex; 
    align-items: center; 
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ©: Ø²Ø¬Ø§Ø¬ÙŠ ØºØ§Ù…Ù‚ Ù…Ø¹ ØªØ¯Ø±Ø¬ Ø®ÙÙŠÙ */
    background: linear-gradient(145deg, rgba(30, 30, 35, 0.8), rgba(10, 10, 12, 0.95));
    backdrop-filter: blur(5px); /* ØªÙ…ÙˆÙŠÙ‡ Ø§Ù„Ø®Ù„ÙÙŠØ© */
    
    /* Ø§Ù„Ø¥Ø·Ø§Ø±: Ø°Ù‡Ø¨ÙŠ Ø®Ø§ÙØª Ø¬Ø¯Ø§Ù‹ (Ù„Ø­Ø¯ Ù…Ø§ ÙŠØªØ¶ØºØ· Ø¹Ù„ÙŠÙ‡) */
    border: 1px solid rgba(255, 215, 0, 0.1);
    
    /* Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©: Ø°Ù‡Ø¨ÙŠ Ù…Ø·ÙÙŠ */
    color: #c5a059;
    font-size: 18px;
    
    /* Ø§Ù„Ø¸Ù„ ÙˆØ§Ù„Ù„Ù…Ø¹Ø§Ù† Ø§Ù„Ù‡Ø§Ø¯ÙŠ (Idle State) */
    box-shadow: 
        0 4px 10px rgba(0, 0, 0, 0.5), /* Ø¸Ù„ Ø¹Ù…Ù‚ */
        inset 0 1px 0 rgba(255, 255, 255, 0.1), /* Ù„Ù…Ø¹Ø© Ø¹Ù„ÙˆÙŠØ© */
        0 0 0 transparent; /* Ù…ÙÙŠØ´ ØªÙˆÙ‡Ø¬ Ù„Ø³Ù‡ */
}

/* 2. Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Menu) Ù…Ù…ÙŠØ² Ø´ÙˆÙŠØ© Ù„Ø¥Ù†Ù‡ Ø§Ù„Ø£Ù‡Ù… */
#menuBtn {
    /* Ø¨Ù†Ø®Ù„ÙŠÙ‡ ÙŠÙ†Ø¨Ø¶ Ø¨Ø¶ÙˆØ¡ Ø®Ø§ÙØª Ø¬Ø¯Ø§Ù‹ ÙˆÙ‡Ùˆ ÙˆØ§Ù‚Ù Ø¹Ø´Ø§Ù† ÙŠÙ„ÙØª Ø§Ù„Ù†Ø¸Ø± */
    animation: idleBreathing 3s infinite alternate;
}

/* 3. Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ Ø£Ùˆ Ø§Ù„Ø¶ØºØ· (Active/Hover) - Ù‡Ù†Ø§ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø¨ØªØ´ØªØºÙ„ */
.icon-btn:active, .icon-btn:hover {
    /* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨ØªÙ†ÙˆØ± Ø£Ø¨ÙŠØ¶ */
    color: #fff;
    
    /* Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨ÙŠÙ†ÙˆØ± Ø°Ù‡Ø¨ÙŠ */
    border-color: #FFD700;
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨ØªØ¨Ù‚Ù‰ Ø°Ù‡Ø¨ÙŠ ØºØ§Ù…Ù‚ Ø´ÙØ§Ù */
    background: linear-gradient(145deg, rgba(255, 215, 0, 0.15), rgba(0, 0, 0, 0.9));
    
    /* Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„Ø¶ÙˆØ¡ (Glow Effect) */
    box-shadow: 
        0 0 15px rgba(255, 215, 0, 0.4), /* ØªÙˆÙ‡Ø¬ Ø®Ø§Ø±Ø¬ÙŠ */
        inset 0 0 10px rgba(255, 215, 0, 0.2); /* ØªÙˆÙ‡Ø¬ Ø¯Ø§Ø®Ù„ÙŠ */
        
    transform: scale(0.95); /* Ø¶ØºØ·Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© Ù„Ù„Ø¯Ø§Ø®Ù„ */
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ù„Ù„Ø²Ø± ÙˆÙ‡Ùˆ ÙˆØ§Ù‚Ù */
@keyframes idleBreathing {
    0% {
        border-color: rgba(255, 215, 0, 0.1);
        box-shadow: 0 0 0 rgba(255, 215, 0, 0);
    }
    100% {
        border-color: rgba(255, 215, 0, 0.3);
        box-shadow: 0 0 8px rgba(255, 215, 0, 0.15);
    }
}


        .search-wrapper { padding: 15px 20px 5px 20px; background: transparent; }
        .search-input-box { position: relative; width: 100%; }
        .search-input-box input {
            width: 100%; padding: 12px 45px 12px 15px; border-radius: 15px;
            background: rgba(30, 30, 35, 0.6); border: 1px solid var(--card-border);
            color: #fff; font-size: 14px; outline: none; transition: 0.3s;
        }
        .search-input-box input:focus { border-color: var(--accent-color); box-shadow: 0 0 15px rgba(139, 92, 246, 0.15); }
        .search-icon-inside { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #777; }

        /* ================= Modals ================= */
        .bottom-sheet-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 20000; opacity: 0; pointer-events: none; transition: 0.3s; display: flex; align-items: flex-end; justify-content: center; }
        .bottom-sheet-overlay.active { opacity: 1; pointer-events: auto; }
        .bottom-sheet { 
    width: 100%; 
    max-width: 500px; 
    background: rgba(20, 20, 25, 0.95); 
    backdrop-filter: blur(20px); 
    border-top: 1px solid rgba(255,255,255,0.1); 
    border-top-left-radius: 25px; 
    border-top-right-radius: 25px; 
    transform: translateY(100%); 
    transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1); 
    padding: 15px 15px 40px 15px; 
    box-shadow: 0 -10px 40px rgba(0,0,0,0.6); 
    
    /* === Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© === */
    max-height: 50vh; /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù† ØªØªØ¬Ø§ÙˆØ² Ù†ØµÙ Ø§Ù„Ø´Ø§Ø´Ø© (50%) */
    overflow-y: auto; /* Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙƒØ«ÙŠØ±Ø© Ø³ÙŠØ¸Ù‡Ø± Ø³ÙƒØ±ÙˆÙ„ Ø¯Ø§Ø®Ù„ÙŠ */
    position: absolute; /* ØªØ«Ø¨ÙŠØª ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
    bottom: 0;
}
   .bottom-sheet-overlay.active .bottom-sheet { transform: translateY(0); }
        .sheet-handle { width: 50px; height: 5px; background: #555; border-radius: 10px; margin: 0 auto 25px auto; }
        .sheet-action { display: flex; align-items: center; gap: 15px; padding: 16px 20px; font-size: 16px; color: #fff; border-radius: 16px; margin-bottom: 8px; cursor: pointer; transition: 0.2s; background: rgba(255,255,255,0.03); }
        .sheet-action:active { background: rgba(255,255,255,0.08); transform: scale(0.98); }
        .sheet-action i { width: 30px; text-align: center; font-size: 18px; color: #ddd; }
        .sheet-action.danger { color: #ff5555; background: rgba(255, 85, 85, 0.05); }

        #toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #222; border: 1px solid #444; color: #fff; padding: 12px 25px; border-radius: 30px; font-size: 14px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 10000; display: flex; align-items: center; gap: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        #toast.show { opacity: 1; bottom: 110px; }
        .empty-message { text-align: center; padding: 30px; color: #777; width: 100%; }
        
        .logout-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 30000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
        .logout-modal-overlay.active { opacity: 1; pointer-events: auto; }
        .logout-card { background: #1e1e1e; width: 85%; max-width: 320px; padding: 25px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); transform: scale(0.9); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .logout-modal-overlay.active .logout-card { transform: scale(1); }
        .logout-actions { display: flex; gap: 10px; margin-top: 20px; }
        .logout-btn { flex: 1; padding: 12px; border-radius: 12px; font-size: 14px; font-weight: bold; cursor: pointer; border: none; outline: none; transition: 0.2s; }
        .btn-yes { background: var(--danger-color); color: white; }
        .btn-no { background: rgba(255,255,255,0.1); color: white; }

        .skeleton { background: linear-gradient(90deg, #1f1f1f 25%, #2a2a2a 50%, #1f1f1f 75%); background-size: 200% 100%; animation: loading 1.5s infinite; border-radius: 6px; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
/* === Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…ØµØºØ±Ø© === */
.profile-preview-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); z-index: 25000;
    display: none; align-items: center; justify-content: center;
    backdrop-filter: blur(2px);
}

.profile-preview-card {
    width: 280px; background: #1e1e1e;
    border-radius: 20px; overflow: hidden;
    position: relative;
    animation: zoomIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

@keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

.pp-image-container {
    width: 100%; height: 280px; position: relative; cursor: pointer;
    background: #000;
}

.pp-image-container img {
    width: 100%; height: 100%; object-fit: cover;
    pointer-events: none; /* Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¶ØºØ· ÙŠÙ…ÙŠÙ† */
    user-select: none;    /* Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
    -webkit-user-select: none;
}

/* Ø·Ø¨Ù‚Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ© */
.protection-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 10; background: transparent;
}

.pp-name-overlay {
    position: absolute; top: 10px; left: 0; width: 100%;
    padding: 5px 15px;
    color: #fff; font-size: 18px; font-weight: bold;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    background: linear-gradient(to bottom, rgba(0,0,0,0.4), transparent);
    z-index: 11; pointer-events: none;
}

.pp-actions {
    display: flex; justify-content: space-around; padding: 10px 0;
    border-top: 1px solid rgba(255,255,255,0.1);
}

.pp-actions div {
    color: var(--accent-color); font-size: 22px; padding: 10px;
    cursor: pointer; width: 100%; text-align: center;
    transition: 0.2s;
}
.pp-actions div:active { background: rgba(255,255,255,0.05); }

/* === Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ© === */
.full-image-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 30000;
    display: none; align-items: center; justify-content: center;
}

.protected-img {
    max-width: 100%; max-height: 100%;
    pointer-events: none; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ Ù„Ù„Ø­ÙØ¸ */
    user-select: none;
    -webkit-touch-callout: none; /* ÙŠÙ…Ù†Ø¹ Ù‚Ø§Ø¦Ù…Ø© iOS Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· */
}

/* Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ÙˆÙŠØ´ Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù†Ø¯ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ØªØ±ÙƒÙŠØ² (Ù‚Ø¯ ØªØ¹Ù…Ù„ ÙƒØ­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø©) */
.blur-content { filter: blur(20px); }
        /* ================= ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØµØ¨Ø­ Ø£ØµØºØ± ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ© ================= */
        
        /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø­ÙˆÙ„ Ø§Ù„ÙƒØ§Ø±Øª */
        .chat-wrapper {
            margin: 0 10px 6px 10px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø³ÙÙ„ÙŠ */
            border-radius: 12px; /* ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø­ÙˆØ§Ù Ø£Ù‚Ù„ Ø­Ø¯Ø© */
        }


        /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© */
        .avatar-container { 
            position: relative; flex-shrink: 0; 
            width: 48px; height: 48px; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 58 Ø¥Ù„Ù‰ 48 */
        }
        
        .avatar { 
            width: 100%; height: 100%; 
            border-radius: 14px; /* ØªØ¯ÙˆÙŠØ± Ù…ØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
            background-size: cover; background-position: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); 
            background-color: #2a2a2a;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* ØªØµØºÙŠØ± Ù†Ù‚Ø·Ø© Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† */
        .active-dot { 
            width: 11px; height: 11px; 
            bottom: -1px; right: -1px;
            border-width: 2px;
        }

        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .info { flex-grow: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: center; }
        
        .top-row { margin-bottom: 2px; } /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø³Ø§Ù„Ø© */
        
        .name { 
            font-weight: 700; 
            font-size: 15px; /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø© */
            color: #ececec; 
            display: flex; align-items: center; gap: 5px; 
        }
        
        .time { 
            font-size: 10px; /* ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„ÙˆÙ‚Øª */
            color: #888; 
            font-weight: 600; 
        }

        .bottom-row { margin-top: 2px; }
        
        .last { 
            color: #aaa; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© */
            font-size: 13px; /* ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
            opacity: 0.9; 
        }
        
        /* Ø¨Ø§Ø¯Ø¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© */
        .unread-badge {
            min-width: 18px; height: 18px; /* ØªØµØºÙŠØ± Ø§Ù„Ø¨Ø§Ø¯Ø¬ */
            font-size: 10px;
            box-shadow: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¸Ù„ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø²Ø­Ù…Ø© */
        }
        /* ================= ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù‚ØµØµ Ù„ØªÙƒÙˆÙ† Ø£ØµØºØ± ÙˆØ£Ø´ÙŠÙƒ ================= */
        .stories-section {
            padding: 8px 0 12px 0; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ÙˆØ§Ù„Ø³ÙÙ„ÙŠØ© */
            border-bottom: 1px solid var(--card-border);
            margin-bottom: 5px;
        }
        
        .stories-title { 
            padding: 0 15px 8px; 
            font-weight: 700; 
            font-size: 13px; /* ØªØµØºÙŠØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… */
            color: var(--text-secondary); 
        }
        
        .stories-scroll {
            display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; padding: 0 12px;
        }

        /* --- Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù…ØµØºØ± --- */
        .story-card {
            position: relative;
            width: 85px;   /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 105px */
            height: 135px; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 170px */
            border-radius: 10px;
            overflow: hidden;
            flex-shrink: 0;
            cursor: pointer;
            background-color: #2a2a2a;
            transition: transform 0.2s;
            border: 1px solid var(--card-border);
        }
        .story-card:active { transform: scale(0.97); }

        .story-card-bg {
            width: 100%; height: 100%;
            object-fit: cover;
            transition: 0.3s;
        }

        /* --- Ø§Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„ØµØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚ØµØ© --- */
        .story-card-avatar {
            position: absolute; top: 6px; left: 6px;
            width: 26px; height: 26px; /* ØªØµØºÙŠØ± Ø§Ù„Ø£ÙØ§ØªØ§Ø± */
            border-radius: 50%;
            border: 2px solid var(--accent-color); /* ØªÙ†Ø­ÙŠÙ Ø§Ù„Ø¥Ø·Ø§Ø± */
            background-size: cover; background-position: center;
            z-index: 2;
        }

        /* --- Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… --- */
        .story-card-name {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 20px 6px 6px 6px;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
            color: #fff; 
            font-size: 10px; /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· */
            font-weight: bold;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            text-align: right; z-index: 2;
        }

        /* === ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙƒØ§Ø±Øª "Ø¥Ø¶Ø§ÙØ© Ù‚ØµØ©" Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ === */
        .my-story-card {
            background: #1e1e1e;
            display: flex; flex-direction: column;
        }
        .my-story-top-img {
            width: 100%; height: 70%; /* Ø²ÙŠØ§Ø¯Ø© Ù†Ø³Ø¨Ø© Ø§Ù„ØµÙˆØ±Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            background-size: cover; background-position: center;
            filter: brightness(0.8);
        }
        .my-story-bottom {
            height: 30%; width: 100%;
            position: relative;
            background: #1e1e1e;
            display: flex; align-items: flex-end; justify-content: center;
            padding-bottom: 6px;
        }
        
        /* Ø²Ø± Ø§Ù„Ø²Ø§Ø¦Ø¯ */
        .add-story-btn-circle {
            position: absolute; top: -14px; left: 50%; transform: translateX(-50%);
            width: 28px; height: 28px; /* ØªØµØºÙŠØ± Ø§Ù„Ø²Ø± */
            background: var(--accent-color);
            border: 2px solid #1e1e1e;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: #fff; font-size: 14px;
            z-index: 5;
        }

        /* Ø³Ø¨ÙŠÙ†Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .uploading-spinner {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 30px; height: 30px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 4;
        }

            /* ================= ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†Ø´Ø± (Insta Style) ================= */
        .insta-source-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 35000;
            display: flex; flex-direction: column;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .insta-source-overlay.active { transform: translateY(0); }

        .insta-top-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; color: #fff;
        }
        .insta-icon { font-size: 24px; padding: 10px; cursor: pointer; }
        .insta-title { font-weight: bold; font-size: 16px; }

        .insta-camera-area {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .camera-shutter-outer {
            width: 80px; height: 80px; border-radius: 50%;
            border: 4px solid #fff; padding: 4px;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .camera-shutter-inner {
            width: 100%; height: 100%; background: #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: #000; font-size: 24px;
        }
        .insta-camera-area:active .camera-shutter-outer { transform: scale(0.9); opacity: 0.8; }

        .insta-bottom-sheet {
            background: #1a1a1a; border-top-left-radius: 20px; border-top-right-radius: 20px;
            padding-bottom: 30px; border-top: 1px solid #333;
            animation: slideUp 0.4s ease;
        }

        .insta-sheet-handle {
            width: 40px; height: 4px; background: #444; border-radius: 10px;
            margin: 10px auto 20px auto;
        }

        .insta-options-grid {
            display: flex; justify-content: space-around; padding: 0 10px;
            margin-bottom: 20px;
        }
        .insta-option-card {
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            color: #fff; font-size: 12px; font-weight: 500; cursor: pointer;
        }
        .insta-opt-icon {
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 20px;
            transition: 0.2s;
        }
        .insta-option-card:active .insta-opt-icon { transform: scale(0.9); }

        .gradient-gallery { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
        .gradient-music { background: linear-gradient(45deg, #4facfe, #00f2fe); }
        .gradient-text { background: linear-gradient(45deg, #43e97b, #38f9d7); color: #000; }

        .fake-gallery-row {
            display: flex; gap: 5px; padding: 0 10px; overflow-x: hidden;
        }
        .fake-img {
            width: 24%; height: 80px; background: #333; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; color: #555;
            cursor: pointer;
        }
/* --- ØªÙ†Ø³ÙŠÙ‚ Ù†Ø§ÙØ°Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª --- */
.custom-modal {
    position: fixed; inset: 0; z-index: 20000;
    display: none; align-items: flex-start; justify-content: center;
    background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px);
    padding-top: 80px; /* Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ */
}

.modal-box {
    background: #161616; width: 90%; max-width: 380px;
    border-radius: 24px; padding: 20px;
    border: 1px solid #2a2a2a; text-align: center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    display: flex; flex-direction: column; gap: 15px;
}

.account-list {
    text-align: right; max-height: 250px; overflow-y: auto;
    background: #0d0d0f; border-radius: 16px; padding: 5px; margin-bottom: 10px;
}

.acc-item {
    display: flex; align-items: center; gap: 12px;
    padding: 12px; margin: 5px; border-radius: 12px;
    cursor: pointer; transition: 0.2s;
    background: transparent; border-bottom: 1px solid #222;
}
.acc-item:last-child { border-bottom: none; }
.acc-item:hover { background: #1f1f1f; }

/* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
.input-group { position: relative; margin-bottom: 15px; width: 100%; }
.input-icon { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); color: #555; }
.pro-input {
    width: 100%; background: #0d0d0f; border: 1px solid #333;
    border-radius: 12px; padding: 14px 50px 14px 15px;
    color: #fff; outline: none; transition: 0.3s;
}
.pro-input:focus { border-color: #8b5cf6; box-shadow: 0 0 15px rgba(139, 92, 246, 0.15); }

.modal-actions { display: flex; flex-direction: column; gap: 10px; width: 100%; }
.btn-purple {
    background: linear-gradient(135deg, #8b5cf6, #6d28d9); color: white;
    border: none; padding: 14px; border-radius: 16px; font-weight: bold;
    cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;
}
.btn-dark {
    background: #1f1f1f; color: #aaa; border: 1px solid #333;
    padding: 12px; border-radius: 16px; font-weight: bold; cursor: pointer; width: 100%;
}
    /* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù†ØµØ± Ø§Ù„ØµØ¯ÙŠÙ‚ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.new-chat-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px;
    border-radius: 12px;
    transition: 0.2s;
    cursor: pointer;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.new-chat-item:active {
    background: rgba(255,255,255,0.08);
}

.new-chat-item:last-child {
    border-bottom: none;
}

.nc-avatar {
    width: 45px; height: 45px;
    border-radius: 14px;
    background-size: cover;
    background-position: center;
    border: 1px solid rgba(255,255,255,0.1);
}

.nc-name {
    font-size: 15px;
    font-weight: bold;
    color: #fff;
}
/* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† */
.viewer-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05);
}
.viewer-info { display: flex; align-items: center; gap: 12px; }
.viewer-avatar { width: 40px; height: 40px; border-radius: 50%; background-size: cover; background-position: center; }
.viewer-name { color: #fff; font-weight: bold; font-size: 14px; }
.viewer-reaction { font-size: 20px; }

/* Ø¥ØµÙ„Ø§Ø­ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆÙ‚ Ø§Ù„Ù‚ØµØ© */
#storyViewersModal {
    z-index: 30000 !important; /* Ø±Ù‚Ù… Ø£Ø¹Ù„Ù‰ Ù…Ù† storyViewer */
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø´ÙƒÙ„ Ø¬Ù…ÙŠÙ„ */
#storyViewersModal .bottom-sheet {
    background: rgba(30, 30, 30, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
}
/* Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ Ø­Ø±ÙƒØ© */
/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
.story-media-container {
    background: #000;
}

.story-enter-next {
    animation: slideZoomNext 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.story-enter-prev {
    animation: slideZoomPrev 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
}

@keyframes slideZoomNext {
    from { transform: translateX(50%) scale(0.8); opacity: 0; }
    to { transform: translateX(0) scale(1); opacity: 1; }
}

@keyframes slideZoomPrev {
    from { transform: translateX(-50%) scale(0.8); opacity: 0; }
    to { transform: translateX(0) scale(1); opacity: 1; }
}

.story-dest-btn {
    background: #222; color: #fff; padding: 8px 15px; border-radius: 20px; font-size: 13px;
}

.send-story-btn {
    background: #fff; color: #000; border: none; padding: 10px 25px;
    border-radius: 25px; font-weight: bold; display: flex; align-items: center; gap: 8px;
}

/* Ø­Ù„Ù‚Ø© Ù…ØªØ¯Ø±Ø¬Ø© Ù…ØªØ­Ø±ÙƒØ© */
@keyframes spin-gradient {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
/* Ø£ÙˆÙ„Ø§Ù‹: Ù„Ø§Ø²Ù… Ù†Ù„ØºÙŠ Ø§Ù„Ù€ overflow hidden Ù…Ù† Ø§Ù„ÙƒØ§Ø±Øª Ø¹Ø´Ø§Ù† Ø§Ù„Ø¥Ø·Ø§Ø± ÙŠØ¸Ù‡Ø± Ù„Ø¨Ø±Ù‡ */
.story-card {
    overflow: visible !important; /* Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ø¹Ø´Ø§Ù† Ø§Ù„ØªÙˆÙ‡Ø¬ ÙŠØ¸Ù‡Ø± */
    z-index: 1; /* Ø¹Ø´Ø§Ù† Ù†Ø¶Ù…Ù† ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª */
}

/* Ø«Ø§Ù†ÙŠØ§Ù‹: Ù†Ø·Ø¨Ù‚ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø±Øª Ù†ÙØ³Ù‡ */
.story-card::before {
    content: '';
    position: absolute;
    /* Ø¨Ù†ÙƒØ¨Ø± Ø§Ù„Ø¥Ø·Ø§Ø± Ù„Ø¨Ø±Ù‡ 3 Ø¨ÙƒØ³Ù„ */
    inset: -3px; 
    
    /* Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…: Ø¨Ù†Ø®Ù„ÙŠ Ø§Ù„Ø­ÙˆØ§Ù Ù†ÙØ³ ØªØ¯ÙˆÙŠØ±Ø© Ø§Ù„ÙƒØ§Ø±Øª (Ù…Ø´ 50% Ø§Ù„Ù„ÙŠ Ø¨ØªØ¹Ù…Ù„ Ø¯Ø§ÙŠØ±Ø©) */
    border-radius: 14px; 
    
    /* Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø¨ØªØ§Ø¹Ùƒ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ */
    background: linear-gradient(135deg, #BF953F, #FCF6BA, #B38728, #FBF5B7, #AA771C);
    
    z-index: -1; /* Ø¹Ø´Ø§Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ±Ø§ Ø§Ù„ÙƒØ§Ø±Øª */
    box-shadow: 0 0 10px rgba(191, 149, 63, 0.5); /* ØªÙˆÙ‡Ø¬ Ø®ÙÙŠÙ */
}

/* Ø¹Ø´Ø§Ù† Ø§Ù„ØµÙˆØ± Ø§Ù„Ù„ÙŠ Ø¬ÙˆÙ‡ Ø§Ù„ÙƒØ§Ø±Øª ØªÙØ¶Ù„ ÙˆØ§Ø®Ø¯Ø© Ø§Ù„ÙƒÙŠØ±Ù */
.story-card-bg, .story-card video {
    border-radius: 10px; /* Ù„Ø§Ø²Ù… Ù†Ø¯ÙŠ Ø§Ù„ØµÙˆØ±Ø© ÙƒÙŠØ±Ù Ù„Ø£Ù†Ù†Ø§ Ù„ØºÙŠÙ†Ø§ Ø§Ù„Ù‚Øµ Ù…Ù† Ø§Ù„Ø£Ø¨ */
}


.story-media-container {
    perspective: 1000px; /* ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¸ÙˆØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
    transform-style: preserve-3d;
}

/* Ø­Ø±ÙƒØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† (Ù…ÙƒØ¹Ø¨) */
.cube-next-enter {
    animation: cubeNextEnter 0.5s ease forwards;
}
.cube-next-leave {
    animation: cubeNextLeave 0.5s ease forwards;
}

@keyframes cubeNextEnter {
    from { transform: translateX(100%) rotateY(90deg); opacity: 1; }
    to { transform: translateX(0) rotateY(0); opacity: 1; }
}
@keyframes cubeNextLeave {
    from { transform: translateX(0) rotateY(0); opacity: 1; }
    to { transform: translateX(-100%) rotateY(-90deg); opacity: 1; }
}
/* ØªÙˆØ³ÙŠØ¹ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ù„ÙˆØ¨ Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
#floatingHearts {
    position: fixed; /* ØªØºÙŠÙŠØ± Ù…Ù† absolute Ø¥Ù„Ù‰ fixed Ù„ØªØ®Ø±Ø¬ Ø¨Ø±Ø© Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© */
    bottom: 0;
    right: 20px;
    width: 100px; /* ÙˆØ³Ø¹Ù†Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ø´ÙˆÙŠØ© */
    height: 100vh; /* ØªØ£Ø®Ø° Ø·ÙˆÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
    pointer-events: none;
    z-index: 99999; /* Ø±Ù‚Ù… Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ Ù„ØªØ¸Ù‡Ø± ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡ */
    overflow: visible; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ */
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„ØµØ¹ÙˆØ¯ Ù„ØªÙƒÙˆÙ† Ø£Ø·ÙˆÙ„ ÙˆØ£Ø³Ù„Ø³ */
@keyframes floatUp {
    0% { 
        transform: translateY(0) scale(0.5); 
        opacity: 0; 
    }
    10% {
        opacity: 1;
        transform: translateY(-50px) scale(1.2); /* ØªÙƒØ¨ÙŠØ± Ø³Ø±ÙŠØ¹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
    }
    100% { 
        transform: translateY(-80vh) scale(1); /* ØªØµØ¹Ø¯ Ù„Ù€ 80% Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
        opacity: 0; 
    }
}

/* ================= ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„ÙØ®Ù… (Royal Dark Gold) ================= */
.chat { 
    position: relative; 
    z-index: 2;
    display: flex; 
    gap: 12px; 
    padding: 12px 14px; /* ÙƒØ¨Ø±Ù†Ø§ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ø³ÙÙ†Ø© Ù„Ù„Ø±Ø§Ø­Ø© */
    cursor: pointer; 
    align-items: center; 
    
    /* 1. Ø§Ù„Ø®Ù„ÙÙŠØ©: ØªØ¯Ø±Ø¬ Ù…Ù† Ø§Ù„Ø£Ø³ÙˆØ¯ Ø§Ù„ØºØ§Ù…Ù‚ Ù„Ø£Ø³ÙˆØ¯ ÙÙŠÙ‡ Ù„Ù…Ø³Ø© Ø°Ù‡Ø¨ÙŠ Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
    background: linear-gradient(135deg, #09090b 0%, #1c1917 100%);
    
    /* 2. Ø§Ù„Ø¥Ø·Ø§Ø±: Ø°Ù‡Ø¨ÙŠ Ø®Ø§ÙØª Ø¬Ø¯Ø§Ù‹ ÙˆØ´ÙØ§Ù (ÙƒØ£Ù†Ù‡ Ø¥Ø¶Ø§Ø¡Ø©) */
    border: 1px solid rgba(191, 149, 63, 0.15);
    border-right: 3px solid rgba(191, 149, 63, 0.4); /* Ø®Ø· Ø°Ù‡Ø¨ÙŠ Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ù„Ø´ÙŠØ§ÙƒØ© */
    
    /* 3. Ø§Ù„Ø¸Ù„ ÙˆØ§Ù„Ù„Ù…Ø¹Ø§Ù† */
    box-shadow: 0 4px 15px rgba(0,0,0,0.4); 
    
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
    user-select: none; 
    width: 100%;
    border-radius: 16px; /* ÙƒÙŠØ±Ù Ø£Ù†Ø¹Ù… */
    overflow: hidden; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ù„Ù…Ø¹Ø© Ù…Ø§ ØªØ®Ø±Ø¬Ø´ Ø¨Ø±Ù‡ */
}

/* Ø¥Ø¶Ø§ÙØ© Ù„Ù…Ø¹Ø© Ø®ÙÙŠÙØ© ØªÙ…Ø± ÙÙˆÙ‚ Ø§Ù„ÙƒØ§Ø±Øª (Sheen Effect) */
.chat {
    /* Ù†Ø­Ø§Ø³ÙŠ Ù…Ø­Ù…Ø± ÙØ®Ù… */
    border: 1px solid rgba(245, 158, 11, 0.3); 
    border-right: 3px solid #d97706;
    
    /* Ø¶ÙŠ Ø¯Ø§ÙÙŠ */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
}

.chat:active {
    border-color: #fbbf24;
    box-shadow: 0 0 15px rgba(245, 158, 11, 0.2);
}

/* ================= Ø§Ù„Ø´Ø§Øª Ø§Ù„Ù…Ø«Ø¨Øª (Pinned) ================= */
/* Ø¯Ù‡ Ø¨Ù‚Ù‰ Ù‡ÙŠÙƒÙˆÙ† Ø°Ù‡Ø¨ÙŠ ØµØ±ÙŠØ­ Ø¨Ø³ ÙØ®Ù… (Premium) */
.chat.pinned-chat { 
    /* ØªØ¯Ø±Ø¬ Ø°Ù‡Ø¨ÙŠ ØºØ§Ù…Ù‚ Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø£Ø¨ÙŠØ¶ ÙŠØ¨Ø§Ù† */
    background: linear-gradient(135deg, rgba(191, 149, 63, 0.15), rgba(10, 10, 12, 0.95));
    border: 1px solid rgba(191, 149, 63, 0.6);
    border-right: 4px solid #FFD700; /* Ø®Ø· Ø°Ù‡Ø¨ÙŠ Ù„Ø§Ù…Ø¹ */
    box-shadow: 0 0 25px rgba(191, 149, 63, 0.1);
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ù„Ù†ØµÙˆØµ Ø¹Ø´Ø§Ù† ØªÙ„ÙŠÙ‚ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
.chat .name {
    color: #fceecb; /* Ù„ÙˆÙ† "Ø³ÙƒØ±ÙŠ" ÙØ§ØªØ­ Ø¨Ø¯Ù„ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„ØµØ±ÙŠØ­ Ø¹Ø´Ø§Ù† ÙŠÙ„ÙŠÙ‚ Ù…Ø¹ Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.chat .last {
    color: #a8a29e; /* Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙØ¦ */
}
/* ================= Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ù…Ù„ÙƒÙŠ ================= */
/* ================= Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¥Ø·Ø§Ø± Ù…ÙˆÙ ØºØ§Ù…Ù‚ ================= */
/* ================= ØªØµØºÙŠØ± ÙˆØªÙˆØ³Ø· Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ================= */

.search-input-box {
    position: relative;
    width: 88%; /* ØµØºØ±Ù†Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ø´Ø§Ù† ÙŠØ¨Ù‚Ù‰ Ù…Ù„Ù…ÙˆÙ… ÙˆØ´ÙŠÙƒ */
    margin: 0 auto; /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ø´Ø±ÙŠØ· ÙÙŠ Ù†Øµ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„Ø¸Ø¨Ø· */
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ù„Ø¥Ù†Ø¨ÙˆØª Ø¹Ø´Ø§Ù† ÙŠÙ…Ù„Ø£ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
.search-input-box input {
    width: 100%;
    /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù„ÙŠ Ø¹Ù…Ù„Ù†Ø§Ù‡Ø§ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡ Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ */
    padding: 12px 45px 12px 15px; 
    border-radius: 20px; /* ÙƒÙŠØ±Ù Ù…ØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    background: rgba(30, 30, 35, 0.6); 
    border: 1px solid #6d28d9; 
    color: #fceecb; 
    outline: none;
    transition: all 0.3s ease;
}

/* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² (Ù„Ù…Ø§ ÙŠØ¯ÙˆØ³ ÙŠÙƒØªØ¨) */
.search-input-box input:focus {
    /* Ø§Ù„Ø¥Ø·Ø§Ø± ÙŠÙ†ÙˆØ± Ù…ÙˆÙ Ø£ÙØªØ­ Ø´ÙˆÙŠØ© */
    border-color: #8b5cf6;
    
    /* ØªÙˆÙ‡Ø¬ Ù…ÙˆÙ Ø­ÙˆØ§Ù„ÙŠÙ† Ø§Ù„Ø´Ø±ÙŠØ· */
    box-shadow: 0 0 15px rgba(109, 40, 217, 0.4), inset 0 2px 5px rgba(0,0,0,0.5);
}


/* 2. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Øµ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ (Placeholder) */
.search-input-box input::placeholder {
    color: #8a7d5b; /* Ø°Ù‡Ø¨ÙŠ Ø±Ù…Ø§Ø¯ÙŠ Ù…Ø·ÙÙŠ Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠØ²ØºÙ„Ù„Ø´ Ø§Ù„Ø¹ÙŠÙ† */
    font-weight: normal;
    transition: 0.3s;
}

/* 3. Ø­Ø§Ù„Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² (Ù„Ù…Ø§ ÙŠØ¯ÙˆØ³ Ø¹Ø´Ø§Ù† ÙŠÙƒØªØ¨) */
.search-input-box input:focus {
    /* Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨ÙŠÙ†ÙˆØ± Ø°Ù‡Ø¨ÙŠ */
    border-color: #BF953F;
    
    /* ØªÙˆÙ‡Ø¬ Ø®Ø§Ø±Ø¬ÙŠ Ø®ÙÙŠÙ */
    box-shadow: 0 0 20px rgba(191, 149, 63, 0.15), inset 0 2px 5px rgba(0,0,0,0.5);
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨ØªÙØªØ­ Ø³ÙÙ†Ø© Ø¨Ø³ÙŠØ·Ø© */
    background: linear-gradient(145deg, rgba(25, 25, 30, 0.95), rgba(50, 45, 30, 0.9));
}

/* Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ²ØŒ Ù†Ø®ÙÙŠ Ø§Ù„Ù€ placeholder Ø¹Ø´Ø§Ù† Ø§Ù„Ø´ÙƒÙ„ ÙŠØ¨Ù‚Ù‰ Ø£Ù†Ø¸Ù */
.search-input-box input:focus::placeholder {
    opacity: 0.5;
    transform: translateX(-5px);
}

/* 4. Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹Ø¯Ø³Ø© */
.search-icon-inside {
    position: absolute;
    right: 20px; /* Ù…ÙƒØ§Ù†Ù‡Ø§ ÙŠÙ…ÙŠÙ† */
    top: 50%;
    transform: translateY(-50%);
    
    /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ Ù…Ø¹Ø¯Ù†ÙŠ */
    color: #D4AF37;
    font-size: 18px;
    pointer-events: none; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø¶ØºØ·Ø© ØªØ¹Ø¯ÙŠ Ù„Ù„Ø­Ù‚Ù„ */
    transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    
    /* Ù„Ù…Ø¹Ø© Ø®ÙÙŠÙØ© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    text-shadow: 0 0 5px rgba(212, 175, 55, 0.3);
}


.search-input-box:focus-within .search-icon-inside {
    color: #FFD700; /* Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ Ù„Ø§Ù…Ø¹ */
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    transform: translateY(-50%) scale(1.1); /* ØªÙƒØ¨ÙŠØ± Ø¨Ø³ÙŠØ· */
}/* ================= Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ø­ÙŠ (Miracle Gold) ================= */

/* 1. Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
.luxury-logo-container {
    background: none !important;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px; /* Ù…Ø³Ø§ÙØ© Ù…Ø±ÙŠØ­Ø© */
    font-family: 'Cairo', sans-serif;
    font-size: 26px;
    font-weight: 900;
}

/* 2. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙ„Ù…ØªÙŠÙ† (Wareed & chat) - Ø°Ù‡Ø¨ÙŠ Ù…Ø¹Ø¯Ù†ÙŠ ÙˆÙ‚ÙˆØ± */
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙ„Ù…ØªÙŠÙ† (Wareed & chat) - Ø°Ù‡Ø¨ÙŠ Ù…Ø¹ Ø¥Ø·Ø§Ø± Ù…ÙˆÙ ØºØ§Ù…Ù‚ */
/* ================= Ø§Ù„Ù†Øµ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø¨Ù„Ù…Ø¹Ø© Ù…ØªØ­Ø±ÙƒØ© (Shining Gold) ================= */

.gold-text {
    /* Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ù„ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ "Ø®Ø· Ù†ÙˆØ±" ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
    background: linear-gradient(
        120deg,      /* Ø²Ø§ÙˆÙŠØ© Ù…ÙŠÙ„ Ø§Ù„Ù„Ù…Ø¹Ø© */
        #3a2c0f 0%,  /* Ø¨Ù†ÙŠ ØºØ§Ù…Ù‚ (Ø¨Ø¯Ø§ÙŠØ©) */
        #997f3d 20%, /* Ø°Ù‡Ø¨ÙŠ Ù…ØªÙˆØ³Ø· */
        #ffecb3 40%, /* Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ */
        #ffffff 50%, /* Ø£Ø¨ÙŠØ¶ Ø³Ø§Ø·Ø¹ (Ø¯ÙŠ Ø§Ù„Ù„Ù…Ø¹Ø© Ù†ÙØ³Ù‡Ø§) */
        #ffecb3 60%, /* Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„ÙØ§ØªØ­ */
        #997f3d 80%, /* Ø°Ù‡Ø¨ÙŠ Ù…ØªÙˆØ³Ø· */
        #3a2c0f 100% /* Ø¨Ù†ÙŠ ØºØ§Ù…Ù‚ (Ù†Ù‡Ø§ÙŠØ©) */
    );
    
    /* ØªÙƒØ¨ÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø¶Ø¹Ù Ø­Ø¬Ù… Ø§Ù„Ù†Øµ Ø¹Ø´Ø§Ù† Ù†Ù‚Ø¯Ø± Ù†Ø­Ø±ÙƒÙ‡Ø§ */
    background-size: 200% auto;
    
    /* Ù‚Øµ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„Ø­Ø±ÙˆÙ */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    color: #fff; /* Ø§Ø­ØªÙŠØ§Ø·ÙŠ */

    /* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…ÙˆÙ Ø§Ù„ØºØ§Ù…Ù‚ Ø¨ØªØ§Ø¹Ùƒ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ */
    -webkit-text-stroke: 1.5px #4c1d95;
    filter: drop-shadow(0 2px 0 rgba(76, 29, 149, 0.5));
    
    text-transform: uppercase;
    letter-spacing: 1px;
    
    /* ØªØ´ØºÙŠÙ„ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù„Ù…Ø¹Ø© */
    /* Ø§Ù„Ù…Ø¯Ø© 5 Ø«ÙˆØ§Ù†ÙŠ - ØªØªÙƒØ±Ø± Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± - Ø­Ø±ÙƒØ© Ø®Ø·ÙŠØ© Ù†Ø§Ø¹Ù…Ø© */
    animation: shineMove 5s linear infinite;
}

/* ØªØ¹Ø±ÙŠÙ Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ù…Ø¹Ø© */
@keyframes shineMove {
    0% {
        background-position: 0% center; /* Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø¹Ø© Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± */
    }
    100% {
        background-position: -200% center; /* ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„ÙŠÙ…ÙŠÙ† */
    }
}

/* ================= Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„ÙØ§Ø®Ø± Ø§Ù„Ù…Ø´Ø¹ (Pro Gold Heart) ================= */

/* ================= Ù‚Ù„Ø¨ Ø§Ù„ÙˆØ±ÙŠØ¯ Ø§Ù„Ø°Ù‡Ø¨ÙŠ (Gold-Rimmed Blood Heart) ================= */

.miracle-heart {
    /* 1. Ø§Ù„Ø­Ø¬Ù… */
    font-size: 32px; 
    display: inline-block;
    
    /* 2. Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (Ù„ÙˆÙ† Ø§Ù„ÙˆØ±ÙŠØ¯/Ø§Ù„Ø¯Ù…) */
    color: #d60000; /* Ø£Ø­Ù…Ø± Ø¯Ù…ÙˆÙŠ ØµØ±ÙŠØ­ */
    
    /* 3. Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ø§Ù„Ø°Ù‡Ø¨ÙŠ) */
    /* Ø¯Ù‡ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¨Ø±ÙˆØ§Ø² Ø§Ù„Ø¯Ù‡Ø¨ÙŠ Ø­ÙˆØ§Ù„ÙŠÙ† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± */
    -webkit-text-stroke: 1.5px #FFD700; 
    
    /* 4. Ø§Ù„Ø¸Ù„ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø¹ */
    /* Ø¨Ù†Ø¹Ù…Ù„ Ù…ÙŠÙƒØ³ Ø¨ÙŠÙ† Ø¶ÙŠ Ø°Ù‡Ø¨ÙŠ ÙˆØ¶ÙŠ Ø£Ø­Ù…Ø± */
    filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.8)) drop-shadow(0 0 10px rgba(200, 0, 0, 0.5));
    
    /* 5. Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
    animation: veinPulse 1.5s infinite cubic-bezier(0.25, 0.46, 0.45, 0.94);
    transform-origin: center;
}

/* Ø­Ø±ÙƒØ© Ù†Ø¨Ø¶ Ø§Ù„ÙˆØ±ÙŠØ¯ */
@keyframes veinPulse {
    0% {
        transform: scale(1);
        color: #d60000; /* Ø£Ø­Ù…Ø± ØºØ§Ù…Ù‚ */
        filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.8));
    }
    15% {
        transform: scale(1.25); /* Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù‚ÙˆÙŠØ© */
        color: #ff0000; /* ÙŠØ­Ù…Ø± Ø¬Ø¯Ø§Ù‹ Ù…Ø¹ Ø§Ù„Ø¯Ù‚Ø© (ÙØ±ÙŠØ´) */
        /* Ø§Ù„ØªÙˆÙ‡Ø¬ ÙŠØ²ÙŠØ¯ Ø°Ù‡Ø¨ÙŠ ÙˆØ£Ø­Ù…Ø± */
        filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1)) drop-shadow(0 0 25px rgba(255, 0, 0, 0.8));
    }
    30% {
        transform: scale(1.1);
        color: #e60000;
    }
    45% {
        transform: scale(1.3); /* Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„ØªØ§Ù†ÙŠØ© */
        color: #ff1a1a;
        filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1)) drop-shadow(0 0 30px rgba(255, 0, 0, 1));
    }
    100% {
        transform: scale(1);
        color: #d60000;
    }
}

/* ØªØ¹Ø±ÙŠÙ Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø¨Ø¶ Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠØ© (Ø¯Ù‚ØªÙŠÙ† Ø³Ø±ÙŠØ¹ØªÙŠÙ† Ø«Ù… Ø±Ø§Ø­Ø©) */
@keyframes proHeartBeat {
    0% { 
        transform: scale(1); 
        filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6)) drop-shadow(0 0 15px rgba(255, 140, 0, 0.4));
    }
    15% { 
        transform: scale(1.15); /* Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ */
        /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ Ù…Ø¹ Ø§Ù„Ù†Ø¨Ø¶Ø© */
        filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.9)) drop-shadow(0 0 25px rgba(255, 69, 0, 0.7)) brightness(1.1);
    }
    30% { 
        transform: scale(1.05); /* Ø±Ø¬ÙˆØ¹ Ø¬Ø²Ø¦ÙŠ */
        filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.7)) drop-shadow(0 0 18px rgba(255, 140, 0, 0.5));
    }
    45% { 
        transform: scale(1.2); /* Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ù„Ø£Ù‚ÙˆÙ‰ */
        /* Ø¥Ø´Ø¹Ø§Ø¹ Ø£Ù‚ÙˆÙ‰ */
        filter: drop-shadow(0 0 18px rgba(255, 215, 0, 1)) drop-shadow(0 0 30px rgba(255, 69, 0, 0.8)) brightness(1.2);
    }
    65% { 
        transform: scale(1); /* Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø­Ø¬Ù… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ */
        filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6)) drop-shadow(0 0 15px rgba(255, 140, 0, 0.4));
    }
    100% { 
        transform: scale(1); /* ÙØªØ±Ø© Ø±Ø§Ø­Ø© */
    }
}
/* ================= Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©: Ø³ØªØ§ÙŠÙ„ "Ø±ÙˆÙŠØ§Ù„ Ø¬ÙˆÙ„Ø¯" (Royal Gold Tech) =/* ================= Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©: Ø³ØªØ§ÙŠÙ„ "Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„ÙƒÙŠ" (Royal Blend) ================= */

.sidebar {
    position: fixed; top: 0; right: -320px; width: 280px; height: 100%;
    z-index: 10001; transition: 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    display: flex; flex-direction: column; 
    padding-top: 0; /* Ø´ÙŠÙ„Ù†Ø§ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ø¹Ø´Ø§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ§Ø®Ø¯ Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙƒÙ„Ù‡Ø§ */
    box-shadow: -10px 0 50px rgba(0,0,0,0.8);
    border-left: 1px solid rgba(255, 215, 0, 0.2);

    /* 1. Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ù„ÙˆÙ† ÙƒØ­Ù„ÙŠ ØºØ§Ù…Ù‚ Ù…Ø§Ø¦Ù„ Ù„Ù„Ù…ÙˆÙ */
    background-color: #0f0c15; 
    overflow: hidden; /* Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ù…Ø§ ØªØ·Ù„Ø¹Ø´ Ø¨Ø±Ù‡ */
}

/* ================= Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ) ================= */
.sidebar-profile-header {
    position: relative;
    flex-shrink: 0;
    padding: 60px 20px 40px; /* ÙƒØ¨Ø±Ù†Ø§ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¹Ø´Ø§Ù† Ø§Ù„ØªØµÙ…ÙŠÙ… ÙŠØ¨Ø§Ù† */
    text-align: center;
    display: flex; flex-direction: column; align-items: center;
    
    /* 2. Ø®Ù„ÙÙŠØ© Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„: ØªØ¯Ø±Ø¬ Ù…ÙˆÙ ØºØ§Ù…Ù‚ */
    background: linear-gradient(180deg, #2e1065 0%, #0f0c15 100%);
    
    /* Ø®Ø· ÙØ§ØµÙ„ Ù†Ø§Ø¹Ù… ØªØ­ØªÙ‡Ø§ */
    border-bottom: 1px solid rgba(255, 215, 0, 0.1);
}

/* 3. Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© (Mesh) - Ø¯ÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù„ÙŠ Ø¨ØªØ¹Ù…Ù„ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ */
.sidebar-profile-header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    
    /* Ø±Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ø¨Ø§Ù„ÙƒÙˆØ¯ */
    background-image: 
        repeating-linear-gradient(45deg, rgba(255, 215, 0, 0.05) 0px, rgba(255, 215, 0, 0.05) 1px, transparent 1px, transparent 10px),
        repeating-linear-gradient(-45deg, rgba(255, 215, 0, 0.05) 0px, rgba(255, 215, 0, 0.05) 1px, transparent 1px, transparent 10px);
    
    /* Ø§Ù„ØªØ±ÙŠÙƒ Ù‡Ù†Ø§: Ø¨Ù†Ø®Ù„ÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© ØªØ®ØªÙÙŠ Ø¨Ø§Ù„ØªØ¯Ø±ÙŠØ¬ Ù…Ù† ØªØ­Øª (Fade Out) */
    mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
    
    z-index: 0; /* Ø¹Ø´Ø§Ù† ØªÙƒÙˆÙ† ÙˆØ±Ø§ Ø§Ù„ÙƒÙ„Ø§Ù… */
}
.sidebar-avatar-container {
    width: 90px; 
    height: 90px; 
    border-radius: 50%;
    
    /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø®Ù„ÙŠØª Ø§Ù„Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ ØµØ±ÙŠØ­ */
    border: 3px solid #FFD700; 
    
    /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø®Ù„ÙŠØª Ø§Ù„Ù†ÙˆØ± (Ø§Ù„ÙˆÙ‡Ø¬) Ø§Ù„Ù„ÙŠ Ø­ÙˆØ§Ù„ÙŠÙ‡Ø§ Ø°Ù‡Ø¨ÙŠ Ø¨Ø±Ø¶Ù‡ */
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
    
    margin-bottom: 15px; 
    background-size: cover; 
    background-position: center;
    background-color: #222;
    position: relative; 
    z-index: 1;
}


/* ================= Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (ØªØ­Øª) ================= */
.sidebar-scroll-area {
    /* ØªØ¯Ø±Ø¬ Ø®ÙÙŠÙ ØªØ­Øª Ø¨ÙŠÙƒÙ…Ù„ Ø§Ù„Ø´ÙƒÙ„ */
    background: linear-gradient(180deg, rgba(15, 12, 21, 0) 0%, rgba(139, 92, 246, 0.05) 100%);
}

/* ================= ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ø´Ø§Ù† ØªÙ„ÙŠÙ‚ ================= */
.sidebar-item {
    margin: 5px 15px;
    border-radius: 10px;
}
/* Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„ ØªØ­Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± */
.sidebar-item::after {
    background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
}

/* ================= Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ================= */
.sidebar-item {
    position: relative;
    padding: 16px 20px; 
    display: flex; 
    align-items: center; 
    gap: 15px;
    font-size: 15px; 
    font-weight: 700; 
    color: #e0e0e0; 
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 5px 15px; /* Ù…Ø³Ø§ÙØ© Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø§Ù„ÙƒÙŠØ±Ù */
    border-radius: 10px;
    overflow: hidden;
}

/* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
.sidebar-item i { 
    width: 30px; 
    text-align: center; 
    font-size: 20px; 
    color: #FFD700; /* Ø°Ù‡Ø¨ÙŠ */
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.4); /* ØªÙˆÙ‡Ø¬ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    transition: 0.3s;
}

/* ================= Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„ (Ø§Ù„Ù†ÙˆØ±) ================= */
/* Ø¯Ù‡ Ø§Ù„Ø®Ø· Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ¸Ù‡Ø± ØªØ­Øª ÙƒÙ„ Ø¹Ù†ØµØ± */
.sidebar-item::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 15%;
    width: 70%;
    height: 1px;
    /* ØªØ¯Ø±Ø¬ Ø°Ù‡Ø¨ÙŠ ÙˆÙ…ÙˆÙ */
    background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.5), rgba(255, 215, 0, 0.5), rgba(139, 92, 246, 0.5), transparent);
    opacity: 0.4;
}
/* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø· Ù…Ù† Ø¢Ø®Ø± Ø¹Ù†ØµØ± */
.sidebar-item:last-child::after { display: none; }

/* ================= ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© (Hover) ================= */
.sidebar-item:hover {
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.05), transparent); /* Ù„Ù…Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ© Ø®ÙÙŠÙØ© */
    transform: translateX(-5px);
    color: #fff;
}

.sidebar-item:hover i {
    transform: scale(1.1);
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
}

.sidebar-item:active {
    transform: scale(0.98);
}
/* ================= Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… Ø§Ù„Ù…Ø¯Ù…Ø¬ (Compact Floating Header) ================= */

.main-header {
    /* 1. Ø§Ù„Ù…ÙƒØ§Ù† */
    position: sticky;
    top: 8px; /* Ù‚Ø±Ø¨Ù†Ø§Ù‡ Ù…Ù† Ø³Ù‚Ù Ø§Ù„Ø´Ø§Ø´Ø© Ø´ÙˆÙŠØ© */
    z-index: 1000;
    
    /* 2. Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (ØµØºØ±Ù†Ø§Ù‡Ø§) */
    width: 94%; /* Ø¹Ø±Ø¶ Ù…Ù†Ø§Ø³Ø¨ */
    height: 55px; /* Ø­ÙƒÙ…Ù†Ø§ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¹Ø´Ø§Ù† Ù…Ø§ÙŠÙØ±Ø´Ø´ */
    margin: 0 auto 15px auto; /* Ù…Ø³Ø§ÙØ© 15 Ø¨ÙƒØ³Ù„ Ù…Ù† ØªØ­Øª Ø¹Ø´Ø§Ù† ÙŠØ¨Ø¹Ø¯ Ø¹Ù† Ø§Ù„Ø³ÙŠØ±Ø´ */
    padding: 0 15px; /* Ù„ØºÙŠÙ†Ø§ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ ÙÙˆÙ‚ ÙˆØªØ­Øª Ø¹Ø´Ø§Ù† Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙŠØ¸Ø¨Ø· */
    
    /* 3. Ø§Ù„Ø´ÙƒÙ„ */
    border-radius: 20px; /* ÙƒÙŠØ±Ù Ø£Ù†Ø¹Ù… ÙˆØ£ØµØºØ± */
    
    /* 4. Ø§Ù„Ø®Ù„ÙÙŠØ© */
    background: rgba(20, 20, 25, 0.85); /* Ø²ÙˆØ¯Ù†Ø§ Ø§Ù„ØªØ¹ØªÙŠÙ… Ø³ÙÙ†Ø© Ù„Ù„ÙˆØ¶ÙˆØ­ */
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    
    /* 5. Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„Ø¥Ø¶Ø§Ø¡Ø© */
    border: 1px solid rgba(255, 215, 0, 0.1);
    border-bottom: 2px solid rgba(139, 92, 246, 0.3);
    
    /* 6. Ø§Ù„Ø¸Ù„ */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
}
/* ================= Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ø§Ø¦Ù… (Royal Floating Button) ================= */

.floating-fab {
    /* 1. Ø§Ù„Ù…ÙƒØ§Ù†: Ø¹Ø§Ø¦Ù… Ø£Ø³ÙÙ„ Ø§Ù„ÙŠØ³Ø§Ø± */
    position: fixed;
    bottom: 30px;
    left: 25px;
    z-index: 9000; /* Ø·Ø¨Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø¹Ø´Ø§Ù† ÙŠØ¸Ù‡Ø± ÙÙˆÙ‚ Ø§Ù„Ø´Ø§Øª */
    
    /* 2. Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ø´ÙƒÙ„ */
    width: 60px;
    height: 60px;
    border-radius: 50%; /* Ø¯Ø§Ø¦Ø±ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹ */
    
    /* 3. Ø§Ù„Ù„ÙˆÙ†: ØªØ¯Ø±Ø¬ Ø°Ù‡Ø¨ÙŠ Ù…Ù„ÙƒÙŠ */
    background: linear-gradient(135deg, #FFD700 0%, #d4af37 100%);
    
    /* 4. Ø§Ù„Ø¸Ù„ ÙˆØ§Ù„Ø¥Ø¶Ø§Ø¡Ø© (Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø¹Ø§ÙŠÙ… 3D) */
    box-shadow: 
        0 10px 20px rgba(0,0,0,0.4), /* Ø¸Ù„ Ø¹Ù…ÙŠÙ‚ ØªØ­Øª */
        0 0 15px rgba(255, 215, 0, 0.3), /* ØªÙˆÙ‡Ø¬ Ø°Ù‡Ø¨ÙŠ */
        inset 0 2px 0 rgba(255,255,255,0.3); /* Ù„Ù…Ø¹Ø© Ø¥Ø¶Ø§Ø¡Ø© Ù…Ù† ÙÙˆÙ‚ */
    
    /* 5. Ø­Ø¯ÙˆØ¯ Ø±ÙÙŠØ¹Ø© */
    border: 1px solid rgba(255, 215, 0, 0.5);
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¬ÙˆÙ‡ */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    
    /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¨Ø³ÙŠØ· ÙŠÙ„ÙØª Ø§Ù„Ù†Ø¸Ø± */
    animation: floatBreathing 3s ease-in-out infinite;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ù„Ù… (Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©) */
.floating-fab i {
    font-size: 24px;
    color: #1a1a1a; /* Ù„ÙˆÙ† ØºØ§Ù…Ù‚ Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø¹Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
    transform: rotate(0deg);
    transition: 0.3s;
}

/* 6. ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· (Active) */
.floating-fab:active {
    transform: scale(0.9); /* ÙŠØµØºØ± Ø³Ù†Ø© */
    box-shadow: 0 5px 10px rgba(0,0,0,0.3);
}

.floating-fab:active i {
    transform: rotate(-15deg); /* Ø§Ù„Ù‚Ù„Ù… ÙŠÙ…ÙŠÙ„ Ù„Ù…Ø§ ØªØ¶ØºØ· */
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ù‡Ø§Ø¯ÙŠ */
@keyframes floatBreathing {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); } /* ÙŠØ·Ù„Ø¹ ÙˆÙŠÙ†Ø²Ù„ Ø¨Ø¨Ø·Ø¡ */
}

/* ØªØµÙ…ÙŠÙ… Ø´Ø§Ø´Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯ (Pop-up) */
#incomingCallModal {
    display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 99999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.caller-avatar-large {
    width: 120px; height: 120px;
    border-radius: 50%;
    border: 3px solid #8b5cf6;
    background-size: cover; background-position: center;
    margin-bottom: 20px;
    box-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
    animation: pulseAvatar 2s infinite;
}

.caller-name-display {
    font-size: 24px; font-weight: bold; color: white; margin-bottom: 50px;
    text-shadow: 0 2px 5px rgba(0,0,0,0.5);
}

.call-actions {
    display: flex; gap: 40px;
}

.call-btn {
    width: 60px; height: 60px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; color: white; cursor: pointer;
    transition: transform 0.2s;
}
.call-btn:active { transform: scale(0.9); }
.btn-accept { background: #22c55e; box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
.btn-decline { background: #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); }

@keyframes pulseAvatar {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
    70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(139, 92, 246, 0); }
    100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
}
/* ØªØµÙ…ÙŠÙ… Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© */
.global-call-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: 999999; /* Ø±Ù‚Ù… Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ Ù„ØªØ¸Ù‡Ø± ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡ */
    display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
}

.global-call-card {
    background: #1e293b;
    padding: 40px;
    border-radius: 30px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 50px rgba(0, 229, 255, 0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 90%;
    max-width: 350px;
}

.g-avatar {
    width: 100px; height: 100px;
    border-radius: 50%;
    background-size: cover; background-position: center;
    border: 3px solid #00e5ff;
    box-shadow: 0 0 20px rgba(0, 229, 255, 0.4);
    margin-bottom: 20px;
    animation: pulseRing 1.5s infinite;
}

.g-info h3 { color: #fff; margin: 0 0 5px 0; font-size: 22px; }
.g-info span { color: #94a3b8; font-size: 14px; }

.g-actions {
    display: flex; gap: 40px; margin-top: 40px;
}

.g-btn {
    width: 60px; height: 60px;
    border-radius: 50%; border: none;
    font-size: 24px; color: #fff;
    cursor: pointer; display: grid; place-items: center;
    transition: 0.2s;
}
.g-btn.reject { background: #ff3b30; box-shadow: 0 5px 15px rgba(255, 59, 48, 0.4); }
.g-btn.accept { background: #10b981; box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4); animation: shake 1.2s infinite; }

@keyframes pulseRing { 0% { box-shadow: 0 0 0 0 rgba(0, 229, 255, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(0, 229, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 229, 255, 0); } }


    </style>
</head>

<body>
    <audio id="notificationSound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3" preload="auto"></audio>

    <header class="main-header">
        <div id="menuBtn" class="icon-btn" onclick="vibrate(); toggleSidebar()">
            <i class="fa-solid fa-bars-staggered"></i>
        </div>
        <div id="backBtn" class="icon-btn" onclick="vibrate(); showSection('inbox')" style="display: none;">
            <i class="fa-solid fa-arrow-right"></i>
        </div>
<div id="headerTitle" class="header-title luxury-logo-container">
    <span class="gold-text">Wareed</span>
    <i class="fa-solid fa-heart-pulse miracle-heart"></i>
    <span class="gold-text">chat</span>
</div>

        <div id="headerIcons" class="header-icons">
            <div class="icon-btn" onclick="vibrate(); location.href='home.html'">
                <i class="fa-solid fa-house"></i>
            </div>
        </div>
    </header>

    <div id="searchContainer" class="search-wrapper">
        <div class="search-input-box">
            <i class="fa-solid fa-magnifying-glass search-icon-inside"></i>
            <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª..." oninput="searchChats(this.value)">
        </div>
    </div>

    <div id="storiesContainer" class="stories-section" style="display:none;">
        <div class="stories-title">Ø§Ù„Ù‚ØµØµ</div>
        <div class="stories-scroll" id="storiesList">
        </div>
    </div>
    
   
    <div id="storyViewer">
        <div class="story-blur-bg" id="storyBlurBg"></div>
        
        <div class="progress-bars-wrapper" id="storyBarsContainer"></div>

        <div class="story-header-info">
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fa-solid fa-xmark" onclick="closeStory()" style="color:#fff; font-size:24px; cursor:pointer; text-shadow:0 2px 5px #000; padding:10px; z-index:50;"></i>
                
                                      <div style="display: flex; align-items: center; gap: 8px; cursor: pointer;" onclick="viewUserProfileFromStory()">
                <div id="storyUserAvatarSmall" class="story-user-avatar-small"></div>
                <div class="story-user-details">
                    <div id="storyViewerName" style="color:#fff; font-weight:bold; text-shadow:0 2px 5px #000; font-size: 14px; display:flex; align-items:center;">User</div>
                    <div id="storyTimeAgo" style="color:#ddd; font-size:11px; text-shadow:0 1px 3px #000;">Ù…Ù†Ø° Ø¯Ù‚ÙŠÙ‚Ø©</div>
                </div>
            </div>

            </div>
            
            <div style="display:flex; align-items:center; gap: 5px;">
                <div id="storyViewsCount" class="story-views-count" style="display:none; margin-left: 10px;"></div>
                
                <i id="storyMuteBtn" class="fa-solid fa-volume-high" onclick="toggleStoryMute(this)" style="color:#fff; font-size:18px; cursor:pointer; text-shadow:0 2px 5px #000; padding:10px; display:none; z-index:50;"></i>
                
                <div class="story-more-btn" onclick="openStoryOptions(event)">
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </div>
            </div>
        </div>

        <div class="story-media-container" id="storyContent"></div>

               <div id="storyFooter" class="story-footer" onclick="event.stopPropagation()">
            <div class="story-reply-input">
                <input type="text" id="storyReplyInput" placeholder="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©..." enterkeyhint="send" onfocus="pauseForInput()" onblur="resumeFromInput()">
                
                <i class="fa-solid fa-paper-plane send-btn-inside" onclick="sendStoryReply()"></i>
            </div>
            
            <div class="story-reaction-btn" onclick="sendQuickReaction('â¤ï¸')">â¤ï¸</div>
            <div class="story-reaction-btn" onclick="sendQuickReaction('ğŸ”¥')">ğŸ”¥</div>
            <div class="story-reaction-btn" onclick="sendQuickReaction('ğŸ˜‚')">ğŸ˜‚</div>
        </div>


        <div id="floatingHearts" style="position: absolute; bottom: 0; right: 20px; width: 50px; height: 100%; pointer-events: none; z-index: 25; overflow: hidden;"></div>
    </div>

    
    <div class="story-sheet-overlay" id="storyOptionsOverlay" onclick="closeStoryOptions()"></div>
    <div class="story-options-sheet" id="storyOptionsSheet">
        <div class="sheet-handle" style="margin-bottom:15px;"></div>
        <div id="storyDynamicOptions"></div>
        <div class="story-opt-item" onclick="downloadStoryMedia()">
            <i class="fa-solid fa-download"></i> Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¬Ù‡Ø§Ø²
        </div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
   <div class="sidebar" id="sidebar">
    <div class="sidebar-profile-header">
        <div id="profileAvatarContainer" class="sidebar-avatar-container"></div>
        <div id="myNameTxt" class="sidebar-my-name">...</div>
        <div class="sidebar-my-status" style="color:#aaa; font-size:12px; margin-top:5px;">NAPD Messenger Pro</div>
    </div>
    
    <div class="sidebar-scroll-area">
        
        <div class="sidebar-item" onclick="vibrate(); toggleMyActivity()">
            <i class="fa-solid fa-ghost"></i> 
            <span id="activityText">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø·: Ø¸Ø§Ù‡Ø±</span>
            <div id="activityDot" style="width:12px; height:12px; border-radius:50%; background:#4ade80; margin-right:auto;"></div>
        </div>

        <div class="sidebar-item" onclick="vibrate(); showSection('inbox')">
            <i class="fa-solid fa-comments"></i> Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª
        </div>
        
        <div class="sidebar-item" onclick="vibrate(); showSection('archive')">
            <i class="fa-solid fa-box-archive"></i> Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        </div>
        
        <div class="sidebar-item" onclick="vibrate(); showSection('requests')">
            <i class="fa-solid fa-envelope-open-text"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        </div>
        
        <div class="sidebar-item" onclick="vibrate(); showSection('friends')">
            <i class="fa-solid fa-user-group"></i> Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
        </div>
        
        <div class="sidebar-item" onclick="vibrate(); location.href='blocked.html'" style="color: #ff7777;">
            <i class="fa-solid fa-ban" style="color: #ff7777;"></i> Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†
        </div>

        <div style="height: 1px; background: rgba(255,255,255,0.05); margin: 10px 20px;"></div>

        <div class="sidebar-item" onclick="vibrate(); openAccountSwitcher()">
            <i class="fa-solid fa-users-gear" style="color: var(--verify-color);"></i> 
            ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
        </div>

    </div>
</div>
    
    

    <div class="bottom-sheet-overlay" id="optionsModal" onclick="closeOptions()">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <div class="sheet-handle"></div>
            <div style="text-align:center; margin-bottom:20px;">
                <div id="sheetAvatar" style="width:70px; height:70px; border-radius:50%; margin:0 auto 10px auto; background-size:cover; border:2px solid var(--accent-color);"></div>
                <h3 id="sheetName" style="color:#fff;">User</h3>
            </div>
            
            
            <div class="sheet-action group-create" onclick="vibrate(); createGroupAction()">
                <i class="fa-solid fa-users"></i> <span>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©</span>
            </div>
            <div class="sheet-action" onclick="vibrate(); togglePinAction()">
                <i class="fa-solid fa-thumbtack"></i> <span id="pinText">ØªØ«Ø¨ÙŠØª</span>
            </div>
            <div class="sheet-action" onclick="vibrate(); toggleReadAction()">
                <i class="fa-solid fa-circle-check"></i> <span id="markReadText">Ù‚Ø±Ø§Ø¡Ø©</span>
            </div>
            <div class="sheet-action" onclick="vibrate(); toggleMuteAction()">
                <i class="fa-solid fa-bell-slash"></i> <span id="muteText">ÙƒØªÙ…</span>
            </div>
            <div class="sheet-action" onclick="vibrate(); archiveChatAction()">
                <i class="fa-solid fa-box-archive"></i> <span id="archiveText">Ø£Ø±Ø´ÙØ©</span>
            </div>
            <div class="sheet-action danger" onclick="vibrate(); deleteChatAction()">
                <i class="fa-solid fa-trash"></i> <span>Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span>
            </div>
        </div>
    </div>

    <div id="toast"><i class="fa-solid fa-info-circle"></i> <span>ØªÙ… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!</span></div>
<div id="listTitleContainer" style="padding: 10px 25px; display:flex; align-items:center;">
    <span id="listTitleText" style="font-size: 18px; font-weight: 800; color: #fff;">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª</span>
</div>


    <div id="list" style="padding-bottom: 20px;"></div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <script>
        moment.locale('ar');
        
        // 1. Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDpvqNAReChsHn5tFJSp7vV_EJHmtD2x4c", 
            authDomain: "pools-e4381.firebaseapp.com",
            projectId: "pools-e4381",
            storageBucket: "pools-e4381.firebasestorage.app"
        };

        // 2. Initialize App
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

        // 3. Define Services
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // 4. Global Variables
        window.isOnlineFeatureEnabled = localStorage.getItem('nabd_online_status') !== 'false';
        const defaultAvatar = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
        
        let currentUser = null;
        let usersCache = {}; 
        let friendUids = new Set();
        let allChats = [];
        let currentView = 'inbox'; 
        let myActivityVisible = true; 
        let selectedChatId = null;
        let selectedChatData = null;
        
        // --- Story System Global Variables ---
        let isStoryMuted = false;
        let storyGroups = []; 
        let currentGroupIndex = 0; 
        let currentStoryIndex = 0; 
        let storyTimer = null;
        let isStoryPaused = false;
        let storyDuration = 5000;
let areGesturesSetup = false; 

        const notificationAudio = document.getElementById('notificationSound');

        // --- Helper Functions ---
        function vibrate() { if(navigator.vibrate) navigator.vibrate(10); }

        function showToast(msg) { 
            const t = document.getElementById('toast'); 
            t.querySelector('span').innerText = msg; 
            t.classList.add('show'); 
            setTimeout(() => t.classList.remove('show'), 2000); 
        }

function initApp() {
    // 1. Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙˆØ±Ø§Ù‹
    const cachedChats = sessionStorage.getItem('cached_allChats');
    const savedScroll = sessionStorage.getItem('scrollPos');

    if (cachedChats) {
        try { 
            // Ù„Ùˆ ÙÙŠÙ‡ ÙƒØ§Ø´ØŒ Ø§Ø¹Ø±Ø¶Ù‡ ÙÙˆØ±Ø§Ù‹
            allChats = JSON.parse(cachedChats); 
            renderList(); 
            
            // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…ÙƒØ§Ù† Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ (Ø¹Ø´Ø§Ù† ÙŠØ±Ø¬Ø¹Ùƒ Ù„Ù†ÙØ³ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù„ÙŠ ÙƒÙ†Øª ÙÙŠÙ‡)
            if(savedScroll) {
                setTimeout(() => window.scrollTo(0, parseInt(savedScroll)), 0);
            }
        } catch(e) {
            console.error("Cache Error", e);
        }
    } else {
        // Ù„Ùˆ Ù…ÙÙŠØ´ ÙƒØ§Ø´ Ø¨Ø³ (Ø£ÙˆÙ„ Ù…Ø±Ø© ÙŠÙØªØ­)ØŒ Ø§Ø¸Ù‡Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        showSkeletonLoading(); 
    }
    
    // 2. Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Ø§Ù„Ø¬Ø¯ÙŠØ¯)
    const cachedStories = sessionStorage.getItem('cached_stories_data');
    if (cachedStories) {
        try {
            const storiesData = JSON.parse(cachedStories);
            // Ø¨Ù†Ù†Ø§Ø¯ÙŠ Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ù… Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ø´
            buildStoriesDOM(storiesData); 
        } catch(e) {}
    }

    // 3. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ø¹Ø´Ø§Ù† ÙŠØ¬ÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©)
    auth.onAuthStateChanged(user => {
        if(!user){ location.href = "index.html"; return; }
        currentUser = user;
        
        db.collection('users').doc(user.uid).get().then(doc => {
            if(doc.exists) {
                const d = doc.data();
                myActivityVisible = d.showActivity !== false;
                updateSidebarProfile(d);
                updateActivityUI();
            }
            loadFriendsList(user.uid);
            monitorIncomingMessages(user.uid); 
            loadChats(user.uid); 
            startPresenceSystem(); 
            // Ø´ØºÙ„Ù†Ø§ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù‚ØµØµ Ù‡Ù†Ø§
            renderStories(); 
            
        });
    });
}

        
        function showSkeletonLoading() {
            const list = document.getElementById("list");
            let html = "";
            for(let i=0; i<5; i++) html += `
                <div class="chat" style="pointer-events:none; margin:10px 10px;">
                    <div class="skeleton" style="width:58px; height:58px; border-radius:18px;"></div>
                    <div style="width:100%; display:flex; flex-direction:column; gap:8px;">
                        <div class="skeleton" style="width:40%; height:15px;"></div>
                        <div class="skeleton" style="width:70%; height:12px;"></div>
                    </div>
                </div>`;
            list.innerHTML = html;
        }

        function updateSidebarProfile(data) {
    // 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
    const userAuthPhoto = currentUser.photoURL;
    const dbPhoto = data.profilePic || data.avatarUrl || data.image; 
    const finalAvatar = dbPhoto || userAuthPhoto || defaultAvatar;

    document.getElementById('profileAvatarContainer').style.backgroundImage = `url('${finalAvatar}')`;
    
    // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ­Ø¬Ù… Ø§Ù„Ø®Ø· (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
    let nameText = data.name || currentUser.displayName || "Ù…Ø³ØªØ®Ø¯Ù…";
    const nameEl = document.getElementById('myNameTxt');

    // Ù…Ø¹Ø§Ø¯Ù„Ø© ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·ÙˆÙ„ Ø§Ù„Ø§Ø³Ù…
    if (nameText.length > 25) {
        nameEl.style.fontSize = "15px"; // Ø®Ø· ØµØºÙŠØ± Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹
    } else if (nameText.length > 15) {
        nameEl.style.fontSize = "18px"; // Ø®Ø· Ù…ØªÙˆØ³Ø·
    } else {
        nameEl.style.fontSize = "22px"; // Ø®Ø· ÙƒØ¨ÙŠØ± Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚ØµÙŠØ±Ø©
    }

    // 3. Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¥Ù† ÙˆØ¬Ø¯Øª
    let finalHTML = nameText;
    if(data.isVerified) {
        // Ø¬Ø¹Ù„Ù†Ø§ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¬Ø§Ù…
        finalHTML += ` <i class="fa-solid fa-circle-check" style="color:#38bdf8; font-size: 0.9em;"></i>`;
    }
    
    nameEl.innerHTML = finalHTML;
}

// Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„Ù‚ØµØµ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© (Ù…Ù†ÙØµÙ„Ø© Ø¹Ø´Ø§Ù† Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„ÙƒØ§Ø´ ÙˆØ§Ù„Ù†Øª)
function drawStoriesUI(groups) {
    const list = document.getElementById('storiesList');
    list.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

    // 1. ÙƒØ§Ø±Øª "Ù‚ØµØªÙƒ" (Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©) - Ø¯Ø§ÙŠÙ…Ø§Ù‹ Ø«Ø§Ø¨Øª ÙÙŠ Ø§Ù„Ø£ÙˆÙ„
    // Ø¨Ù†Ø¬ÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø£Ùˆ Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
    const myAvatar = currentUser.photoURL || defaultAvatar;
    
    const myCard = document.createElement('div');
    myCard.className = 'story-card my-story-card';
    myCard.innerHTML = `
        <div class="my-story-top-img" style="background-image: url('${myAvatar}');"></div>
        <div class="my-story-bottom">
            <div class="add-story-btn-circle"><i class="fa-solid fa-plus"></i></div>
            <div style="font-size:12px; font-weight:bold; color:#fff;">Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ©</div>
        </div>
    `;
    myCard.onclick = () => { window.location.href = 'add_story.html'; };
    list.appendChild(myCard);

    // 2. Ø±Ø³Ù… Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚ØµØµ (Ø³ÙˆØ§Ø¡ Ø¨ØªØ§Ø¹ØªÙŠ Ø£Ùˆ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡)
    groups.forEach((group, index) => {
        // Ù„Ùˆ Ø§Ù„Ø¬Ø±ÙˆØ¨ Ø¯Ù‡ Ù‡Ùˆ "Ù‚ØµØªÙƒ" (Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙŠ) ÙˆÙ„Ù‡Ø§ Ø´ÙƒÙ„ Ù…Ù…ÙŠØ²
        const isMe = group.user.uid === currentUser.uid;
        
        // Ø¢Ø®Ø± Ù‚ØµØ© ÙÙŠ Ø§Ù„Ø¬Ø±ÙˆØ¨ (Ø¹Ø´Ø§Ù† Ø§Ù„ØºÙ„Ø§Ù)
        const lastStory = group.stories[group.stories.length - 1];
        
        // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø¥Ø·Ø§Ø± (Ø£Ø²Ø±Ù‚ Ù„Ùˆ Ø´ÙˆÙØªÙ‡Ø§ØŒ Ù…Ù„ÙˆÙ† Ù„Ùˆ Ù„Ø³Ù‡)
        // Ø¨Ù†Ø´ÙŠÙƒ Ù„Ùˆ ÙÙŠÙ‡ Ù‚ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ø§Ù„Ø£Ù‚Ù„ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
        const hasUnseen = group.stories.some(s => !s.viewers || !s.viewers.includes(currentUser.uid));
        const borderCol = (isMe) ? '#ddd' : (hasUnseen ? 'var(--accent-color)' : '#555');

        // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ ØµÙˆØ±Ø©)
        // Ø¨Ù†Ø­Ø· poster Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ Ø¨Ù†Ø®ÙÙŠ Ø§Ù„ØµÙˆØª Ø¹Ø´Ø§Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
        let contentHTML = lastStory.type === 'video' 
            ? `<video src="${lastStory.url}#t=0.1" class="story-card-bg" style="object-fit:cover;" muted preload="metadata"></video>`
            : `<div class="story-card-bg" style="background-image:url('${lastStory.url}'); background-size:cover; background-position:center;"></div>`;

        // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚
        let displayNameHTML = isMe ? "Ù‚ØµØªÙƒ" : group.user.name;
        if (!isMe && group.user.isVerified) displayNameHTML += ` <i class="fa-solid fa-circle-check" style="color:#38bdf8; font-size:10px; vertical-align: middle;"></i>`;

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒØ§Ø±Øª
        const item = document.createElement('div');
        item.className = 'story-card';
        item.onclick = () => openStoryViewer(index); // Ø§Ù„Ø§Ù†Ø¯ÙƒØ³ Ù‡Ù†Ø§ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©

        item.innerHTML = `
            <div class="story-card-avatar" style="background-image:url('${group.user.avatar}'); border-color:${borderCol}"></div>
            ${contentHTML}
            <div class="story-card-name">${displayNameHTML}</div>`;
        
        list.appendChild(item);
    });
}


        // 4. Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØµ (Ù†Ø¸Ø§Ù… ÙƒØ±ÙˆØª ÙÙŠØ³Ø¨ÙˆÙƒ)
                // 4. Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØµ (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØµÙˆØ± ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØ«ÙŠÙ‚)
        function renderStories() {
    const list = document.getElementById('storiesList');
    const container = document.getElementById('storiesContainer');
    const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);

    if(currentView === 'inbox') container.style.display = 'block';

    db.collection('stories')
    .where('timestamp', '>', twentyFourHoursAgo)
    .orderBy('timestamp', 'asc')
    .onSnapshot(async snapshot => {
        const storiesMap = {};

        snapshot.docs.forEach(doc => {
            const d = doc.data();
            if(!storiesMap[d.uid]) storiesMap[d.uid] = [];
            storiesMap[d.uid].push({ id: doc.id, ...d });
    
        });

        // Ø­ÙØ¸ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø³Ù… Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø¶ÙŠØ§Ø¹ Ù…ÙƒØ§Ù†Ùƒ ÙÙŠ Ø§Ù„Ù‚ØµØ©
        const isViewerOpen = document.getElementById('storyViewer').style.display === 'flex';

        list.innerHTML = ''; 
        storyGroups = [];
    // Ø¶ÙŠÙ Ø¯Ù‡ ÙÙŠ Ø§Ù„Ø£ÙˆÙ„ Ø¹Ø´Ø§Ù† ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙÙˆØ±Ø§Ù‹
    const cachedStories = sessionStorage.getItem('my_cached_stories');
    if (cachedStories) {
        // Ù‡Ù†Ø§ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø¹Ù†Ø¯Ùƒ ÙƒÙˆØ¯ Ø§Ù„Ø±Ø³Ù… Ø£Ùˆ ØªÙ†Ø§Ø¯ÙŠ Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ù… Ù„Ùˆ Ø¹Ø§Ù…Ù„Ù‡Ø§
        // Ù„Ùˆ Ù…Ø´ Ø¹Ø§Ù…Ù„ Ø¯Ø§Ù„Ø© Ø±Ø³Ù…ØŒ Ø­Ø· ÙƒÙˆØ¯ Ø§Ù„Ù€ innerHTML ÙˆØ§Ù„Ù„ÙˆØ¨ Ù‡Ù†Ø§
    }

        // ==========================================
        // 1. ÙƒØ§Ø±Øª "Ù‚ØµØªÙƒ" (Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ)
        // ==========================================
                const myStories = storiesMap[currentUser.uid] || [];
        
        let myData = usersCache[currentUser.uid];
        if(!myData) myData = await fetchAndCacheUser(currentUser.uid);

        const myUserObj = { 
            uid: currentUser.uid, 
            name: 'Ù‚ØµØªÙƒ', 
            avatar: myData.avatar || currentUser.photoURL || defaultAvatar,
            isVerified: myData.isVerified 
        };
        
        // Ø¯ÙŠ Ù…Ù‡Ù…Ø© Ø¹Ø´Ø§Ù† Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ù‚ØµØµ ØªÙ‚Ø¯Ø± ØªÙØªØ­Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¹Ø§Ø±Ø¶
        if (myStories.length > 0) {
            storyGroups.push({ user: myUserObj, stories: myStories });
        }

        // ==========================================
        // ÙƒØ§Ø±Øª "Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ©" (Ø§Ù„Ø²Ø±Ø§Ø±)
        // ==========================================
        const myCard = document.createElement('div');
        myCard.className = 'story-card my-story-card';
        
        let myProfilePic = myUserObj.avatar;
        
        // ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§: Ø´ÙŠÙ„Ù†Ø§ Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        myCard.innerHTML = `
            <div class="my-story-top-img" style="background-image: url('${myProfilePic}');"></div>
            <div class="my-story-bottom">
                <div class="add-story-btn-circle"><i class="fa-solid fa-plus"></i></div>
                <div style="font-size:12px; font-weight:bold; color:#fff;">Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ©</div>
            </div>
        `;
        
        // ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ğŸ”¥
        myCard.onclick = () => { 
            window.location.href = 'add_story.html'; 
        };
        
        list.appendChild(myCard);

        // ==========================================
        // ÙƒØ§Ø±Øª "Ù…Ø´Ø§Ù‡Ø¯Ø© Ù‚ØµØªÙƒ" (Ù„Ùˆ Ù†Ø´Ø±Øª Ø­Ø§Ø¬Ø© Ø¨Ø§Ù„ÙØ¹Ù„)
        // ==========================================
        if (myStories.length > 0) {
            const myViewCard = document.createElement('div');
            myViewCard.className = 'story-card';
            const lastStory = myStories[myStories.length - 1];
            
            let bgContent = lastStory.type === 'video' 
                ? `<video src="${lastStory.url}" class="story-card-bg" style="object-fit:cover;" muted></video>`
                : `<div class="story-card-bg" style="background-image:url('${lastStory.url}'); background-size:cover; background-position:center;"></div>`;

            let myDisplayName = "Ù‚ØµØªÙƒ";
            myViewCard.innerHTML = `
                <div class="story-card-avatar" style="background-image:url('${myProfilePic}'); border-color: #ddd;"></div>
                ${bgContent}
                <div class="story-card-name">${myDisplayName}</div>
            `;
            
            // Ù†Ø³ØªØ®Ø¯Ù… 0 Ù„Ø£Ù† Ù‚ØµØªÙŠ (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©) Ø¯Ø§ÙŠÙ…Ø§Ù‹ Ø¨ØªÙƒÙˆÙ† Ø£ÙˆÙ„ Ø¬Ø±ÙˆØ¨ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            myViewCard.onclick = () => openStoryViewer(0); 
            list.appendChild(myViewCard);
        }

        // ==========================================
        // 2. Ù‚ØµØµ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
        // ==========================================
        const otherUids = Object.keys(storiesMap).filter(uid => uid !== currentUser.uid);
        
        for (const uid of otherUids) {
            let u = usersCache[uid];
            if(!u) u = await fetchAndCacheUser(uid);
            
            storyGroups.push({ user: u, stories: storiesMap[uid] });
            // Ù†Ø­ØªÙØ¸ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø¥Ù†Ø¯ÙƒØ³
            const thisGroupIndex = storyGroups.length - 1;
            
            const userStories = storiesMap[uid];
            const lastStory = userStories[userStories.length - 1]; 
            const hasUnseen = userStories.some(s => !s.viewers || !s.viewers.includes(currentUser.uid));
            const borderCol = hasUnseen ? 'var(--accent-color)' : '#555';

            const item = document.createElement('div');
            item.className = 'story-card';
            item.onclick = () => openStoryViewer(thisGroupIndex);
            
            // Ù„Ø§Ø­Ø¸ Ø¥Ø¶Ø§ÙØ© #t=0.1 ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ¥Ø¶Ø§ÙØ© preload="metadata"
let contentHTML = lastStory.type === 'video' 
    ? `<video src="${lastStory.url}#t=0.1" class="story-card-bg" style="object-fit:cover;" muted preload="metadata"></video>`
    : `<div class="story-card-bg" style="background-image:url('${lastStory.url}'); background-size:cover; background-position:center;"></div>`;


            let displayNameHTML = u.name;
            if (u.isVerified) displayNameHTML += ` <i class="fa-solid fa-circle-check" style="color:#38bdf8; font-size:10px; vertical-align: middle;"></i>`;

            item.innerHTML = `
                <div class="story-card-avatar" style="background-image:url('${u.avatar}'); border-color:${borderCol}"></div>
                ${contentHTML}
                <div class="story-card-name">${displayNameHTML}</div>`;
            
            list.appendChild(item);
        }

        // ğŸ”¥ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø³Ø­Ø±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ”¥
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ Ù…ÙØªÙˆØ­Ø§Ù‹ØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹ Ù„ÙƒÙŠ ÙŠØ¸Ù‡Ø± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
        if (isViewerOpen) {
            updateStoryUI();
            
        }
    });
}

        function openStoryViewer(groupIndex) {
    currentGroupIndex = groupIndex;
    currentStoryIndex = 0;
    isStoryPaused = false;

    const group = storyGroups[currentGroupIndex];
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚ØµØµ ØºÙŠØ± Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ù„Ø¨Ø¯Ø¡ Ù…Ù†Ù‡Ø§
    const firstUnseen = group.stories.findIndex(s => !s.viewers || !s.viewers.includes(currentUser.uid));
    if(firstUnseen > 0) currentStoryIndex = firstUnseen;

    const viewer = document.getElementById('storyViewer');
    viewer.style.display = 'flex';
    
    updateStoryUI();
    loadStory();

    // --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ù„Ø§ Ù†Ø³ØªØ¯Ø¹ÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯Ù‡Ø§ Ù…Ù† Ù‚Ø¨Ù„ ---
    if (!areGesturesSetup) {
        setupStoryGestures(viewer);
        areGesturesSetup = true; // Ù†ØºÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø­ØªÙ‰ Ù„Ø§ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
    }
}


        // ======================= UI Updates & Options =======================

               
        // --- Options Menu Functions ---
        function openStoryOptions(e) {
            if(e) e.stopPropagation();
            isStoryPaused = true; 
            const vid = document.querySelector('video');
            if(vid) vid.pause();

            const group = storyGroups[currentGroupIndex];
            const user = group.user;
            const isMe = user.uid === currentUser.uid;
            
            const container = document.getElementById('storyDynamicOptions');
            container.innerHTML = '';

            if (isMe) {
                container.innerHTML += `
                    <div class="story-opt-item danger" onclick="confirmDeleteStory()">
                        <i class="fa-solid fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ù‚ØµØ©
                    </div>
                    <div class="story-opt-item" onclick="closeStoryOptions()">
                        <i class="fa-solid fa-gear"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚ØµØ©
                    </div>`;
            } else {
                container.innerHTML += `
                    <div class="story-opt-item" onclick="muteUserStories('${user.uid}')">
                        <i class="fa-solid fa-bell-slash"></i> ÙƒØªÙ… Ù‚ØµØµ ${user.name}
                    </div>
                    <div class="story-opt-item danger" onclick="reportStory()">
                        <i class="fa-solid fa-triangle-exclamation"></i> Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                    </div>`;
            }

            document.getElementById('storyOptionsOverlay').classList.add('active');
            document.getElementById('storyOptionsSheet').classList.add('active');
        }

        function closeStoryOptions() {
            document.getElementById('storyOptionsOverlay').classList.remove('active');
            document.getElementById('storyOptionsSheet').classList.remove('active');
            resumeFromInput(); 
        }

        function downloadStoryMedia() {
            const group = storyGroups[currentGroupIndex];
            const story = group.stories[currentStoryIndex];
            
            const a = document.createElement('a');
            a.href = story.url;
            a.target = '_blank';
            a.download = `story_${Date.now()}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†Ø²ÙŠÙ„...");
            closeStoryOptions();
        }

        function confirmDeleteStory() {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù‚ØµØ©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.")) {
                const group = storyGroups[currentGroupIndex];
                const story = group.stories[currentStoryIndex];
                deleteCurrentStory(story);
                closeStoryOptions();
            }
        }

        function muteUserStories(uid) {
            showToast("ØªÙ… ÙƒØªÙ… Ø§Ù„Ù‚ØµØµ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
            closeStoryOptions();
        }

        function reportStory() {
            showToast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©");
            closeStoryOptions();
        }

        // ======================= Story Playback & Navigation =======================

        function loadStory() {
    clearTimeout(storyTimer);
    const group = storyGroups[currentGroupIndex];
    const story = group.stories[currentStoryIndex];
    const contentDiv = document.getElementById('storyContent');
    const blurBg = document.getElementById('storyBlurBg');
    const timeAgoDiv = document.getElementById('storyTimeAgo');

    // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    document.querySelector('.story-header-info').style.opacity = '1';
    document.getElementById('storyFooter').style.opacity = '1';
    document.getElementById('storyBarsContainer').style.opacity = '1';

    if(story.timestamp) timeAgoDiv.innerText = moment(story.timestamp.toDate()).fromNow();

    let newElement;
    const mediaType = story.type || 'image';

    // ==========================================
    // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­ Ø¬Ø²Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ”¥
    // ==========================================
    if (mediaType === 'video') {
        // 1. Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„ Ø­ØªÙ‰ ÙŠØ¬Ù‡Ø² Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        contentDiv.innerHTML = '<div style="color:#fff; font-size:30px;"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';

        newElement = document.createElement('video');
        newElement.src = story.url;
        newElement.playsInline = true; // Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø¢ÙŠÙÙˆÙ†
        newElement.preload = "auto";   // Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        
        // Ù†Ø¨Ø¯Ø£ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…ÙƒØªÙˆÙ… Ø§Ù„ØµÙˆØª Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ´ØºÙŠÙ„ (Ø­Ù„ Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…ØªØµÙØ­Ø§Øª)
        // Ø«Ù… Ù†Ù‚ÙˆÙ… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø±
        newElement.muted = true; 

        // 2. Ø¹Ù†Ø¯ ØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø§Ù„Ù…Ø¯Ø©)
        newElement.onloadedmetadata = () => {
            storyDuration = newElement.duration * 1000;
            if(!isFinite(storyDuration)) storyDuration = 15000; // Ø­Ù…Ø§ÙŠØ© Ù„Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø¯ØªÙ‡ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©
        };

        // 3. Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¬Ø§Ù‡Ø²Ø§Ù‹ Ù„Ù„ØªØ´ØºÙŠÙ„
        newElement.oncanplay = () => {
            // ØªÙØ±ÙŠØº Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            contentDiv.innerHTML = ''; 
            contentDiv.appendChild(newElement);
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø­Ø§Ù„Ø© ÙƒØªÙ… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            newElement.muted = isStoryMuted;

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ù€ Promise Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            const playPromise = newElement.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // Ù†Ø¬Ø­ Ø§Ù„ØªØ´ØºÙŠÙ„
                    startProgress(storyDuration);
                    blurBg.style.background = '#000';
                }).catch(error => {
                    console.warn("Autoplay blocked, muting and retrying:", error);
                    // Ù„Ùˆ ÙØ´Ù„ Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØµÙˆØªØŒ Ù†ÙƒØªÙ…Ù‡ ÙˆÙ†Ø´ØºÙ„ ØªØ§Ù†ÙŠ
                    newElement.muted = true;
                    isStoryMuted = true; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
                    updateMuteBtnState(); // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±
                    newElement.play();
                    startProgress(storyDuration);
                });
            }
        };

        newElement.onended = nextStory;
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        newElement.onerror = () => {
            console.error("Video Error");
            showToast("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù‚ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
            setTimeout(nextStory, 2000); 
        };

    } else {
        // ==========================================
        // Ø¬Ø²Ø¡ Ø§Ù„ØµÙˆØ± (ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø¨Ø³ÙŠØ·)
        // ==========================================
        contentDiv.innerHTML = '<div style="color:#fff; font-size:30px;"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';
        
        const img = new Image();
        img.src = story.url;
        
        const capturedStoryIndex = currentStoryIndex;
        const capturedGroupIndex = currentGroupIndex;

        img.onload = () => {
            if (currentStoryIndex !== capturedStoryIndex || currentGroupIndex !== capturedGroupIndex) return;

            contentDiv.innerHTML = '';
            contentDiv.appendChild(img);
            
            storyDuration = 5000;
            startProgress(5000);
            
            clearTimeout(storyTimer);
            storyTimer = setTimeout(nextStory, 5000);
            
            blurBg.style.backgroundImage = `url('${story.url}')`;
        };
        
        // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        img.onerror = () => {
            showToast("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©");
            setTimeout(nextStory, 2000);
        }
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    if (group.user.uid !== currentUser.uid) {
        if(!story.viewers || !story.viewers.includes(currentUser.uid)) {
            db.collection('stories').doc(story.id).update({
                viewers: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
            });
        }
    }
    
    preloadNextStory();
}

        function preloadNextStory() {
            const group = storyGroups[currentGroupIndex];
            // 1. Ø§Ù„Ù‚ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (currentStoryIndex + 1 < group.stories.length) {
                const next = group.stories[currentStoryIndex + 1];
                if(next.type === 'video') {
                    const v = document.createElement('video'); v.src = next.url; v.preload = 'auto';
                } else {
                    const i = new Image(); i.src = next.url;
                }
            }
            // 2. Ø£ÙˆÙ„ Ù‚ØµØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ§Ù„ÙŠ
            else if (currentGroupIndex + 1 < storyGroups.length) {
                const nextUserStory = storyGroups[currentGroupIndex + 1].stories[0];
                if(nextUserStory.type === 'video') {
                    const v = document.createElement('video'); v.src = nextUserStory.url; v.preload = 'auto';
                } else {
                    const i = new Image(); i.src = nextUserStory.url;
                }
            }
        }

        function startProgress(duration) {
            const bar = document.getElementById(`prog-${currentStoryIndex}`);
            if(bar) {
                bar.style.transition = 'none';
                bar.style.width = '0%';
                void bar.offsetWidth;
                bar.style.transition = `width ${duration}ms linear`;
                bar.style.width = '100%';
            }
        }

        function nextStory() {
            if(isStoryPaused) return;
            const group = storyGroups[currentGroupIndex];
            
            const bar = document.getElementById(`prog-${currentStoryIndex}`);
            if(bar) { bar.style.transition = 'none'; bar.style.width = '100%'; }

            if (currentStoryIndex < group.stories.length - 1) {
                currentStoryIndex++;
                updateMuteBtnState();
                loadStory();
            } else {
                if (currentGroupIndex < storyGroups.length - 1) {
                    currentGroupIndex++;
                    currentStoryIndex = 0;
                    updateStoryUI();
                    loadStory();
                } else {
                    closeStory();
                }
            }
        }

        function prevStory() {
            const bar = document.getElementById(`prog-${currentStoryIndex}`);
            if(bar) { bar.style.transition = 'none'; bar.style.width = '0%'; }

            if (currentStoryIndex > 0) {
                currentStoryIndex--;
                const prevBar = document.getElementById(`prog-${currentStoryIndex}`);
                if(prevBar) { prevBar.style.transition = 'none'; prevBar.style.width = '0%'; }
                
                updateMuteBtnState();
                loadStory();
            } else {
                if (currentGroupIndex > 0) {
                    currentGroupIndex--;
                    currentStoryIndex = storyGroups[currentGroupIndex].stories.length - 1;
                    updateStoryUI();
                    loadStory();
                } else {
                    loadStory();
                }
            }
        }
        
        function updateMuteBtnState() {
             const group = storyGroups[currentGroupIndex];
             const story = group.stories[currentStoryIndex];
             const muteBtn = document.getElementById('storyMuteBtn');
             if(story.type === 'video') {
                 muteBtn.style.display = 'block';
                 muteBtn.className = isStoryMuted ? 'fa-solid fa-volume-xmark' : 'fa-solid fa-volume-high';
             } else {
                 muteBtn.style.display = 'none';
             }
        }

        function toggleStoryMute(btn) {
            isStoryMuted = !isStoryMuted;
            btn.className = isStoryMuted ? 'fa-solid fa-volume-xmark' : 'fa-solid fa-volume-high';
            const video = document.querySelector('#storyContent video');
            if(video) video.muted = isStoryMuted;
            event.stopPropagation();
        }

        // ================== GESTURE LOGIC ==================
        function setupStoryGestures(element) {
            let touchStartX = 0;
            let touchStartY = 0;
            let touchStartTime = 0;
            let longPressTimer = null;
            let isLongPressActive = false;
            let isDragging = false;

            // 1. Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³
            element.addEventListener('touchstart', (e) => {
                if(e.target.closest('#storyFooter') || e.target.closest('.story-header-info') || e.target.closest('.story-options-sheet')) return;

                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
                touchStartTime = Date.now();
                isLongPressActive = false;
                isDragging = false;

                longPressTimer = setTimeout(() => {
                    if (!isDragging) {
                        isLongPressActive = true;
                        pauseStoryInteraction();
                    }
                }, 250);
            }, {passive: true});

            // 2. Ø­Ø±ÙƒØ© Ø§Ù„Ø¥ØµØ¨Ø¹
            element.addEventListener('touchmove', (e) => {
                const touch = e.touches[0];
                const moveX = touch.clientX - touchStartX;
                const moveY = touch.clientY - touchStartY;

                if (Math.abs(moveX) > 10 || Math.abs(moveY) > 10) {
                    isDragging = true;
                    clearTimeout(longPressTimer);
                    
                    if (isLongPressActive) {
                        resumeStoryInteraction();
                        isLongPressActive = false;
                    }
                }
            }, {passive: true});

            // 3. Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ù…Ø³
            element.addEventListener('touchend', (e) => {
                if(e.target.closest('#storyFooter') || e.target.closest('.story-header-info') || e.target.closest('.story-options-sheet')) return;
                
                clearTimeout(longPressTimer);
                const touchEndTime = Date.now();
                const timeDiff = touchEndTime - touchStartTime;
                
                if (isLongPressActive) {
                    resumeStoryInteraction();
                    return; 
                }

                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;

                // Ø³Ø­Ø¨ Ù„Ù„Ø£Ø³ÙÙ„ (Ø¥ØºÙ„Ø§Ù‚)
                if (diffY > 100 && Math.abs(diffX) < 50) {
                    closeStory();
                    return;
                }

                // Ø³Ø­Ø¨ Ø¬Ø§Ù†Ø¨ÙŠ (ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
                if (Math.abs(diffX) > 60) {
                    if (diffX < 0) nextUserGroup(); // Ø³Ø­Ø¨ Ù„Ù„ÙŠØ³Ø§Ø±
                    else prevUserGroup(); // Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ†
                    return;
                }

                // Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                if (!isDragging && timeDiff < 250) {
                    const screenWidth = window.innerWidth;
                    if (touchEndX < screenWidth * 0.3) {
                        prevStory();
                    } else {
                        nextStory();
                    }
                }
            });

            function pauseStoryInteraction() {
                isStoryPaused = true;
                clearTimeout(storyTimer);
                const vid = document.querySelector('video');
                if(vid) vid.pause();
                
                const bar = document.getElementById(`prog-${currentStoryIndex}`);
                if(bar) {
                    const computedStyle = window.getComputedStyle(bar);
                    const w = computedStyle.getPropertyValue('width');
                    bar.style.transition = 'none';
                    bar.style.width = w;
                }

                document.querySelector('.story-header-info').style.opacity = '0';
                document.getElementById('storyFooter').style.opacity = '0';
                document.getElementById('storyBarsContainer').style.opacity = '0';
            }

            function resumeStoryInteraction() {
                isStoryPaused = false;
                document.querySelector('.story-header-info').style.opacity = '1';
                document.getElementById('storyFooter').style.opacity = '1';
                document.getElementById('storyBarsContainer').style.opacity = '1';

                const vid = document.querySelector('video');
                if (vid) {
                    vid.play();
                } else {
                     const bar = document.getElementById(`prog-${currentStoryIndex}`);
                     if(bar) {
                         bar.style.transition = `width ${storyDuration}ms linear`;
                         bar.style.width = '100%';
                     }
                     storyTimer = setTimeout(nextStory, 2000);
                }
            }
        }

        function nextUserGroup() {
            if (currentGroupIndex < storyGroups.length - 1) {
                currentGroupIndex++;
                currentStoryIndex = 0;
                updateStoryUI();
                loadStory();
            } else {
                closeStory();
            }
        }

        function prevUserGroup() {
            if (currentGroupIndex > 0) {
                currentGroupIndex--;
                currentStoryIndex = 0;
                updateStoryUI();
                loadStory();
            }
        }

        async function deleteCurrentStory(story) {
            showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...");
            closeStory(); 
            try {
                let imageRef = firebase.storage().refFromURL(story.url);
                await imageRef.delete();
                await db.collection('stories').doc(story.id).delete();
                showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            } catch (error) {
                db.collection('stories').doc(story.id).delete();
                showToast("ØªÙ… Ø§Ù„Ø­Ø°Ù");
            }
        }

        function closeStory() { 
    const viewer = document.getElementById('storyViewer');
    viewer.style.display = 'none'; 
    document.getElementById('storyOptionsOverlay').classList.remove('active');
    document.getElementById('storyOptionsSheet').classList.remove('active');
    
    document.querySelector('.story-header-info').style.opacity = '1';
    document.getElementById('storyFooter').style.opacity = '1';
    document.getElementById('storyBarsContainer').style.opacity = '1';

    // --- ØªÙ†Ø¸ÙŠÙ ÙƒØ§Ù…Ù„ ---
    clearTimeout(storyTimer);
    storyTimer = null; // ØªÙØ±ÙŠØº Ø§Ù„Ù…ØªØºÙŠØ±
    
    const vid = document.querySelector('video');
    if(vid) {
        vid.pause();
        vid.src = ""; // Ø¥ÙŠÙ‚Ø§Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        vid.onended = null; // Ø¥Ù„ØºØ§Ø¡ Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø«
    }

    document.getElementById('storyContent').innerHTML = '';
    isStoryPaused = false;
}

        // --- Interactions (Reactions & Input) ---
        // ============================================
// 1. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ Ù„Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
// ============================================
// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø¥ÙŠÙ…ÙˆØ¬ÙŠ) ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
function sendQuickReaction(emoji) {
    // 1. Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ØµØ±ÙŠ (Ù‚Ù„ÙˆØ¨ Ø·Ø§ÙŠØ±Ø©)
    const container = document.getElementById('floatingHearts');
    const heart = document.createElement('div');
    heart.innerText = emoji;
    heart.style.position = 'absolute';
    heart.style.bottom = '50px';
    heart.style.right = Math.random() * 50 + 'px';
    heart.style.fontSize = '30px';
    heart.style.animation = 'floatUp 2s linear forwards';
    container.appendChild(heart);
    setTimeout(() => heart.remove(), 2000);

    // 2. Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
    const group = storyGroups[currentGroupIndex];
    const story = group.stories[currentStoryIndex];
    
    // Ù„Ùˆ Ø£Ù†Ø§ ØµØ§Ø­Ø¨ Ø§Ù„Ù‚ØµØ© Ù…Ø´ Ù‡ÙŠÙ†ÙØ¹ Ø£ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ù†ÙØ³ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    if(group.user.uid === currentUser.uid) return;

    // Ø¨Ù†Ø³ØªØ®Ø¯Ù… set Ù…Ø¹ merge Ø¹Ø´Ø§Ù† Ù†Ø¶ÙŠÙ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨ØªØ§Ø¹Ù†Ø§ Ù…Ù† ØºÙŠØ± Ù…Ø§ Ù†Ù…Ø³Ø­ ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ù†Ø§Ø³
    const updateData = {};
    updateData[`reactions.${currentUser.uid}`] = emoji;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù…ÙŠ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† Ø¨Ø§Ù„Ù…Ø±Ø© (Ù„Ø£Ù† Ø§Ù„ØªÙØ§Ø¹Ù„ ÙŠØ¹ØªØ¨Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©)
    db.collection('stories').doc(story.id).update({
        ...updateData,
        viewers: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
    }).then(() => {
        showToast(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${emoji}`);
    }).catch(err => console.log(err));
}

// ============================================
// 2. ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‚ØµØ© Ù„Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¹ÙŠÙ† Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
// ============================================
function updateStoryUI() {
    const group = storyGroups[currentGroupIndex];
    if (!group) return; // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
    const user = group.user;
    const isMe = user.uid === currentUser.uid;
    
    // ... (ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø© ÙƒÙ…Ø§ Ù‡Ùˆ Ù„Ø¯ÙŠÙƒ) ...
    let nameHTML = user.name;
    if (user.isVerified) {
        nameHTML += ` <i class="fa-solid fa-circle-check" style="color:#38bdf8; font-size:14px; margin-right:5px;"></i>`;
    }
    document.getElementById('storyViewerName').innerHTML = nameHTML;
    document.getElementById('storyUserAvatarSmall').style.backgroundImage = `url('${user.avatar}')`;
    
    // ØªØ­Ø¯ÙŠØ« Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
    const barsContainer = document.getElementById('storyBarsContainer');
    barsContainer.innerHTML = '';
    group.stories.forEach((_, i) => {
        const seg = document.createElement('div');
        seg.className = 'progress-segment';
        seg.innerHTML = `<div class="progress-fill" id="prog-${i}" style="width: ${i < currentStoryIndex ? '100%' : '0%'}"></div>`;
        barsContainer.appendChild(seg);
    });

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙˆØªØ±
    document.getElementById('storyFooter').style.display = isMe ? 'none' : 'flex';
    
    // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹Ø¯Ø§Ø¯ + Ø±Ø¨Ø·Ù‡ Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ”¥
    // ... Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© updateStoryUI ...

    // ğŸ”¥ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„ÙŠØ´Ù…Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª ğŸ”¥
    const viewsDiv = document.getElementById('storyViewsCount');
    const story = group.stories[currentStoryIndex];
    
    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
    const viewCount = (story.viewers && Array.isArray(story.viewers)) ? story.viewers.length : 0;
    
    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª (Ø§Ù„Ø±ÙŠØ§ÙƒØ´Ù†Ø§Øª)
    const reactionsMap = story.reactions || {};
    const reactionCount = Object.keys(reactionsMap).length;

    if(isMe) {
        viewsDiv.style.display = 'flex';
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹ÙŠÙ† ÙˆØ¬Ù†Ø¨Ù‡Ø§ Ø§Ù„Ù‚Ù„Ø¨ Ù„Ùˆ ÙÙŠÙ‡ ØªÙØ§Ø¹Ù„Ø§Øª
        let htmlContent = `<i class="fa-solid fa-eye"></i> ${viewCount}`;
        
        if (reactionCount > 0) {
            htmlContent += ` <span style="margin: 0 5px; opacity: 0.5;">|</span> <i class="fa-solid fa-heart" style="color: #ff4444;"></i> ${reactionCount}`;
        }

        viewsDiv.innerHTML = htmlContent;
        
        viewsDiv.onclick = (e) => {
            e.stopPropagation();
            showStoryViewers();
        };
        viewsDiv.style.cursor = 'pointer';
    } else {
        viewsDiv.style.display = 'none';
    }
    
    updateMuteBtnState();
}


// ============================================
// 3. Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† ÙˆØ§Ù„ØªÙØ§Ø¹Ù„Ø§Øª (Ø¬Ø¯ÙŠØ¯)
// ============================================
function showStoryViewers() {
    // 1. Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯ Ù…Ø¤Ù‚ØªØ§Ù‹
    isStoryPaused = true;
    const vid = document.querySelector('video');
    if(vid) vid.pause();

    // 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const modal = document.getElementById('storyViewersModal');
    const listContainer = document.getElementById('viewersListContainer');
    const countSpan = document.getElementById('viewersTotalCount');
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ø¤Ù‚ØªØ©
    listContainer.innerHTML = '<div style="text-align:center; padding:20px; color:#aaa;"><i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© ÙÙˆØ±Ø§Ù‹
    modal.classList.add('active'); 

    // 3. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ØµØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø¨Ø§Ø´Ø±Ø©
    const group = storyGroups[currentGroupIndex];
    const storyId = group.stories[currentStoryIndex].id;

    db.collection('stories').doc(storyId).get().then(doc => {
        if (!doc.exists) return;
        
        const data = doc.data();
        const viewersList = data.viewers || [];
        const reactionsMap = data.reactions || {};

        // ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        countSpan.innerText = `(${viewersList.length})`;
        
        // ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‚ØµØ© Ù†ÙØ³Ù‡Ø§ Ø£ÙŠØ¶Ø§Ù‹
        const uiCountDiv = document.getElementById('storyViewsCount');
        if(uiCountDiv) uiCountDiv.innerHTML = `<i class="fa-solid fa-eye"></i> ${viewersList.length}`;

        listContainer.innerHTML = '';

        if (viewersList.length === 0) {
            listContainer.innerHTML = `<div style="text-align:center; padding:30px; color:#777;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø¨Ø¹Ø¯</div>`;
        } else {
            // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
            viewersList.forEach(async uid => {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                let user = usersCache[uid];
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ÙƒØ§Ø´ØŒ Ù†Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ (ØªØ­Ø³ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠ)
                if(!user) {
                    try {
                        const uDoc = await db.collection('users').doc(uid).get();
                        if(uDoc.exists) user = uDoc.data();
                    } catch(e) {}
                }
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const avatar = user ? (user.profilePic || user.avatarUrl || defaultAvatar) : defaultAvatar;
                const name = user ? (user.name || "Ù…Ø³ØªØ®Ø¯Ù…") : "Ù…Ø³ØªØ®Ø¯Ù…";
                const reaction = reactionsMap[uid] ? reactionsMap[uid] : ''; // Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ

                const item = document.createElement('div');
                item.className = 'viewer-item';
                item.innerHTML = `
                    <div class="viewer-info">
                        <div class="viewer-avatar" style="background-image: url('${avatar}')"></div>
                        <div class="viewer-name">${name}</div>
                    </div>
                    <div class="viewer-reaction">${reaction}</div>
                `;
                listContainer.appendChild(item);
            });
        }
    });
}


function closeStoryViewers() {
    document.getElementById('storyViewersModal').classList.remove('active');
    // Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù‚ØµØ©
    resumeFromInput();
}

        function pauseForInput() { 
            isStoryPaused = true; 
            clearTimeout(storyTimer); 
            const v = document.querySelector('video'); 
            if(v) v.pause(); 
        }

        function resumeFromInput() { 
            isStoryPaused = false; 
            const v = document.querySelector('video'); 
            if(v) v.play(); 
        }

        // ======================= Core App Logic (Friends & Chats) =======================

        function loadFriendsList(uid) {
            db.collection("users").doc(uid).collection("friends").onSnapshot(async snap => {
                friendUids = new Set(snap.docs.map(doc => doc.id));
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ù„Ù„ÙƒØ§Ø´
                await Promise.all(Array.from(friendUids).map(fetchAndCacheUser));
                renderStories();
                if(allChats.length > 0) renderList(); 
            });
        }

        function loadChats(userId) {
            db.collection("chats").where("users", "array-contains", userId).onSnapshot(async snap => {
                let tempChats = [];
                for (const doc of snap.docs) {
                    const d = doc.data();
                    if (d.deletedBy && d.deletedBy.includes(userId)) continue;

                    let chatName = "Ù…Ø³ØªØ®Ø¯Ù…", chatAvatar = defaultAvatar, isVerified = false, otherUid = null, isGroup = (d.type === 'GROUP'); 
                    if (isGroup) { chatName = d.name; } 
                    else {
                        otherUid = d.users.find(u => u !== userId);
                        if(otherUid) {
                            const u = usersCache[otherUid] || await fetchAndCacheUser(otherUid);
                            chatName = u.name; chatAvatar = u.avatar; isVerified = u.isVerified;
                        }
                    }

                    let previewMsg = d.lastMessage || 'Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©';
                    let isMedia = false;
                    if(previewMsg.includes('http') || previewMsg === 'ØµÙˆØ±Ø©' || previewMsg === 'image') {
                        previewMsg = '<i class="fa-solid fa-camera"></i> ØµÙˆØ±Ø©'; isMedia = true;
                    }
                    let isTyping = (d.typing && d.typing.includes(otherUid));

                    tempChats.push({
                        id: doc.id, name: chatName, avatar: chatAvatar, isGroup,
                        lastMsg: previewMsg, isMedia, isTyping,
                        time: d.lastMessageTime ? moment(d.lastMessageTime.toDate()).fromNow(true) : '',
                        timestamp: d.lastMessageTime ? d.lastMessageTime.toMillis() : 0,
                        otherUid, isOnline: isGroup ? true : (usersCache[otherUid]?.isOnline || false),
                        amISender: d.lastSender === userId, isSeen: d.seen === true,        
                        unreadCount: d.unreadCount || 0, isArchived: d.archivedBy && d.archivedBy.includes(userId),
                        isBlocked: d.blockedBy && d.blockedBy.includes(userId), isVerified,
                        isPinned: d.pinnedBy && d.pinnedBy.includes(userId),
                        isMuted: d.mutedBy && d.mutedBy.includes(userId),
                        isRequest: !isGroup && d.lastSender !== userId && !friendUids.has(otherUid)
                    });
                }
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª: Ø§Ù„Ù…Ø«Ø¨Øª Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ø£Ø­Ø¯Ø«
                tempChats.sort((a, b) => {
                    if (a.isPinned !== b.isPinned) return a.isPinned ? -1 : 1;
                    return b.timestamp - a.timestamp;
                });
                allChats = tempChats;
                                allChats = tempChats;
                // --- Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ---
                sessionStorage.setItem('cached_allChats', JSON.stringify(allChats));
                renderList();

                
            });
        }

        async function fetchAndCacheUser(uid) {
    // Ù„Ùˆ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ÙƒØ§Ø´ ÙˆØ­Ø¯ÙŠØ«Ø© (Ø£Ù‚Ù„ Ù…Ù† Ø¯Ù‚ÙŠÙ‚Ø©) Ù†Ø±Ø¬Ø¹Ù‡Ø§
    // Ù„ÙƒÙ† Ù„Ù„Ø£Ù…Ø§Ù† Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ ÙƒÙ„ Ù…Ø±Ø© Ø£Ùˆ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Listener
    
    // ... (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ if usersCache Ù‡Ø°Ø§ Ø³Ù†ØªØ±ÙƒÙ‡ ÙƒÙ…Ø§ Ù‡ÙˆØŒ Ù„ÙƒÙ† Ø³Ù†Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„Ø£Ø³ÙÙ„)

    try {
        const doc = await db.collection("users").doc(uid).get();
        if (doc.exists) {
            const d = doc.data();
            
            // === [ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹] ===
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª (5 Ø¯Ù‚Ø§Ø¦Ù‚ = 300000 Ù…ÙŠÙ„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
            let isOnlineCalculated = false;
            
            if (d.online === true && d.showActivity !== false) {
                if (d.lastSeen) {
                    const lastSeenTime = d.lastSeen.toMillis();
                    const currentTime = Date.now();
                    const diff = currentTime - lastSeenTime;
                    
                    // Ù„Ùˆ Ø§Ù„ÙØ±Ù‚ Ø£Ù‚Ù„ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚ ÙŠØ¹ØªØ¨Ø± Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
                    if (diff < 300000) { 
                        isOnlineCalculated = true;
                    }
                } else {
                    // Ù„Ùˆ Ù…Ø¹Ù†Ø¯ÙˆØ´ ÙˆÙ‚Øª Ø¨Ø³ Ø¹Ù†Ø¯Ù‡ online=true (Ø­Ø§Ù„Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©)
                    isOnlineCalculated = true; 
                }
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø´Ø±Ø· "Ù‡Ù„ Ø£Ù†Ø§ Ù…ÙØ¹Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø·ØŸ" Ø¹Ø´Ø§Ù† Ø£Ø´ÙˆÙ Ø§Ù„Ù†Ø§Ø³
            const realOnline = isOnlineCalculated && myActivityVisible;

            usersCache[uid] = { 
                uid, 
                name: d.name || "Ù…Ø³ØªØ®Ø¯Ù…", 
                avatar: d.profilePic || d.avatarUrl || defaultAvatar, 
                isVerified: d.isVerified === true, 
                isOnline: realOnline // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            };
            // Ø¯Ù‡ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ø³ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
sessionStorage.setItem('cached_users_data', JSON.stringify(usersCache));

            return usersCache[uid];
            
        }
    } catch (e) {}
    return { uid, name: 'Ù…Ø¬Ù‡ÙˆÙ„', avatar: defaultAvatar, isOnline: false };
}

function renderList() {
    const list = document.getElementById("list");
    list.innerHTML = "";
    const titleText = document.getElementById("listTitleText");

    // 1. ØªØµÙÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠ (inbox, archive, requests)
    let filteredChats = [];
    if (currentView === 'inbox') {
        titleText.innerText = "Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª";
        filteredChats = allChats.filter(c => !c.isArchived && !c.isBlocked && !c.isRequest);
        document.getElementById('storiesContainer').style.display = 'block';
    } else {
        document.getElementById('storiesContainer').style.display = 'none';

        if (currentView === 'archive') {
            titleText.innerText = "Ø§Ù„Ø£Ø±Ø´ÙŠÙ";
            filteredChats = allChats.filter(c => c.isArchived && !c.isBlocked);
        } else if (currentView === 'requests') {
            titleText.innerText = "Ø§Ù„Ø·Ù„Ø¨Ø§Øª";
            filteredChats = allChats.filter(c => c.isRequest && !c.isBlocked && !c.isArchived);
        }
    }

    // 2. Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª
    if (filteredChats.length === 0) {
        list.innerHTML = `<div class="empty-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù‡Ù†Ø§</div>`;
        return;
    }

    // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    filteredChats.forEach(c => {
        const wrapper = document.createElement('div');
        wrapper.className = 'chat-wrapper';


        const el = document.createElement('div');
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
        let displayName = c.name;
        if (c.isGroup) displayName = `<span style="background:var(--accent-color); padding:1px 5px; border-radius:4px; font-size:9px; margin-left:4px;">GR</span> ${c.name}`;
        if (c.isVerified) displayName += ` <i class="fa-solid fa-circle-check verify-badge"></i>`;

        let statusIconsHTML = '';
        if (c.isPinned) statusIconsHTML += `<i class="fa-solid fa-thumbtack" style="color:var(--accent-color); font-size:10px; margin-left:4px;"></i>`;
        if (c.isMuted) statusIconsHTML += `<i class="fa-solid fa-bell-slash" style="color:#777; font-size:10px; margin-left:4px;"></i>`;

        let bottomContent = c.isTyping ? `<div class="typing-indicator">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©...</div>` : `<div class="last-message-wrapper">${(!c.isBlocked && c.amISender && c.isSeen) ? `<div class="read-blue-dot"></div>` : ''}<div class="last">${c.lastMsg}</div></div>`;
        
        // Ø§Ù„Ø¨Ø§Ø¯Ø¬ ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø© ÙˆØ£Ù†Ø§ Ù„Ø³Øª Ø§Ù„Ù…Ø±Ø³Ù„
        let unreadHTML = (!c.amISender && c.unreadCount > 0) ? `<div class="unread-badge">${c.unreadCount}</div>` : '';

        el.className = 'chat';
        if (c.isPinned) el.classList.add('pinned-chat');

        // Ø¨Ù†Ø§Ø¡ HTML Ø§Ù„Ø¹Ù†ØµØ±
        el.innerHTML = `
            <div class="avatar-container" id="avatar-${c.id}">
                <div class="avatar" style="background-image:url('${c.avatar}')"></div>
                <div class="active-dot" style="background:${c.isOnline && window.isOnlineFeatureEnabled ? '#4ade80' : '#777'}"></div>
            </div>
            <div class="info">
                <div class="top-row"><div class="name">${displayName}</div><div class="time">${statusIconsHTML} ${c.time}</div></div>
                <div class="bottom-row">${bottomContent}${unreadHTML}</div>
            </div>`;

        // =======================================================
        // Ø£) Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© (ÙŠÙØªØ­ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø·)
        // =======================================================
        const avatarDiv = el.querySelector(`#avatar-${c.id}`);
        avatarDiv.onclick = (e) => {
            e.stopPropagation(); // ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø­Ø¯Ø« Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø´Ø§Øª
            vibrate();
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
            if(typeof openProfilePreview === 'function'){
                openProfilePreview(e, c);
            }
        };

        // =======================================================
        // Ø¨) Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Øª (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù… Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø±ÙŠØ³ØªØ§Ø±Øª)
        // =======================================================
        // ØªØ¹Ø±ÙŠÙ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ù‡Ù†Ø§ Ù„Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ø´Ø±Ø·
        let startX = 0;
        let currentX = 0;
        let isDragging = false; 

        el.onclick = async (e) => {
            // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©: Ù„Ùˆ Ø§Ù„Ø¶ØºØ·Ø© Ø¬Øª Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„ØºÙ„Ø·ØŒ Ø§Ø®Ø±Ø¬
            if (e.target.closest('.avatar-container')) return;
            
            // Ø­Ù…Ø§ÙŠØ© Ù‡Ø§Ù…Ø©: Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØ§Ù† Ø¨ÙŠØ³Ø­Ø¨ (Swipe) ÙˆØ§ÙŠØ¯Ù‡ ÙÙ„ØªØªØŒ Ù„Ø§ ØªÙØªØ­ Ø§Ù„Ø´Ø§Øª
            if (isDragging) return; 

            vibrate();
            
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†
            if (c.isBlocked) { showToast("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¸ÙˆØ±"); return; }
            
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ)
            if (!c.isRequest && !c.amISender && c.unreadCount > 0) {
                // 1. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø§Ø¯Ø¬ ÙÙˆØ±Ø§Ù‹ (Visual Feedback)
                const badge = el.querySelector('.unread-badge');
                if(badge) badge.style.display = 'none';
                
                // 2. Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙØ¹Ù„ÙŠØ§Ù‹
                try {
                    await resetUnreadCount(c.id);
                } catch(err) {
                    console.log("Error resetting count:", err);
                }
            }

            // Ø­ÙØ¸ Ù…ÙƒØ§Ù† Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ø´Ø§Ù† Ù„Ù…Ø§ ÙŠØ±Ø¬Ø¹ ÙŠÙ„Ø§Ù‚ÙŠ Ù†ÙØ³Ù‡ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙƒØ§Ù†
            sessionStorage.setItem('scrollPos', window.scrollY);

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø´Ø§Øª
            openChat(c.id, encodeURIComponent(c.name), c.isGroup ? 'GROUP' : c.otherUid, c.isRequest);
        };

        // Ø²Ø± Ø§Ù„ÙØ£Ø±Ø© Ø§Ù„Ø£ÙŠÙ…Ù† Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
        el.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            vibrate();
            openOptions(c);
        });

        // ... (Ø¨Ø¹Ø¯ Ù…Ø§ Ø®Ù„ØµØª Ø§Ù„Ù€ innerHTML ÙÙˆÙ‚) ...

        // =======================================================
        // 1. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¶ØºØ· Ù„ÙØªØ­ Ø§Ù„Ø´Ø§Øª (Ø³ÙŠØ¨Ù‡ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ)
        // =======================================================
        el.onclick = async (e) => {
            // Ø­Ù…Ø§ÙŠØ©: Ù„Ùˆ Ø¯Ø§Ø³ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù…ÙŠØ¹Ù…Ù„Ø´ Ø­Ø§Ø¬Ø© Ù‡Ù†Ø§ (Ù„Ø£Ù† Ø§Ù„ØµÙˆØ±Ø© Ù„ÙŠÙ‡Ø§ ÙƒÙˆØ¯ Ù„ÙˆØ­Ø¯Ù‡Ø§)
            if (e.target.closest('.avatar-container')) return;
            
            vibrate();
            
            if (c.isBlocked) { showToast("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¸ÙˆØ±"); return; }
            
            // ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ùˆ ÙÙŠÙ‡ Ø±Ø³Ø§ÙŠÙ„ Ù…Ø´ Ù…Ù‚Ø±ÙˆØ¡Ø©
            if (!c.isRequest && !c.amISender && c.unreadCount > 0) {
                const badge = el.querySelector('.unread-badge');
                if(badge) badge.style.display = 'none';
                try { await resetUnreadCount(c.id); } catch(err) {}
            }

            sessionStorage.setItem('scrollPos', window.scrollY);
            openChat(c.id, encodeURIComponent(c.name), c.isGroup ? 'GROUP' : c.otherUid, c.isRequest);
        };

        // =======================================================
        // 2. ÙƒÙˆØ¯ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ø³ÙŠØ¨Ù‡ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ)
        // =======================================================
        el.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            vibrate();
            openOptions(c);
        });

        // =======================================================
        // (ØªÙ… Ø­Ø°Ù Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø³Ø­Ø¨ touchstart, touchmove, touchend Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹)
        // =======================================================

        // 3. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù„ØµÙØ­Ø© (Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ø¹Ø´Ø§Ù† Ø§Ù„Ø´Ø§Øª ÙŠØ¸Ù‡Ø±)
        wrapper.appendChild(el);
        list.appendChild(wrapper);

    }); // Ø¯ÙŠ Ù‚ÙÙ„Ø© Ø§Ù„Ù€ forEach (Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹)
} // Ø¯ÙŠ Ù‚ÙÙ„Ø© Ø¯Ø§Ù„Ø© renderList (Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹)

    // 2. Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª
    
        // --- Standard & Modal Actions ---
      // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØ±Ø¬Ø¹ Promise Ù„Ù†Ù†ØªØ¸Ø±Ù‡Ø§ Ù‚Ø¨Ù„ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©
function resetUnreadCount(chatId) { 
    return db.collection('chats').doc(chatId).update({ unreadCount: 0, seen: true }); 
}
    function openChat(cid, name, uid, req) { location.href = (req ? 'request_view.html' : 'chat.html') + `?chatId=${cid}&name=${name}&uid=${uid}`; }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('sidebarOverlay').classList.toggle('active'); }
        function showSection(section) { currentView = section; toggleSidebar(); renderList(); }
        
        function openOptions(chat) {
            selectedChatId = chat.id; selectedChatData = chat;
            document.getElementById('sheetName').innerText = chat.name;
            document.getElementById('sheetAvatar').style.backgroundImage = `url('${chat.avatar}')`;
            document.getElementById('pinText').innerText = chat.isPinned ? "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª" : "ØªØ«Ø¨ÙŠØª";
            document.getElementById('archiveText').innerText = chat.isArchived ? "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø£Ø±Ø´ÙØ©" : "Ø£Ø±Ø´ÙØ©";
            document.getElementById('muteText').innerText = chat.isMuted ? "ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª" : "ÙƒØªÙ…";
            document.getElementById('markReadText').innerText = chat.isSeen ? "ØªØ­Ø¯ÙŠØ¯ ÙƒØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡" : "Ù‚Ø±Ø§Ø¡Ø©";
            document.getElementById('optionsModal').classList.add('active');
        }

        function closeOptions() { document.getElementById('optionsModal').classList.remove('active'); }

        async function createGroupAction() {
            closeOptions();
            const groupName = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
            if (!groupName || groupName.trim() === "") return;
            const participants = [currentUser.uid];
            if (selectedChatData && selectedChatData.otherUid) participants.push(selectedChatData.otherUid);
            
            try {
                const groupRef = await db.collection('chats').add({
                    name: groupName, users: participants, type: 'GROUP', createdBy: currentUser.uid,
                    lastMessage: "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©", lastMessageTime: firebase.firestore.FieldValue.serverTimestamp(), admins: [currentUser.uid]
                });
                showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©! ğŸ‰");
                openChat(groupRef.id, encodeURIComponent(groupName), 'GROUP');
            } catch (error) { console.error(error); showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"); }
        }

        function togglePinAction() {
            const ref = db.collection('chats').doc(selectedChatId);
            const op = selectedChatData.isPinned ? firebase.firestore.FieldValue.arrayRemove(currentUser.uid) : firebase.firestore.FieldValue.arrayUnion(currentUser.uid);
            ref.update({ pinnedBy: op }); closeOptions();
        }

        function archiveChatAction() {
            const ref = db.collection('chats').doc(selectedChatId);
            const op = selectedChatData.isArchived ? firebase.firestore.FieldValue.arrayRemove(currentUser.uid) : firebase.firestore.FieldValue.arrayUnion(currentUser.uid);
            ref.update({ archivedBy: op }); showToast(selectedChatData.isArchived ? "ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø£Ø±Ø´ÙØ©" : "ØªÙ…Øª Ø§Ù„Ø£Ø±Ø´ÙØ©"); closeOptions();
        }

        function deleteChatAction() {
    // Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ† + ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù‡
    db.collection('chats').doc(selectedChatId).update({
        deletedBy: firebase.firestore.FieldValue.arrayUnion(currentUser.uid),
        // Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©: Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø£ÙŠØ¶Ø§Ù‹
        unreadCount: 0 
    }).then(() => {
        showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©");
        closeOptions();
        // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø§ØªØŒ Ù†Ø¹ÙˆØ¯ Ù„Ù„Ø®Ù„Ù
        if(currentView === 'chat') showSection('inbox');
    });
}


        function toggleMuteAction() {
            const ref = db.collection('chats').doc(selectedChatId);
            const op = selectedChatData.isMuted ? firebase.firestore.FieldValue.arrayRemove(currentUser.uid) : firebase.firestore.FieldValue.arrayUnion(currentUser.uid);
            ref.update({ mutedBy: op }); closeOptions();
        }

        function toggleReadAction() { db.collection('chats').doc(selectedChatId).update({ seen: !selectedChatData.isSeen }); closeOptions(); }
        
         function hideLogoutModal() { document.getElementById('logoutModal').classList.remove('active'); }
        function performLogout() { sessionStorage.clear(); auth.signOut().then(() => location.href = 'index.html'); }
        
        function toggleMyActivity() {
            myActivityVisible = !myActivityVisible;
            localStorage.setItem('nabd_online_status', myActivityVisible);
            updateActivityUI();
            db.collection('users').doc(currentUser.uid).update({ showActivity: myActivityVisible });
            showToast(myActivityVisible ? "Ø£Ù†Øª Ø¸Ø§Ù‡Ø± Ø§Ù„Ø¢Ù†" : "Ø£Ù†Øª Ù…Ø®ÙÙŠ Ø§Ù„Ø¢Ù†");
            usersCache = {}; friendUids.forEach(fid => delete usersCache[fid]); loadChats(currentUser.uid);
        }

        function updateActivityUI() {
            const txt = document.getElementById('activityText');
            const dot = document.getElementById('activityDot');
            if(myActivityVisible) { txt.innerText = "Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø·: Ø¸Ø§Ù‡Ø±"; dot.style.background = "#4ade80"; } 
            else { txt.innerText = "Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø·: Ù…Ø®ÙÙŠ"; dot.style.background = "#555"; }
        }

        function monitorIncomingMessages(uid) {
            db.collection('chats').where('users', 'array-contains', uid).onSnapshot(s => {
                s.docChanges().forEach(c => {
                    if (c.type === 'modified') {
                        const d = c.doc.data();
                        if (d.lastSender !== uid && d.unreadCount > 0 && !(d.mutedBy && d.mutedBy.includes(uid))) {
                            if(notificationAudio) notificationAudio.play().catch(()=>{});
                            vibrate();
                        }
                    }
                });
            });
        }

        function searchChats(val) {
            val = val.toLowerCase();
            document.querySelectorAll('.chat-wrapper').forEach(el => {
                const name = el.querySelector('.name').innerText.toLowerCase();
                el.style.display = name.includes(val) ? 'block' : 'none';
            });
        }

   
// 1. Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØºØ±Ø¶ Ø§Ù„Ø¨Ø­Ø«
let currentFriendsData = [];

function startNewChat() {
    vibrate();
    const modal = document.getElementById('newChatModal');
    const listContainer = document.getElementById('newChatListContainer');
    const searchInput = document.getElementById('newChatSearchInput');

    // ØªØµÙÙŠØ± Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù‚Ø§Ø¦Ù…Ø©
    searchInput.value = '';
    listContainer.innerHTML = '';
    currentFriendsData = [];

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ØµØ¯Ù‚Ø§Ø¡
    if (friendUids.size === 0) {
        listContainer.innerHTML = `
            <div style="text-align:center; padding:30px; color:#777;">
                <i class="fa-solid fa-user-plus" style="font-size:30px; margin-bottom:10px;"></i>
                <br>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
                <br>
                <button onclick="showSection('friends')" style="background:var(--accent-color); border:none; color:#fff; padding:8px 15px; border-radius:8px; margin-top:10px; cursor:pointer;">Ø¥Ø¶Ø§ÙØ© Ø£ØµØ¯Ù‚Ø§Ø¡</button>
            </div>`;
    } else {
        // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± Ù„Ù„Ø¨Ø­Ø«
        friendUids.forEach(uid => {
            if(usersCache[uid]) {
                currentFriendsData.push(usersCache[uid]);
            }
        });

        // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        renderNewChatList(currentFriendsData);
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø©
    modal.classList.add('active');
}

// Ø¯Ø§Ù„Ø© ØªØµÙÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø§Ù„Ø¨Ø­Ø«
function filterNewChatList(query) {
    const lowerQ = query.toLowerCase().trim();
    
    if (lowerQ === '') {
        renderNewChatList(currentFriendsData);
        return;
    }

    const filtered = currentFriendsData.filter(user => 
        user.name.toLowerCase().includes(lowerQ)
    );
    
    renderNewChatList(filtered);
}

// Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
function renderNewChatList(dataList) {
    const listContainer = document.getElementById('newChatListContainer');
    listContainer.innerHTML = '';

    if (dataList.length === 0) {
        listContainer.innerHTML = `<div style="text-align:center; padding:20px; color:#555;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>`;
        return;
    }

    dataList.forEach(user => {
        const item = document.createElement('div');
        item.className = 'new-chat-item';
        
        let displayName = user.name;
        if(user.isVerified) displayName += ` <i class="fa-solid fa-circle-check" style="color:#38bdf8; font-size:12px;"></i>`;

        item.innerHTML = `
            <div class="nc-avatar" style="background-image: url('${user.avatar}')"></div>
            <div class="nc-name">${displayName}</div>
            <i class="fa-solid fa-comment-dots" style="margin-right: auto; color: var(--accent-color);"></i>
        `;
        
        item.onclick = () => {
            closeNewChatModal();
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ø§Ø¯Ø«Ø© Ø³Ø§Ø¨Ù‚Ø© Ø£Ùˆ ÙØªØ­ Ø¬Ø¯ÙŠØ¯Ø©
            const existingChat = allChats.find(c => !c.isGroup && c.otherUid === user.uid);
            if (existingChat) {
                openChat(existingChat.id, encodeURIComponent(user.name), user.uid, false);
            } else {
                openChat('new', encodeURIComponent(user.name), user.uid, false);
            }
        };
        
        listContainer.appendChild(item);
    });
}

function closeNewChatModal() {
    document.getElementById('newChatModal').classList.remove('active');
}

// Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ØµØºØ±Ø©
function openProfilePreview(e, chatData) {
    e.stopPropagation(); // Ù…Ù†Ø¹ ÙØªØ­ Ø§Ù„Ø´Ø§Øª
    vibrate();
    
    currentPreviewChatId = chatData.id;
    currentPreviewImage = chatData.avatar;
    
    document.getElementById('ppPreviewImg').src = chatData.avatar;
    document.getElementById('ppPreviewName').innerText = chatData.name;
    
    const modal = document.getElementById('profilePreviewModal');
    modal.style.display = 'flex';
}

function closeProfilePreview() {
    document.getElementById('profilePreviewModal').style.display = 'none';
}

// ÙØªØ­ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
function openFullProfileImage() {
    const fullModal = document.getElementById('fullImageModal');
    const fullImg = document.getElementById('fullPPImg');
    
    fullImg.src = currentPreviewImage;
    fullModal.style.display = 'flex';
    closeProfilePreview();
}

function closeFullImage() {
    document.getElementById('fullImageModal').style.display = 'none';
}

// Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
function navigateToChatFromPP() {
    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Øª
    const chatEl = document.querySelector(`.chat-wrapper[onclick*="${currentPreviewChatId}"]`); // Ù‡Ø°Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· ÙÙŠ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    // Ù„Ù„ØªØ¨Ø³ÙŠØ· Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆÙØªØ­ Ø§Ù„Ø´Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¬Ø§Ù‡Ø²Ø©
    closeProfilePreview();
    // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ openChat Ù‡Ù†Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
}

// ==== ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© renderList Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø±Ø¨Ø· Ø§Ù„Ø­Ø¯Ø« ====
// Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Øµ Ø¨Ø¥Ù†Ø´Ø§Ø¡ div Ø§Ù„Ø£ÙØ§ØªØ§Ø± ÙÙŠ Ø¯Ø§Ù„Ø© renderList ÙˆØ§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø§Ù„ØªØ§Ù„ÙŠ:
/*
    const avatarContainer = document.createElement('div');
    avatarContainer.className = 'avatar-container';
    avatarContainer.innerHTML = `
        <div class="avatar" style="background-image:url('${c.avatar}')"></div>
        <div class="active-dot" style="background:${c.isOnline && window.isOnlineFeatureEnabled ? '#4ade80' : '#777'}"></div>
    `;
    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙØ§ØªØ§Ø±
    avatarContainer.onclick = (e) => openProfilePreview(e, c);
    
    el.appendChild(avatarContainer);
*/

// ==== Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª (Client Side) ====
// Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª 100% ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ØŒ Ù„ÙƒÙ† Ù‡Ø°Ù‡ Ø­ÙŠÙ„ Ù„ØªØµØ¹ÙŠØ¨ Ø§Ù„Ø£Ù…Ø±

// 1. Ù…Ù†Ø¹ Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙŠÙ…Ù†
document.addEventListener('contextmenu', event => event.preventDefault());

// 2. Ù…Ù†Ø¹ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (PrintScreen, Ctrl+S, etc)
document.addEventListener('keydown', function(e) {
    if (e.key === 'PrintScreen' || (e.ctrlKey && e.key === 's')) {
        copyToClipboard(); // Ù…Ø³Ø­ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        alert("Ø§Ù„ØªØµÙˆÙŠØ± Ù…Ù…Ù†ÙˆØ¹!");
        e.preventDefault();
    }
});

// 3. ØªØ´ÙˆÙŠØ´ Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù„Ù„Ø¬ÙˆØ§Ù„ Ø¹Ù†Ø¯ ÙØªØ­ ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…)
window.addEventListener('blur', () => {
    document.body.classList.add('blur-content');
});
window.addEventListener('focus', () => {
    document.body.classList.remove('blur-content');
});

function copyToClipboard() {
    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§ÙØ¸Ø©
    navigator.clipboard.writeText('Screenshots are disabled');
}

                    function viewUserProfileFromStory() {
            const group = storyGroups[currentGroupIndex];
            const user = group.user;
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‚ØµØ© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ù„ÙƒÙ† Ø£ÙØ¶Ù„ Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
            const vid = document.querySelector('video');
            if(vid) vid.pause();
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (uid)
            location.href = `profile.html?uid=${user.uid}`;
        }

            
    /* --- Ù†Ø¸Ø§Ù… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Messenger Version) --- */

// 1. ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
function openAccountSwitcher() {
    vibrate();
    toggleSidebar(); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
    document.getElementById('accountSwitcherModal').style.display = 'flex';
    document.getElementById('addAccountForm').style.display = 'none';
    document.getElementById('addAccBtnContainer').style.display = 'flex';

    const list = document.getElementById('accountList');
    list.innerHTML = "";

    // Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ù†ÙØ³ Ù…ÙØªØ§Ø­ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ÙŠØ¹Ù…Ù„Ø§ Ù…Ø¹Ø§Ù‹)
    let accounts = JSON.parse(localStorage.getItem('nabd_accounts') || '[]');

    // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    if(currentUser) {
        const currentIdx = accounts.findIndex(a => a.uid === currentUser.uid);
        if(currentIdx > -1) {
            // Ù†Ø­Ø§ÙˆÙ„ Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
            const menuName = document.getElementById('myNameTxt') ? document.getElementById('myNameTxt').innerText : "Ø­Ø³Ø§Ø¨ÙŠ";
            accounts[currentIdx].name = menuName;
            localStorage.setItem('nabd_accounts', JSON.stringify(accounts));
        }
    }

    if (accounts.length === 0) {
        list.innerHTML = "<div style='text-align:center;color:#777;padding:20px'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>";
    }

    accounts.forEach((acc, idx) => {
        const isCurrent = (currentUser && acc.uid === currentUser.uid);
        
        // ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†
        const bgStyle = acc.pic ? `background-image:url('${acc.pic}')` : `background:#5D5FEF`;
        const char = acc.pic ? '' : (acc.name ? acc.name[0] : 'U');

        list.innerHTML += `
        <div class="acc-item" onclick="${isCurrent ? '' : `switchAccount(${idx})`}" style="${isCurrent ? 'opacity:0.5; cursor:default; border:1px solid var(--accent-color);' : ''}">
            <div style="width:40px; height:40px; border-radius:50%; ${bgStyle}; background-size:cover; background-position:center; display:grid; place-items:center; font-weight:bold; border:1px solid #333; flex-shrink:0;">
                ${char}
            </div>
            
            <div style="flex:1; text-align:right;">
                <div style="font-weight:bold; font-size:14px; color:#fff;">
                    ${acc.name} ${acc.isVerified ? '<i class="fa-solid fa-circle-check" style="color:#38bdf8; font-size:12px;"></i>' : ''}
                </div>
                <div style="font-size:11px; color:#aaa;">${acc.email}</div>
            </div>

            ${!isCurrent ? `<i class="fa-solid fa-trash-can" style="color:#ef4444; padding:10px; font-size:14px;" onclick="removeAccount(event, ${idx})"></i>` : '<span style="font-size:10px; color:#38bdf8">Ù†Ø´Ø·</span>'}
        </div>`;
    });
}

// 2. Ø¥Ø¸Ù‡Ø§Ø± ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ©
function showAddAccountForm() {
    vibrate();
    document.getElementById('addAccountForm').style.display = 'block';
    document.getElementById('addAccBtnContainer').style.display = 'none';
}

function hideAddAccountForm() {
    document.getElementById('addAccountForm').style.display = 'none';
    document.getElementById('addAccBtnContainer').style.display = 'flex';
}

// 3. Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
async function addNewAccountAction() {
    vibrate();
    const e = document.getElementById('newAccEmail').value;
    const p = document.getElementById('newAccPass').value;
    
    if(!e || !p) return showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");
    
    showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...");

    try { 
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const cred = await auth.signInWithEmailAndPassword(e, p); 
        const uid = cred.user.uid;

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ÙØ¸
        const userDoc = await db.collection('users').doc(uid).get();
        const userData = userDoc.data() || {};
        const realName = userData.name || e.split('@')[0];
        const isVerified = userData.isVerified || false;
        const pic = userData.profilePic || userData.avatarUrl || "";

        // Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ LocalStorage
        let accs = JSON.parse(localStorage.getItem('nabd_accounts') || '[]'); 
        
        // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
        if(!accs.find(a => a.uid === uid)) {
            accs.push({
                uid: uid, 
                email: e, 
                token: btoa(p), // ØªØ´ÙÙŠØ± Ø¨Ø³ÙŠØ·
                name: realName, 
                isVerified: isVerified, 
                pic: pic
            }); 
            localStorage.setItem('nabd_accounts', JSON.stringify(accs)); 
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        location.reload(); 

    } catch(er) { 
        console.error(er); 
        showToast("Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"); 
    }
}

// 4. ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
function switchAccount(idx) { 
    vibrate();
    let accs = JSON.parse(localStorage.getItem('nabd_accounts')); 
    if(accs[idx]) {
        showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„...");
        auth.signInWithEmailAndPassword(accs[idx].email, atob(accs[idx].token))
            .then(() => location.reload())
            .catch(() => showToast("ÙØ´Ù„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚Ø¯ ØªÙƒÙˆÙ† ØªØºÙŠØ±Øª"));
    }
}

// 5. Ø­Ø°Ù Ø­Ø³Ø§Ø¨
function removeAccount(e, idx) { 
    e.stopPropagation();
    if(!confirm("Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ")) return;
    
    let accs = JSON.parse(localStorage.getItem('nabd_accounts')); 
    accs.splice(idx, 1);
    localStorage.setItem('nabd_accounts', JSON.stringify(accs)); 
    
    openAccountSwitcher(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    showToast("ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø©");
}
    
// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù€ Interval Ø¹Ø´Ø§Ù† Ù†Ù‚Ø¯Ø± Ù†ÙˆÙ‚ÙÙ‡ Ù„Ùˆ Ø­Ø¨ÙŠÙ†Ø§
let presenceInterval;

function startPresenceSystem() {
    if (!currentUser) return;

    // 1. ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    updateMyStatus();

    // 2. ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (Heartbeat)
    presenceInterval = setInterval(() => {
        updateMyStatus();
    }, 60000); // 60000 Ù…ÙŠÙ„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© = Ø¯Ù‚ÙŠÙ‚Ø©

    // 3. Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ (ØªØ­Ø¯ÙŠØ« Ø£Ø®ÙŠØ±)
    window.addEventListener('beforeunload', () => {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø±ÙŠØ¹Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ (Ù‚Ø¯ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙØ§Ø¬Ø¦ØŒ Ù„Ø°Ø§ Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª)
        const batch = db.batch();
        const userRef = db.collection('users').doc(currentUser.uid);
        batch.update(userRef, { online: false, lastSeen: firebase.firestore.FieldValue.serverTimestamp() });
        batch.commit();
    });
    
    // 4. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ (Ù„Ùˆ Ø®Ø±Ø¬ ÙˆØ±Ø¬Ø¹)
    document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === 'visible') {
            updateMyStatus(); // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø©
        }
    });
}


    function updateMyStatus() {
        if (!currentUser || !myActivityVisible) return;
        
        db.collection('users').doc(currentUser.uid).update({
            online: true,
            lastSeen: firebase.firestore.FieldValue.serverTimestamp()
        }).catch(err => console.log("Presence Error", err));
    }
    // ... (Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ) ...

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ù…ÙÙ‚ÙˆØ¯Ø© ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù…Ù†Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    // ============================================
    function callUserFromPP() {
        showToast("Ù…ÙŠØ²Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ù‚Ø±ÙŠØ¨Ø§Ù‹...");
    }

    function infoUserFromPP() {
        // ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        if(currentPreviewChatId) {
            // Ù‡Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù€ UID Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹ Ø£Ùˆ ÙØªØ­ Ø§Ù„Ø´Ø§Øª
             navigateToChatFromPP();
        }
    }

    // ============================================
    // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ”¥
    // ============================================
    initApp(); 
// 1. Ø±Ø¨Ø· Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø­Ø¯Ø« Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
document.getElementById('storyReplyInput').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        sendStoryReply();
    }
});

// 2. Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ ÙƒØ±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ©
// 1. ØªØ´ØºÙŠÙ„ Ø²Ø±Ø§Ø± Ø§Ù„Ù€ Enter ÙÙŠ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (keyup Ø£ÙØ¶Ù„ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)
document.getElementById('storyReplyInput').addEventListener('keyup', function (e) {
    if (e.key === 'Enter') {
        e.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
        sendStoryReply();   // Ø¥Ø±Ø³Ø§Ù„
    }
});

// 2. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Ù…Ø¹Ø¯Ù„Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„)
async function sendStoryReply() {
    const input = document.getElementById('storyReplyInput');
    const text = input.value.trim();
    
    // Ù„Ùˆ Ù…ÙÙŠØ´ Ù†ØµØŒ Ù…Ù†Ø¹Ù…Ù„Ø´ Ø­Ø§Ø¬Ø©
    if (!text) return;

    const group = storyGroups[currentGroupIndex];
    const storyOwnerId = group.user.uid;
    const story = group.stories[currentStoryIndex];

    if (storyOwnerId === currentUser.uid) {
        showToast("Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù‚ØµØªÙƒ");
        return;
    }

    // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚Ù„ ÙÙˆØ±Ø§Ù‹ Ø¹Ø´Ø§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ­Ø³ Ø¨Ø§Ù„Ø³Ø±Ø¹Ø©
    const msgToSend = text; // Ù†Ø®Ø²Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    input.value = ''; 
    input.blur(); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯

    try {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø´Ø§Øª
        let chatId = null;
        const snapshot = await db.collection('chats')
            .where('users', 'array-contains', currentUser.uid)
            .get();

        snapshot.forEach(doc => {
            const data = doc.data();
            if (data.type !== 'GROUP' && data.users.includes(storyOwnerId)) {
                chatId = doc.id;
            }
        });

        // Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø§Øª Ø¬Ø¯ÙŠØ¯ Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯
        if (!chatId) {
            const newChatRef = await db.collection('chats').add({
                users: [currentUser.uid, storyOwnerId],
                type: 'DIRECT',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastMessage: "Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ØµØ©",
                lastMessageTime: firebase.firestore.FieldValue.serverTimestamp(),
                seen: false,
                lastSender: currentUser.uid,
                unreadCount: 1
            });
            chatId = newChatRef.id;
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        await db.collection('chats').doc(chatId).collection('messages').add({
            text: msgToSend,
            sender: currentUser.uid,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            type: 'story_reply',
            storyUrl: story.url,
            storyType: story.type
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
        await db.collection('chats').doc(chatId).update({
            lastMessage: `Ø±Ø¯ Ø¹Ù„Ù‰ Ù‚ØµØªÙƒ: ${msgToSend}`,
            lastMessageTime: firebase.firestore.FieldValue.serverTimestamp(),
            lastSender: currentUser.uid,
            seen: false,
            unreadCount: firebase.firestore.FieldValue.increment(1) 
        });

        showToast("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…");
        resumeFromInput();

    } catch (error) {
        console.error(error);
        showToast("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
    }
}

// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¶ØºØ·Ø©
let lastTap = 0;

function handleDoubleTap(e) {
    const currentTime = new Date().getTime();
    const tapLength = currentTime - lastTap;
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø¶ØºØ·ØªÙŠÙ† Ø£Ù‚Ù„ Ù…Ù† 300ms
    if (tapLength < 300 && tapLength > 0) {
        e.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙˆÙ…
        
        // 1. Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ù„Ø¨ ÙƒØ¨ÙŠØ± ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
        showBigHeartAnimation();
        
        // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±
        sendQuickReaction('â¤ï¸'); 
    }
    lastTap = currentTime;
}

// Ø£Ø¶Ù Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø­Ø¯Ø« Ø¹Ù„Ù‰ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…ÙŠØ¯ÙŠØ§
document.getElementById('storyContent').addEventListener('touchend', handleDoubleTap);

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ù‚Ù„Ø¨ Ø§Ù„ÙƒØ¨ÙŠØ±
function showBigHeartAnimation() {
    const container = document.getElementById('storyContent');
    const heart = document.createElement('i');
    heart.className = 'fa-solid fa-heart';
    heart.style.cssText = `
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%) scale(0);
        font-size: 100px; color: #fff;
        filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        z-index: 100; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    `;
    
    container.appendChild(heart);
    
    // ØªÙƒØ¨ÙŠØ±
    requestAnimationFrame(() => { heart.style.transform = 'translate(-50%, -50%) scale(1.2)'; });
    
    // Ø§Ø®ØªÙØ§Ø¡
    setTimeout(() => {
        heart.style.opacity = '0';
        heart.style.transform = 'translate(-50%, -50%) scale(0)';
        setTimeout(() => heart.remove(), 300);
    }, 800);
}
// Ø§Ø³ØªØ¯Ø¹Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ loadStory Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ØµØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØªØµÙˆÙŠØª
function renderPollSticker(question, option1, option2) {
    const container = document.getElementById('storyContent');
    
    const pollDiv = document.createElement('div');
    pollDiv.className = 'story-poll';
    pollDiv.innerHTML = `
        <div class="poll-question">${question}</div>
        <div class="poll-options">
            <button onclick="votePoll(this, 1)">${option1}</button>
            <button onclick="votePoll(this, 2)">${option2}</button>
        </div>
    `;
    // Ø³ØªØ§ÙŠÙ„ Ø³Ø±ÙŠØ¹
    pollDiv.style.cssText = `
        position: absolute; top: 60%; left: 50%; transform: translateX(-50%);
        background: #fff; width: 70%; border-radius: 12px; padding: 15px;
        text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 20;
    `;
    
    container.appendChild(pollDiv);
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…Ù„Ù
initGlobalCallListener();


    </script>
    

    
    <div id="profilePreviewModal" class="profile-preview-overlay" onclick="closeProfilePreview()">
        <div class="profile-preview-card" onclick="event.stopPropagation()">
            <div class="pp-image-container" onclick="openFullProfileImage()">
                <div class="protection-layer"></div>
                <img id="ppPreviewImg" src="" alt="Profile">
                <div class="pp-name-overlay" id="ppPreviewName">User Name</div>
            </div>
            <div class="pp-actions">
                <div onclick="navigateToChatFromPP()"><i class="fa-solid fa-message"></i></div>
                <div onclick="callUserFromPP()"><i class="fa-solid fa-phone"></i></div>
                <div onclick="infoUserFromPP()"><i class="fa-solid fa-circle-info"></i></div>
            </div>
        </div>
    </div>

    <div id="fullImageModal" class="full-image-overlay" onclick="closeFullImage()">
        <div id="screenShotWarning" style="display:none; color:red; position:absolute; top:50%;">Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø´Ø§Ø´Ø©!</div>
        <img id="fullPPImg" src="" class="protected-img">
    </div>


    <div class="bottom-sheet-overlay" id="newChatModal" onclick="closeNewChatModal()">
        <div class="bottom-sheet" onclick="event.stopPropagation()" style="max-height: 80vh; display: flex; flex-direction: column;">
            <div class="sheet-handle"></div>
            <div style="text-align: center; margin-bottom: 15px;">
                <h3 style="color: #fff;">Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            </div>
            <div style="padding: 0 10px 15px 10px;">
                <div style="position: relative; width: 100%;">
                    <input type="text" id="newChatSearchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù…..." 
                        oninput="filterNewChatList(this.value)" 
                        style="width: 100%; padding: 12px 40px 12px 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: #fff; font-family: 'Cairo'; outline: none;">
                    <i class="fa-solid fa-magnifying-glass" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #777;"></i>
                </div>
            </div>
            <div id="newChatListContainer" style="overflow-y: auto; flex: 1; padding: 0 5px;"></div>
        </div>
    </div>

    <div class="bottom-sheet-overlay" id="storyViewersModal" onclick="closeStoryViewers()">
        <div class="bottom-sheet" onclick="event.stopPropagation()" style="height: 60vh;">
            <div class="sheet-handle"></div>
            <h3 style="text-align:center; color:#fff; margin-bottom:15px;">Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª <span id="viewersTotalCount" style="font-size:14px; color:#777;">(0)</span></h3>
            <div id="viewersListContainer" style="overflow-y:auto; height:calc(100% - 60px);"></div>
        </div>
    </div>
<div id="accountSwitcherModal" class="custom-modal">
    <div class="modal-box">
        <h3 style="color:#fff; margin-bottom:15px;">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h3>
        
        <div id="accountList" class="account-list"></div>

        <div id="addAccBtnContainer" class="modal-actions">
            <button onclick="showAddAccountForm()" class="btn-purple">
                <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
            </button>
            <button onclick="document.getElementById('accountSwitcherModal').style.display='none'" class="btn-dark">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>

        <div id="addAccountForm" style="display:none; width:100%;">
            <div class="input-group">
                <i class="fa-solid fa-envelope input-icon"></i>
                <input type="email" id="newAccEmail" class="pro-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            </div>
            <div class="input-group">
                <i class="fa-solid fa-lock input-icon"></i>
                <input type="password" id="newAccPass" class="pro-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            
            <div class="modal-actions">
                <button onclick="addNewAccountAction()" class="btn-purple">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø­ÙØ¸</button>
                <button onclick="hideAddAccountForm()" class="btn-dark">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
</div>
<div class="floating-fab" onclick="vibrate(); startNewChat()">
    <i class="fa-solid fa-pen"></i>
</div>
<div id="incomingCallModal">
    <div id="callerImage" class="caller-avatar-large"></div>
    <div id="callerName" class="caller-name-display">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</div>
    
    <div class="call-actions">
        <div class="call-btn btn-decline" onclick="rejectCall()">
            <i class="fa-solid fa-phone-slash"></i>
        </div>
        <div class="call-btn btn-accept" onclick="acceptCall()">
            <i class="fa-solid fa-phone"></i>
        </div>
    </div>
</div>

<audio id="ringtoneIn" loop preload="none">
    <source src="./sounds/ring_in.wav" type="audio/wav">
</audio>
<script src="global-call.js"></script>


</body>
</html>