<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NABD - Ù…Ø±ÙƒØ² Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #0b1120;
            --card-bg: #151e32;
            --primary: #5D5FEF;
            --gold: #f59e0b;
            --text: #fff;
            --text-muted: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
            --info: #3b82f6;
            --locked: #334155;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg-body); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; padding-bottom: 20px; }

        /* --- Header & Tabs --- */
        .main-header { padding: 15px 20px; display: flex; align-items: center; background: rgba(21, 30, 50, 0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .back-btn { font-size: 20px; color: var(--text); cursor: pointer; }
        .main-title { flex: 1; text-align: center; font-weight: 800; font-size: 18px; }

        .tabs-container {
            display: flex; gap: 10px; padding: 15px; background: var(--bg-body);
            position: sticky; top: 60px; z-index: 99; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .tab-btn {
            flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            background: var(--card-bg); color: var(--text-muted); font-weight: bold; font-size: 14px;
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .tab-btn.active {
            background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 5px 15px rgba(93, 95, 239, 0.3);
        }

        /* --- View Containers --- */
        .view-section { display: none; padding: 10px; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

        /* ============================
           STYLES FOR SYSTEM 1 (TOSEEQ) 
           ============================ */
        .hero { text-align: center; padding: 30px 20px; background: linear-gradient(180deg, rgba(93, 95, 239, 0.15) 0%, transparent 100%); }
        .badge-icon { font-size: 50px; color: var(--primary); text-shadow: 0 0 30px rgba(93, 95, 239, 0.5); margin-bottom: 10px; }
        .hero h1 { margin-bottom: 5px; font-size: 22px; }
        .hero p { color: var(--text-muted); font-size: 13px; max-width: 300px; margin: 0 auto; opacity: 0.8; }

        .criteria-card { background: var(--card-bg); border-radius: 16px; padding: 15px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; }
        .c-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .c-left { display: flex; gap: 12px; align-items: center; }
        .c-icon { width: 38px; height: 38px; border-radius: 10px; display: grid; place-items: center; font-size: 16px; }
        .c-info h3 { font-size: 15px; margin-bottom: 2px; }
        .c-info span { font-size: 11px; color: var(--text-muted); }
        .c-percent { font-weight: bold; font-size: 13px; }

        .progress-track { height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; width: 0%; border-radius: 10px; transition: width 1s ease; }
        .status-text { text-align: left; font-size: 11px; margin-top: 6px; font-weight: bold; opacity: 0.8; font-family: monospace; }

        /* Colors for Cards */
        .card-views .c-icon { background: rgba(245, 158, 11, 0.15); color: var(--gold); }
        .card-views .progress-fill { background: var(--gold); }
        .card-followers .c-icon { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .card-followers .progress-fill { background: var(--success); }
        .card-likes .c-icon { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .card-likes .progress-fill { background: var(--danger); }
        .card-age .c-icon { background: rgba(59, 130, 246, 0.15); color: var(--info); }
        .card-age .progress-fill { background: var(--info); }

        .apply-btn { width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: 800; font-size: 16px; cursor: pointer; transition: 0.3s; background: #222; color: #666; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; border: 1px solid #333; pointer-events: none; }
        .apply-btn.active { background: linear-gradient(135deg, var(--primary), #4338ca); color: white; border: none; pointer-events: auto; box-shadow: 0 5px 20px rgba(93, 95, 239, 0.4); animation: pulse 2s infinite; }

        /* ============================
           STYLES FOR SYSTEM 2 (LEVELS) 
           ============================ */
        .my-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; background: linear-gradient(180deg, rgba(93, 95, 239, 0.15), transparent); border-radius: 16px; margin-bottom: 20px; }
        .stat-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-val { font-weight: 900; font-size: 16px; color: var(--primary); }
        .stat-lbl { font-size: 11px; color: #aaa; margin-top: 2px; }

        .xp-container { padding: 0 5px; margin-bottom: 20px; }
        .xp-header { display: flex; justify-content: space-between; font-size: 12px; color: #ccc; margin-bottom: 5px; font-weight: bold; }
        .xp-track { height: 8px; background: #222; border-radius: 20px; overflow: hidden; border: 1px solid #333; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #a855f7); width: 0%; transition: width 1s ease; border-radius: 20px; box-shadow: 0 0 10px var(--primary); }

        .levels-list { display: flex; flex-direction: column; gap: 20px; }
        
        .lvl-card { background: var(--card-bg); border-radius: 18px; border: 1px solid var(--locked); position: relative; overflow: hidden; transition: 0.3s; }
        .lvl-card.active { border-color: var(--primary); box-shadow: 0 0 20px rgba(93, 95, 239, 0.15); transform: scale(1.01); z-index: 2; }
        .lvl-card.active .lvl-badge { background: var(--primary); color: #fff; }
        
        .lvl-card.elite { border-color: var(--gold); background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(21, 30, 50, 1)); }
        .lvl-card.elite .lvl-badge { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }

        .lvl-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .lvl-info { display: flex; align-items: center; gap: 12px; }
        .lvl-badge { width: 35px; height: 35px; background: #333; border-radius: 10px; display: grid; place-items: center; font-weight: 900; font-size: 16px; color: #777; transition: 0.3s; }
        .lvl-name { font-weight: 800; font-size: 16px; }
        
        .lvl-body { padding: 15px; }
        .features { margin: 0; padding: 0; list-style: none; }
        .features li { font-size: 13px; color: #ccc; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .features li i { color: var(--success); font-size: 14px; }
        
        /* --- Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ù…Ù‡Ù…: Ù„ÙˆÙ† Ø§Ù„Ù†ØµÙˆØµ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… --- */
        .req-text-lvl { 
            font-size: 13px; 
            color: #fff; /* Ù„ÙˆÙ† Ø£Ø¨ÙŠØ¶ ÙˆØ§Ø¶Ø­ */
            margin-top: 15px; 
            padding-top: 10px; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            display: flex; 
            gap: 15px; 
            flex-wrap: wrap; 
            font-weight: bold;
        }
        .req-item-lvl { display: flex; align-items: center; gap: 5px; }

        .lock-screen { position: absolute; inset: 0; background: rgba(11, 17, 32, 0.85); display: flex; align-items: center; justify-content: center; flex-direction: column; backdrop-filter: blur(2px); z-index: 5; }
        .lvl-card.active .lock-screen { display: none; }

        .verify-btn-lvl { width: 100%; padding: 14px; background: linear-gradient(135deg, #f59e0b, #d97706); border: none; border-radius: 12px; color: #fff; font-weight: 800; font-size: 15px; margin-top: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3); animation: pulse 2s infinite; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* Loader */
        .loader-overlay { position: fixed; inset: 0; background: var(--bg-body); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .loader-overlay.hide { opacity: 0; pointer-events: none; }

        /* ============================
           STYLES FOR SYSTEM 3 (BADGES) 
           ============================ */
        .badges-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 Ø´Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„ØµÙ */
            gap: 12px;
            padding: 10px;
        }

        .badge-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 15px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transition: 0.3s;
            opacity: 0.5; /* Ù…Ø·ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            filter: grayscale(1);
        }

        /* Ø§Ù„Ø´Ø§Ø±Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø© */
        .badge-item.unlocked {
            opacity: 1;
            filter: grayscale(0);
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .badge-icon-box {
            width: 50px; height: 50px;
            border-radius: 50%;
            display: grid; place-items: center;
            font-size: 24px; margin-bottom: 8px;
            position: relative;
            z-index: 2;
        }

        .badge-name { font-size: 11px; font-weight: 800; color: #eee; margin-bottom: 2px; }
        .badge-lvl { font-size: 9px; color: #aaa; font-family: monospace; }

        /* --- ÙØ¦Ø§Øª Ø§Ù„Ù†Ø¯Ø±Ø© (Rarity Tiers) --- */

        /* 1. Ø¨Ø±ÙˆÙ†Ø²ÙŠ (Levels 1-5) */
        .tier-bronze .badge-icon-box {
            background: linear-gradient(135deg, #cd7f32, #a05a2c);
            box-shadow: 0 0 10px rgba(205, 127, 50, 0.3);
            border: 2px solid #eecfa1;
            color: #fff;
        }

        /* 2. ÙØ¶ÙŠ (Levels 6-10) */
        .tier-silver .badge-icon-box {
            background: linear-gradient(135deg, #c0c0c0, #7f8c8d);
            box-shadow: 0 0 15px rgba(192, 192, 192, 0.3);
            border: 2px solid #fff;
            color: #fff;
        }

        /* 3. Ø°Ù‡Ø¨ÙŠ (Levels 11-15) */
        .tier-gold .badge-icon-box {
            background: linear-gradient(135deg, #ffd700, #f39c12);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            border: 2px solid #fff8dc;
            color: #000;
        }
        .tier-gold.unlocked { border: 1px solid rgba(255, 215, 0, 0.3); }

        /* 4. Ù…Ø§Ø³ÙŠ (Levels 16-19) */
        .tier-diamond .badge-icon-box {
            background: linear-gradient(135deg, #00eaff, #0072ff);
            box-shadow: 0 0 25px rgba(0, 234, 255, 0.5);
            border: 2px solid #e0ffff;
            color: #fff;
        }
        .tier-diamond.unlocked .badge-icon-box { animation: shine 3s infinite; }

        /* 5. Ø®Ø±Ø§ÙÙŠ (Level 20 - GOD MODE) */
        .tier-mythical .badge-icon-box {
            background: linear-gradient(135deg, #ff0055, #5D5FEF);
            box-shadow: 0 0 30px rgba(255, 0, 85, 0.6), 0 0 60px rgba(93, 95, 239, 0.4);
            border: 2px solid #fff;
            color: #fff;
        }
        .tier-mythical.unlocked {
            border: 1px solid #ff0055;
            background: linear-gradient(180deg, rgba(255,0,85,0.1), transparent);
        }
        .tier-mythical.unlocked .badge-icon-box { animation: pulse-mythic 1.5s infinite alternate; }

        @keyframes pulse-mythic { from { transform: scale(1); box-shadow: 0 0 20px #ff0055; } to { transform: scale(1.1); box-shadow: 0 0 40px #ff0055, 0 0 10px #fff; } }
        @keyframes shine { 0% { filter: brightness(1); } 50% { filter: brightness(1.3); } 100% { filter: brightness(1); } }

    </style>
</head>
<body>

    <div class="loader-overlay" id="pageLoader">
        <i class="fa-solid fa-chart-pie fa-spin fa-2x" style="color:var(--primary); margin-bottom:15px"></i>
        <div style="font-size:14px; color:#aaa">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>

    <div class="main-header">
        <i class="fa-solid fa-arrow-right back-btn" onclick="history.back()"></i>
        <div class="main-title">Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø³Ù…ÙŠ</div>
    </div>

    <div class="tabs-container">
        <div class="tab-btn active" onclick="switchTab('verification')" id="tab-v">
            <i class="fa-solid fa-certificate"></i> Ø´Ø±ÙˆØ· Ø§Ù„ØªÙˆØ«ÙŠÙ‚
        </div>
        <div class="tab-btn" onclick="switchTab('levels')" id="tab-l">
            <i class="fa-solid fa-trophy"></i> Ø³Ù„Ù… Ø§Ù„Ù…Ø¬Ø¯
        </div>
        <div class="tab-btn" onclick="switchTab('badges')" id="tab-b">
            <i class="fa-solid fa-shield-halved"></i> Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø§Øª
        </div>
    </div>

    <div id="view-verification" class="view-section active">
        <div class="hero">
            <div class="badge-icon"><i class="fa-solid fa-medal"></i></div>
            <h1>Ø´Ø±ÙˆØ· Ø§Ù„ØªÙˆØ«ÙŠÙ‚</h1>
            <p>ÙŠØ¬Ø¨ ØªØ­Ù‚ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ÙØªØ­ Ø²Ø± Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</p>
        </div>

        <div class="criteria-card card-views">
            <div class="c-header">
                <div class="c-left">
                    <div class="c-icon"><i class="fa-solid fa-eye"></i></div>
                    <div class="c-info"><h3>Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</h3><span>Ù…Ø·Ù„ÙˆØ¨ 10 Ù…Ù„ÙŠÙˆÙ†</span></div>
                </div>
                <div class="c-percent" id="perc-views">0%</div>
            </div>
            <div class="progress-track"><div class="progress-fill" id="bar-views"></div></div>
            <div class="status-text"><span id="txt-views">0</span> / 10,000,000</div>
        </div>

        <div class="criteria-card card-followers">
            <div class="c-header">
                <div class="c-left">
                    <div class="c-icon"><i class="fa-solid fa-users"></i></div>
                    <div class="c-info"><h3>Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ† (Ø­Ù‚ÙŠÙ‚ÙŠ)</h3><span>Ù…Ø·Ù„ÙˆØ¨ 50 Ø£Ù„Ù</span></div>
                </div>
                <div class="c-percent" id="perc-subs">0%</div>
            </div>
            <div class="progress-track"><div class="progress-fill" id="bar-subs"></div></div>
            <div class="status-text"><span id="txt-subs">0</span> / 50,000</div>
        </div>

        <div class="criteria-card card-likes">
            <div class="c-header">
                <div class="c-left">
                    <div class="c-icon"><i class="fa-solid fa-heart"></i></div>
                    <div class="c-info"><h3>ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</h3><span>Ù…Ø·Ù„ÙˆØ¨ 1000 Ù„Ø§ÙŠÙƒ</span></div>
                </div>
                <div class="c-percent" id="perc-likes">0%</div>
            </div>
            <div class="progress-track"><div class="progress-fill" id="bar-likes"></div></div>
            <div class="status-text"><span id="txt-likes">0</span> / 1,000</div>
        </div>

        <div class="criteria-card card-age">
            <div class="c-header">
                <div class="c-left">
                    <div class="c-icon"><i class="fa-solid fa-calendar-check"></i></div>
                    <div class="c-info"><h3>Ø£Ù‚Ø¯Ù…ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨</h3><span>Ù…Ø·Ù„ÙˆØ¨ 90 ÙŠÙˆÙ… (3 Ø´Ù‡ÙˆØ±)</span></div>
                </div>
                <div class="c-percent" id="perc-age">0%</div>
            </div>
            <div class="progress-track"><div class="progress-fill" id="bar-age"></div></div>
            <div class="status-text"><span id="txt-age">0</span> / 90 ÙŠÙˆÙ…</div>
        </div>

        <button id="applyBtn" class="apply-btn" onclick="submitEliteRequest()">
            <i class="fa-solid fa-lock"></i> Ø§Ù„Ø´Ø±ÙˆØ· ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©
        </button>
    </div>

    <div id="view-levels" class="view-section">
        <div class="my-stats">
            <div class="stat-box">
                <div class="stat-val" id="lvl-views">0</div>
                <div class="stat-lbl">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</div>
            </div>
            <div class="stat-box">
                <div class="stat-val" id="lvl-subs">0</div>
                <div class="stat-lbl">Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</div>
            </div>
            <div class="stat-box">
                <div class="stat-val" id="lvl-likes">0</div>
                <div class="stat-lbl">ØªÙØ§Ø¹Ù„</div>
            </div>
        </div>

        <div class="xp-container">
            <div class="xp-header">
                <span>Ø§Ù„ØªÙ‚Ø¯Ù… Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</span>
                <span id="xpPercentage">0%</span>
            </div>
            <div class="xp-track"><div class="xp-fill" id="xpBar"></div></div>
        </div>

        <div class="levels-list" id="levelsContainer">
            </div>
    </div>

    <div id="view-badges" class="view-section">
        <div class="hero" style="background:none; padding:10px;">
            <h1 style="font-size:20px;">Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø§Øª</h1>
            <p>Ø£ÙˆØ³Ù…Ø© Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± ÙÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</p>
        </div>
        <div class="badges-container" id="badgesContainer">
            </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyDpvqNAReChsHn5tFJSp7vV_EJHmtD2x4c",
            authDomain: "pools-e4381.firebaseapp.com",
            projectId: "pools-e4381",
            storageBucket: "pools-e4381.appspot.com",
            messagingSenderId: "339799216046",
            appId: "1:339799216046:web:26e437a7b7d5c24fe9023f"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.firestore();

        // --- Constants ---
        const TARGETS = { VIEWS: 10000000, SUBS: 50000, LIKES: 1000, DAYS: 90 };

        const LEVELS = [
            { id: 1, name: "Ù…Ø¨ØªØ¯Ø¦", req: {v:0, s:0, l:0}, feats: ["Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨", "Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚", "Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù†ØµÙŠØ©"] },
            { id: 2, name: "Ù‡Ø§ÙˆÙŠ", req: {v:1000, s:10, l:50}, feats: ["ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù", "Ø¥Ø¶Ø§ÙØ© Ø¨Ø§ÙŠÙˆ (Bio)"] },
            { id: 3, name: "ÙƒØ§ØªØ¨", req: {v:5000, s:50, l:100}, feats: ["Ù†Ø´Ø± Ø¨ÙˆØ³ØªØ§Øª Ø·ÙˆÙŠÙ„Ø©", "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‡Ø§Ø´ØªØ§Ø¬"] },
            { id: 4, name: "Ù…ØµÙˆØ±", req: {v:10000, s:100, l:300}, feats: ["Ø±ÙØ¹ 4 ØµÙˆØ± ÙÙŠ Ø§Ù„Ø¨ÙˆØ³Øª", "Ø¬ÙˆØ¯Ø© ØµÙˆØ± Ø¹Ø§Ù„ÙŠØ©"] },
            { id: 5, name: "ØµØ§Ù†Ø¹ ÙÙŠØ¯ÙŠÙˆ", req: {v:25000, s:200, l:500}, feats: ["Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù‚ØµÙŠØ±Ø©", "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª"] },
            { id: 6, name: "Ù…ØªÙØ§Ø¹Ù„", req: {v:50000, s:500, l:1000}, feats: ["Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„ØµÙ‚Ø§Øª", "Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª"] },
            { id: 7, name: "Ù†Ø¬Ù… ØµØ§Ø¹Ø¯", req: {v:100000, s:1000, l:2500}, feats: ["ØªØ«Ø¨ÙŠØª Ø¨ÙˆØ³Øª ÙÙŠ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„", "Ø¸Ù‡ÙˆØ± ÙÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª"] },
            { id: 8, name: "Ø´Ø¨Ø­", req: {v:250000, s:2500, l:5000}, feats: ["ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø¨Ø­ ğŸ‘»", "ØªØµÙØ­ Ø®ÙÙŠ"] },
            { id: 9, name: "Ù…Ø¤Ø«Ø±", req: {v:500000, s:5000, l:10000}, feats: ["Ø¥Ø·Ø§Ø± Ù…Ù…ÙŠØ² Ù„Ù„ØµÙˆØ±Ø©", "Ø£ÙˆÙ„ÙˆÙŠØ© ÙÙŠ Ø§Ù„Ø¯Ø¹Ù…"] },
            { id: 10, name: "Ø§Ù„Ù†Ø®Ø¨Ø© (Elite)", req: {v:1000000, s:10000, l:20000}, isVerifyLevel: true, feats: ["ğŸ… Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ (Ø§Ù„ØªÙˆØ«ÙŠÙ‚)", "Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª", "Ø¯Ø¹Ù… ÙÙ†ÙŠ VIP"] },
            { id: 11, name: "Ù…Ø­ØªØ±Ù", req: {v:2000000, s:20000, l:30000}, feats: ["Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø·ÙˆÙŠÙ„Ø©", "Ø¬ÙˆØ¯Ø© HD"] },
            { id: 12, name: "ÙÙ†Ø§Ù†", req: {v:3000000, s:30000, l:40000}, feats: ["ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª", "Ø«ÙŠÙ…Ø§Øª Ø®Ø§ØµØ©"] },
            { id: 13, name: "Ù‚Ø§Ø¦Ø¯", req: {v:4000000, s:40000, l:50000}, feats: ["Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª", "Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰"] },
            { id: 14, name: "VIP", req: {v:5000000, s:50000, l:60000}, feats: ["Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ", "Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª"] },
            { id: 15, name: "Ù…Ù„ÙŠÙˆÙ†ÙŠØ±", req: {v:7000000, s:60000, l:80000}, feats: ["Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§", "Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Øª"] },
            { id: 16, name: "Ø²Ø¹ÙŠÙ…", req: {v:9000000, s:70000, l:100000}, feats: ["Ø´Ø§Ø±Ø© Ø§Ù„Ø²Ø¹ÙŠÙ…", "Ù†Ø´Ø± Ø±ÙˆØ§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠØ©"] },
            { id: 17, name: "Ø³ÙÙŠØ±", req: {v:12000000, s:80000, l:150000}, feats: ["ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±", "ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª"] },
            { id: 18, name: "Ø£Ø³Ø·ÙˆØ±Ø©", req: {v:15000000, s:90000, l:200000}, feats: ["Ù…Ø³Ø§Ø­Ø© ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©", "ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª 4K"] },
            { id: 19, name: "Ø­Ø§ÙƒÙ…", req: {v:18000000, s:100000, l:300000}, feats: ["Ù…Ø¯ÙŠØ± Ø£Ø¹Ù…Ø§Ù„", "Ø­Ù…Ø§ÙŠØ© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©"] },
            { id: 20, name: "GOD MODE", req: {v:20000000, s:150000, l:500000}, feats: ["ğŸ‘‘ Ø´Ø±ÙŠÙƒ Ø±Ø³Ù…ÙŠ", "Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­", "Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ±ÙŠÙ†Ø¯"] }
        ];

        const BADGES_LIST = [
            { lvl: 1, name: "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø­Ù„Ø©", icon: "fa-shoe-prints", tier: "tier-bronze" },
            { lvl: 2, name: "Ù…Ø³ØªÙƒØ´Ù", icon: "fa-compass", tier: "tier-bronze" },
            { lvl: 3, name: "Ù…Ø¯ÙˆÙ†", icon: "fa-pen-nib", tier: "tier-bronze" },
            { lvl: 4, name: "Ù…ØµÙˆØ±", icon: "fa-camera", tier: "tier-bronze" },
            { lvl: 5, name: "ØµØ§Ù†Ø¹ Ù…Ø­ØªÙˆÙ‰", icon: "fa-video", tier: "tier-bronze" },
            { lvl: 6, name: "Ù†Ø§Ø´Ø·", icon: "fa-bolt", tier: "tier-silver" },
            { lvl: 7, name: "Ù†Ø¬Ù… ØµØ§Ø¹Ø¯", icon: "fa-star-half-stroke", tier: "tier-silver" },
            { lvl: 8, name: "Ø§Ù„Ø´Ø¨Ø­", icon: "fa-ghost", tier: "tier-silver" },
            { lvl: 9, name: "Ù…Ø¤Ø«Ø±", icon: "fa-bullhorn", tier: "tier-silver" },
            { lvl: 10, name: "Ø§Ù„Ù†Ø®Ø¨Ø© (Elite)", icon: "fa-certificate", tier: "tier-silver" },
            { lvl: 11, name: "Ù…Ø­ØªØ±Ù", icon: "fa-briefcase", tier: "tier-gold" },
            { lvl: 12, name: "ÙÙ†Ø§Ù†", icon: "fa-palette", tier: "tier-gold" },
            { lvl: 13, name: "Ù‚Ø§Ø¦Ø¯", icon: "fa-users-gear", tier: "tier-gold" },
            { lvl: 14, name: "VIP", icon: "fa-crown", tier: "tier-gold" },
            { lvl: 15, name: "Ù…Ù„ÙŠÙˆÙ†ÙŠØ±", icon: "fa-sack-dollar", tier: "tier-gold" },
            { lvl: 16, name: "Ø§Ù„Ø²Ø¹ÙŠÙ…", icon: "fa-chess-king", tier: "tier-diamond" },
            { lvl: 17, name: "Ø³ÙÙŠØ±", icon: "fa-globe", tier: "tier-diamond" },
            { lvl: 18, name: "Ø£Ø³Ø·ÙˆØ±Ø©", icon: "fa-dragon", tier: "tier-diamond" },
            { lvl: 19, name: "Ø§Ù„Ø­Ø§ÙƒÙ…", icon: "fa-scale-balanced", tier: "tier-diamond" },
            { lvl: 20, name: "GOD MODE", icon: "fa-hand-holding-medical", tier: "tier-mythical" }
        ];

        // --- Auth Listener ---
        auth.onAuthStateChanged(user => {
            if(user) {
                loadAllUserStats(user.uid);
            } else {
                location.href = "index.html";
            }
        });

        // --- Main Data Loading Function ---
        async function loadAllUserStats(uid) {
            try {
                // 1. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userDoc = await db.collection('users').doc(uid).get();
                const userData = userDoc.data() || {};

                // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ† (Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ)
                let realSubs = userData.followersCount || 0;
                if(realSubs === 0) {
                    const subsSnap = await db.collection('users').doc(uid).collection('followers').get();
                    realSubs = subsSnap.size;
                }

                // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø±
                let createdAt = userData.createdAt ? userData.createdAt.toDate() : new Date();
                let now = new Date();
                let diffTime = Math.abs(now - createdAt);
                let accountDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                // 4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª ÙˆØ§Ù„Ù„Ø§ÙŠÙƒØ§Øª
                const postsSnap = await db.collection('posts').where('uid', '==', uid).get();
                let totalViews = 0;
                let totalLikes = 0;

                postsSnap.forEach(doc => {
                    const p = doc.data();
                    totalViews += (p.views || 0);
                    if (p.likes) totalLikes += Object.keys(p.likes).length;
                });

                // --- ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ---
                updateVerificationUI(totalViews, realSubs, totalLikes, accountDays);

                // --- ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ---
                updateLevelsUI(totalViews, realSubs, totalLikes, userData.isVerified);

                // --- Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ±Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø§Øª ---
                let currentLevel = 0;
                LEVELS.forEach(lvl => {
                    if (totalViews >= lvl.req.v && realSubs >= lvl.req.s && totalLikes >= lvl.req.l) {
                        currentLevel = lvl.id;
                    }
                });
                renderBadgesGallery(currentLevel);

                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ¯Ø±
                document.getElementById('pageLoader').classList.add('hide');

            } catch (e) {
                console.error(e);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            }
        }

        // --- UI Logic: Tabs ---
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`view-${tabId}`).classList.add('active');
            
            if(tabId === 'verification') document.getElementById('tab-v').classList.add('active');
            else if(tabId === 'levels') document.getElementById('tab-l').classList.add('active');
            else if(tabId === 'badges') document.getElementById('tab-b').classList.add('active');
        }

        // --- UI Logic: Verification ---
        function updateVerificationUI(views, subs, likes, days) {
            updateCard('views', views, TARGETS.VIEWS);
            updateCard('subs', subs, TARGETS.SUBS);
            updateCard('likes', likes, TARGETS.LIKES);
            updateCard('age', days, TARGETS.DAYS);

            const btn = document.getElementById('applyBtn');
            if (views >= TARGETS.VIEWS && subs >= TARGETS.SUBS && likes >= TARGETS.LIKES && days >= TARGETS.DAYS) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fa-solid fa-check-circle"></i> ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¢Ù†';
                btn.onclick = submitEliteRequest;
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="fa-solid fa-lock"></i> Ø§Ù„Ø´Ø±ÙˆØ· ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©';
                btn.onclick = null;
            }
        }

        function updateCard(id, current, target) {
            const perc = Math.min(100, (current / target) * 100);
            document.getElementById(`bar-${id}`).style.width = `${perc}%`;
            document.getElementById(`perc-${id}`).innerText = `${perc.toFixed(1)}%`;
            document.getElementById(`txt-${id}`).innerText = formatNumber(current);
        }

        // --- UI Logic: Levels ---
        function updateLevelsUI(v, s, l, alreadyVerified) {
            document.getElementById('lvl-views').innerText = formatNumber(v);
            document.getElementById('lvl-subs').innerText = formatNumber(s);
            document.getElementById('lvl-likes').innerText = formatNumber(l);

            const container = document.getElementById('levelsContainer');
            container.innerHTML = "";
            let nextLevelReq = null;

            LEVELS.forEach((lvl, idx) => {
                const isUnlocked = (v >= lvl.req.v && s >= lvl.req.s && l >= lvl.req.l);
                if (!isUnlocked && !nextLevelReq) nextLevelReq = lvl.req;

                let cardClass = `lvl-card ${isUnlocked ? 'active' : ''} ${lvl.isVerifyLevel ? 'elite' : ''}`;
                
                let btnHtml = "";
                if (lvl.isVerifyLevel && isUnlocked && !alreadyVerified) {
                    btnHtml = `<button class="verify-btn-lvl" onclick="requestLevelVerification()"><i class="fa-solid fa-paper-plane"></i> ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</button>`;
                } else if (lvl.isVerifyLevel && alreadyVerified) {
                    btnHtml = `<div style="text-align:center; color:var(--success); margin-top:10px; font-weight:bold; background:rgba(16, 185, 129, 0.1); padding:10px; border-radius:10px;"><i class="fa-solid fa-check-double"></i> ØªÙ… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­</div>`;
                }

                let featsHtml = lvl.feats.map(f => `<li><i class="fa-solid fa-star"></i> ${f}</li>`).join('');

                container.innerHTML += `
                <div class="${cardClass}">
                    ${!isUnlocked ? `<div class="lock-screen"><i class="fa-solid fa-lock" style="font-size:24px; color:#aaa; margin-bottom:5px"></i><span style="font-size:12px; color:#aaa">Ù…ØºÙ„Ù‚</span></div>` : ''}
                    
                    <div class="lvl-header">
                        <div class="lvl-info">
                            <div class="lvl-badge">${lvl.id}</div>
                            <div class="lvl-name">${lvl.name}</div>
                        </div>
                        ${isUnlocked ? '<i class="fa-solid fa-unlock" style="color:var(--success)"></i>' : ''}
                    </div>

                    <div class="lvl-body">
                        <ul class="features">${featsHtml}</ul>
                        ${btnHtml}
                        <div class="req-text-lvl">
                            <div class="req-item-lvl"><i class="fa-solid fa-eye" style="color:var(--primary)"></i> ${formatNumber(lvl.req.v)}</div>
                            <div class="req-item-lvl"><i class="fa-solid fa-users" style="color:var(--success)"></i> ${formatNumber(lvl.req.s)}</div>
                            <div class="req-item-lvl"><i class="fa-solid fa-heart" style="color:var(--danger)"></i> ${formatNumber(lvl.req.l)}</div>
                        </div>
                    </div>
                </div>`;
            });

            if (nextLevelReq) {
                const vP = Math.min(100, (v / nextLevelReq.v) * 100);
                const sP = Math.min(100, (s / nextLevelReq.s) * 100);
                const lP = Math.min(100, (l / nextLevelReq.l) * 100);
                const avg = (vP + sP + lP) / 3;
                document.getElementById('xpBar').style.width = `${avg}%`;
                document.getElementById('xpPercentage').innerText = `${avg.toFixed(1)}%`;
            } else {
                document.getElementById('xpBar').style.width = `100%`;
                document.getElementById('xpPercentage').innerText = `MAX`;
            }
        }

        // --- UI Logic: Badges (Corrected) ---
        function renderBadgesGallery(userLevel) {
            const container = document.getElementById('badgesContainer');
            if(!container) return;
            
            container.innerHTML = "";
            
            BADGES_LIST.forEach(b => {
                const isUnlocked = userLevel >= b.lvl;
                
                let html = `
                <div class="badge-item ${b.tier} ${isUnlocked ? 'unlocked' : ''}">
                    <div class="badge-icon-box">
                        <i class="fa-solid ${isUnlocked ? b.icon : 'fa-lock'}"></i>
                    </div>
                    <div class="badge-name">${b.name}</div>
                    <div class="badge-lvl">LVL ${b.lvl}</div>
                </div>`;
                
                container.innerHTML += html;
            });
        }

        // --- Requests ---
        async function submitEliteRequest() {
            const user = auth.currentUser;
            if(!user) return;
            const existing = await db.collection('verification_requests').doc(user.uid).get();
            if(existing.exists) { alert("Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø§Ù„ÙØ¹Ù„!"); return; }

            if(confirm("ØªØ£ÙƒÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ØŸ")) {
                const btn = document.getElementById('applyBtn');
                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ...';
                
                const uData = await db.collection('users').doc(user.uid).get();
                await db.collection('verification_requests').doc(user.uid).set({
                    uid: user.uid,
                    name: uData.data().name,
                    email: uData.data().email,
                    photoURL: uData.data().profilePic || "",
                    type: "ELITE_FULL_CRITERIA",
                    stats: {
                        views: document.getElementById('txt-views').innerText,
                        followers: document.getElementById('txt-subs').innerText,
                        likes: document.getElementById('txt-likes').innerText,
                        age: document.getElementById('txt-age').innerText
                    },
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                btn.innerHTML = '<i class="fa-solid fa-check"></i> ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
                btn.style.background = "#10b981";
                alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            }
        }

        async function requestLevelVerification() {
            const user = auth.currentUser;
            if(!user) return;
            const existing = await db.collection('verification_requests').doc(user.uid).get();
            if(existing.exists) { alert("Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ â³"); return; }

            if(confirm("Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ (Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø®Ø¨Ø©)ØŸ")) {
                const uData = await db.collection('users').doc(user.uid).get();
                await db.collection('verification_requests').doc(user.uid).set({
                    uid: user.uid,
                    name: uData.data().name,
                    email: uData.data().email,
                    photoURL: uData.data().profilePic || "",
                    type: "LEVEL_10_ELITE",
                    stats: {
                        views: document.getElementById('lvl-views').innerText,
                        subs: document.getElementById('lvl-subs').innerText,
                        likes: document.getElementById('lvl-likes').innerText
                    },
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰");
                location.reload();
            }
        }

        // --- Helpers ---
        function formatNumber(num) {
            if(!num) return '0';
            if(num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if(num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num.toString();
        }
    </script>
</body>
</html>
